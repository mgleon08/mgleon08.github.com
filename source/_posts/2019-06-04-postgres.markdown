
---
layout: post
title: "Postgres"
date: 2019-06-04 18:56:17 +0800
comments: true
categories: postgres
---

<!-- more -->

## install 

```sql
brew install postgresql
```

## Initdb

```sql
initdb /usr/local/var/postgres -E utf8
```

## Connect postgresql

```sql
psql
```

## Create DB

```sql
createdb <dbname>
```

or

```sql
-- into postgres
psql
-- show all database
/l 
-- create database
CREATE DATABASE dbname;
```

## Connect to database

```sql
psql <dbname>
```

or

```sql
psql
\l
\c <dbname>
```

## Show

```sql
\l -- List databases
\dt *.* -- List tables from all schemas
\dt -- List current path tables
\dn -- List Schema
\di -- List Index
\dt+ -- List Table
\d+ <tablename> -- List Column
SELECT * FROM <tablename> -- List Record
```

## Dump db

```sql
pg_dump <dbname> <filename>
```

## Import db

```sql
psql <filename> < <dbname>
```

## Connect to a remote database

```sql
psql -h <host> -p <port> -U <username>
```

## Create User

```sql
createuser testuser

-- or

--show users
\du+

CREATE USER <username>;
GRANT ALL PRIVILEGES ON DATABASE <dbname> TO <username>;
GRANT ALL PRIVILEGES ON TABLE <tablename> TO <username>;
-- Allow user1 to set role as user2
GRANT <username2> to <username1>; 
```
 
## other

* [syntax - What does :: do in PostgreSQL? - Stack Overflow](https://stackoverflow.com/questions/15537709/what-does-do-in-postgresql) - A type cast specifies a conversion from one data type to another.

```sql
SELECT * FROM trends WHERE  user_id = ANY('{1, 2, 3}'::text[]) ORDER BY array_position('{1, 2}'::text[], user_id), updated_at DESC, metric_value DESC LIMIT 30
```

## Tool

* [pgcli](https://www.pgcli.com/) - Pgcli is a command line interface for Postgres with auto-completion and syntax highlighting.
* [Postico](https://eggerapps.at/postico/) - GUI client on mac
* [goose](https://github.com/pressly/goose) - Goose database migration tool 
* [postgres-cheatsheet](https://gist.github.com/Kartones/dd3ff5ec5ea238d4c546)
