<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Leon's Blogging]]></title>
  <link href="http://mgleon08.github.com/atom.xml" rel="self"/>
  <link href="http://mgleon08.github.com/"/>
  <updated>2018-08-06T23:07:25+08:00</updated>
  <id>http://mgleon08.github.com/</id>
  <author>
    <name><![CDATA[LeonJi]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Javascript30 - 009. 14 Must Know Dev Tools Tricks]]></title>
    <link href="http://mgleon08.github.com/blog/2018/08/06/javascript30-009-14-must-know-dev-tools-tricks/"/>
    <updated>2018-08-06T23:03:31+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/08/06/javascript30-009-14-must-know-dev-tools-tricks</id>
    <content type="html"><![CDATA[<!-- more -->


<h1><a href="https://mgleon08.github.io/JavaScript30/009.14-Must-Know-Dev-Tools-Tricks/index.html">Demo</a> | <a href="https://github.com/mgleon08/JavaScript30/tree/master/009.14-Must-Know-Dev-Tools-Tricks">Github</a></h1>

<p>14 å€‹ debug æŠ€å·§</p>

<h1>01. Regular</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>02. Interpolated</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello I am a %s string!&#39;</span><span class="p">,</span> <span class="s1">&#39;ğŸ’©&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>03. Styled</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;%c I am some great text&#39;</span><span class="p">,</span> <span class="s1">&#39;font-size:50px background:red text-shadow: 10px 10px 0 blue&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>04. warning!</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;OH NOOO&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>05. Error :|</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Shit!&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>06. Info</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Crocodiles eat 3-4 people per year&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>07. Testing</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s1">&#39;ouch&#39;</span><span class="p">),</span> <span class="s1">&#39;That is wrong!&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>08. clearing</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h1>09. Viewing DOM Elements</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>10. Grouping together</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">dogs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">dog</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">groupCollapsed</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">dog</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">$</span><span class="p">{</span><span class="nx">dog</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">dog</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span> <span class="nx">is</span> <span class="nx">$</span><span class="p">{</span><span class="nx">dog</span><span class="p">.</span><span class="nx">age</span><span class="p">}</span> <span class="nx">years</span> <span class="nx">old</span><span class="err">`</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">dog</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span> <span class="nx">is</span> <span class="nx">$</span><span class="p">{</span><span class="nx">dog</span><span class="p">.</span><span class="nx">age</span> <span class="o">*</span> <span class="mi">7</span><span class="p">}</span> <span class="nx">dog</span> <span class="nx">years</span> <span class="nx">old</span><span class="err">`</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">groupEnd</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">dog</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h1>11. counting</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Wes&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Wes&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Steve&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Steve&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Wes&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Steve&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Wes&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Steve&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Steve&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Steve&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Steve&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="s1">&#39;Steve&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>12. timing</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">time</span><span class="p">(</span><span class="s1">&#39;fetching data&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;https://api.github.com/users/wesbos&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">timeEnd</span><span class="p">(</span><span class="s1">&#39;fetching data&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">dogs</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>13. table</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">dogs</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript30 - 008. Fun With HTML5 Canvas]]></title>
    <link href="http://mgleon08.github.com/blog/2018/08/05/javascript30-008-fun-with-html5-canvas/"/>
    <updated>2018-08-05T17:10:09+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/08/05/javascript30-008-fun-with-html5-canvas</id>
    <content type="html"><![CDATA[<p><img src="https://mgleon08.github.io/JavaScript30/008.Fun-with-HTML5-Canvas/images/thumbnail.png" alt="" /></p>

<!-- more -->


<h1><a href="https://mgleon08.github.io/JavaScript30/008.Fun-with-HTML5-Canvas/index.html">Demo</a> | <a href="https://github.com/mgleon08/JavaScript30/tree/master/008.Fun-with-HTML5-Canvas">Github</a></h1>

<p>é€é HTML çš„canvas æ­é… Javascript åšå‡ºç•«å¸ƒçš„æ•ˆæœã€‚</p>

<blockquote><p>è¦åŠ  ; å¦å‰‡æœƒæœ‰ error</p></blockquote>

<h1>canvas</h1>

<p>é€é <code>canvas.getContext</code> å®šç¾©ç‚º 2d ç¹ªåœ–</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#draw&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">;</span>
</span><span class='line'><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>ctx.strokeStyle</code> è¨­å®šæˆ–è¿”å›ç”¨æ–¼ç­†è§¸çš„é¡è‰²ã€æ¼¸è®Šæˆ–æ¨¡å¼</li>
<li><code>ctx.lineJoin</code> è¨­å®šæˆ–è¿”å›å…©æ¢ç·šç›¸äº¤æ™‚ï¼Œæ‰€å»ºç«‹çš„æ‹è§’é¡å‹</li>
<li><code>ctx.lineCap</code> è¨­å®šæˆ–è¿”å›ç·šæ¢çš„çµæŸç«¯é»æ¨£å¼</li>
<li><code>ctx.lineWidth</code> è¨­å®šæˆ–è¿”å›ç•¶å‰çš„ç·šæ¢å¯¬åº¦</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s1">&#39;#BADA55&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineJoin</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineCap</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>ctx.beginPath()</code> èµ·å§‹ä¸€æ¢è·¯å¾‘ï¼Œæˆ–é‡ç½®ç•¶å‰è·¯å¾‘</li>
<li><code>ctx.moveTo(a,b)</code> æŠŠè·¯å¾‘è¡Œå‹•åˆ°ç•«å¸ƒä¸­çš„æŒ‡å®šé»ï¼Œä¸å»ºç«‹ç·šæ¢</li>
<li><code>ctx.lineTo(a,b)</code> æ–°å¢ä¸€å€‹æ–°é»ï¼Œç„¶å¾Œåœ¨ç•«å¸ƒä¸­å»ºç«‹å¾è©²é»åˆ°æœ€å¾ŒæŒ‡å®šé»çš„ç·šæ¢</li>
<li><code>ctx.stroke()</code> ç¹ªè£½å·²å®šç¾©çš„è·¯å¾‘</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span> <span class="c1">// start from</span>
</span><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">);</span> <span class="c1">// go to</span>
</span><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">offsetX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">offsetY</span><span class="p">);</span>
</span><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
</span><span class='line'><span class="p">[</span><span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">offsetX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">offsetY</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h1>EventListener</h1>

<ul>
<li><code>mousedown</code> æŒ‰ä¸‹æ»‘é¼ </li>
<li><code>mousemove</code> ç§»å‹•æ»‘é¼ </li>
<li><code>mouseup</code>   æ”¾é–‹æ»‘é¼ </li>
<li><code>mouseout</code> æ»‘é¼ ç§»é–‹è¦–çª—</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">isDrawing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="p">[</span><span class="nx">lastX</span><span class="p">,</span> <span class="nx">lastY</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">e</span><span class="p">.</span><span class="nx">offsetX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">offsetY</span><span class="p">];</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="nx">draw</span><span class="p">);</span>
</span><span class='line'><span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseup&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">isDrawing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'><span class="nx">canvas</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;mouseout&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">isDrawing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://developer.mozilla.org/zh-TW/docs/Web/API/Canvas_API/Tutorial/Basic_usage">MDN Canvas åŸºæœ¬ç”¨é€”</a></li>
<li><a href="http://www.w3school.com.cn/tags/html_ref_canvas.asp">HTML 5 Canvas åƒè€ƒæ‰‹å†Š</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript30 - 007. Array Cardio Day 2]]></title>
    <link href="http://mgleon08.github.com/blog/2018/08/04/javascript30-007-array-cardio-day-2/"/>
    <updated>2018-08-04T16:18:27+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/08/04/javascript30-007-array-cardio-day-2</id>
    <content type="html"><![CDATA[<!-- more -->


<h1><a href="https://mgleon08.github.io/JavaScript30/007.Array-Cardio-Day-2/index.html">Demo</a> | <a href="https://github.com/mgleon08/JavaScript30/tree/master/007.Array-Cardio-Day-2">Github</a></h1>

<p>ç·´ç¿’ js çš„ array å„ç¨® methods 2</p>

<h1>some</h1>

<p>check åªè¦æœ‰ä¸€å€‹æˆç«‹å°± return true</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">isAdult</span> <span class="o">=</span> <span class="nx">people</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kr">const</span> <span class="nx">currentYear</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getFullYear</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">currentYear</span> <span class="o">-</span> <span class="nx">person</span><span class="p">.</span><span class="nx">year</span> <span class="o">&gt;=</span> <span class="mi">19</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">isAdult</span> <span class="o">=</span> <span class="nx">people</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">person</span> <span class="o">=&gt;</span> <span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getFullYear</span><span class="p">())</span> <span class="o">-</span> <span class="nx">person</span><span class="p">.</span><span class="nx">year</span> <span class="o">&gt;=</span> <span class="mi">19</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h1>every</h1>

<p>æ¯å€‹éƒ½è¦æˆç«‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">allAdults</span> <span class="o">=</span> <span class="nx">people</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">person</span> <span class="o">=&gt;</span> <span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getFullYear</span><span class="p">())</span> <span class="o">-</span> <span class="nx">person</span><span class="p">.</span><span class="nx">year</span> <span class="o">&gt;=</span> <span class="mi">19</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h1>find</h1>

<p>ç¬¬ä¸€å€‹æˆç«‹çš„å°±å›å‚³</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">comment</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">comment</span> <span class="o">=&gt;</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="mi">823423</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h1>findIndex</h1>

<p>ç¬¬ä¸€å€‹æˆç«‹çš„ index</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">(</span><span class="nx">comment</span> <span class="o">=&gt;</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="mi">823423</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h1>slice</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">newComments</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="p">...</span><span class="nx">comments</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">index</span><span class="p">),</span>
</span><span class='line'>  <span class="p">...</span><span class="nx">comments</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">animals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ant&#39;</span><span class="p">,</span> <span class="s1">&#39;bison&#39;</span><span class="p">,</span> <span class="s1">&#39;camel&#39;</span><span class="p">,</span> <span class="s1">&#39;duck&#39;</span><span class="p">,</span> <span class="s1">&#39;elephant&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">animals</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="c1">// ç¬¬äºŒå€‹åˆ°æœ€å¾Œ</span>
</span><span class='line'><span class="c1">// expected output: Array [&quot;camel&quot;, &quot;duck&quot;, &quot;elephant&quot;]</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">animals</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="c1">// äºŒåˆ°å››(ä¸åŒ…å«å››)</span>
</span><span class='line'><span class="c1">// expected output: Array [&quot;camel&quot;, &quot;duck&quot;]</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">animals</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1">// ä¸€åˆ°äº”(ä¸åŒ…å«äº”)</span>
</span><span class='line'><span class="c1">// expected output: Array [&quot;bison&quot;, &quot;camel&quot;, &quot;duck&quot;, &quot;elephant&quot;]</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">slice</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript30 - 006. Ajax Type Ahead]]></title>
    <link href="http://mgleon08.github.com/blog/2018/08/03/javascript30-006-ajax-type-ahead/"/>
    <updated>2018-08-03T23:57:24+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/08/03/javascript30-006-ajax-type-ahead</id>
    <content type="html"><![CDATA[<p><img src="https://mgleon08.github.io/JavaScript30/006.Ajax-Type-Ahead/images/thumbnail.png" alt="" /></p>

<!-- more -->


<h1><a href="https://mgleon08.github.io/JavaScript30/006.Ajax-Type-Ahead/index.html">Demo</a> | <a href="https://github.com/mgleon08/JavaScript30/tree/master/006.Ajax-Type-Ahead">Github</a></h1>

<p>ç·´ç¿’ ajax</p>

<h1>outline</h1>

<p>ç¹ªè£½æ–¼å…ƒç´ å‘¨åœçš„ä¸€æ¢ç·šï¼Œä½æ–¼é‚Šæ¡†é‚Šç·£çš„å¤–åœï¼Œå¯èµ·åˆ°çªå‡ºå…ƒç´ çš„ä½œç”¨ï¼Œç”¨æ³•è·Ÿ border ä¸€æ¨£</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">p</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">outline</span><span class="o">:</span> <span class="m">#4CAF50</span> <span class="k">solid</span> <span class="m">10px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://www.w3schools.com/css/css_outline.asp">CSS Outline</a></li>
</ul>


<h1>text-transform</h1>

<p>å¯æ”¹è®Šå­—é«”çš„å¤§å°å¯«</p>

<ul>
<li><code>none</code>    No capitalization. The text renders as it is. This is default</li>
<li><code>capitalize</code>  Transforms the first character of each word to uppercase</li>
<li><code>uppercase</code>   Transforms all characters to uppercase</li>
<li><code>lowercase</code>   Transforms all characters to lowercase</li>
<li><code>initial</code> Sets this property to its default value. Read about initial</li>
<li><code>inherit</code> Inherits this property from its parent element. Read about inherit</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">a</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">text-transform</span><span class="o">:</span> <span class="k">uppercase</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://www.w3schools.com/cssref/pr_text_text-transform.asp">CSS text-transform Property</a></li>
</ul>


<h1>nth-child</h1>

<p>å¯ä»¥é‡å°æ¯å€‹å…ƒç´ åšå€‹åˆ¥çš„æ¨£å¼è¨­å®š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/* é‡å°å¶æ•¸ */</span>
</span><span class='line'><span class="nc">.suggestions</span> <span class="nt">li</span><span class="nd">:nth-child</span><span class="o">(</span><span class="nt">even</span><span class="o">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">transform</span><span class="o">:</span> <span class="n">perspective</span><span class="p">(</span><span class="m">100px</span><span class="p">)</span> <span class="n">rotateX</span><span class="p">(</span><span class="m">3</span><span class="n">deg</span><span class="p">)</span> <span class="n">translateY</span><span class="p">(</span><span class="m">2px</span><span class="p">)</span> <span class="n">scale</span><span class="p">(</span><span class="m">1</span><span class="o">.</span><span class="m">001</span><span class="p">);</span>
</span><span class='line'>  <span class="k">background</span><span class="o">:</span> <span class="n">linear</span><span class="o">-</span><span class="n">gradient</span><span class="p">(</span><span class="n">to</span> <span class="k">bottom</span><span class="o">,</span>  <span class="m">#ffffff</span> <span class="m">0%</span><span class="o">,</span><span class="m">#EFEFEF</span> <span class="m">100%</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c">/* é‡å°å¥‡æ•¸ */</span>
</span><span class='line'><span class="nc">.suggestions</span> <span class="nt">li</span><span class="nd">:nth-child</span><span class="o">(</span><span class="nt">odd</span><span class="o">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">transform</span><span class="o">:</span> <span class="n">perspective</span><span class="p">(</span><span class="m">100px</span><span class="p">)</span> <span class="n">rotateX</span><span class="p">(</span><span class="m">-3</span><span class="n">deg</span><span class="p">)</span> <span class="n">translateY</span><span class="p">(</span><span class="m">3px</span><span class="p">);</span>
</span><span class='line'>  <span class="k">background</span><span class="o">:</span> <span class="n">linear</span><span class="o">-</span><span class="n">gradient</span><span class="p">(</span><span class="n">to</span> <span class="k">top</span><span class="o">,</span>  <span class="m">#ffffff</span> <span class="m">0%</span><span class="o">,</span><span class="m">#EFEFEF</span> <span class="m">100%</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://muki.tw/tech/css-nth-child-notice/">ä½¿ç”¨ CSS nth-child å¿…é ˆè¦æ³¨æ„çš„äº‹æƒ…</a></li>
</ul>


<h1>linear-gradient</h1>

<p>é¡è‰²æ¼¸å±¤</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/* æ¼¸è®Šè»¸ç‚º45åº¦ï¼Œå¾è—è‰²æ¼¸è®Šåˆ°ç´…è‰² */</span>
</span><span class='line'><span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">45deg</span><span class="o">,</span> <span class="nt">blue</span><span class="o">,</span> <span class="nt">red</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c">/* å¾å³ä¸‹åˆ°å·¦ä¸Šã€å¾è—è‰²æ¼¸è®Šåˆ°ç´…è‰² */</span>
</span><span class='line'><span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">to</span> <span class="nt">left</span> <span class="nt">top</span><span class="o">,</span> <span class="nt">blue</span><span class="o">,</span> <span class="nt">red</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c">/* å¾ä¸‹åˆ°ä¸Šï¼Œå¾è—è‰²é–‹å§‹æ¼¸è®Šã€åˆ°é«˜åº¦40%ä½ç½®æ˜¯ç¶ è‰²æ¼¸è®Šé–‹å§‹ã€æœ€å¾Œä»¥ç´…è‰²çµæŸ */</span>
</span><span class='line'><span class="nt">linear-gradient</span><span class="o">(</span><span class="nt">0deg</span><span class="o">,</span> <span class="nt">blue</span><span class="o">,</span> <span class="nt">green</span> <span class="nt">40</span><span class="o">%,</span> <span class="nt">red</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/linear-gradient">MDN linear-gradient</a></li>
</ul>


<h1>fetch</h1>

<p>é€é fetch æ‹¿å– endpoint è³‡æ–™</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// fetch æœƒå›å‚³ä¸€å€‹åŒ…å« response çš„ promise </span>
</span><span class='line'><span class="nx">fetch</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">blob</span> <span class="o">=&gt;</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span> <span class="c1">// é€é fetch æ‹¿å– json è³‡æ–™</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="nx">cities</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">data</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://developer.mozilla.org/zh-TW/docs/Web/API/Fetch_API/Using_Fetch">MDN fetch</a></li>
</ul>


<h1>å±•é–‹é‹ç®—å­ &hellip;</h1>

<p>å¯å°‡ array å±•é–‹ä¾†ï¼Œä¹Ÿç®—æ˜¯æ·ºæ‹·è²çš„ä¸€ç¨®</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">fetch</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">)</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">blob</span> <span class="o">=&gt;</span> <span class="nx">blob</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
</span><span class='line'>  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="nx">cities</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">data</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="mi">7</span> <span class="p">]</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">other</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">...</span><span class="nx">params</span> <span class="p">]</span> <span class="c1">// [ 1, 2, &quot;hello&quot;, true, 7 ]</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/rest_spread.html">å±•é–‹é‹ç®—å­èˆ‡å…¶é¤˜é‹ç®—å­</a></li>
</ul>


<h1>RegExp &amp; match</h1>

<ul>
<li><code>RegExp</code> ç”¨ä¾†åšæ­£è¦è¡¨é”å¼</li>
<li><code>match</code> mapping å­—ä¸²</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="kd">function</span> <span class="nx">findMatches</span><span class="p">(</span><span class="nx">wordToMatch</span><span class="p">,</span> <span class="nx">cities</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">cities</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">place</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// here we need to figure out if the city or state matches what was searched</span>
</span><span class='line'>      <span class="c1">// i ä¸åˆ†å¤§å°å¯«ï¼Œg å…¨åŸŸæœå°‹ global search</span>
</span><span class='line'>      <span class="kr">const</span> <span class="nx">regex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">wordToMatch</span><span class="p">,</span> <span class="s1">&#39;gi&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">place</span><span class="p">.</span><span class="nx">city</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">)</span> <span class="o">||</span> <span class="nx">place</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">)</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Guide/Regular_Expressions">MDN Regular_Expressions</a></li>
</ul>


<h1>replace</h1>

<p>å°‡å­—ä¸²æ›¿æ›æ‰</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">regex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="s1">&#39;gi&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c1">// è‹¥æ‰¾åˆ°ç¬¦åˆ this.value e.g. bos å°±æ›¿æ›æˆ &lt;span class=&quot;hl&quot;&gt;bos&lt;/span&gt;</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">cityName</span> <span class="o">=</span> <span class="nx">place</span><span class="p">.</span><span class="nx">city</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regex</span><span class="p">,</span> <span class="err">`</span><span class="o">&lt;</span><span class="nx">span</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;hl&quot;</span><span class="o">&gt;</span><span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/span&gt;`)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">numberWithCommas</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\B(?=(\d{3})+(?!\d))/g</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Guide/Regular_Expressions">MDN Regular_Expressions</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript30 - 005. Flex Panels Image Gallery]]></title>
    <link href="http://mgleon08.github.com/blog/2018/08/02/javascript30-005-flex-panels-image-gallery/"/>
    <updated>2018-08-02T22:44:33+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/08/02/javascript30-005-flex-panels-image-gallery</id>
    <content type="html"><![CDATA[<p><img src="https://mgleon08.github.io/JavaScript30/005.Flex-Panels-Image-Gallery/images/thumbnail.png" alt="" /></p>

<!-- more -->


<h1><a href="https://mgleon08.github.io/JavaScript30/005.Flex-Panels-Image-Gallery/index.html">Demo</a> | <a href="https://github.com/mgleon08/JavaScript30/tree/master/005.Flex-Panels-Image-Gallery">Github</a></h1>

<p>ç·´ç¿’ flex~</p>

<h1>box-sizing</h1>

<p>å…ƒç´ çš„å¯¦éš›å¯¬ã€é«˜åŒ…å«äº†å…§å®¹çš„å¯¬é«˜åŠ ä¸Špadding å’Œ borderé•·åº¦</p>

<ul>
<li><code>content-box</code> - è¨­å®šçš„å¯¬åº¦åƒ…ç‚ºå…§å®¹å¯¬åº¦ï¼Œè€Œå…§è·èˆ‡é‚Šæ¡†é¡å¤–åŠ ä¸Šå»ã€‚</li>
<li><code>border-box</code> - è¨­å®šçš„å¯¬åº¦å°±å·²ç¶“åŒ…å«å…§å®¹å¯¬åº¦ã€å…§è·èˆ‡é‚Šæ¡†å¯¬åº¦ã€‚</li>
<li><code>inherit</code> - ç¹¼æ‰¿è‡³çˆ¶å±¤çš„ broder-sizing è¨­å®šå€¤ã€‚</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">html</span> <span class="p">{</span>
</span><span class='line'> <span class="n">box</span><span class="o">-</span><span class="n">sizing</span><span class="o">:</span> <span class="k">border</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://mandywahahablog.wordpress.com/2015/05/20/css-box-sizing-%E5%B1%AC%E6%80%A7%E7%AD%86%E8%A8%98/">CSS box-sizing å±¬æ€§ç­†è¨˜</a></li>
<li><a href="http://zh-tw.learnlayout.com/box-sizing.html">é—œæ–¼ box-sizing å±¬æ€§</a></li>
<li><a href="http://www.wibibi.com/info.php?tid=CSS3_box-sizing_%E5%B1%AC%E6%80%A7">CSS3 box-sizing å±¬æ€§</a></li>
</ul>


<h1>overflow</h1>

<ul>
<li><code>visible</code> - å…§å®¹ä¸æœƒè¢«ä¿®å‰ªï¼Œç•¶è¶…å‡ºå…ƒç´ çš„ç¯„åœæ™‚å…§å®¹æœƒå‘ˆç¾åœ¨å…ƒç´ æ¡†ä¹‹å¤–ã€‚</li>
<li><code>hidden</code> - å…§å®¹æœƒè¢«ä¿®å‰ªï¼Œä½†ä¸æœƒé¡¯ç¤ºæ²è»¸ï¼Œç•¶è¶…å‡ºå…ƒç´ çš„ç¯„åœæ™‚éš±è—å…§å®¹ã€‚</li>
<li><code>scroll</code> - å…§å®¹æœƒè¢«ä¿®å‰ªï¼Œç•¶è¶…å‡ºç¯„åœæ™‚è‡ªå‹•è®Šæˆæ²è»¸å‘ˆç¾æ–¹å¼ã€‚</li>
<li><code>auto</code> - è‡ªå‹•é¸æ“‡ç”±ç€è¦½å™¨æ±ºå®šå¦‚ä½•é¡¯ç¤º(é è¨­å€¼)ï¼Œç•¶è¶…å‡ºç¯„åœæ™‚è‡ªå‹•è®Šæˆæ²è»¸å‘ˆç¾æ–¹å¼ã€‚</li>
<li><code>inherit</code> - ç¹¼æ‰¿è‡³çˆ¶å±¤çš„ overflow è¨­å®šå€¤ã€‚</li>
<li><code>overflow-x</code> - å¯è¨­å®šã€Œæ°´å¹³ã€æ–¹å‘ï¼Œç•¶è¶…å‡ºç¯„åœæ™‚è‡ªå‹•è®Šæˆæ²è»¸å‘ˆç¾æ–¹å¼ã€‚(éœ€è¦å…§æœ‰å¯¬åº¦å¤§æ–¼å…ƒç´ æ¡†çš„ç‰©ä»¶)</li>
<li><code>overflow-y</code> - å¯è¨­å®šã€Œå‚ç›´ã€æ–¹å‘ï¼Œç•¶è¶…å‡ºç¯„åœæ™‚è‡ªå‹•è®Šæˆæ²è»¸å‘ˆç¾æ–¹å¼ã€‚</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.panels</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">min-height</span><span class="o">:</span><span class="m">100</span><span class="n">vh</span><span class="p">;</span>
</span><span class='line'>  <span class="k">overflow</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://www.eion.com.tw/Blogger/?Pid=1158">CSS overflow å…§å®¹ã€Œæº¢å‡ºé‚Šç•Œã€å€å¡Šå±¤å…ƒç´ </a></li>
</ul>


<h1>transition è½‰å ´</h1>

<p>å¯ä»¥é‡å°å„ç¨®æ•ˆæœåšè½‰å ´ <code>font-size</code> <code>flex</code> <code>background</code> &hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.panel</span> <span class="p">{</span>
</span><span class='line'>  <span class="c">/* Safari transitionend event.propertyName === flex */</span>
</span><span class='line'>  <span class="c">/* Chrome + FF transitionend event.propertyName === flex-grow */</span>
</span><span class='line'>  <span class="n">transition</span><span class="o">:</span>
</span><span class='line'>    <span class="k">font-size</span> <span class="m">0.7s</span> <span class="n">cubic</span><span class="o">-</span><span class="n">bezier</span><span class="p">(</span><span class="m">0</span><span class="o">.</span><span class="m">61</span><span class="o">,-</span><span class="m">0</span><span class="o">.</span><span class="m">19</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">7</span><span class="o">,-</span><span class="m">0</span><span class="o">.</span><span class="m">11</span><span class="p">)</span><span class="o">,</span>
</span><span class='line'>    <span class="n">flex</span> <span class="m">0.7s</span> <span class="n">cubic</span><span class="o">-</span><span class="n">bezier</span><span class="p">(</span><span class="m">0</span><span class="o">.</span><span class="m">61</span><span class="o">,-</span><span class="m">0</span><span class="o">.</span><span class="m">19</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">7</span><span class="o">,-</span><span class="m">0</span><span class="o">.</span><span class="m">11</span><span class="p">)</span><span class="o">,</span>
</span><span class='line'>    <span class="k">background</span> <span class="m">0.2s</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://developer.mozilla.org/zh-TW/docs/Web/CSS/CSS_Transitions/Using_CSS_transitions">CSS è½‰å ´</a></li>
</ul>


<h1>e.propertyName</h1>

<p>é€é <code>e.propertyName</code> çŸ¥é“å“ªå€‹ class åŸ·è¡Œå®Œ <code>transitionend</code> è§¸ç™¼äº† <code>toggleActive</code>ï¼Œå°±å¯ä»¥é‡å°æƒ³è¦åˆ¤æ–·çš„åšè™•ç†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">toggleActive</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">propertyName</span><span class="p">)</span>
</span><span class='line'>  <span class="c1">// å› ç‚ºåœ¨ Safari ç‚º flex, Chrome ç‚º flex-grow å› æ­¤ç”¨ includes</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">propertyName</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;flex&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s1">&#39;open-active&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">panels</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">panel</span> <span class="o">=&gt;</span> <span class="nx">panel</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;transitionend&#39;</span><span class="p">,</span> <span class="nx">toggleActive</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript30 - 004. Array Cardio Day 1]]></title>
    <link href="http://mgleon08.github.com/blog/2018/08/01/javascript30-004-array-cardio-day-1/"/>
    <updated>2018-08-01T22:53:10+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/08/01/javascript30-004-array-cardio-day-1</id>
    <content type="html"><![CDATA[<!-- more -->


<h1><a href="https://mgleon08.github.io/JavaScript30/004.Array-Cardio-Day-1/index.html">Demo</a> | <a href="https://github.com/mgleon08/JavaScript30/tree/master/004.Array-Cardio-Day-1">Github</a></h1>

<p>ç·´ç¿’ js çš„ array å„ç¨® methods</p>

<h1>console.table</h1>

<p>åœ¨ console å°‡ data ä»¥ table çš„å½¢å¼å‘ˆç¾</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">table</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>filter</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">fifteen</span> <span class="o">=</span> <span class="nx">inventors</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">inventor</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">inventor</span><span class="p">.</span><span class="nx">year</span> <span class="o">&gt;=</span> <span class="mi">1500</span> <span class="o">&amp;&amp;</span> <span class="nx">inventor</span><span class="p">.</span><span class="nx">year</span> <span class="o">&lt;=</span> <span class="mi">1600</span><span class="p">){</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">fifteen</span> <span class="o">=</span> <span class="nx">inventors</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">inventor</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">inventor</span><span class="p">.</span><span class="nx">year</span> <span class="o">&gt;=</span> <span class="mi">1500</span> <span class="o">&amp;&amp;</span> <span class="nx">inventor</span><span class="p">.</span><span class="nx">year</span> <span class="o">&lt;=</span> <span class="mi">1600</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h1>map</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">fullname</span> <span class="o">=</span> <span class="nx">inventors</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">inventor</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">inventor</span><span class="p">.</span><span class="nx">first</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">inventor</span><span class="p">.</span><span class="nx">last</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">fullname</span> <span class="o">=</span> <span class="nx">inventors</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">inventor</span> <span class="o">=&gt;</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">inventor</span><span class="p">.</span><span class="nx">first</span><span class="p">}</span> <span class="nx">$</span><span class="p">{</span><span class="nx">inventor</span><span class="p">.</span><span class="nx">last</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>sort</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">ordered</span> <span class="o">=</span> <span class="nx">inventors</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">year</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">year</span><span class="p">){</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">ordered</span> <span class="o">=</span> <span class="nx">inventors</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">year</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">year</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>reduce</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">totalYears</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">inventors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">totalYears</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">inventors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">passed</span> <span class="o">-</span> <span class="nx">inventors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">year</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">totalYears</span> <span class="o">=</span> <span class="nx">inventors</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">total</span><span class="p">,</span> <span class="nx">inventor</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">total</span> <span class="o">+</span> <span class="p">(</span><span class="nx">inventor</span><span class="p">.</span><span class="nx">passed</span> <span class="o">-</span> <span class="nx">inventor</span><span class="p">.</span><span class="nx">year</span><span class="p">)</span>
</span><span class='line'><span class="p">},</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>combo</h1>

<p><a href="https://en.wikipedia.org/wiki/Category:Boulevards_in_Paris">https://en.wikipedia.org/wiki/Category:Boulevards_in_Paris</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">category</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.mw-category&#39;</span><span class="p">)</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">links</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">category</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">de</span> <span class="o">=</span> <span class="nx">links</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">link</span> <span class="o">=&gt;</span> <span class="nx">link</span><span class="p">.</span><span class="nx">textContent</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">streetName</span> <span class="o">=&gt;</span> <span class="nx">streetName</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">links</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">category</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)]</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>category.querySelectorAll æœƒæ˜¯ NodeList å› æ­¤è¦ç”¨ <code>Array.from</code> or <code>[...]</code> è½‰æˆ array æ‰èƒ½å¤ ä½¿ç”¨ map</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript30 - 003. Playing With CSS Variables and JS]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/31/javascript30-003-playing-with-css-variables-and-js/"/>
    <updated>2018-07-31T22:31:16+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/31/javascript30-003-playing-with-css-variables-and-js</id>
    <content type="html"><![CDATA[<p><img src="https://mgleon08.github.io/JavaScript30/003.Playing-with-CSS-Variables-and-JS/images/thumbnail.png" alt="" /></p>




<!-- more -->




<h1 id="demohttpsmgleon08githubiojavascript30003playingwithcssvariablesandjsindexhtmlgithubhttpsgithubcommgleon08javascript30treemaster003playingwithcssvariablesandjs"><a href="https://mgleon08.github.io/JavaScript30/003.Playing-with-CSS-Variables-and-JS/index.html">Demo</a> | <a href="https://github.com/mgleon08/JavaScript30/tree/master/003.Playing-with-CSS-Variables-and-JS">Github</a></h1>




<p>åˆ©ç”¨ js ä¾†æ›´æ–° css çš„æ•ˆæœ!</p>




<h1 id="rangeinput">range input</h1>




<ul>
<li><code>data-sizing</code>: è‡ªè¡Œæ–°å¢å±¬æ€§ï¼Œç”¨ä¾†åˆ¤æ–· size çš„å–®ä½</li>
</ul>




<pre><code class="html language-html">&lt;label for="spacing"&gt;Spacing:&lt;/label&gt;
&lt;input type="range" name="spacing" min="10" max="200" value="10" data-sizing="px"&gt;
</code></pre>




<h1 id="dataset">dataset</h1>




<p>é€é js æŠ“å– <code>this.dataset</code>ï¼Œå°±å¯ä»¥æ‹¿åˆ°è‡ªè¡Œæ–°å¢å±¬æ€§çš„å€¼ï¼Œå›å‚³ä¸€å€‹ object å›ä¾†ï¼Œå¯ä»¥å¤šå€‹</p>




<pre><code class="js language-js">function handleUpdate() {
  this.dataset
}
</code></pre>




<p>ä¹Ÿå¯ä»¥ç”¨ getAttribute</p>




<pre><code class="js language-js">function handleUpdate(){
  this.getAttribute('data-sizing')
}
</code></pre>




<h1 id="colorinput">color input</h1>




<p>åœ¨ browser ä¸Šç”¢ç”Ÿï¼Œcolor é¸æ“‡å™¨</p>




<pre><code class="html language-html">&lt;!-- value ä¸€é–‹å§‹é è¨­çš„å€¼ --&gt;
&lt;label for="base"&gt;Base Color&lt;/label&gt;
&lt;input type="color" name="base" value="#ffc600"&gt;
</code></pre>




<h1 id="root">:root</h1>




<p>css åŸç”Ÿè®Šæ•¸å®šç¾©</p>




<pre><code class="css language-css">:root {
/* å®šç¾©è®Šæ•¸çš„æ–¹æ³• */
  --base: #ffc600;
  --spacing: 10px;
  --blur: 10px;
}

img {
/* è®Šæ•¸çš„ä½¿ç”¨æ–¹å¼ */
  padding: var(--spacing);
}
</code></pre>




<ul>
<li><a href="http://muki.tw/tech/native-css-variables/">SASS, LESS é€€æ•£ï¼ŒåŸç”Ÿ CSS å¯ä»¥ä½¿ç”¨è®Šæ•¸å•¦ï¼</a></li>
</ul>




<h1 id="filter">filter</h1>




<p>css çš„æ¿¾é¡æ•ˆæœ</p>




<pre><code class="css language-css">img {
  filter: blur(10px); /* blur æ¨¡ç³Š */
}
</code></pre>




<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter">MDN filter</a></li>
</ul>




<h1 id="queryselectorall">querySelectorAll</h1>




<p>å¯æŠ“å–ç¯€é»ä¸Šçš„ domï¼Œä¸¦ä¸”å›å‚³å€¼æœƒæ˜¯ <code>NodeList</code> ä¸æ˜¯ <code>array</code></p>




<blockquote>
  <p>NodeList ä¸æ˜¯ Arrayï¼Œä½†ä»å¯ä»¥ä½¿ç”¨ forEach() æ–¹æ³•ä¾†é€²è¡Œè¿­ä»£ï¼Œä½†æœ‰äº›é‚„æ˜¯åªæœ‰ Array æ‰æœƒæœ‰</p>
</blockquote>




<pre><code class="js language-js">document.querySelectorAll('.controls input')
</code></pre>




<ul>
<li><a href="https://developer.mozilla.org/zh-TW/docs/Web/API/NodeList">MDN NodeList</a></li>

<li><a href="http://www.jstips.co/zh_tw/javascript/converting-a-node-list-to-an-array/">å°‡ Node List è½‰æ›æˆé™£åˆ—</a></li>
</ul>




<h1 id="setproperty">setProperty</h1>




<p>æ›´æ”¹å±¬æ€§</p>




<pre><code class="js language-js">function handleUpdate() {
  const suffix = this.dataset.sizing || '';
  // æ›´æ”¹ style çš„å±¬æ€§ï¼Œ
  document.documentElement.style.setProperty(`--${this.name}`, this.value + suffix)
}
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript30 - 002. CSS + JS Clock]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/30/javascript30-002-css-js-clock/"/>
    <updated>2018-07-30T23:10:35+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/30/javascript30-002-css-js-clock</id>
    <content type="html"><![CDATA[<p><img src="https://mgleon08.github.io/JavaScript30/002.CSS+JS-Clock/images/thumbnail.png" alt="" /></p>

<!-- more -->


<h1><a href="https://mgleon08.github.io/JavaScript30/002.CSS+JS-Clock/index.html">Demo</a> | <a href="https://github.com/mgleon08/JavaScript30/tree/master/002.CSS%2BJS-Clock">Github</a></h1>

<p>åˆ©ç”¨ js + css æ•ˆæœåšå‡ºæ™‚é˜</p>

<h1>translateY</h1>

<p>y è»¸æ–¹å‘çš„è·é›¢ (translateX, translateZ, translate3d..s)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.clock-face</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
</span><span class='line'>  <span class="n">transform</span><span class="o">:</span> <span class="n">translateY</span><span class="p">(</span><span class="m">-3px</span><span class="p">);</span> <span class="c">/* account for the height of the clock hands */</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/translateY">MDN translateY()</a></li>
<li><a href="http://webkkl.com/style/translate.php">transform:translate()ï¼ˆå…ƒç´ çš„è¡¨ç¤ºä½ç½®é€²è¡Œå¹³ç§»ï¼‰</a></li>
</ul>


<h1>transform-origin</h1>

<p>æ—‹è½‰å…ƒç´ çš„åŸºé»ä½ç½®(default: 50%)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.hand</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">transform</span><span class="o">-</span><span class="n">origin</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span> <span class="c">/* 100% æœ€å³é‚Š */</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://wcc723.github.io/css/2013/10/10/css-transform-origin/">CSSæ²’æœ‰æ¥µé™ - CSS transform-origin</a></li>
</ul>


<h1>transition-timing-function</h1>

<blockquote><p>åšå‡ºæ™‚é˜é “é»çš„æ•ˆæœ</p></blockquote>

<p>æ•¸ç‡æ›²ç·š</p>

<ul>
<li>easeï¼š<code>cubic-bezier(0.25, 0.1, 0.25, 1)</code></li>
<li>ease-in: <code>cubic-bezier(0.42, 0,1, 1)</code></li>
<li>ease-out: <code>cubic-bezier(0, 0, 0.58, 1)</code></li>
<li>ease-in-out: <code>cubic-bezier(0.42, 0, 0.58, 1)</code></li>
<li>linear: <code>cubic-bezier(0, 0, 1, 1)</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.hand</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">transition</span><span class="o">-</span><span class="n">timing</span><span class="o">-</span><span class="n">function</span><span class="o">:</span> <span class="n">cubic</span><span class="o">-</span><span class="n">bezier</span><span class="p">(</span><span class="m">0</span><span class="o">.</span><span class="m">1</span><span class="o">,</span> <span class="m">2</span><span class="o">.</span><span class="m">7</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">58</span><span class="o">,</span> <span class="m">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://wcc723.github.io/css/2013/08/24/css-transtion-speed/">CSS transition å„ç¨®é€Ÿç‡</a></li>
<li><a href="http://devdocs.io/css/timing-function#The_cubic-bezier(">timing-functions</a>_class_of_timing-functions)</li>
<li><a href="https://segmentfault.com/a/1190000004618375">å¯¦ç”¨çš„ CSS â€” è²å¡çˆ¾æ›²ç·š(cubic-bezier)</a></li>
</ul>


<h1>setInterval</h1>

<p>å®šæ™‚å™¨ï¼Œå¯ä»¥è¨­å®šå¤šä¹…å°±åŸ·è¡ŒæŒ‡å®šçš„å‹•ä½œ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// setInterval(function, ms time)</span>
</span><span class='line'><span class="nx">setInterval</span><span class="p">(</span><span class="nx">setDate</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://blog.camel2243.com/2016/08/06/javascript-%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3-settimeout-%E8%88%87-setinterval-%E7%9A%84%E4%B8%8D%E5%90%8C%E4%B9%8B%E8%99%95/">[javascript] æ·±å…¥ç­è§£ setTimeout() èˆ‡ setInterval() çš„ä¸åŒä¹‹è™•</a></li>
</ul>


<h1>Date Time</h1>

<p>é€é js æ™‚é–“å‡½ç¤ºï¼Œæ‹¿åˆ°æ™‚, åˆ†, ç§’ï¼Œåœ¨è½‰æ›æˆåº¦æ•¸ï¼Œå‘ˆç¾åœ¨ <code>rotate(${åº¦æ•¸}deg)</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kr">const</span> <span class="nx">now</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">hours</span> <span class="o">=</span> <span class="nx">now</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">mins</span> <span class="o">=</span> <span class="nx">now</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">secs</span> <span class="o">=</span> <span class="nx">now</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Javascript30 - 001. JavaScript Drum Kit]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/29/javascript30-001-javascript-drum-kit/"/>
    <updated>2018-07-29T21:49:28+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/29/javascript30-001-javascript-drum-kit</id>
    <content type="html"><![CDATA[<p><img src="https://mgleon08.github.io/JavaScript30/001.JavaScript-Drum-Kit/images/thumbnail.png" alt="" /></p>

<!-- more -->


<h1><a href="https://mgleon08.github.io/JavaScript30/001.JavaScript-Drum-Kit/index.html">Demo</a> | <a href="https://github.com/mgleon08/JavaScript30/tree/master/001.JavaScript-Drum-Kit">GitHub</a></h1>

<p>åˆ©ç”¨ js ç›£è½éµç›¤ eventï¼Œä½¿å…¶ç™¼å‡ºå°æ‡‰çš„éŸ³æ•ˆ</p>

<h1>window.addEventListener</h1>

<p>ç›£è½ event</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// åœ¨å…¨å±€ç›£è½ keydown å‹•ä½œï¼Œä¸¦åŸ·è¡Œ playSound function</span>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="nx">playSound</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// åœ¨æ‰€æœ‰ key éƒ½åŠ ä¸Šç›£è½ transitionend (CSS Transition Events) ç‰¹æ•ˆï¼Œç‰¹æ•ˆçµæŸå¾Œå°±åŸ·è¡Œ removeTransition function</span>
</span><span class='line'><span class="nx">keys</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">key</span> <span class="o">=&gt;</span> <span class="nx">key</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;transitionend&#39;</span><span class="p">,</span> <span class="nx">removeTransition</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">ç›¸ç•¶æ–¼</span>
</span><span class='line'><span class="cm">keys.forEach(function (key) {</span>
</span><span class='line'><span class="cm">  return key.addEventListener(&#39;transitionend&#39;, removeTransition);</span>
</span><span class='line'><span class="cm">});</span>
</span><span class='line'><span class="cm">*/</span>
</span></code></pre></td></tr></table></div></figure>


<h1>data-key</h1>

<p>html å¯ä»¥è‡ªè¡Œå®šç¾©ä¸€å€‹å±¬æ€§ç‚º <code>data-* attribute</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;key&quot;</span> <span class="na">data-key=</span><span class="s">&quot;65&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;kbd&gt;</span>A<span class="nt">&lt;/kbd&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;sound&quot;</span><span class="nt">&gt;</span>clap<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;audio</span> <span class="na">data-key=</span><span class="s">&quot;65&quot;</span> <span class="na">src=</span><span class="s">&quot;../sounds/clap.wav&quot;</span><span class="nt">&gt;&lt;/audio&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// é€é e.keyCode æ‹¿åˆ°å°æ‡‰çš„ data-key</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="err">`</span><span class="p">.</span><span class="nx">key</span><span class="p">[</span><span class="nx">data</span><span class="o">-</span><span class="nx">key</span><span class="o">=</span><span class="s2">&quot;${e.keyCode}&quot;</span><span class="p">]</span><span class="err">`</span><span class="p">)</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">audio</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="err">`</span><span class="nx">audio</span><span class="p">[</span><span class="nx">data</span><span class="o">-</span><span class="nx">key</span><span class="o">=</span><span class="s2">&quot;${e.keyCode}&quot;</span><span class="p">]</span><span class="err">`</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://pjchender.blogspot.com/2017/01/html-5-data-attribute.html">[æŠ€è¡“åˆ†äº«] ä»€éº¼æ˜¯ HTML 5 ä¸­çš„è³‡æ–™å±¬æ€§ï¼ˆdata-* attributeï¼‰</a></li>
</ul>


<h1>classList</h1>

<p>åœ¨æ—¢æœ‰çš„ class ä¸Šé¢ï¼Œæ–°å¢æˆ–åˆªé™¤ class</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="nx">key</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;playing&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">this</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;playing&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>audio</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;audio</span> <span class="na">data-key=</span><span class="s">&quot;65&quot;</span> <span class="na">src=</span><span class="s">&quot;../sounds/clap.wav&quot;</span><span class="nt">&gt;&lt;/audio&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// è¨­å®šæ™‚é–“</span>
</span><span class='line'><span class="nx">audio</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="c1">// é–‹å§‹æ’­æ”¾</span>
</span><span class='line'><span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h1>vh</h1>

<p>vh, vw å¯è¦–ç¯„åœï¼Œå¯éš¨è‘—è¢å¹•çš„é•·å¯¬å»åšè®ŠåŒ–</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.keys</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">min-height</span><span class="o">:</span> <span class="m">100</span><span class="n">vh</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://pjchender.blogspot.com/2015/04/css-3vh-vw.html">[ç­†è¨˜] å¥½ç”¨çš„css 3æ–°å–®ä½vh vw â”€ è®“ä½ çš„åœ–ç‰‡å¯ä»¥éš¨è‘—è¢å¹•å¤§å°è€Œä¸åŒ</a></li>
</ul>


<h1>shadow</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.key</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">text-shadow</span><span class="o">:</span> <span class="m">0px</span> <span class="m">0px</span> <span class="m">15px</span> <span class="k">rgb</span><span class="p">(</span><span class="m">255</span><span class="o">,</span> <span class="m">251</span><span class="o">,</span> <span class="m">40</span><span class="p">);</span>
</span><span class='line'>  <span class="c">/* </span>
</span><span class='line'><span class="c">    h-shadowï¼šæ°´å¹³ä½ç§»è·é›¢</span>
</span><span class='line'><span class="c">    v-shadowï¼šå‚ç›´ä½ç§»è·é›¢</span>
</span><span class='line'><span class="c">    blurï¼šæ¨¡ç³ŠåŠå¾‘</span>
</span><span class='line'><span class="c">    spreadï¼šæ“´æ•£è·é›¢</span>
</span><span class='line'><span class="c">    colorï¼šé¡è‰² </span>
</span><span class='line'><span class="c">  */</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">15px</span> <span class="m">#ffc600</span><span class="p">;</span>
</span><span class='line'>  <span class="c">/* </span>
</span><span class='line'><span class="c">     h-shadowï¼šæ°´å¹³ä½ç§»è·é›¢</span>
</span><span class='line'><span class="c">     v-shadowï¼šå‚ç›´ä½ç§»è·é›¢</span>
</span><span class='line'><span class="c">     blurï¼šæ¨¡ç³ŠåŠå¾‘</span>
</span><span class='line'><span class="c">     spreadï¼šæ“´æ•£è·é›¢</span>
</span><span class='line'><span class="c">     colorï¼šé¡è‰²</span>
</span><span class='line'><span class="c">     insetï¼šå…§é™°å½±</span>
</span><span class='line'><span class="c">     æœ€å°‘è¦æœ‰ h-shadow åŠ v-shadow å…©å€‹åƒæ•¸</span>
</span><span class='line'><span class="c">  */</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://abgne.tw/css/css3-lab/css3-text-shadow.html">[CSS3]text-shadow æ–‡å­—é™°å½±</a></li>
<li><a href="https://abgne.tw/css/css3-lab/css3-box-shadow.html">[CSS3]box-shadow å€å¡Šé™°å½±</a></li>
</ul>


<h1>letter-spacing</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.sound</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">font-size</span><span class="o">:</span> <span class="m">1</span><span class="o">.</span><span class="m">2</span><span class="n">rem</span><span class="p">;</span>
</span><span class='line'>  <span class="k">text-transform</span><span class="o">:</span> <span class="k">uppercase</span><span class="p">;</span> <span class="c">/* è½‰å¤§å¯« */</span>
</span><span class='line'>  <span class="k">letter-spacing</span><span class="o">:</span> <span class="m">1px</span><span class="p">;</span> <span class="c">/* å­—é–“è·é›¢ */</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span> <span class="m">#ffc600</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>transform</h1>

<p>æ§åˆ¶å…ƒç´ çš„è®Šå½¢çš„æ•ˆæœ (translate ä½ç§»ã€scale æ”¾å¤§ç¸®å°ã€rotate æ—‹è½‰ã€skew å‚¾æ–œã€<a href="http://www.oxxostudio.tw/articles/201409/svg-20-transform-matrix.html">matrix</a>)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.playing</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">transform</span><span class="o">:</span><span class="n">scale</span><span class="p">(</span><span class="m">1</span><span class="o">.</span><span class="m">1</span><span class="p">);</span> <span class="c">/* (xè»¸,yè»¸) æ”¾å¤§ 1.1 å€ */</span>
</span><span class='line'>  <span class="k">border-color</span><span class="o">:</span><span class="m">#ffc600</span><span class="p">;</span>
</span><span class='line'>  <span class="n">box</span><span class="o">-</span><span class="n">shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span> <span class="m">15px</span> <span class="m">#ffc600</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://www.w3schools.com/css/css3_2dtransforms.asp">CSS 2D Transforms</a></li>
<li><a href="http://www.oxxostudio.tw/articles/201409/svg-19-transform.html">SVG ç ”ç©¶ä¹‹è·¯ (19) - transform åŸºç¤ç¯‡</a></li>
</ul>


<p>åƒè€ƒæ–‡ç« </p>

<ul>
<li><a href="https://javascript30.com/">Wes Bos javascript30</a></li>
<li><a href="https://guahsu.io/2017/05/JavaScript30-01-Java-Script-Drum-Kit/">ã€ŒJS30ç´€éŒ„ï¼†å¿ƒå¾—ã€01 - JavaScript Drum Kit</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CSS Flex å±¬æ€§]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/28/css-flex/"/>
    <updated>2018-07-28T21:46:59+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/28/css-flex</id>
    <content type="html"><![CDATA[<p>css ç”¨ä¾†æ’ç‰ˆçš„æ–°èªæ³•ï¼Œä»¥å‰éƒ½æ˜¯ç”¨ float ä¾†åšæ’ç‰ˆï¼Œä½†ç›¸ç•¶éº»ç…©ï¼Œç”¨äº† flex è®Šçš„ç›¸ç•¶è¼•é¬†å¥½ç”¨</p>

<!-- more -->


<h1>Flex å¤–å®¹å™¨å±¬æ€§</h1>

<h3>display</h3>

<p>å¿…é ˆå®£å‘Šæ‰èƒ½ä½¿ç”¨ flex</p>

<ul>
<li><code>flex</code></li>
<li><code>inline-flex</code>: ç›¸ç•¶æ–¼ <code>inline-block</code> + <code>flex</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>flex-direction</h3>

<p>æ’åºæ–¹å‘</p>

<ul>
<li><code>row</code>: æ°´å¹³ - Items are placed the same as the text direction.</li>
<li><code>row-reverse</code>: æ°´å¹³åè½‰ - Items are placed opposite to the text direction.</li>
<li><code>column</code>: å‚ç›´ - Items are placed top to bottom.</li>
<li><code>column-reverse</code>: å‚ç›´åè½‰ - Items are placed bottom to top</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>  <span class="na">flex-direction</span><span class="o">:</span> <span class="n">row</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>flex-wrap</h3>

<p>è¶…å‡ºç¯„åœæ™‚çš„è™•ç†æ–¹å¼</p>

<ul>
<li><code>nowrap</code>: æ›è¡Œ (<em>default</em>)</li>
<li><code>wrap</code>: ä¸æ›è¡Œ</li>
<li><code>wrap-reverse</code>: æ›è¡Œæ™‚åè½‰</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>  <span class="na">flex-wrap</span><span class="o">:</span> <span class="no">nowrap</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>flex-flow</h3>

<p><code>flex-direction</code> èˆ‡ <code>flex-wrap</code> çš„ç¸®å¯«</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>  <span class="na">flex-flow</span><span class="o">:</span> <span class="n">row</span> <span class="no">nowrap</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>justify-content</h3>

<p>æ°´å¹³è»¸å°é½Šè¨­å®š</p>

<ul>
<li><code>flex-start</code>: Items align to the left side of the container.</li>
<li><code>flex-end</code>: Items align to the right side of the container.</li>
<li><code>center</code>: Items align at the center of the container.</li>
<li><code>space-between</code>: Items display with equal spacing between them. å¹³å‡åˆ†é…å…§å®¹å…ƒç´ ï¼Œå·¦å³å…ƒç´ å°‡æœƒèˆ‡ main start å’Œ main end è²¼é½Š</li>
<li><code>space-around</code>: Items display with equal spacing around them. å¹³å‡åˆ†é…å…§å®¹å…ƒç´ ï¼Œé–“è·ä¹Ÿæ˜¯å¹³å‡åˆ†é…</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>  <span class="na">justify-content</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>align-items</h3>

<p>äº¤éŒ¯è»¸çš„å°é½Šè¨­å®š</p>

<ul>
<li><code>flex-start</code>: Items align to the top of the container.</li>
<li><code>flex-end</code>: Items align to the bottom of the container.</li>
<li><code>center</code>: Items align at the vertical center of the container.</li>
<li><code>baseline</code>: Items display at the baseline of the container. ä»¥æ‰€æœ‰å…§å®¹å…ƒç´ çš„åŸºç·šä½œç‚ºå°é½Šæ¨™æº–</li>
<li><code>stretch</code>: Items are stretched to fit the container. å°‡å…§å®¹å…ƒç´ å…¨éƒ¨æ’é–‹è‡³ Flexbox çš„é«˜åº¦ (<em>default</em>)</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>  <span class="na">align-items</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>align-content</h3>

<p><code>align-items</code> å¤šè¡Œç‰ˆæœ¬</p>

<blockquote><p>æ³¨æ„ stretch åœ¨é«˜åº¦è¢«é™åˆ¶çš„æƒ…æ³ä¸‹ä¸æœƒæ­£å¸¸ä¼¸å±•ã€‚</p></blockquote>

<ul>
<li><code>flex-start</code>: Lines are packed at the top of the container.</li>
<li><code>flex-end</code>: Lines are packed at the bottom of the container.</li>
<li><code>center</code>: Lines are packed at the vertical center of the container.</li>
<li><code>space-between</code>: Lines display with equal spacing between them. å°‡ç¬¬ä¸€è¡Œèˆ‡æœ€å¾Œä¸€è¡Œåˆ†åˆ¥å°é½Šæœ€ä¸Šæ–¹èˆ‡æœ€ä¸‹æ–¹</li>
<li><code>space-around</code>: Lines display with equal spacing around them. æ¯è¡Œå¹³å‡åˆ†é…é–“è·</li>
<li><code>stretch</code>: Lines are stretched to fit the container.å…§å®¹å…ƒç´ å…¨éƒ¨æ’é–‹ï¼ˆ<em>default</em>ï¼‰</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>  <span class="na">align-content</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Flex å…§å…ƒä»¶å±¬æ€§</h1>

<h3>flex</h3>

<p>åŒ…å«äº† <code>flex-grow</code> <code>flex-shrink</code> <code>flex-basis</code></p>

<ul>
<li><code>flex-grow</code>: æ•¸å­—ï¼Œç„¡å–®ä½ï¼Œç•¶å­å…ƒç´ çš„ flex-basis é•·åº¦ã€Œå°ã€æ–¼å®ƒè‡ªå·±åœ¨çˆ¶å…ƒç´ åˆ†é…åˆ°çš„é•·åº¦ï¼ŒæŒ‰ç…§æ•¸å­—åšç›¸å°æ‡‰çš„ã€Œä¼¸å±•ã€æ¯”ä¾‹åˆ†é…ï¼Œé è¨­å€¼ç‚º 0ï¼Œä¸æœƒé€²è¡Œå½ˆæ€§è®ŠåŒ–ï¼Œä¸å¯ç‚ºè² å€¼ï¼Œè¨­ç‚º 1 å‰‡æœƒé€²è¡Œå½ˆæ€§è®ŠåŒ–ã€‚</li>
<li><code>flex-shrink</code>: æ•¸å­—ï¼Œç„¡å–®ä½ï¼Œç•¶å­å…ƒç´ çš„ flex-basis é•·åº¦ã€Œå¤§ã€æ–¼å®ƒè‡ªå·±åœ¨çˆ¶å…ƒç´ åˆ†é…åˆ°çš„é•·åº¦ï¼ŒæŒ‰ç…§æ•¸å­—åšç›¸å°æ‡‰çš„ã€Œå£“ç¸®ã€æ¯”ä¾‹åˆ†é…ï¼Œé è¨­å€¼ç‚º 1ï¼Œè¨­ç‚º 0 çš„è©±ä¸æœƒé€²è¡Œå½ˆæ€§è®ŠåŒ–ï¼Œä¸å¯ç‚ºè² å€¼ã€‚</li>
<li><code>flex-basis</code>: å­å…ƒç´ çš„åŸºæœ¬å¤§å°ï¼Œä½œç‚ºçˆ¶å…ƒç´ çš„å¤§å°æ¯”è¼ƒåŸºæº–ï¼Œé è¨­å€¼ç‚º 0ï¼Œä¹Ÿå› ç‚ºé è¨­å€¼ç‚º 0ï¼Œæ‰€ä»¥æ²’æœ‰è¨­å®šæ­¤å±¬æ€§çš„æ™‚å€™ï¼Œæœƒä»¥ç›´æ¥æ¡ç”¨ flex-grow å±¬æ€§ï¼Œflex-basis ä¹Ÿå¯ä»¥è¨­ç‚º autoï¼Œå¦‚æœè¨­ç‚º autoï¼Œå°±è¡¨ç¤ºå­å…ƒç´ ä»¥è‡ªå·±çš„åŸºæœ¬å¤§å°ç‚ºå–®ä½ã€‚</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">flex</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// ç•¶è¨­å®šä¸€å€‹æ˜¯ flex-grow</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>align-self</h3>

<p><code>align-self</code> çš„ä½œç”¨åœ¨æ–¼è¦†å¯«å·²ç¶“å¥—ç”¨ <code>align-items</code> çš„å±¬æ€§ï¼Œå¯èª¿æ•´å…§å…ƒä»¶äº¤éŒ¯è»¸çš„å°é½Šè¨­å®š(ä¸»è»¸ç·šå‰‡ä¸èƒ½å¦å¤–åšè¨­å®š)ï¼Œä¸”å¯ä»¥å€‹åˆ¥è¨­å®šå–®ä¸€å…ƒä»¶çš„å€¼ã€‚</p>

<ul>
<li><code>auto</code></li>
<li><code>flex-start</code></li>
<li><code>flex-end</code></li>
<li><code>center</code></li>
<li><code>baseline</code></li>
<li><code>stretch</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>  <span class="na">align-self</span><span class="o">:</span> <span class="no">center</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>order</h3>

<p>å¯é‡æ–°å®šç¾©å…ƒä»¶çš„æ’åˆ—é †åºï¼Œé †åºæœƒä¾æ“šæ•¸å€¼çš„å¤§å°æ’åˆ—ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="na">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>  <span class="na">order</span><span class="o">:</span> <span class="mi">-1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>playground</h1>

<p data-height="265" data-theme-id="0" data-slug-hash="rrYjvX" data-default-tab="css,result" data-user="leonji" data-pen-title="rrYjvX" class="codepen">See the Pen <a href="https://codepen.io/leonji/pen/rrYjvX/">rrYjvX</a> by leonji (<a href="https://codepen.io/leonji">@leonji</a>) on <a href="https://codepen.io">CodePen</a>.</p>


<script async src="https://static.codepen.io/assets/embed/ei.js"></script>


<p>åƒè€ƒæ–‡ä»¶</p>

<ul>
<li><a href="https://flexboxfroggy.com/">flexboxfroggy</a></li>
<li><a href="https://flexbox.io/">flexbox Wes Bos</a></li>
<li><a href="http://www.oxxostudio.tw/articles/201501/css-flexbox.html">æ·±å…¥è§£æ CSS Flexbox </a></li>
<li><a href="https://wcc723.github.io/css/2017/07/21/css-flex/">åœ–è§£ï¼šCSS Flex å±¬æ€§ä¸€é»ä¹Ÿä¸é›£</a></li>
<li><a href="https://hackernoon.com/the-ultimate-css-battle-grid-vs-flexbox-d40da0449faf">The ultimate CSS battle: Grid vs Flexbox</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nothing Is Something by Sandi Metz]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/26/nothing-is-something-by-sandi-metz/"/>
    <updated>2018-07-26T21:36:02+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/26/nothing-is-something-by-sandi-metz</id>
    <content type="html"><![CDATA[<p>é€™æ˜¯ Sandi Metz 2015 çš„æ¼”è¬›ï¼Œé›–ç„¶æœ‰é»èˆŠï¼Œä½†é‚„æ˜¯å¾ˆä¸éŒ¯ï¼Œä¾†ç´€éŒ„ä¸€ä¸‹</p>

<!-- more -->


<h3>Smalltalk Infected</h3>

<p>ä¸€é–‹å§‹å…ˆä»‹ç´¹ <code>if</code> å¯ä»¥æ”¹å¯«ç‚ºè‡ªå·±çš„ method</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">true</span><span class="o">.</span><span class="n">class</span> <span class="c1"># TrueClass</span>
</span><span class='line'><span class="kp">false</span><span class="o">.</span><span class="n">class</span> <span class="c1"># FalseClass</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">TrueClass</span>
</span><span class='line'> <span class="k">def</span> <span class="nf">if_true</span>
</span><span class='line'>    <span class="k">yield</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'> <span class="k">def</span> <span class="nf">if_false</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">FalseClass</span>
</span><span class='line'> <span class="k">def</span> <span class="nf">if_true</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'> <span class="k">def</span> <span class="nf">if_false</span>
</span><span class='line'>    <span class="k">yield</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">if_true</span><span class="p">{</span> <span class="nb">puts</span> <span class="s2">&quot;evaluated block&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="n">evaluated</span> <span class="n">block</span>
</span><span class='line'><span class="c1"># =&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥ä¸‹ä¾†æ”¹å¯«ç‚º <code>Object</code> <code>FalseClass</code> <code>NilClass</code> å› ç‚ºåœ¨ ruby çš„ä¸–ç•Œä¸­ï¼Œé™¤äº† <code>false</code> å’Œ <code>nil</code> æ˜¯ &ldquo;Falsy"ï¼Œå…¶ä»–éƒ½æ˜¯ "truthy&rdquo;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Object</span>
</span><span class='line'> <span class="k">def</span> <span class="nf">if_true</span>
</span><span class='line'>    <span class="k">yield</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'> <span class="k">def</span> <span class="nf">if_false</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">FalseClass</span>
</span><span class='line'> <span class="k">def</span> <span class="nf">if_true</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'> <span class="k">def</span> <span class="nf">if_false</span>
</span><span class='line'>    <span class="k">yield</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">NilClass</span>
</span><span class='line'> <span class="k">def</span> <span class="nf">if_true</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'>
</span><span class='line'> <span class="k">def</span> <span class="nf">NilClass</span>
</span><span class='line'>    <span class="k">yield</span>
</span><span class='line'>    <span class="nb">self</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">(</span><span class="mi">1</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">if_true</span><span class="p">{</span> <span class="nb">puts</span> <span class="s1">&#39;a&#39;</span> <span class="p">}</span><span class="o">.</span><span class="n">if_false</span><span class="p">{</span> <span class="nb">puts</span><span class="s1">&#39;b&#39;</span> <span class="p">}</span>
</span><span class='line'><span class="n">a</span>
</span><span class='line'><span class="c1"># true</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†æˆ‘å€‘ä¸¦ä¸æƒ³æ”¹å¯« ruby åŸæœ¬å°±æœ‰çš„ methodï¼Œè€Œæ˜¯å°‡ä¸Šé¢çš„æŠ€å·§æ‡‰ç”¨åœ¨éœ€è¦çš„åœ°æ–¹</p>

<h3>Condition Averse</h3>

<p>Sometimes nil is nothing</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ids</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;pig&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;sheep&#39;</span><span class="o">]</span>
</span><span class='line'><span class="n">animals</span> <span class="o">=</span> <span class="n">ids</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="nb">id</span><span class="o">|</span> <span class="no">Animal</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)}</span>
</span><span class='line'><span class="c1"># =&gt; [#&lt;Animal:0x007f94b290ae90 @name=&quot;pig&quot;&gt;, nil,</span>
</span><span class='line'>     <span class="c1">#&lt;Animal:0x007f94b290ae18 @name=&quot;sheep&quot;&gt;]</span>
</span><span class='line'>
</span><span class='line'><span class="n">animals</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">animal</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">animal</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; &#39;pig&#39;</span>
</span><span class='line'><span class="c1"># NoMethodError: undefined method `name&#39; for nil:NilClass</span>
</span><span class='line'>
</span><span class='line'><span class="n">animals</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">animal</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">animal</span><span class="o">.</span><span class="n">nil?</span> <span class="p">?</span> <span class="s1">&#39;no animal&#39;</span> <span class="p">:</span> <span class="n">animal</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; &#39;pig&#39;</span>
</span><span class='line'><span class="c1">#    &#39;no animal&#39;</span>
</span><span class='line'><span class="c1">#    &#39;sheep&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">animals</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">animal</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">animal</span> <span class="o">&amp;&amp;</span> <span class="n">animal</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
</span><span class='line'><span class="n">animals</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">animal</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">animal</span><span class="o">.</span><span class="n">try</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="n">animals</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">animal</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">animal</span><span class="o">.</span><span class="n">nil?</span> <span class="p">?</span> <span class="s1">&#39;&#39;</span> <span class="p">:</span> <span class="n">animal</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
</span><span class='line'><span class="n">animals</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">animal</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">animal</span> <span class="o">==</span> <span class="kp">nil</span> <span class="p">?</span> <span class="s1">&#39;&#39;</span> <span class="p">:</span> <span class="n">animal</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
</span><span class='line'><span class="n">animals</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">animal</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">animal</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">NilClass</span><span class="p">)</span> <span class="p">?</span> <span class="s1">&#39;&#39;</span> <span class="p">:</span> <span class="n">animal</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; &#39;pig&#39;</span>
</span><span class='line'><span class="c1">#    empty string</span>
</span><span class='line'><span class="c1">#    &#39;sheep&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Message Centric</h3>

<p>æ–°å¢ <code>MissingAnimal</code> class</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Animal</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MissingAnimal</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>    <span class="s1">&#39;no animal&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">ids</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;pig&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;sheep&#39;</span><span class="o">]</span>
</span><span class='line'><span class="n">animals</span> <span class="o">=</span> <span class="n">ids</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="nb">id</span><span class="o">|</span> <span class="no">Animal</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">||</span> <span class="no">MissingAnimal</span><span class="o">.</span><span class="n">new</span><span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; [#&lt;Animal: @name=&quot;pig&quot;&gt;, #&lt;MissingAnimal:&gt;, #&lt;Animal: @name=&quot;sheep&quot;&gt;]</span>
</span><span class='line'>
</span><span class='line'><span class="n">animals</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">animal</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">animal</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; &#39;pig&#39;</span>
</span><span class='line'><span class="c1">#    &#39;no animal&#39;</span>
</span><span class='line'><span class="c1">#    &#39;sheep&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†æ˜¯é€™æ¨£åè€Œå° <code>MissingAnimal</code> æœƒæœ‰ dependencyï¼Œæ¥è‘—åœ¨å¤–é¢å†åŒ…ä¸€å±¤ï¼Œå°‡ dependency å°è£èµ·ä¾†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">GuaranteedAnimal</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>    <span class="no">Animal</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">||</span> <span class="no">MissingAnimal</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">animals</span> <span class="o">=</span> <span class="n">ids</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span><span class="no">GuaranteedAnimal</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; [#&lt;Animal: @name=&quot;pig&quot;&gt;, </span>
</span><span class='line'>      <span class="c1">#&lt;MissingAnimal:&gt;,</span>
</span><span class='line'>      <span class="c1">#&lt;Animal: @name=&quot;sheep&quot;&gt;]</span>
</span><span class='line'>
</span><span class='line'><span class="n">animals</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">animal</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">animal</span><span class="o">.</span><span class="n">name</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; &#39;pig&#39;</span>
</span><span class='line'><span class="c1">#    &#39;no animal&#39;</span>
</span><span class='line'><span class="c1">#    &#39;sheep&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Abstraction Seeking</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">House</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">recite</span>
</span><span class='line'>    <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.data</span><span class="o">.</span><span class="n">length</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span class='line'>    <span class="s2">&quot;This is </span><span class="si">#{</span><span class="n">phrase</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">phrase</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span class='line'>    <span class="n">parts</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">.</span><span class="n">last</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">data</span>
</span><span class='line'>    <span class="o">[</span> <span class="s1">&#39;the horse and the hound and the horn that belonged to&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="c1"># ...</span>
</span><span class='line'>    <span class="s1">&#39;the malt that lay in&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;the house that Jack built&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥è‘— Implement <code>RandomHouse</code> <code>EchoHouse</code> without &lsquo;if&rsquo; statements</p>

<p>ç”¨ç¹¼æ‰¿ Inheritance?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">RandomHouse</span> <span class="o">&lt;</span> <span class="no">House</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">data</span>
</span><span class='line'>    <span class="vi">@data</span> <span class="o">||=</span> <span class="k">super</span><span class="o">.</span><span class="n">shuffle</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">EchoHouse</span> <span class="o">&lt;</span> <span class="no">House</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span class='line'>    <span class="k">super</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span><span class="k">super</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†é€™æ¨£ä¸€å€‹è¦æ”¹å¯« <code>data</code> å¦ä¸€å€‹æ”¹å¯« <code>parts</code>ï¼Œç•¶æœ‰æ–°éœ€æ±‚ <code>RandomEchoHouse</code>ï¼Œé‚£ä¸å°±è¦é€™å…©å€‹ method åœ¨å¯«ä¸€æ¬¡ï¼Œä¹Ÿä¸å¯èƒ½åªç¹¼æ‰¿å…¶ä¸­ä¸€å€‹</p>

<blockquote><p>Inheritance is for specialization is not for sharing code</p></blockquote>

<p>æ”¹ç”¨çµ„åˆ Composition çš„æ–¹å¼ä¾†è™•ç†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">House</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:formatter</span><span class="p">,</span> <span class="ss">:data</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="ss">orderer</span><span class="p">:</span> <span class="no">DefaultOrder</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="ss">formatter</span><span class="p">:</span> <span class="no">DefaultFormatter</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@formatter</span> <span class="o">=</span> <span class="n">formatter</span>
</span><span class='line'>    <span class="vi">@data</span> <span class="o">=</span> <span class="n">orderer</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="no">DATA</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
</span><span class='line'>    <span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">last</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">DefaultOrder</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">RandomOrder</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">.</span><span class="n">shuffle</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">DefaultFormatter</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
</span><span class='line'>    <span class="n">parts</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">EchoFormatter</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
</span><span class='line'>    <span class="n">parts</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="no">House</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">orderer</span><span class="p">:</span> <span class="no">RandomOrder</span><span class="o">.</span><span class="n">new</span><span class="p">)</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</span><span class='line'><span class="no">House</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">formatter</span><span class="p">:</span> <span class="no">EchoFormatter</span><span class="o">.</span><span class="n">new</span><span class="p">)</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>åƒè€ƒæ–‡ä»¶</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=OMPfEXIlTVE">[Video]RailsConf 2015 - Nothing is Something</a></li>
<li><a href="https://speakerdeck.com/skmetz/nothing-is-something-railsconf">[Silde] RailsConf 2015 - Nothing is Something</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TaiwanUserID å°ç£èº«åˆ†è­‰å­—è™Ÿé©—è­‰]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/24/taiwan-user-id/"/>
    <updated>2018-07-24T21:38:14+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/24/taiwan-user-id</id>
    <content type="html"><![CDATA[<p>ä½ çŸ¥é“å°ç£èº«åˆ†è­‰å­—è™Ÿæ˜¯æ€éº¼ç®—å‡ºä¾†çš„å—?</p>

<!-- more -->


<p>å‰›å¥½å…¬å¸åŒäº‹æœ‰å¯«åˆ°ï¼Œè »æœ‰è¶£çš„ä¾†ç´€éŒ„ä¸€ä¸‹ï¼Œè¦å¿«é‚„æ˜¯è¦ç”¨ <code>while</code> é˜¿~</p>

<h1>å…¬å¼</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>æˆ¶ç±ä»£è¡¨çš„å­—æ¯æ•¸å­—ï¼š
</span><span class='line'>ï¼¡å°åŒ—å¸‚-10 ï¼¢å°ä¸­å¸‚-11 ï¼£åŸºéš†å¸‚-12 ï¼¤å°å—å¸‚-13 ï¼¥é«˜é›„å¸‚-14 ï¼¦å°åŒ—ç¸£-15
</span><span class='line'>ï¼§å®œè˜­ç¸£-16 ï¼¨æ¡ƒåœ’ç¸£-17 ï¼©å˜‰ç¾©å¸‚-34 ï¼ªæ–°ç«¹ç¸£-18 ï¼«è‹—æ —ç¸£-19 ï¼¬å°ä¸­ç¸£-20
</span><span class='line'>ï¼­å—æŠ•ç¸£-21 ï¼®å½°åŒ–ç¸£-22 ï¼¯æ–°ç«¹å¸‚-35 ï¼°é›²æ—ç¸£-23 ï¼±å˜‰ç¾©ç¸£-24 ï¼²å°å—ç¸£-25
</span><span class='line'>ï¼³é«˜é›„ç¸£-26 ï¼´å±æ±ç¸£-27 ï¼µèŠ±è“®ç¸£-28 ï¼¶å°æ±ç¸£-29 ï¼·é‡‘é–€ç¸£-32 ï¼¸æ¾æ¹–ç¸£-30
</span><span class='line'>ï¼¹é™½æ˜å±±-31 ï¼ºé€£æ±Ÿç¸£-33
</span><span class='line'>
</span><span class='line'>å…¬å¼
</span><span class='line'>A123456789 -&gt; 10123456789
</span><span class='line'>
</span><span class='line'>1   0   1    2    3    4    5    6    7   8   9 (æ‹†è§£å­—æ¯å¾Œçš„æ•¸å­—)
</span><span class='line'>*   *   *    *    *    *    *    *    *   *   *
</span><span class='line'>1   9   8    7    6    5    4    3    2   1   1 (å›ºå®šä¿‚æ•¸)
</span><span class='line'>-----------------------------------------------
</span><span class='line'>1 + 0 + 8 + 14 + 18 + 20 + 20 + 18 + 14 + 8 + 9 = 130
</span><span class='line'>
</span><span class='line'>130 % 10 == 0</span></code></pre></td></tr></table></div></figure>


<h1>Code</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;benchmark&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">LOCATION_CODE</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;A&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;J&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;P&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;S&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="no">MULTIPLIER</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">id_card_validate</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="nb">id</span> <span class="o">=~</span> <span class="sr">/\A[A-Z](1|2)\d{8}\z/</span>
</span><span class='line'>  <span class="n">chars</span> <span class="o">=</span> <span class="nb">id</span><span class="o">.</span><span class="n">chars</span>
</span><span class='line'>  <span class="n">numbers</span> <span class="o">=</span> <span class="no">LOCATION_CODE</span><span class="o">[</span><span class="n">chars</span><span class="o">.</span><span class="n">shift</span><span class="o">]</span> <span class="o">+</span> <span class="n">chars</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:to_i</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sum</span> <span class="o">=</span> <span class="n">numbers</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span><span class="no">MULTIPLIER</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="p">}</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="ss">:+</span><span class="p">)</span>
</span><span class='line'>  <span class="c1"># sum, i = 0, 0</span>
</span><span class='line'>  <span class="c1"># while i &lt;= 10</span>
</span><span class='line'>  <span class="c1">#   sum += numbers[i] * MULTIPLIER[i]</span>
</span><span class='line'>  <span class="c1">#   i += 1</span>
</span><span class='line'>  <span class="c1"># end</span>
</span><span class='line'>  <span class="p">(</span><span class="n">sum</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">zero?</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">n</span> <span class="o">=</span> <span class="mi">100000</span>
</span><span class='line'><span class="no">Benchmark</span><span class="o">.</span><span class="n">bmbm</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
</span><span class='line'>  <span class="n">x</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;leonji&#39;</span><span class="p">){</span> <span class="n">n</span><span class="o">.</span><span class="n">times</span><span class="p">{</span> <span class="n">id_card_validate</span><span class="p">(</span><span class="s1">&#39;A123456789&#39;</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Rehearsal ------------------------------------------</span>
</span><span class='line'><span class="c1"># leonji   0.770000   0.010000   0.780000 (  0.796012)</span>
</span><span class='line'><span class="c1"># --------------------------------- total: 0.780000sec</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#              user     system      total        real</span>
</span><span class='line'><span class="c1"># leonji   0.770000   0.000000   0.770000 (  0.792737)</span>
</span></code></pre></td></tr></table></div></figure>


<p>åƒè€ƒæ–‡ä»¶</p>

<ul>
<li><a href="http://tzoyiing.pixnet.net/blog/post/29821245-%5B%E8%BD%89%E8%B2%BC%5D-%E8%BA%AB%E4%BB%BD%E8%A8%BC%E5%AD%97%E8%99%9F%E7%B7%A8%E7%A2%BC%E5%85%AC%E5%BC%8F%E8%AA%AA%E6%98%8E~%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E9%A9%97">[è½‰è²¼] èº«ä»½è­‰å­—è™Ÿç·¨ç¢¼å…¬å¼èªªæ˜~æ•™ä½ å¦‚ä½•é©—è­‰</a></li>
<li><a href="https://tonytonyjan.net/2015/04/15/national-identification-card-validator-of-taiwan/">å°ç£èº«ä»½è­‰å­—è™Ÿé©—è­‰å™¨</a></li>
<li><a href="https://github.com/wayne5540/taiwanese_id_builder">taiwanese_id_builder</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Environment Banner]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/23/environment-banner/"/>
    <updated>2018-07-23T21:35:24+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/23/environment-banner</id>
    <content type="html"><![CDATA[<p>å¯ä»¥å¾ˆå¿«é€Ÿçš„çŸ¥é“ç›®å‰ç’°å¢ƒä¸Šçš„ç‰ˆæœ¬æ˜¯ä»€éº¼</p>

<!-- more -->


<p>å…¬å¸å› ç‚ºå¤šå°æ©Ÿå™¨ä¸åŒç’°å¢ƒï¼Œå› æ­¤æœ‰åŒäº‹åšäº†ä¸€å€‹ <code>Environment banner</code>ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°çŸ¥é“ç›®å‰æ˜¯å“ªä¸€å€‹ branch å“ªä¸€å€‹ ç‰ˆæœ¬ï¼Œé€™é‚Šå°±ä¾†è¨˜éŒ„ä¸€ä¸‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/helpers/environment_banner_helper.rb</span>
</span><span class='line'><span class="k">module</span> <span class="nn">EnvironmentBannerHelper</span>
</span><span class='line'>  <span class="no">RELEASE_INFO_PATH</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">public_path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;release_info&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">current_branch</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">git_available?</span>
</span><span class='line'>      <span class="c1"># è®€å–ç•¶å‰ HEAD æ‰€åœ¨çš„ branch åç¨±</span>
</span><span class='line'>      <span class="sb">`git rev-parse --abbrev-ref HEAD`</span><span class="o">.</span><span class="n">chomp</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="c1"># ç•¶åœ¨ deploy çš„æ™‚å€™ï¼Œç„¡æ³•ç”¨ git (é™¤éå¦å¤–è£)ï¼Œå› æ­¤å¯ä»¥å…ˆå°‡è³‡è¨Šå­˜æ”¾åœ¨æŸçš„æª”æ¡ˆï¼Œæˆ–æ˜¯ç’°å¢ƒè®Šæ•¸</span>
</span><span class='line'>      <span class="n">git_info</span><span class="o">[</span><span class="ss">:branch</span><span class="o">]</span> <span class="c1"># æª”æ¡ˆ</span>
</span><span class='line'>      <span class="c1"># ENV.fetch(&quot;CURRENT_BRANCH&quot;, &quot;--branch-not-found--&quot;) # ENV</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">current_sha</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">git_available?</span>
</span><span class='line'>      <span class="c1"># è®€å–ç•¶å‰çš„ log æœ€æ–°ä¸€è¡Œ</span>
</span><span class='line'>      <span class="sb">`git log --oneline -1`</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="c1"># ç•¶åœ¨ deploy çš„æ™‚å€™ï¼Œç„¡æ³•ç”¨ git (é™¤éå¦å¤–è£)ï¼Œå› æ­¤å¯ä»¥å…ˆå°‡è³‡è¨Šå­˜æ”¾åœ¨æŸçš„æª”æ¡ˆï¼Œæˆ–æ˜¯ç’°å¢ƒè®Šæ•¸</span>
</span><span class='line'>      <span class="n">git_info</span><span class="o">[</span><span class="ss">:sha</span><span class="o">]</span> <span class="c1"># æª”æ¡ˆ</span>
</span><span class='line'>      <span class="c1"># ENV.fetch(&quot;CURRENT_SHA&quot;, &quot;--sha-not-found--&quot;) # ENV</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ç¢ºèªç•¶å‰ç’°å¢ƒæœ‰æ²’æœ‰ git</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">git_available?</span>
</span><span class='line'>    <span class="n">to_dev_null</span> <span class="o">=</span> <span class="s2">&quot;&gt; /dev/null 2&gt;&amp;1&quot;</span>
</span><span class='line'>    <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;which git </span><span class="si">#{</span><span class="n">to_dev_null</span><span class="si">}</span><span class="s2"> &amp;&amp; git rev-parse --git-dir </span><span class="si">#{</span><span class="n">to_dev_null</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># ä¸»è¦æ˜¯ç‚ºäº† capistrano ä¸Šé¢æœƒæœ‰ä¸åŒçš„ release è³‡æ–™å¤¾</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">release_number</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">unless</span> <span class="n">check_release_info</span> <span class="o">&amp;&amp;</span> <span class="no">IO</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="no">RELEASE_INFO_PATH</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>    <span class="no">IO</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="no">RELEASE_INFO_PATH</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\D/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">prepend</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">git_info</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span> <span class="ss">sha</span><span class="p">:</span> <span class="s2">&quot;N/A&quot;</span><span class="p">,</span> <span class="ss">branch</span><span class="p">:</span> <span class="s2">&quot;N/A&quot;</span><span class="p">}</span> <span class="k">unless</span> <span class="n">check_release_info</span> <span class="o">&amp;&amp;</span> <span class="no">IO</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="no">RELEASE_INFO_PATH</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>    <span class="n">line</span> <span class="o">=</span> <span class="no">IO</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="no">RELEASE_INFO_PATH</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="ss">sha</span><span class="p">:</span>    <span class="n">line</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">6</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">branch</span><span class="p">:</span> <span class="n">line</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/refs\/heads\//</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">check_release_info</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">exist?</span> <span class="no">RELEASE_INFO_PATH</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/views/layouts/application.html.erb</span>
</span><span class='line'><span class="o">&lt;</span><span class="sx">% unless </span><span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">production?</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">  &lt;div class=&quot;environment-banner &lt;%= Rails.env %&gt;</span><span class="s2">&quot;&gt;</span>
</span><span class='line'><span class="s2">    &lt;%= Rails.env %&gt; | &lt;%= &quot;</span><span class="c1">#{current_branch} @ #{current_sha} #{release_number}&quot; %&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sr">/div&gt;</span>
</span><span class='line'><span class="sr">&lt;% end %&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/* app/assets/stylesheets/application.scss */</span>
</span><span class='line'><span class="nc">.environment-banner.development</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background</span><span class="o">:</span> <span class="err">$</span><span class="nb">green</span><span class="p">;</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span> <span class="err">$</span><span class="nb">white</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>capistrano deploy æ™‚æ–°å¢ <code>release_info</code> æª”æ¡ˆæ–¹å¼</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">set</span> <span class="ss">:repo_url</span><span class="p">,</span> <span class="s1">&#39;git@github.com:xxx/xxx.git&#39;</span>
</span><span class='line'><span class="n">ask</span> <span class="ss">:branch</span><span class="p">,</span> <span class="sb">`git rev-parse --abbrev-ref HEAD`</span><span class="o">.</span><span class="n">chomp</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># å°‡æ‰€æœ‰ git æ’æ³å¯«åˆ°ä¸€å€‹ file ä¸Šï¼Œå†é€éè©² file ä¾†é¡¯ç¤º</span>
</span><span class='line'><span class="c1"># readlink å¯ä»¥æ‰¾åˆ°å¯¦éš›æª”æ¡ˆä½ç½®ï¼Œawk åˆ†æå‡ºè·¯å¾‘ä¸Šæœ€å¾Œçš„ release è³‡æ–™å¤¾åç¨±</span>
</span><span class='line'><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;echo current_release: `readlink -f </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2"> | awk -F&#39;/&#39; &#39;{print $NF}&#39;` &gt; </span><span class="si">#{</span><span class="n">shared_path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;public/release_info&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1"># header</span>
</span><span class='line'><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;git ls-remote -h </span><span class="si">#{</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:repo_url</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:branch</span><span class="p">)</span><span class="si">}</span><span class="s2"> &gt;&gt; </span><span class="si">#{</span><span class="n">shared_path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;public/release_info&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1"># tag</span>
</span><span class='line'><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;git ls-remote -t </span><span class="si">#{</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:repo_url</span><span class="p">)</span><span class="si">}</span><span class="s2"> | tail -n 1 &gt;&gt; </span><span class="si">#{</span><span class="n">shared_path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;public/release_info&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Deploying Rails API + Nuxt.js + Devise-JWT API App to Production With Heroku]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/22/deploying-rails-nuxt-jwt-to-production-with-heroku/"/>
    <updated>2018-07-22T23:12:48+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/22/deploying-rails-nuxt-jwt-to-production-with-heroku</id>
    <content type="html"><![CDATA[<p>æ¥è‘—ä¾†æŠŠåšå¥½çš„ <code>Rails API + Nuxt.js + Devise-JWT</code> deploy åˆ° heroku</p>

<!-- more -->


<ul>
<li><a href="https://medium.com/@fishpercolator/deploying-your-nuxt-rails-api-app-to-production-with-heroku-54efd09eec22">Deploying your Nuxt+Rails API app to production with Heroku</a></li>
</ul>


<p>ç”±æ–¼ä¸€é–‹å§‹æˆ‘å€‘å¸Œæœ›ç”¨ docker-compose ä¾† build ç’°å¢ƒï¼Œå› æ­¤å°‡å‰å¾Œç«¯éƒ½ commit åœ¨ä¸€èµ·ï¼Œä½†åœ¨éƒ¨å±¬çš„æ™‚å€™å¸Œæœ›å°‡å…©å€‹åˆ†é–‹ï¼Œé€™æ™‚å°±å¯ä»¥ç”¨åˆ° <code>git subtree</code></p>

<p><a href="https://heroku.com"><img src="https://www.herokucdn.com/deploy/button.svg" alt="Deploy" /></a></p>

<h1>Backend</h1>

<p>Rails5.2 å¿…é ˆå…ˆå°‡ <code>production</code> çš„ <code>config.require_master_key</code> æ‰“é–‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/config/environments/production.rb</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">require_master_key</span> <span class="o">=</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¨˜å¾—è¦æŠŠ <code>cors.rb</code> è¨­å®šæˆ herokuapp çš„ domain (æ ¹æ“šå‰ç«¯å°ˆæ¡ˆçš„åç¨±)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/config/initializers/cors.rb</span>
</span><span class='line'><span class="n">origins</span> <span class="s1">&#39;localhost:3000&#39;</span><span class="p">,</span> <span class="s1">&#39;autheg-frontend-demo.herokuapp.com&#39;</span>
</span><span class='line'><span class="c1"># or</span>
</span><span class='line'><span class="n">origins</span> <span class="s1">&#39;*&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>å®‰è£ <a href="https://devcenter.heroku.com/articles/heroku-cli">heroku-cli</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">heroku</span><span class="o">/</span><span class="n">brew</span><span class="o">/</span><span class="n">heroku</span>
</span></code></pre></td></tr></table></div></figure>


<p>create backend çš„ heroku å°ˆæ¡ˆ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># å…ˆåˆ°æœ€ä¸Šå±¤çš„è³‡æ–™å¤¾</span>
</span><span class='line'><span class="n">cd</span> <span class="n">autheg</span>
</span><span class='line'><span class="c1"># å¦‚æœçœ‹åˆ°é€™å€‹ &quot;Name is already taken&quot;ï¼Œå°±æ›ä¸€å€‹åå­—å³å¯</span>
</span><span class='line'><span class="n">heroku</span> <span class="ss">apps</span><span class="p">:</span><span class="n">create</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">demo</span>
</span></code></pre></td></tr></table></div></figure>


<p>é è¨­ remote name æœƒæ˜¯ herokuï¼Œå› ç‚ºç­‰ä¸‹è¦åœ¨ create frontend remoteï¼Œå› æ­¤å…ˆæ”¹å</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># æ›´æ”¹ local çš„ remote name</span>
</span><span class='line'><span class="n">git</span> <span class="n">remote</span> <span class="n">rename</span> <span class="n">heroku</span> <span class="n">backend</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°‡å¾Œç«¯ autheg-backend push ä¸Šå»</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># é€é subtree å…ˆå°‡å¾Œç«¯ autheg-backend push ä¸Šå»</span>
</span><span class='line'><span class="n">git</span> <span class="n">subtree</span> <span class="n">push</span> <span class="o">--</span><span class="n">prefix</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span> <span class="n">backend</span> <span class="n">master</span>
</span></code></pre></td></tr></table></div></figure>


<p>å»ºç«‹ç’°å¢ƒè®Šæ•¸</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">heroku</span> <span class="ss">config</span><span class="p">:</span><span class="n">set</span> <span class="o">-</span><span class="n">a</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">demo</span> <span class="no">RAILS_MASTER_KEY</span><span class="o">=</span><span class="p">(</span><span class="n">local</span> <span class="err">è£¡é¢çš„</span> <span class="n">config</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">heroku</span> <span class="ss">config</span><span class="p">:</span><span class="n">set</span> <span class="o">-</span><span class="n">a</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">demo</span> <span class="no">JWT_SECRET</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">heroku</span> <span class="n">run</span> <span class="o">-</span><span class="n">a</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">demo</span> <span class="n">rails</span> <span class="n">secret</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>å»ºç«‹ table data</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">heroku</span> <span class="n">run</span> <span class="o">-</span><span class="n">a</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">demo</span> <span class="n">rails</span> <span class="ss">db</span><span class="p">:</span><span class="ss">schema</span><span class="p">:</span><span class="nb">load</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ–°å¢ db è³‡æ–™</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">heroku</span> <span class="n">run</span> <span class="o">-</span><span class="n">a</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">demo</span> <span class="n">rails</span> <span class="n">console</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># user</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">create!</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">&quot;test@example.com&quot;</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="s2">&quot;password&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># example</span>
</span><span class='line'><span class="p">{</span><span class="s2">&quot;foo&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;purple&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="o">|</span> <span class="no">Example</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="ss">colour</span><span class="p">:</span> <span class="n">c</span><span class="p">)}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥ä¸‹ä¾†å°±å¯ä»¥é€é <a href="http://yet-another-rest-client.com/">YARC</a> or <a href="https://www.getpostman.com/">Postman</a> ä¾†æ¸¬è©¦æœ‰æ²’æœ‰æˆåŠŸ!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">POST</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">autheg</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">demo</span><span class="o">.</span><span class="n">herokuapp</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">sign_in</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="s2">&quot;user&quot;</span><span class="p">:{</span>
</span><span class='line'>      <span class="s2">&quot;email&quot;</span><span class="ss">:&quot;test@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;password&quot;</span><span class="ss">:&quot;password&quot;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Frontend</h1>

<p><a href="https://github.com/nuxt/docs/blob/master/en/faq/heroku-deployment.md">nuxt heroku-deployment</a></p>

<p>create frontend çš„ heroku å°ˆæ¡ˆ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># å…ˆåˆ°æœ€ä¸Šå±¤çš„è³‡æ–™å¤¾</span>
</span><span class='line'><span class="n">cd</span> <span class="n">autheg</span>
</span><span class='line'><span class="c1"># å¦‚æœçœ‹åˆ°é€™å€‹ &quot;Name is already taken&quot;ï¼Œå°±æ›ä¸€å€‹åå­—å³å¯</span>
</span><span class='line'><span class="n">heroku</span> <span class="ss">apps</span><span class="p">:</span><span class="n">create</span> <span class="n">autheg</span><span class="o">-</span><span class="n">frontend</span><span class="o">-</span><span class="n">demo</span>
</span></code></pre></td></tr></table></div></figure>


<p>rename remote name</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="n">remote</span> <span class="n">rename</span> <span class="n">heroku</span> <span class="n">frontend</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¨­å®šç’°å¢ƒè®Šæ•¸ï¼Œè¦è·‘åœ¨ production æ¨¡å¼ï¼Œå› æ­¤è¦å°‡ä¹‹å‰å®‰è£åœ¨ dev ç’°å¢ƒä¸­çš„å¥—ä»¶ï¼Œå®‰è£ä¸Šå»</p>

<blockquote><p>The following command tells your app to run in production mode and on all interfaces (0.0.0.0) but tells yarn/npm to run in development mode, so that all the dev packages are installed as part of the build process.</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">heroku</span> <span class="ss">config</span><span class="p">:</span><span class="n">set</span> <span class="o">-</span><span class="n">a</span> <span class="n">autheg</span><span class="o">-</span><span class="n">frontend</span><span class="o">-</span><span class="n">demo</span> <span class="no">NODE_ENV</span><span class="o">=</span><span class="n">production</span> <span class="no">HOST</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span> <span class="no">NPM_CONFIG_PRODUCTION</span><span class="o">=</span><span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ”¹ä¸€ä¸‹ <code>package.json</code>ï¼Œè®“ heroku deploy ä¹‹å¾Œå¯ä»¥ build æª”æ¡ˆå‡ºä¾†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="s2">&quot;heroku-postbuild&quot;</span><span class="p">:</span> <span class="s2">&quot;npm run build&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¨­å®š backend çš„ API è·¯å¾‘</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">heroku</span> <span class="ss">config</span><span class="p">:</span><span class="n">set</span> <span class="o">-</span><span class="n">a</span> <span class="n">autheg</span><span class="o">-</span><span class="n">frontend</span><span class="o">-</span><span class="n">demo</span> <span class="no">API_URL</span><span class="o">=</span><span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">autheg</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">demo</span><span class="o">.</span><span class="n">herokuapp</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥è‘—å°±å¯ä»¥åˆ°é¦–é ä¸Šå»æ¸¬è©¦äº†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">autheg</span><span class="o">-</span><span class="n">frontend</span><span class="o">-</span><span class="n">demo</span><span class="o">.</span><span class="n">herokuapp</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
</span><span class='line'><span class="c1"># email: test@example.com</span>
</span><span class='line'><span class="c1"># password: password</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Heroku</h1>

<p>å…¶ä»– heroku åŠŸèƒ½</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># create new heroku project</span>
</span><span class='line'><span class="n">heroku</span> <span class="n">create</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># push heroku</span>
</span><span class='line'><span class="n">git</span> <span class="n">push</span> <span class="n">heroku</span> <span class="n">master</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># env config remove</span>
</span><span class='line'><span class="n">heroku</span> <span class="ss">config</span><span class="p">:</span><span class="n">remove</span> <span class="no">TOKEN</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># log</span>
</span><span class='line'><span class="n">heroku</span> <span class="n">logs</span> <span class="o">--</span><span class="n">tail</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># scale</span>
</span><span class='line'><span class="n">heroku</span> <span class="ss">ps</span><span class="p">:</span><span class="n">scale</span> <span class="n">web</span><span class="o">=</span><span class="mi">2</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ssh</span>
</span><span class='line'><span class="n">heroku</span> <span class="n">run</span> <span class="o">-</span><span class="n">a</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span> <span class="n">bash</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># run æŒ‡ä»¤</span>
</span><span class='line'><span class="n">heroku</span> <span class="n">run</span> <span class="o">-</span><span class="n">a</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">demo</span> <span class="n">rails</span> <span class="n">console</span>
</span></code></pre></td></tr></table></div></figure>


<h1>git subtree</h1>

<p>git subtree æœ¬èº«ä¸æ”¯æ´ force pushï¼Œå› æ­¤è¦é€éå…¶ä»–æ–¹å¼ä¾†é”æˆ</p>

<ul>
<li><a href="https://gist.github.com/tduarte/eac064b4778711b116bb827f8c9bef7b">publish-ghpages.md</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="n">checkout</span> <span class="n">master</span> <span class="c1"># you can avoid this line if you are in master...</span>
</span><span class='line'><span class="n">git</span> <span class="n">subtree</span> <span class="nb">split</span> <span class="o">--</span><span class="n">prefix</span> <span class="n">dist</span> <span class="o">-</span><span class="n">b</span> <span class="n">gh</span><span class="o">-</span><span class="n">pages</span> <span class="c1"># create a local gh-pages branch containing the splitted output folder</span>
</span><span class='line'><span class="n">git</span> <span class="n">push</span> <span class="o">-</span><span class="n">f</span> <span class="n">origin</span> <span class="n">gh</span><span class="o">-</span><span class="ss">pages</span><span class="p">:</span><span class="n">gh</span><span class="o">-</span><span class="n">pages</span> <span class="c1"># force the push of the gh-pages branch to the remote gh-pages branch at origin</span>
</span><span class='line'><span class="n">git</span> <span class="n">branch</span> <span class="o">-</span><span class="n">D</span> <span class="n">gh</span><span class="o">-</span><span class="n">pages</span> <span class="c1"># delete the local gh-pages because you will need it: ref</span>
</span></code></pre></td></tr></table></div></figure>


<p>åƒè€ƒæ–‡ä»¶</p>

<ul>
<li><a href="https://medium.com/@fishpercolator/deploying-your-nuxt-rails-api-app-to-production-with-heroku-54efd09eec22">Deploying your Nuxt+Rails API app to production with Heroku</a></li>
<li><a href="https://hexo.crboy.net/2016/09/amazing-git-subtree/">ç¥å¥‡çš„ Git Subtree</a></li>
<li><a href="http://yutin.logdown.com/posts/188306-git-subtree-total-addendum-library">Git SubTree å…±ç·¨ Library</a></li>
<li><a href="http://erning.net/blog/2012/05/09/the-twelve-factor-app/">The Twelve-Factor App</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails API + Nuxt.js + Devise-JWT]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/17/rails-nuxt-jwt/"/>
    <updated>2018-07-17T17:39:32+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/17/rails-nuxt-jwt</id>
    <content type="html"><![CDATA[<p>åœ¨ç¶²è·¯ä¸Šç™¼ç¾é€™ç¯‡æ–‡ç« ï¼Œè¦ºå¾—å¯«å¾—å¾ˆä¸éŒ¯ï¼Œæ‰€ä»¥é€™æ¬¡å°±è·Ÿè‘—é€™ç¯‡ä¸€èµ·åšä¸€é~</p>

<!-- more-->


<p><a href="https://medium.com/@fishpercolator/how-to-separate-frontend-backend-with-rails-api-nuxt-js-and-devise-jwt-cf7dd9da9d16">How to separate frontend + backend with Rails API, Nuxt.js and Devise-JWT</a></p>

<p>ä¾†å­¸ç¿’ï¼Œ<code>Rails API / Nuxt.js / JWT / Docker</code></p>

<ul>
<li><a href="#part1">Part 1: Creating a development environment</a></li>
<li><a href="#part2">Part 2: Getting them talking to each other</a></li>
<li><a href="#part3">Part 3: Authentication with Devise-JWT</a></li>
</ul>


<h1><span id="part1">Part 1: Creating a development environment</span></h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># backend</span>
</span><span class='line'><span class="n">mkdir</span> <span class="n">autheg</span>
</span><span class='line'><span class="n">cd</span> <span class="n">autheg</span>
</span><span class='line'><span class="n">rails</span> <span class="kp">new</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span> <span class="o">-</span><span class="n">T</span> <span class="o">--</span><span class="n">skip</span><span class="o">-</span><span class="n">spring</span> <span class="o">-</span><span class="n">C</span> <span class="o">-</span><span class="n">B</span> <span class="o">-</span><span class="n">d</span> <span class="n">postgresql</span> <span class="o">--</span><span class="n">api</span>
</span><span class='line'><span class="c1"># -T = skip test</span>
</span><span class='line'><span class="c1"># -C = skip action cable</span>
</span><span class='line'><span class="c1"># -B = skip bundle ä¸»è¦æ˜¯ä½œè€…è¦è·‘åœ¨ docker è£¡é¢</span>
</span><span class='line'><span class="c1"># --api = æ²’æœ‰ä»»ä½• view ç´” API server</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#frontend</span>
</span><span class='line'><span class="n">vue</span> <span class="n">init</span> <span class="n">nuxt</span><span class="o">-</span><span class="n">community</span><span class="o">/</span><span class="n">starter</span><span class="o">-</span><span class="n">template</span> <span class="n">autheg</span><span class="o">-</span><span class="n">frontend</span>
</span><span class='line'><span class="n">cd</span> <span class="n">autheg</span><span class="o">-</span><span class="n">frontend</span>
</span><span class='line'><span class="n">yarn</span> <span class="n">generate</span><span class="o">-</span><span class="n">lock</span><span class="o">-</span><span class="n">entry</span> <span class="o">&gt;</span> <span class="n">yarn</span><span class="o">.</span><span class="n">lock</span>
</span><span class='line'><span class="c1"># è·Ÿ -B é¡ä¼¼ï¼Œç‚ºäº†ä¸ install</span>
</span></code></pre></td></tr></table></div></figure>


<h3>backend</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg/autheg-backend/Dockerfile</span>
</span><span class='line'><span class="no">FROM</span> <span class="ss">ruby</span><span class="p">:</span><span class="mi">2</span><span class="o">.</span><span class="mi">5</span>
</span><span class='line'>
</span><span class='line'><span class="no">ARG</span> <span class="no">UID</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">adduser</span> <span class="n">rails</span> <span class="o">--</span><span class="n">uid</span> <span class="vg">$UID</span> <span class="o">--</span><span class="n">disabled</span><span class="o">-</span><span class="n">password</span> <span class="o">--</span><span class="n">gecos</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="c1"># å¯ä»¥é€é $UID çµ¦äºˆä¸åŒçš„ user IDï¼Œä¸¦ä¸”é€²åˆ°ä»»ä½•çš„ container éƒ½å¯ä»¥ç”¨ç›¸åŒçš„ user ID</span>
</span><span class='line'><span class="c1"># --disabled-password - è®“ rails ç„¡æ³•ç”¨å¯†ç¢¼ç™»å…¥</span>
</span><span class='line'>
</span><span class='line'><span class="no">ENV</span> <span class="no">APP</span> <span class="sr">/usr/s</span><span class="n">rc</span><span class="o">/</span><span class="n">app</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">mkdir</span> <span class="vg">$APP</span>
</span><span class='line'><span class="no">WORKDIR</span> <span class="vg">$APP</span>
</span><span class='line'>
</span><span class='line'><span class="no">COPY</span> <span class="no">Gemfile</span><span class="o">*</span> <span class="vg">$APP</span><span class="o">/</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">bundle</span> <span class="n">install</span> <span class="o">-</span><span class="n">j3</span> <span class="o">--</span><span class="n">path</span> <span class="n">vendor</span><span class="o">/</span><span class="n">bundle</span>
</span><span class='line'><span class="c1"># Gems and yarn packages are installed into the mounted volumes. </span>
</span><span class='line'><span class="c1"># This will stop you from needing to rebuild the whole Docker image every time you change the Gemfile or package.json.</span>
</span><span class='line'>
</span><span class='line'><span class="no">COPY</span> <span class="o">.</span> <span class="vg">$APP</span><span class="o">/</span>
</span><span class='line'>
</span><span class='line'><span class="no">CMD</span> <span class="o">[</span><span class="s2">&quot;bin/rails&quot;</span><span class="p">,</span> <span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;8080&quot;</span><span class="p">,</span> <span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="o">]</span>
</span><span class='line'><span class="c1"># é€™è£¡åŸæœ¬æ˜¯ railsï¼Œä½†å¯¦éš›åœ¨ run çš„æ™‚å€™æœƒæœ‰ errorï¼Œå› æ­¤æ”¹ç‚º bin/rails</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>.dockerignore</code> é¿å… Docker åœ¨ build çš„æ™‚å€™ï¼Œä¸€ä½µè¤‡è£½éå»</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg/autheg-backend/.dockerignore</span>
</span><span class='line'><span class="sr">/vendor/</span><span class="n">bundle</span>
</span><span class='line'><span class="sr">/log</span>
</span><span class='line'><span class="sr">/</span><span class="n">tmp</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg/autheg-backend/.gitignore</span>
</span><span class='line'><span class="sr">/vendor/</span><span class="n">bundle</span><span class="o">/</span>
</span></code></pre></td></tr></table></div></figure>


<h3>frontend</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg/autheg-frontend/Dockerfile</span>
</span><span class='line'>
</span><span class='line'><span class="no">FROM</span> <span class="ss">node</span><span class="p">:</span><span class="mi">9</span>
</span><span class='line'>
</span><span class='line'><span class="no">ARG</span> <span class="no">UID</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">adduser</span> <span class="n">frontend</span> <span class="o">--</span><span class="n">uid</span> <span class="vg">$UID</span> <span class="o">--</span><span class="n">disabled</span><span class="o">-</span><span class="n">password</span> <span class="o">--</span><span class="n">gecos</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">ENV</span> <span class="no">APP</span> <span class="sr">/usr/s</span><span class="n">rc</span><span class="o">/</span><span class="n">app</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">mkdir</span> <span class="vg">$APP</span>
</span><span class='line'><span class="no">WORKDIR</span> <span class="vg">$APP</span>
</span><span class='line'>
</span><span class='line'><span class="no">COPY</span> <span class="n">package</span><span class="o">.</span><span class="n">json</span> <span class="n">yarn</span><span class="o">.</span><span class="n">lock</span> <span class="vg">$APP</span><span class="o">/</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">yarn</span>
</span><span class='line'><span class="c1"># Gems and yarn packages are installed into the mounted volumes. </span>
</span><span class='line'><span class="c1"># This will stop you from needing to rebuild the whole Docker image every time you change the Gemfile or package.json.</span>
</span><span class='line'>
</span><span class='line'><span class="no">COPY</span> <span class="o">.</span> <span class="vg">$APP</span><span class="o">/</span>
</span><span class='line'>
</span><span class='line'><span class="no">CMD</span> <span class="o">[</span><span class="s2">&quot;yarn&quot;</span><span class="p">,</span> <span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;dev&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>.dockerignore</code> é¿å… Docker åœ¨ build çš„æ™‚å€™ï¼Œä¸€ä½µè¤‡è£½éå»</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg/autheg-frontend/.dockerignore</span>
</span><span class='line'><span class="sr">/node_modules/</span>
</span></code></pre></td></tr></table></div></figure>


<h3>all</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg/docker-compose.yml</span>
</span><span class='line'>
</span><span class='line'><span class="ss">version</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span> <span class="c1"># dockerfile ç‰ˆæœ¬ </span>
</span><span class='line'><span class="ss">services</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">db</span><span class="p">:</span> <span class="c1"># å°æ‡‰ rails database.yml çš„ host</span>
</span><span class='line'>    <span class="ss">image</span><span class="p">:</span> <span class="n">postgres</span>
</span><span class='line'>    <span class="ss">ports</span><span class="p">:</span>
</span><span class='line'>      <span class="o">-</span> <span class="s2">&quot;5432&quot;</span>
</span><span class='line'>  <span class="ss">backend</span><span class="p">:</span> <span class="c1"># æœƒè®Šæˆ REPOSITORY name autheg_backend</span>
</span><span class='line'>    <span class="ss">build</span><span class="p">:</span>
</span><span class='line'>      <span class="ss">context</span><span class="p">:</span> <span class="n">autheg</span><span class="o">-</span><span class="n">backend</span> <span class="c1"># è¦ build çš„è³‡æ–™å¤¾ä½ç½®</span>
</span><span class='line'>      <span class="ss">args</span><span class="p">:</span>
</span><span class='line'>        <span class="ss">UID</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="ss">UID</span><span class="p">:</span><span class="o">-</span><span class="mi">1001</span><span class="p">}</span>
</span><span class='line'>    <span class="ss">volumes</span><span class="p">:</span>
</span><span class='line'>      <span class="o">-</span> <span class="o">.</span><span class="n">/autheg</span><span class="o">-</span><span class="ss">backend</span><span class="p">:</span><span class="sr">/usr/s</span><span class="n">rc</span><span class="o">/</span><span class="n">app</span>
</span><span class='line'>      <span class="c1"># æ”¾å“ªè£¡æ²’æœ‰ä¸€å®š /var/www/html,  /usr/src/app,  /home éƒ½æœ‰äººæ”¾</span>
</span><span class='line'>    <span class="ss">ports</span><span class="p">:</span>
</span><span class='line'>      <span class="o">-</span> <span class="s2">&quot;8080:8080&quot;</span>
</span><span class='line'>    <span class="ss">depends_on</span><span class="p">:</span>
</span><span class='line'>      <span class="o">-</span> <span class="n">db</span>
</span><span class='line'>    <span class="ss">user</span><span class="p">:</span> <span class="n">rails</span> <span class="c1"># å°æ‡‰åˆ° adduser çš„åç¨±</span>
</span><span class='line'>  <span class="ss">frontend</span><span class="p">:</span> <span class="c1"># æœƒè®Šæˆ REPOSITORY name autheg_frontend</span>
</span><span class='line'>    <span class="ss">build</span><span class="p">:</span>
</span><span class='line'>      <span class="ss">context</span><span class="p">:</span> <span class="n">autheg</span><span class="o">-</span><span class="n">frontend</span>
</span><span class='line'>      <span class="ss">args</span><span class="p">:</span>
</span><span class='line'>        <span class="ss">UID</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="ss">UID</span><span class="p">:</span><span class="o">-</span><span class="mi">1001</span><span class="p">}</span>
</span><span class='line'>    <span class="ss">volumes</span><span class="p">:</span>
</span><span class='line'>      <span class="o">-</span> <span class="o">.</span><span class="n">/autheg</span><span class="o">-</span><span class="ss">frontend</span><span class="p">:</span><span class="sr">/usr/s</span><span class="n">rc</span><span class="o">/</span><span class="n">app</span>
</span><span class='line'>    <span class="ss">ports</span><span class="p">:</span>
</span><span class='line'>      <span class="o">-</span> <span class="s2">&quot;3000:3000&quot;</span>
</span><span class='line'>    <span class="ss">user</span><span class="p">:</span> <span class="n">frontend</span> <span class="c1"># å°æ‡‰åˆ° adduser çš„åç¨±</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥ä¸‹ä¾†åŸ·è¡Œ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">build</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># docker images</span>
</span><span class='line'><span class="no">REPOSITORY</span>          <span class="no">TAG</span>                 <span class="no">IMAGE</span> <span class="no">ID</span>            <span class="no">CREATED</span>              <span class="no">SIZE</span>
</span><span class='line'><span class="n">autheg_frontend</span>     <span class="n">latest</span>              <span class="mi">18</span><span class="n">b1178326a7</span>        <span class="no">About</span> <span class="n">a</span> <span class="n">minute</span> <span class="n">ago</span>   <span class="mi">890</span><span class="no">MB</span>
</span><span class='line'><span class="n">autheg_backend</span>      <span class="n">latest</span>              <span class="mi">528</span><span class="n">bfe5bf6d6</span>        <span class="mi">2</span> <span class="n">minutes</span> <span class="n">ago</span>        <span class="mi">1</span><span class="o">.</span><span class="mo">03</span><span class="no">GB</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="n">backend</span> <span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># docker ps -a</span>
</span><span class='line'><span class="no">CONTAINER</span> <span class="no">ID</span>        <span class="no">IMAGE</span>               <span class="no">COMMAND</span>                  <span class="no">CREATED</span>              <span class="no">STATUS</span>                          <span class="no">PORTS</span>                     <span class="no">NAMES</span>
</span><span class='line'><span class="n">a11609898c96</span>        <span class="n">autheg_backend</span>      <span class="s2">&quot;bundle&quot;</span>                 <span class="no">About</span> <span class="n">a</span> <span class="n">minute</span> <span class="n">ago</span>   <span class="no">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="no">About</span> <span class="n">a</span> <span class="n">minute</span> <span class="n">ago</span>                             <span class="n">autheg_backend_run_1</span>
</span><span class='line'><span class="n">f088297e9b9b</span>        <span class="n">postgres</span>            <span class="s2">&quot;docker-entrypoint.sâ€¦&quot;</span>   <span class="no">About</span> <span class="n">a</span> <span class="n">minute</span> <span class="n">ago</span>   <span class="no">Up</span> <span class="no">About</span> <span class="n">a</span> <span class="n">minute</span>               <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span><span class="mi">32783</span><span class="o">-&gt;</span><span class="mi">5432</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">autheg_db_1</span>
</span><span class='line'>
</span><span class='line'><span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span>
</span><span class='line'><span class="c1"># DRIVER              VOLUME NAME</span>
</span><span class='line'><span class="c1"># local               64117d4ab46a1d0575cc7136e745cc70bf568cfb3e200c80c69ae035cde89085</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="n">frontend</span> <span class="n">yarn</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># docker ps -a</span>
</span><span class='line'><span class="no">CONTAINER</span> <span class="no">ID</span>        <span class="no">IMAGE</span>               <span class="no">COMMAND</span>                  <span class="no">CREATED</span>                  <span class="no">STATUS</span>                     <span class="no">PORTS</span>                     <span class="no">NAMES</span>
</span><span class='line'><span class="n">d51e53bd1370</span>        <span class="n">autheg_frontend</span>     <span class="s2">&quot;yarn&quot;</span>                   <span class="no">Less</span> <span class="n">than</span> <span class="n">a</span> <span class="n">second</span> <span class="n">ago</span>   <span class="no">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="mi">3</span> <span class="n">seconds</span> <span class="n">ago</span>                             <span class="n">autheg_frontend_run_1</span>
</span><span class='line'><span class="n">a11609898c96</span>        <span class="n">autheg_backend</span>      <span class="s2">&quot;bundle&quot;</span>                 <span class="mi">3</span> <span class="n">minutes</span> <span class="n">ago</span>            <span class="no">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="mi">3</span> <span class="n">minutes</span> <span class="n">ago</span>                             <span class="n">autheg_backend_run_1</span>
</span><span class='line'><span class="n">f088297e9b9b</span>        <span class="n">postgres</span>            <span class="s2">&quot;docker-entrypoint.sâ€¦&quot;</span>   <span class="mi">3</span> <span class="n">minutes</span> <span class="n">ago</span>            <span class="no">Up</span> <span class="mi">3</span> <span class="n">minutes</span>               <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span><span class="mi">32783</span><span class="o">-&gt;</span><span class="mi">5432</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">autheg_db_1</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¦å†è·‘ bundle &amp; yarn æ˜¯å› ç‚ºæœ‰åš volumesï¼Œå› æ­¤åˆ©ç”¨ docker æ‰€å»ºç«‹çš„ç’°å¢ƒï¼Œè·‘ host çš„ bundle &amp; yarnï¼Œè®“å…©é‚Šä¸€è‡´</p>

<blockquote><p>The reason you need to run bundle and yarn after building is because your docker-compose file mounts your host volumes into the containers so you need to install the packages into the host volumes as well as the images that are used to create the containers</p></blockquote>

<h3>ç·¨è¼¯ database.yml &amp; package.json</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'> default: &amp;default
</span><span class='line'>   adapter: postgresql
</span><span class='line'>   encoding: unicode
</span><span class='line'><span class="gi">+  host: db</span>
</span><span class='line'><span class="gi">+  username: postgres</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>   &quot;private&quot;: true,
</span><span class='line'>   &quot;scripts&quot;: {
</span><span class='line'><span class="gd">-    &quot;dev&quot;: &quot;nuxt&quot;,</span>
</span><span class='line'><span class="gi">+    &quot;dev&quot;: &quot;HOST=0.0.0.0 nuxt&quot;,</span>
</span><span class='line'>     &quot;build&quot;: &quot;nuxt build&quot;,
</span><span class='line'>     &quot;start&quot;: &quot;nuxt start&quot;,
</span><span class='line'>     &quot;generate&quot;: &quot;nuxt generate&quot;,
</span></code></pre></td></tr></table></div></figure>


<p><code>HOST=0.0.0.0 nuxt</code> so itâ€™s visible on your host machine</p>

<p>å†å•Ÿå‹•ä¸€å€‹ container ç”¨ä¾†å»ºç«‹æ–°è³‡æ–™åº«</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='diff'><span class='line'>docker-compose run backend bin/rails db:create
</span></code></pre></td></tr></table></div></figure>


<p>æ­¤æ™‚ db æœƒ create åœ¨ï¼Œä¸€é–‹å§‹è¨­å®šçš„ db container <code>autheg_db_1</code> è£¡é¢ï¼Œå¯ä»¥</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span> <span class="nb">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">autheg_db_1</span> <span class="n">bash</span>
</span><span class='line'><span class="n">su</span> <span class="o">-</span> <span class="n">postgres</span>
</span><span class='line'><span class="n">psql</span> <span class="o">-</span><span class="n">ls</span>
</span><span class='line'><span class="c1"># å°±æœƒçœ‹åˆ° create å¥½çš„ database</span>
</span></code></pre></td></tr></table></div></figure>


<p>çœ‹ä¸€ä¸‹ç›®å‰ç”¢ç”Ÿçš„ container</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># docker ps -a</span>
</span><span class='line'><span class="no">CONTAINER</span> <span class="no">ID</span>        <span class="no">IMAGE</span>               <span class="no">COMMAND</span>                  <span class="no">CREATED</span>             <span class="no">STATUS</span>                     <span class="no">PORTS</span>                     <span class="no">NAMES</span>
</span><span class='line'><span class="mi">85</span><span class="n">d3ec81e943</span>        <span class="n">autheg_backend</span>      <span class="s2">&quot;bin/rails db:create&quot;</span>    <span class="mi">6</span> <span class="n">minutes</span> <span class="n">ago</span>       <span class="no">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="mi">6</span> <span class="n">minutes</span> <span class="n">ago</span>                             <span class="n">autheg_backend_run_2</span>
</span><span class='line'><span class="mi">6</span><span class="n">e1f7b406a70</span>        <span class="n">autheg_frontend</span>     <span class="s2">&quot;yarn&quot;</span>                   <span class="mi">7</span> <span class="n">minutes</span> <span class="n">ago</span>       <span class="no">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="mi">7</span> <span class="n">minutes</span> <span class="n">ago</span>                             <span class="n">autheg_frontend_run_1</span>
</span><span class='line'><span class="mi">55</span><span class="n">ff63bb46e9</span>        <span class="n">autheg_backend</span>      <span class="s2">&quot;bundle&quot;</span>                 <span class="mi">25</span> <span class="n">minutes</span> <span class="n">ago</span>      <span class="no">Exited</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="mi">8</span> <span class="n">minutes</span> <span class="n">ago</span>                             <span class="n">autheg_backend_run_1</span>
</span><span class='line'><span class="n">e889c2e713d0</span>        <span class="n">postgres</span>            <span class="s2">&quot;docker-entrypoint.sâ€¦&quot;</span>   <span class="mi">25</span> <span class="n">minutes</span> <span class="n">ago</span>      <span class="no">Up</span> <span class="mi">25</span> <span class="n">minutes</span>              <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">:</span><span class="mi">32770</span><span class="o">-&gt;</span><span class="mi">5432</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">autheg_db_1</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°‡æ‰€æœ‰ container å•Ÿå‹•</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span>
</span><span class='line'><span class="c1"># docker-compose stop</span>
</span><span class='line'><span class="c1"># docker-compose down</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°±èƒ½çœ‹åˆ°</p>

<ul>
<li>rails : <code>http://localhost:8080/</code></li>
<li>nuxt : <code>http://localhost:3000/</code></li>
</ul>


<p><img src="https://cdn-images-1.medium.com/max/1600/1*hoai7Zion_e9-0uZQGr1Sw.png" alt="" />
<em>from <a href="https://medium.com/@fishpercolator/how-to-separate-frontend-backend-with-rails-api-nuxt-js-and-devise-jwt-cf7dd9da9d16">How to separate frontend + backend with Rails API, Nuxt.js and Devise-JWT</a></em></p>

<h1><span id="part2">Part 2: Getting them talking to each other</span></h1>

<p>æ–°å¢ table, model, controller</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="n">backend</span> <span class="n">bash</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">g</span> <span class="n">resource</span> <span class="n">example</span> <span class="nb">name</span><span class="ss">:string</span> <span class="ss">colour</span><span class="p">:</span><span class="n">string</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">c</span>
</span><span class='line'><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;purple&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="p">,</span><span class="n">c</span><span class="o">|</span> <span class="no">Example</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="ss">colour</span><span class="p">:</span> <span class="n">c</span><span class="p">)}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç·¨è¼¯ controller</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/app/controllers/examples_controller.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ExamplesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="n">examples</span> <span class="o">=</span> <span class="no">Example</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:colour</span><span class="p">)</span>
</span><span class='line'>    <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="n">examples</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/config/routes.rb</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:api</span><span class="p">,</span> <span class="ss">defaults</span><span class="p">:</span> <span class="p">{</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span> <span class="p">}</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">resources</span> <span class="ss">:examples</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>é€™å€‹æ­¥é©Ÿç›®å‰å…ˆä¸åšï¼Œè¦ç­‰å¾Œé¢å®‰è£ <code>devise</code> æ‰éœ€è¦</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/app/controllers/application_controller.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">API</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">MimeResponds</span>
</span><span class='line'>  <span class="n">respond_to</span> <span class="ss">:json</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç¾åœ¨æ‰“ <code>http://localhost:8080/api/examples</code> å°±æœƒçœ‹åˆ°</p>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*76hf6XcYJM_xLdpbd0jZGw.png" alt="" />
<em>from <a href="https://medium.com/@fishpercolator/how-to-separate-frontend-backend-with-rails-api-nuxt-js-and-devise-jwt-cf7dd9da9d16">How to separate frontend + backend with Rails API, Nuxt.js and Devise-JWT</a></em></p>

<p>æ¥è‘—å®‰è£ <a href="https://github.com/axios/axios">axios</a> &amp; <a href="https://vuetifyjs.com/en/">vuetify</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="n">frontend</span> <span class="n">yarn</span> <span class="n">add</span> <span class="vi">@nuxtjs</span><span class="o">/</span><span class="n">axios</span> <span class="vi">@nuxtjs</span><span class="o">/</span><span class="n">vuetify</span>
</span></code></pre></td></tr></table></div></figure>


<p>é€™é‚Šæ˜¯ hardcode åœ¨ä¸Šé¢ï¼Œæ­£å¼æ©Ÿä¸æ‡‰è©²é€™æ¨£å¯«</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// autheg-frontend/nuxt.config.js</span>
</span><span class='line'>  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="s1">&#39;@nuxtjs/vuetify&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;@nuxtjs/axios&#39;</span>
</span><span class='line'>  <span class="p">],</span>
</span><span class='line'>  <span class="nx">axios</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">port</span><span class="o">:</span> <span class="mi">8080</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">prefix</span><span class="o">:</span> <span class="s1">&#39;/api&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ›´æ”¹ç•«é¢</p>

<p>The <code>nuxt</code> option to the link tells it to use Nuxtâ€™s router to handle the link, rather than doing it in the browser.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// autheg-frontend/layouts/default.vue</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;app&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">app</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">toolbar</span> <span class="nx">app</span> <span class="nx">dark</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">toolbar</span><span class="o">-</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Auth</span> <span class="nx">example</span><span class="o">&lt;</span><span class="err">/v-toolbar-title&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">spacer</span> <span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">btn</span> <span class="nx">icon</span> <span class="nx">nuxt</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">icon</span><span class="o">&gt;</span><span class="nx">home</span><span class="o">&lt;</span><span class="err">/v-icon&gt;&lt;/v-btn&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/v-toolbar&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">content</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">container</span> <span class="nx">fluid</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">nuxt</span><span class="o">/&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/v-container&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/v-content&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/v-app&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>mounted()</code> æœƒåœ¨ template åˆå§‹åŒ–çš„æ™‚å€™å‘¼å«ï¼Œä¸¦ä¸”æœƒ call <code>updateExamples()</code> methodï¼Œå» call <code>/examples</code> API æ‹¿è³‡æ–™å›ä¾†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// autheg-frontend/pages/index.vue</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">layout</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">flex</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">list</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">list</span><span class="o">-</span><span class="nx">tile</span> <span class="nx">v</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;example in examples&quot;</span> <span class="o">:</span><span class="nx">key</span><span class="o">=</span><span class="s2">&quot;example.id&quot;</span> <span class="o">:</span><span class="kr">class</span><span class="o">=</span><span class="s2">&quot;example.colour&quot;</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">list</span><span class="o">-</span><span class="nx">tile</span><span class="o">-</span><span class="nx">content</span><span class="o">&gt;</span><span class="p"></span><span class="o">&lt;</span><span class="err">/v-list-tile-content&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/v-list-tile&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/v-list&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/v-layout&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">examples</span><span class="o">:</span> <span class="p">[]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">async</span> <span class="nx">updateExamples</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">examples</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">$get</span><span class="p">(</span><span class="s1">&#39;/examples&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">updateExamples</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥è‘—æœƒçœ‹åˆ° browser console æœƒ errorï¼Œä¸»è¦æ˜¯å› ç‚º <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CROS</a> çš„åŸå› </p>

<blockquote><p>JavaScript isnâ€™t allowed to query endpoints on other domains unless those domains set the CORS headers appropriately</p></blockquote>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*5PhACGlQd7cfjiA-DqksuA.png" alt="" />
<em>from <a href="https://medium.com/@fishpercolator/how-to-separate-frontend-backend-with-rails-api-nuxt-js-and-devise-jwt-cf7dd9da9d16">How to separate frontend + backend with Rails API, Nuxt.js and Devise-JWT</a></em></p>

<p>æ¥è‘—è¦å» <code>backend</code> æ–°å¢ <code>cros</code> çš„è¨­å®šï¼Œè®“ <code>frontend</code> å¯ä»¥ call</p>

<p>å…ˆå°‡ Gemfile çš„ comment æ‰“é–‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/Gemfile</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;rack-cors&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># autheg-backend/config/initializers/cors.rb</span>
</span><span class='line'>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">insert_before</span> <span class="mi">0</span><span class="p">,</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Cors</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">allow</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">origins</span> <span class="s1">&#39;localhost:3000&#39;</span> <span class="c1"># ä¹Ÿå¯ä»¥ * å°±æ˜¯æ‰€æœ‰ domain éƒ½å¯ä»¥æ‰“é€²ä¾†</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">resource</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">headers</span><span class="p">:</span> <span class="ss">:any</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">methods</span><span class="p">:</span> <span class="o">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:put</span><span class="p">,</span> <span class="ss">:patch</span><span class="p">,</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">:options</span><span class="p">,</span> <span class="ss">:head</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥è‘—è·‘</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="n">backend</span> <span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶å¾Œé‡æ–°èµ·å‹• container</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ctrl</span> <span class="o">+</span> <span class="n">c</span>
</span><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://cdn-images-1.medium.com/max/1600/1*LUreZEc1i0c5WfhoDCLxSQ.png" alt="" />
<em>from <a href="https://medium.com/@fishpercolator/how-to-separate-frontend-backend-with-rails-api-nuxt-js-and-devise-jwt-cf7dd9da9d16">How to separate frontend + backend with Rails API, Nuxt.js and Devise-JWT</a></em></p>

<h1><span id="part3">Part 3: Authentication with Devise-JWT</span></h1>

<p>é€™æ¬¡è¦åŠ ä¸Š devise åŠ ä¸Š JWT</p>

<ul>
<li><a href="https://jwt.io/">JWT</a></li>
<li><a href="https://github.com/plataformatec/devise">devise</a></li>
<li><a href="https://github.com/waiting-for-dev/devise-jwt">devise-jwt</a></li>
</ul>


<p>å…ˆåœ¨ Gemfile æ–°å¢</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/Gemfile</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;devise&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;devise-jwt&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>bundle</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="n">backend</span> <span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥è‘—å…ˆå®‰è£ devise åƒè€ƒ <a href="https://github.com/plataformatec/devise#getting-started">getting-started</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># é–‹æ–°çš„ container å®‰è£ devise</span>
</span><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="n">backend</span> <span class="n">bash</span>
</span><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">g</span> <span class="ss">devise</span><span class="p">:</span><span class="n">install</span>
</span><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">g</span> <span class="n">devise</span> <span class="n">user</span>
</span><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span></code></pre></td></tr></table></div></figure>


<p>åˆ°é€™å€‹æ­¥é©Ÿéƒ½é‚„æ²’ç”¨åˆ° <a href="https://jwt.io/">JWT</a>ï¼Œæ¥ä¸‹ä¾†è¦è¦æ±ºå®šå¦‚ä½•ä½¿ä»¤ç‰Œç„¡æ•ˆï¼ŒåŸæ–‡é¸æ“‡ç”¨ <code>é»‘åå–®</code> çš„æ–¹å¼</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="n">jwt_blacklist</span> <span class="ss">jti</span><span class="p">:</span><span class="ss">string</span><span class="p">:</span><span class="n">index</span> <span class="ss">exp</span><span class="p">:</span><span class="n">datetime</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸¦å°‡æ¬„ä½åŠ ä¸Š <code>null: false</code> å’Œç§»é™¤ <code>t.timestamps</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>  <span class="n">create_table</span> <span class="ss">:jwt_blacklists</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:jti</span><span class="p">,</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="ss">:exp</span><span class="p">,</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">add_index</span> <span class="ss">:jwt_blacklists</span><span class="p">,</span> <span class="ss">:jti</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨ model åŠ ä¸Š <code>include Devise::JWT::RevocationStrategies::Blacklist</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/app/models/jwt_blacklist.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">JwtBlacklist</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Devise</span><span class="o">::</span><span class="no">JWT</span><span class="o">::</span><span class="no">RevocationStrategies</span><span class="o">::</span><span class="no">Blacklist</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>secret setting</h3>

<blockquote><p>åœ¨é€™è£¡é‡åˆ°å€‹å•é¡Œ <a href="https://github.com/waiting-for-dev/devise-jwt/issues/56">No implicit conversion of nil into String</a>ï¼Œä¸»è¦æ˜¯ç”¨çš„ rails ç‰ˆæœ¬ï¼Œèˆ‡åŸæ–‡ç« çš„ ralis(5.1) ä¸åŒï¼Œå°è‡´é‡åˆ°åœ¨ 5.2 ç‰ˆæœ¬æ™‚å·²ç¶“æ²’æœ‰ <code>secrets.yml</code>&hellip; è½‰è€Œæ”¹ç”¨ <code>credentials.yml.enc</code>ï¼Œæ‰€ä»¥åœ¨é€™è£¡è¨˜éŒ„ä¸€ä¸‹å…©å€‹ç‰ˆæœ¬çš„è¨­å®š</p></blockquote>

<h3>Before rails 5.2</h3>

<p>æ¥è‘—ç”¢ç”Ÿä¸€çµ„ secretï¼Œåšè¨­å®š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">secret</span>
</span><span class='line'><span class="c1"># 9dd044df628a496e83c668f..</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/config/secrets.yml</span>
</span><span class='line'><span class="ss">development</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">secret_key_base</span><span class="p">:</span> <span class="n">xxx</span>
</span><span class='line'>  <span class="ss">jwt_secret</span><span class="p">:</span> <span class="mi">9</span><span class="n">dd044df628a496e83c668f</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'>
</span><span class='line'><span class="nb">test</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">secret_key_base</span><span class="p">:</span> <span class="n">xxx</span>
</span><span class='line'>  <span class="ss">jwt_secret</span><span class="p">:</span> <span class="mi">9</span><span class="n">dd044df628a496e83c668f</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'>
</span><span class='line'><span class="ss">production</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">secret_key_base</span><span class="p">:</span> <span class="o">&lt;</span><span class="sx">%= ENV[&quot;SECRET_KEY_BASE&quot;] %&gt;</span>
</span><span class='line'><span class="sx">  jwt_secret: &lt;%=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;JWT_SECRET&quot;</span><span class="o">]</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/config/initializers/devise.rb</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">jwt</span> <span class="k">do</span> <span class="o">|</span><span class="n">jwt</span><span class="o">|</span>
</span><span class='line'>  <span class="n">jwt</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">secrets</span><span class="o">.</span><span class="n">jwt_secret</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>After rails 5.2</h3>

<ul>
<li><a href="https://medium.com/cedarcode/rails-5-2-credentials-9b3324851336">Rails 5.2 credentials</a></li>
<li><a href="https://www.viget.com/articles/storing-secret-credentials-in-rails-5-2-and-up/">Storing Secret Credentials in Rails 5.2 and Up</a></li>
<li><a href="https://keithpblog.org/post/encrypted-secrets/">Rails 5.2: encrypted secrets</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">secret</span>
</span><span class='line'><span class="c1"># 9dd044df628a496e83c668f..</span>
</span></code></pre></td></tr></table></div></figure>


<p>é€™æ™‚å¿…é ˆåœ¨ consoleåŸ·è¡Œ <code>EDITOR="vim" rails credentials:edit</code>ï¼Œä½†æ˜¯åœ¨ container ä¸¦æ²’æœ‰ <code>vim</code> å’Œ <code>sudo</code> é€™å€‹æŒ‡ä»¤ï¼Œå› æ­¤è¦å…ˆåˆ‡æ›æˆ root å»å®‰è£ <code>vim</code> æ‰æœ‰è¾¦æ³•åŸ·è¡Œ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="n">backend</span> <span class="n">bash</span>
</span><span class='line'><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
</span><span class='line'><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">vim</span> <span class="o">-</span><span class="n">y</span> <span class="c1"># å®‰è£ vim </span>
</span><span class='line'><span class="no">EDITOR</span><span class="o">=</span><span class="s2">&quot;vim&quot;</span> <span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="ss">credentials</span><span class="p">:</span><span class="n">edit</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># æ¥è‘—ç·¨è¼¯</span>
</span><span class='line'><span class="ss">secret_key_base</span><span class="p">:</span> <span class="n">xxx</span>
</span><span class='line'><span class="ss">jwt_secret</span><span class="p">:</span> <span class="mi">9</span><span class="n">dd044df628a496e83c668f</span><span class="o">.</span><span class="n">.</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/config/initializers/devise.rb</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">jwt</span> <span class="k">do</span> <span class="o">|</span><span class="n">jwt</span><span class="o">|</span>
</span><span class='line'>  <span class="n">jwt</span><span class="o">.</span><span class="n">secret</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">credentials</span><span class="o">[</span><span class="ss">:jwt_secret</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢ secret è¨­å®šå¥½å°±å¯ä»¥ç¹¼çºŒ</p>

<p>è¨­å®š <code>response format</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/app/controllers/application_controller.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">API</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">MimeResponds</span>
</span><span class='line'>  <span class="n">respond_to</span> <span class="ss">:json</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/app/models/user.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
</span><span class='line'>  <span class="c1"># Include default devise modules. Others available are:</span>
</span><span class='line'>  <span class="c1"># :confirmable, :lockable, :timeoutable and :omniauthable</span>
</span><span class='line'>  <span class="n">devise</span> <span class="ss">:database_authenticatable</span><span class="p">,</span> <span class="ss">:registerable</span><span class="p">,</span>
</span><span class='line'>         <span class="ss">:recoverable</span><span class="p">,</span> <span class="ss">:rememberable</span><span class="p">,</span> <span class="ss">:trackable</span><span class="p">,</span> <span class="ss">:validatable</span><span class="p">,</span>
</span><span class='line'>         <span class="ss">:jwt_authenticatable</span><span class="p">,</span> <span class="ss">jwt_revocation_strategy</span><span class="p">:</span> <span class="no">JwtBlacklist</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¨­å®šå¥½è·‘</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°‡ router çš„ <code>devise_scope :user</code> ç§»åˆ° api scope è£¡é¢</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="c1"># For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:api</span><span class="p">,</span> <span class="ss">defaults</span><span class="p">:</span> <span class="p">{</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span> <span class="p">}</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">resources</span> <span class="ss">:examples</span>
</span><span class='line'>    <span class="n">devise_for</span> <span class="ss">:users</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>restart containers</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ctrl</span> <span class="o">+</span> <span class="n">c</span>
</span><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span>
</span></code></pre></td></tr></table></div></figure>


<p>console æ–°å¢ä¸€å€‹ User</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">c</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s1">&#39;test@example.com&#39;</span><span class="p">,</span> <span class="ss">password</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥ä¸‹ä¾†å°±å¯ä»¥ä¾†æ¸¬è©¦ <code>user login</code> åŸæ–‡æ¨è–¦ä½¿ç”¨ <a href="http://yet-another-rest-client.com/">YARC</a> ä¸éå€‹äººåå¥½ <a href="https://www.getpostman.com/">Postman</a>ï¼Œéƒ½å¯ä»¥</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">POST</span> <span class="sr">/api/use</span><span class="n">rs</span><span class="o">/</span><span class="n">sign_in</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="s2">&quot;user&quot;</span><span class="p">:{</span>
</span><span class='line'>      <span class="s2">&quot;email&quot;</span><span class="ss">:&quot;test@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;password&quot;</span><span class="ss">:&quot;password&quot;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://cdn-images-1.medium.com/max/1600/1*2cTvgN1s2-6VkCLknzuwXQ.png" alt="" />
<em>from <a href="https://medium.com/@fishpercolator/how-to-separate-frontend-backend-with-rails-api-nuxt-js-and-devise-jwt-cf7dd9da9d16">How to separate frontend + backend with Rails API, Nuxt.js and Devise-JWT</a></em></p>

<p>é€™è£¡å¯ä»¥çœ‹åˆ° Response Headers å¤šäº†ä¸€å€‹æ¬„ä½</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># åŸæœ¬</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;x-runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;0.496080&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;etag&quot;</span><span class="p">:</span> <span class="s2">&quot;W/</span><span class="se">\&quot;</span><span class="s2">9a9c93785c7d5e5890c3189efa33ca10</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;vary&quot;</span><span class="p">:</span> <span class="s2">&quot;Origin&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;cache-control&quot;</span><span class="p">:</span> <span class="s2">&quot;max-age=0, private, must-revalidate&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;transfer-encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;chunked&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;x-request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;c6a59d67-2551-496f-8f99-f69c5b79bd75&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">201</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># åŠ ä¸Š jwt</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;x-runtime&quot;</span><span class="p">:</span> <span class="s2">&quot;0.998534&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;etag&quot;</span><span class="p">:</span> <span class="s2">&quot;W/</span><span class="se">\&quot;</span><span class="s2">d2403cf91d814bea7a094efecd1e0ae9</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwic2NwIjoidXNlciIsImF1ZCI6bnVsbCwiaWF0IjoxNTMxNjY2NjA0LCJleHAiOjE1MzE2NzAyMDQsImp0aSI6ImYzMjkxMWViLTY0ZDEtNDU0NS1iNGJjLTQ5MjE2NjQwMDc1OCJ9.nP5vGhbiPfC5acnQOusY_bEZCAWF2TZ29vq28SMUX2U&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;vary&quot;</span><span class="p">:</span> <span class="s2">&quot;Origin&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;cache-control&quot;</span><span class="p">:</span> <span class="s2">&quot;max-age=0, private, must-revalidate&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;transfer-encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;chunked&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;x-request-id&quot;</span><span class="p">:</span> <span class="s2">&quot;4eec0e2f-5cb5-4c4d-9ed9-be9385c79a5d&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="mi">201</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥è‘—è¦ä¾†è¦†è“‹æ‰ devise åŸæœ¬çš„ session controllerï¼Œè®“æˆ‘å€‘å¯ä»¥å°‡ jwt åŠ é€²å»</p>

<p>å…ˆ generate devise å…§å»ºçš„ sessino controller</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">generate</span> <span class="ss">devise</span><span class="p">:</span><span class="n">controllers</span> <span class="n">users</span> <span class="o">-</span><span class="n">c</span><span class="o">=</span><span class="n">sessions</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸¦ä¸”æ–°å¢ä¸€å€‹ routerï¼Œå·²ä¾¿å¯ä»¥æ‹¿åˆ° user çš„ detail è³‡è¨Š</p>

<blockquote><p>é€™è£¡è·ŸåŸæ–‡ç« ä¸å¤ªä¸€æ¨£ï¼Œé€™é‚Šæ˜¯è—‰ç”± devise å…§å»ºçš„ generate ç”¢ç”Ÿ session controller fileï¼Œæ˜¯æ”¾åœ¨ app/controller/users/sessions_controller.rbï¼ŒåŸæ–‡ç« æ‡‰è©²æ˜¯è‡ªè¡Œå»ºç«‹çš„æª”æ¡ˆæ”¾åœ¨ app/controller/sessions_controller.rbï¼Œå› æ­¤åº•ä¸‹çš„ router è¨­å®šä¹Ÿæœƒæœ‰ç¨å¾®ä¸åŒ</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/config/routes.rb</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:api</span><span class="p">,</span> <span class="ss">defaults</span><span class="p">:</span> <span class="p">{</span> <span class="nb">format</span><span class="p">:</span> <span class="ss">:json</span> <span class="p">}</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">resources</span> <span class="ss">:examples</span>
</span><span class='line'>    <span class="n">devise_for</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">controllers</span><span class="p">:</span> <span class="p">{</span> <span class="ss">sessions</span><span class="p">:</span> <span class="s1">&#39;users/sessions&#39;</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">devise_scope</span> <span class="ss">:user</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">get</span> <span class="s1">&#39;users/current&#39;</span><span class="p">,</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;users/sessions#show&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°‡ Gemfile è£¡çš„ <code>jbuilder</code> gem æ‰“é–‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;jbuilder&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 2.5&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="n">backend</span> <span class="n">bundle</span>
</span><span class='line'><span class="c1"># restart containers</span>
</span><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/app/controllers/users/sessions_controller.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Users</span><span class="o">::</span><span class="no">SessionsController</span> <span class="o">&lt;</span> <span class="no">Devise</span><span class="o">::</span><span class="no">SessionsController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="k">super</span> <span class="p">{</span> <span class="vi">@token</span> <span class="o">=</span> <span class="n">current_token</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">current_token</span>
</span><span class='line'>    <span class="n">request</span><span class="o">.</span><span class="n">env</span><span class="o">[</span><span class="s1">&#39;warden-jwt_auth.token&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/app/views/users/create.json.jbuilder</span>
</span><span class='line'><span class="n">json</span><span class="o">.</span><span class="n">token</span> <span class="vi">@token</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/app/views/users/show.json.jbuilder</span>
</span><span class='line'><span class="k">if</span> <span class="n">user_signed_in?</span>
</span><span class='line'>  <span class="n">json</span><span class="o">.</span><span class="n">user</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">json</span><span class="o">.</span><span class="p">(</span><span class="n">current_user</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:email</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥ä¸‹ä¾†å¯ä»¥æ¸¬è©¦ login äº†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># ç™»å…¥æ‹¿ token</span>
</span><span class='line'><span class="no">POST</span> <span class="sr">/api/use</span><span class="n">rs</span><span class="o">/</span><span class="n">sign_in</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="s2">&quot;user&quot;</span><span class="p">:{</span>
</span><span class='line'>      <span class="s2">&quot;email&quot;</span><span class="ss">:&quot;test@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;password&quot;</span><span class="ss">:&quot;password&quot;</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># åœ¨ Header åŠ ä¸Šå‰›å‰›ç™»å…¥æ‹¿åˆ°çš„ token</span>
</span><span class='line'><span class="c1"># &quot;authorization&quot;: &quot;Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdW ...&quot;</span>
</span><span class='line'><span class="no">GET</span> <span class="sr">/api/use</span><span class="n">rs</span><span class="o">/</span><span class="n">current</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ç™»å‡ºï¼Œè¨˜å¾—ä¹Ÿè¦å¸¶ token æ‰çŸ¥é“èª°è¦ç™»å‡º</span>
</span><span class='line'><span class="c1"># &quot;authorization&quot;: &quot;Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdW ...&quot;</span>
</span><span class='line'><span class="no">DELETE</span> <span class="sr">/api/use</span><span class="n">rs</span><span class="o">/</span><span class="n">sign_out</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¸¬è©¦ ok å¾Œï¼Œæ¥ä¸‹ä¾†åœ¨ <code>ExamplesController</code> åŠ ä¸Š <code>authentication</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># autheg-backend/app/controllers/examples_controller.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ExamplesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">before_action</span> <span class="ss">:authenticate_user!</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="n">examples</span> <span class="o">=</span> <span class="no">Example</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:colour</span><span class="p">)</span>
</span><span class='line'>    <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="n">examples</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>é€™æ™‚ <code>GET /api/examples</code> å°±å¿…é ˆå¸¶ <code>token</code> å¦å‰‡æœƒ <code>error</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">GET</span> <span class="sr">/api/ex</span><span class="n">amples</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;You need to sign in or sign up before continuing.&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥ä¸‹ä¾†å›åˆ° frontendï¼Œæœƒç™¼ç¾ <code>401 Unauthorized error</code> æ‰€ä»¥è¦åœ¨ frontend åŠ ä¸Š <code>authentication</code></p>

<p>æ–°å¢å¾Œç«¯ <code>sign_in</code> <code>sign_out</code> <code>detail</code> API &amp; <code>@nuxtjs/auth</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">run</span> <span class="n">frontend</span> <span class="n">yarn</span> <span class="n">add</span> <span class="vi">@nuxtjs</span><span class="o">/</span><span class="n">auth</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// autheg-frontend/nuxt.config.js</span>
</span><span class='line'><span class="nx">modules</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>  <span class="s1">&#39;@nuxtjs/vuetify&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;@nuxtjs/axios&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;@nuxtjs/auth&#39;</span>
</span><span class='line'><span class="p">],</span>
</span><span class='line'><span class="nx">auth</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">endpoints</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">login</span><span class="o">:</span>  <span class="p">{</span> <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/users/sign_in&#39;</span> <span class="p">},</span>
</span><span class='line'>    <span class="nx">logout</span><span class="o">:</span> <span class="p">{</span> <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/users/sign_out&#39;</span><span class="p">,</span> <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;delete&#39;</span> <span class="p">},</span>
</span><span class='line'>    <span class="nx">user</span><span class="o">:</span>   <span class="p">{</span> <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/users/current&#39;</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// autheg-frontend/store/index.js</span>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">state</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
</span><span class='line'>  <span class="p">})</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>restart container è®“ frontend åƒåˆ°å‰›å‰›çš„è¨­å®š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// autheg-frontend/pages/login.vue</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">layout</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">flex</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">card</span> <span class="nx">v</span><span class="o">-</span><span class="k">if</span><span class="o">=</span><span class="s2">&quot;$auth.state.loggedIn&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">alert</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;error&quot;</span> <span class="o">:</span><span class="nx">value</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="o">&gt;</span><span class="p"></span><span class="o">&lt;</span><span class="err">/v-alert&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">card</span><span class="o">-</span><span class="nx">text</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="nx">Logged</span> <span class="k">in</span> <span class="nx">as</span> <span class="p"></span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/v-card-text&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">card</span><span class="o">-</span><span class="nx">actions</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">btn</span> <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&quot;logout&quot;</span><span class="o">&gt;</span><span class="nx">Log</span> <span class="nx">out</span><span class="o">&lt;</span><span class="err">/v-btn&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/v-card-actions&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/v-card&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">card</span> <span class="nx">v</span><span class="o">-</span><span class="k">else</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">alert</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;error&quot;</span> <span class="o">:</span><span class="nx">value</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="o">&gt;</span><span class="p"></span><span class="o">&lt;</span><span class="err">/v-alert&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">card</span><span class="o">-</span><span class="nx">text</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">form</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">text</span><span class="o">-</span><span class="nx">field</span> <span class="nx">v</span><span class="o">-</span><span class="nx">model</span><span class="o">=</span><span class="s2">&quot;email&quot;</span> <span class="nx">label</span><span class="o">=</span><span class="s2">&quot;Email&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">text</span><span class="o">-</span><span class="nx">field</span> <span class="nx">v</span><span class="o">-</span><span class="nx">model</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="nx">label</span><span class="o">=</span><span class="s2">&quot;Password&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="err">/v-form&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">card</span><span class="o">-</span><span class="nx">actions</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">btn</span> <span class="err">@</span><span class="nx">click</span><span class="o">=</span><span class="s2">&quot;login&quot;</span><span class="o">&gt;</span><span class="nx">Log</span> <span class="k">in</span><span class="o">&lt;</span><span class="err">/v-btn&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="err">/v-card-actions&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/v-card-text&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/v-card&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/v-layout&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nx">error</span><span class="o">:</span> <span class="kc">null</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">login</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span><span class="p">.</span><span class="nx">login</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">email</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">password</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">logout</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">$auth</span><span class="p">.</span><span class="nx">logout</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç¾åœ¨å¯ä»¥åˆ° <code>/login</code> è©¦è©¦çœ‹ç™»å…¥äº†</p>

<p>å¦‚æœæƒ³è¦è®“ user æ²’æœ‰ login çš„ç‹€æ…‹ä¸‹éƒ½ redirect åˆ° <code>login page</code> å°±åŠ ä¸Š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// autheg-frontend/pages/index.vue</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">layout</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">flex</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">list</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">list</span><span class="o">-</span><span class="nx">tile</span> <span class="nx">v</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;example in examples&quot;</span> <span class="o">:</span><span class="nx">key</span><span class="o">=</span><span class="s2">&quot;example.id&quot;</span> <span class="o">:</span><span class="kr">class</span><span class="o">=</span><span class="s2">&quot;example.colour&quot;</span><span class="o">&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">v</span><span class="o">-</span><span class="nx">list</span><span class="o">-</span><span class="nx">tile</span><span class="o">-</span><span class="nx">content</span><span class="o">&gt;</span><span class="p"></span><span class="o">&lt;</span><span class="err">/v-list-tile-content&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="err">/v-list-tile&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/v-list&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/v-layout&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">middleware</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;auth&#39;</span><span class="p">],</span>
</span><span class='line'>  <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">examples</span><span class="o">:</span> <span class="p">[]</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">async</span> <span class="nx">updateExamples</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">examples</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">$axios</span><span class="p">.</span><span class="nx">$get</span><span class="p">(</span><span class="s1">&#39;/examples&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">updateExamples</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç¾åœ¨å¯ä»¥ try ä¸€ä¸‹</p>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*012-LUDxJttnF6Jtn0Cm7A.png" alt="" />
<em>from <a href="https://medium.com/@fishpercolator/how-to-separate-frontend-backend-with-rails-api-nuxt-js-and-devise-jwt-cf7dd9da9d16">How to separate frontend + backend with Rails API, Nuxt.js and Devise-JWT</a></em></p>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*X7EYUzlYqfSEDGUlTaK7vQ.png" alt="" />
<em>from <a href="https://medium.com/@fishpercolator/how-to-separate-frontend-backend-with-rails-api-nuxt-js-and-devise-jwt-cf7dd9da9d16">How to separate frontend + backend with Rails API, Nuxt.js and Devise-JWT</a></em></p>

<p>åƒè€ƒæ–‡ä»¶</p>

<ul>
<li><a href="https://medium.com/@fishpercolator/how-to-separate-frontend-backend-with-rails-api-nuxt-js-and-devise-jwt-cf7dd9da9d16">How to separate frontend + backend with Rails API, Nuxt.js and Devise-JWT</a></li>
<li><a href="https://medium.com/@fishpercolator/deploying-your-nuxt-rails-api-app-to-production-with-heroku-54efd09eec22">Deploying your Nuxt+Rails API app to production with Heroku</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JSON Web Token(JWT) ç°¡å–®ä»‹ç´¹]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/16/jwt/"/>
    <updated>2018-07-16T17:48:22+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/16/jwt</id>
    <content type="html"><![CDATA[<p>ä¹‹å‰å¸¸å¸¸è½åˆ° jwtï¼Œä½†æ²’æœ‰å¾ˆäº†è§£ï¼Œå°±ä¾†ç ”ç©¶ä¸€ä¸‹å§</p>

<!-- more -->


<h1>ä»€éº¼æ˜¯ JWT</h1>

<ul>
<li>JWT æ˜¯åŸºæ–¼ JSON çš„é–‹æ”¾æ¨™æº– (RFC 7519)</li>
<li>ä¸€èˆ¬è¢«ç”¨ä¾†åœ¨ èº«ä»½æä¾›è€… å’Œ æœå‹™æä¾›è€… é–“å‚³éè¢« èªè­‰ çš„ç”¨æˆ¶èº«ä»½è¨Šæ¯ï¼Œä»¥ä¾¿æ–¼å¾è³‡æºä¼ºæœå™¨ç²å–è³‡æº</li>
<li>åŒæ™‚ä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¡å¤–çš„è²æ˜è¨Šæ¯ï¼Œè©² token ä¹Ÿå¯ç›´æ¥è¢«ç”¨æ–¼èªè­‰ï¼Œä¹Ÿå¯è¢«åŠ å¯†</li>
<li>ç‰¹åˆ¥é©ç”¨æ–¼åˆ†ä½ˆå¼ç«™é»çš„å–®é»ç™»éŒ„ï¼ˆSSOï¼‰å ´æ™¯</li>
</ul>


<p>å…ˆä¾†ç­è§£ä¸€èˆ¬ session å’Œ jwt çš„å·®åˆ¥</p>

<h2>Session</h2>

<p>Http å”è­°æœ¬èº«æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œæ‰€ä»¥ç„¡æ³•çŸ¥é“æ¯å€‹ request ä¾†çš„æ˜¯èª°? å› æ­¤ç”¨æˆ¶æ¯æ¬¡ request å°±å¿…é ˆæä¾›å¸³è™Ÿå¯†ç¢¼ï¼Œä»¥ä¾¿è­‰æ˜èº«ä»½ï¼Œä½†æ¯æ¬¡éƒ½è¦å¦å¤–è¼¸å…¥å¸³è™Ÿå¯†ç¢¼ï¼Œè±ˆä¸æ˜¯å¾ˆéº»ç…©?</p>

<p>æ‰€ä»¥ç•¶ç”¨æˆ¶ç¬¬ä¸€æ¬¡ç™¼ request éä¾†å¾Œï¼Œå°±æœƒç”¢ç”Ÿä¸€çµ„ token ç´€éŒ„åœ¨ db å’Œ sessionï¼Œä¸¦ä¸”å°‡é€™çµ„ token çµ¦ç”¨æˆ¶ï¼Œå‘Šè¨´å…¶ä¿å­˜åœ¨ cookieï¼Œç•¶ä¸‹æ¬¡ç™¼ request çš„æ™‚å€™ï¼Œå°±ç›´æ¥å¸¶é€™çµ„ token ä»¥ä¾¿è­‰æ˜èº«ä»½ã€‚</p>

<h2>JWT</h2>

<p>JWT çš„çµ„æˆå…§å®¹æœ‰ä¸‰å€‹éƒ¨åˆ†ï¼Œç”± <code>.</code> åšå€éš”ï¼Œæœ€å¾Œé€éé€™ä¸‰å€‹éƒ¨åˆ†ï¼Œä¸²æˆä¸€å€‹ Jwt å­—ä¸²</p>

<h3>1. Header é ­éƒ¨</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;typ&#39;</span><span class="p">:</span> <span class="s1">&#39;JWT&#39;</span><span class="p">,</span> <span class="c1"># è²æ˜é¡å‹</span>
</span><span class='line'>  <span class="s1">&#39;alg&#39;</span><span class="p">:</span> <span class="s1">&#39;HS256&#39;</span> <span class="c1"># åŠ å¯†çš„æ–¹æ³•: HMACã€SHA256ã€RSA é€²è¡Œ Base64 ç·¨ç¢¼</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>é€²è¡Œ base64 åŠ å¯†ï¼ˆè©²åŠ å¯†æ˜¯å¯ä»¥å°ç¨±è§£å¯†çš„)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. Payload è¼‰è·</h3>

<p>é€™è£¡æ”¾è²æ˜å…§å®¹ï¼Œå¯ä»¥èªªå°±æ˜¯å­˜æ”¾æºé€šè¨Šæ¯çš„åœ°æ–¹ï¼Œåœ¨å®šç¾©ä¸Šæœ‰ 3 ç¨®è²æ˜ (Claims)</p>

<ul>
<li>Reserved (è¨»å†Šè²æ˜)</li>
<li>Public (å…¬é–‹è²æ˜)</li>
<li>Private (ç§æœ‰è²æ˜)</li>
</ul>


<p>è¨»å†Šè²æ˜åƒæ•¸ (å»ºè­°ä½†ä¸å¼·åˆ¶ä½¿ç”¨)</p>

<ul>
<li>iss (Issuer) - jwtç°½ç™¼è€…</li>
<li>sub (Subject) -  jwtæ‰€é¢å‘çš„ç”¨æˆ¶</li>
<li>aud (Audience) - æ¥æ”¶jwtçš„ä¸€æ–¹</li>
<li>exp (Expiration Time) - jwtçš„éæœŸæ™‚é–“ï¼Œé€™å€‹éæœŸæ™‚é–“å¿…é ˆè¦å¤§æ–¼ç°½ç™¼æ™‚é–“</li>
<li>nbf (Not Before) - å®šç¾©åœ¨ä»€éº¼æ™‚é–“ä¹‹å‰ï¼Œè©²jwtéƒ½æ˜¯ä¸å¯ç”¨çš„</li>
<li>iat (Issued At) - jwtçš„ç°½ç™¼æ™‚é–“</li>
<li>jti (JWT ID) - jwtçš„å”¯ä¸€èº«ä»½æ¨™è­˜ï¼Œä¸»è¦ç”¨ä¾†ä½œç‚ºä¸€æ¬¡æ€§token,å¾è€Œè¿´é¿é‡æ”¾æ”»æ“Š</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;sub&quot;</span><span class="p">:</span> <span class="s2">&quot;1234567890&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;iat&quot;</span><span class="p">:</span> <span class="mi">1516239022</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>é€²è¡Œ base64 åŠ å¯†ï¼ˆè©²åŠ å¯†æ˜¯å¯ä»¥å°ç¨±è§£å¯†çš„)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. Signature</h3>

<p>ç”±ä¸‰å€‹éƒ¨åˆ†çµ„æˆ</p>

<ul>
<li>header (base64å¾Œçš„)</li>
<li>payload (base64å¾Œçš„)</li>
<li>secret</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">HMACSHA256</span><span class="p">(</span><span class="n">base64UrlEncode</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">base64UrlEncode</span><span class="p">(</span><span class="n">payload</span><span class="p">),</span> <span class="s1">&#39;secret&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>secret è¦ä¿å­˜åœ¨ server ç«¯ï¼Œjwt çš„ ç°½ç™¼é©—è­‰éƒ½å¿…é ˆä½¿ç”¨é€™å€‹ secretï¼Œç•¶å…¶ä»–äººå¾—çŸ¥é€™å€‹ secretï¼Œé‚£å°±æ„å‘³è‘—å®¢æˆ¶ç«¯æ˜¯å¯ä»¥è‡ªæˆ‘ç°½ç™¼ jwt ï¼Œå› æ­¤åœ¨ä»»ä½•å ´æ™¯éƒ½ä¸æ‡‰è©²å¤–æµ</p></blockquote>

<p>é€²è¡Œ base64 åŠ å¯†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span>
</span></code></pre></td></tr></table></div></figure>


<p>æœ€å¾Œç”±ä¸‰å€‹éƒ¨åˆ†ç”± <code>.</code> çµ„æˆ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><span class="o">.</span><span class="n">eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ</span><span class="o">.</span><span class="n">SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span>
</span></code></pre></td></tr></table></div></figure>


<h1>ä½¿ç”¨æ–¹æ³•</h1>

<p>åœ¨ç™¼ request çš„æ™‚å€™åœ¨ header åŠ å…¥ <code>Authorization: Bearer &lt;token&gt;</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">post</span><span class="p">(</span><span class="s1">&#39;api/user/1&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">headers</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer &#39;</span> <span class="o">+</span> <span class="n">token</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://cdn.auth0.com/content/jwt/jwt-diagram.png" alt="" /></p>

<h1>å„ªé»</h1>

<ul>
<li>è·¨èªè¨€ï¼Œå› ç‚º json æ ¼å¼å¤§éƒ¨åˆ†èªè¨€éƒ½å¯ä½¿ç”¨</li>
<li>å¯å„²å­˜ä¸€äº›ç°¡å–®ä½†éæ•æ„Ÿçš„å•†æ¥­é‚è¼¯ - role ..</li>
<li>æ§‹æˆå…§å®¹ç°¡å–®ï¼Œä½”ç”¨ Size å°æ–¹ä¾¿å‚³è¼¸</li>
<li>ä¸éœ€åœ¨ server ä¿å­˜ sessionï¼Œæ‰€ä»¥å®ƒæ˜“æ–¼æ‡‰ç”¨çš„æ“´å±•</li>
</ul>


<h1>å®‰å…¨ç›¸é—œ Security</h1>

<ul>
<li>Base64 æ˜¯å¯é€†çš„åŠ å¯†æ–¹å¼ï¼Œä¸é©åˆå­˜æ”¾æ•æ„Ÿè¨Šæ¯ï¼Œå› ç‚ºè©²éƒ¨åˆ†æ˜¯å®¢æˆ¶ç«¯å¯è§£å¯†çš„éƒ¨åˆ†</li>
<li>ç”¨ä¾†åŠ å¯†çš„ Secret è¦ä¿è­·å¥½ï¼Œå­˜åœ¨ server ç«¯</li>
<li>ä½¿ç”¨ Https å”è­° - é¿å…æ•æ„Ÿè¨Šæ¯è¢«å—…æ¢</li>
<li>ä½¿ç”¨ HttpOnly ä¾†é˜²æ­¢ Cookie è¢« JavaScript è®€å–ï¼Œå¾è€Œé¿å…è·¨ç«™è…³æœ¬æ”»æ“Šï¼ˆXSSæ”»æ“Šï¼‰</li>
</ul>


<h1>JWTçš„é©ç”¨å ´æ™¯</h1>

<ul>
<li>ä¸€æ¬¡æ€§é©—è­‰  ex: ä¿¡ä»¶ä¸­çš„é€£çµ</li>
<li>restful api çš„ç„¡ç‹€æ…‹èªè­‰</li>
<li>å–®é»ç™»éŒ„+æœƒè©±ç®¡ç†(ä¸æ¨è–¦ï¼Œçµ•å¤§å¤šæ•¸æƒ…æ³ä¸‹ï¼Œå‚³çµ±çš„ cookie-session æ©Ÿåˆ¶å·¥ä½œå¾—æ›´å¥½)</li>
</ul>


<p>åƒè€ƒæ–‡ä»¶:</p>

<ul>
<li><a href="https://jwt.io/">JWT</a></li>
<li><a href="https://www.jianshu.com/p/576dbf44b2ae">ä»€éº¼æ˜¯ JWT &ndash; JSON WEB TOKEN</a></li>
<li><a href="https://hk.saowen.com/a/e86e2d932aa9b5dc3d11d639e9940eb55812f030029fac54245f6d1f9eef6f23">ä¸è¦ç”¨JWTæ›¿ä»£sessionç®¡ç†ï¼ˆä¸Šï¼‰ï¼šå…¨é¢ç­è§£Token,JWT,OAuth,SAML,SSO</a></li>
<li><a href="https://blog.leapoahead.com/2015/09/06/understanding-jwt/">JSON Web Token - åœ¨Webæ‡‰ç”¨é–“å®‰å…¨åœ°å‚³éè¨Šæ¯</a></li>
<li><a href="http://blog.leapoahead.com/2015/09/07/user-authentication-with-jwt/">å…«å¹…æ¼«ç•«ç†è§£ä½¿ç”¨JSON Web Tokenè¨­è¨ˆå–®é»ç™»éŒ„ç³»çµ±</a></li>
<li><a href="https://hk.saowen.com/a/afdc2b0fb445a973bed63330596f8588ad8f86da0faf6b5af5211ff3e29c2da8">ç†è§£JWTçš„ä½¿ç”¨å ´æ™¯å’Œå„ªåŠ£</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails 5.2 Credentials]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/14/rails-credentials/"/>
    <updated>2018-07-14T00:22:53+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/14/rails-credentials</id>
    <content type="html"><![CDATA[<p>rails5.2 é–‹å§‹ <code>config/secrets.yml</code> å·²ç¶“è¢«ç§»é™¤äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ <code>credentials</code></p>

<!-- more -->


<p>rails5.2 æœƒæ–°å¢å…©å€‹æª”æ¡ˆ</p>

<ul>
<li><p><code>config/credentials.yml.enc</code> is an encrypted file that will contain all your secret credentialsï¼Œå› ç‚ºåŠ å¯†éå¯ä»¥å¾ˆæ”¾æ–°çš„æ¨åˆ° github</p></li>
<li><p><code>config/master.key</code> is a file containing your encryption key</p></li>
</ul>


<p><code>mater.key</code> æ˜¯ç”¨ä¾†åŠ è§£å¯† <code>credentials.yml.enc</code>ï¼Œè¨˜å¾—ä¸è¦ä¸Šåˆ° githubï¼Œè¦æ”¾åˆ° <code>.gitignore</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># .gitignore</span>
</span><span class='line'><span class="c1"># Ignore master key for decrypting credentials and more.</span>
</span><span class='line'><span class="sr">/config/m</span><span class="n">aster</span><span class="o">.</span><span class="n">key</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># å¯ä»¥çœ‹èªªæ˜</span>
</span><span class='line'><span class="n">rails</span> <span class="ss">credentials</span><span class="p">:</span><span class="n">help</span>
</span></code></pre></td></tr></table></div></figure>


<p>å› ç‚ºç¶“éåŠ å¯†ï¼Œæ‰€ä»¥æ‰“é–‹ <code>credentials.yml.enc</code> æœƒç™¼ç¾ä¸€ä¸²äº‚ç¢¼</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># credentials.yml.enc</span>
</span><span class='line'><span class="mi">17</span><span class="no">NEkGq</span><span class="o">/</span><span class="n">xkDO</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœè¦ç·¨è¼¯æª”æ¡ˆéœ€è¦å¦å¤–åŸ·è¡Œè§£å¯†ï¼Œæ‰èƒ½å¤ é€²è¡Œç·¨è¼¯</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># EDITOR å¯ä»¥æ”¹ç”¨å…¶ä»–ç·¨è¼¯å™¨ subl code éƒ½å¯ä»¥</span>
</span><span class='line'><span class="no">EDITOR</span><span class="o">=</span><span class="n">vim</span> <span class="n">rails</span> <span class="ss">credentials</span><span class="p">:</span><span class="n">edit</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># aws:</span>
</span><span class='line'><span class="c1">#   access_key_id: 123</span>
</span><span class='line'><span class="c1">#   secret_access_key: 345</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Used as the base secret for all MessageVerifiers in Rails, including the one protecting cookies.</span>
</span><span class='line'><span class="ss">secret_key_base</span><span class="p">:</span> <span class="mo">00</span><span class="mi">8174812</span><span class="n">dc5a309a0de</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>é›¢é–‹å¾Œå°±æœƒè‡ªå‹•å„²å­˜</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># é€™æ™‚å€™å°±æœƒç”¨ master.key é€²è¡ŒåŠ å¯†</span>
</span><span class='line'><span class="no">New</span> <span class="n">credentials</span> <span class="n">encrypted</span> <span class="ow">and</span> <span class="n">saved</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>è®€å–æª”æ¡ˆ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">dig</span><span class="p">(</span><span class="ss">:secret_key_base</span><span class="p">)</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">credentials</span><span class="o">[</span><span class="ss">:secret_key_base</span><span class="o">]</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">aws</span><span class="o">[</span><span class="ss">:access_key_id</span><span class="o">]</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">aws</span><span class="o">[</span><span class="ss">:secret_access_key</span><span class="o">]</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">secret_key_base</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸¦ä¸”å‘å…¶ä»– <code>yml</code> æª”æ¡ˆä¸€æ¨£ï¼Œå»ºç«‹ä¸€åœ¨ <code>share</code> çš„è³‡æ–™å¤¾ä¸­ï¼Œæˆ–æ˜¯æ–°å¢ä¸€å€‹ç’°å¢ƒè®Šæ•¸ <code>RAILS_MASTER_KEY</code></p>

<h3>Environments</h3>

<p>å¦‚æœæƒ³åƒä¹‹å‰ä¸€æ¨£ï¼Œä¸åŒç’°å¢ƒæœ‰ä¸åŒçš„ keyï¼Œå¯ä»¥è¨­å®šæˆè·Ÿä¹‹å‰çš„ <code>secret.yml</code> ä¸€æ¨£</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">development</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">aws</span><span class="p">:</span>
</span><span class='line'>    <span class="ss">access_key_id</span><span class="p">:</span> <span class="mi">123</span>
</span><span class='line'>    <span class="ss">secret_access_key</span><span class="p">:</span> <span class="mi">345</span>
</span><span class='line'><span class="ss">production</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">aws</span><span class="p">:</span>
</span><span class='line'>    <span class="ss">access_key_id</span><span class="p">:</span> <span class="mi">321</span>
</span><span class='line'>    <span class="ss">secret_access_key</span><span class="p">:</span> <span class="mi">543</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">credentials</span><span class="o">[</span><span class="no">Rails</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">to_sym</span><span class="o">][</span><span class="ss">:aws</span><span class="o">][</span><span class="ss">:access_key_id</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Production</h3>

<p>å¦‚æœåœ¨ <code>production</code> ç’°å¢ƒï¼Œè¦åšä»¥ä¸‹è¨­å®š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#config/environments/production.rb</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">require_master_key</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>åƒè€ƒæ–‡ä»¶</p>

<ul>
<li><a href="https://medium.com/cedarcode/rails-5-2-credentials-9b3324851336">Rails 5.2 credentials</a></li>
<li><a href="https://www.viget.com/articles/storing-secret-credentials-in-rails-5-2-and-up/">Storing Secret Credentials in Rails 5.2 and Up</a></li>
<li><a href="https://keithpblog.org/post/encrypted-secrets/">Rails 5.2: encrypted secrets</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails ä¸­çš„ Attr_accessor, Has_many, Scope æ€éº¼ä¾†?]]></title>
    <link href="http://mgleon08.github.com/blog/2018/07/04/rails-class/"/>
    <updated>2018-07-04T21:56:05+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/07/04/rails-class</id>
    <content type="html"><![CDATA[<p>ç›¸ä¿¡å­¸ rails çš„ä¸€å®šå° <code>attr_accessor</code>, <code>has_many</code>, <code>scope</code> é€™äº›ä¸é™Œç”Ÿ</p>

<!-- more -->


<p>ä½†æ˜¯åˆ°åº•æ˜¯ç‚ºä»€éº¼å¯ä»¥åœ¨ model è£¡é¢ç›´æ¥ä¸‹é€™äº› method?</p>

<p>å…ˆçœ‹ä¸€ä¸‹ rails çš„ modelï¼Œå¯ä»¥é€™æ¨£å®šç¾©</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 5.x.x</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Klass</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:books</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:male</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">gender</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 4.x.x</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Klass</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:books</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:male</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">gender</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¯ä»¥çŸ¥é“ model è£¡çš„æ˜¯ <code>class</code> ä¸¦ä¸”æ˜¯ç¹¼æ‰¿ <code>ApplicationRecord</code> å› æ­¤åˆ¤æ–·å¯èƒ½æ˜¯å±¬æ–¼ <code>ApplicationRecord</code> æˆ–è€…æ˜¯æ›´ä¸Šå±¤çš„æŸä¸€å€‹ç‰©ä»¶</p>

<p>åœ¨ ruby ä¸­ï¼Œæ‰€æœ‰é¡åˆ¥çš„é¡åˆ¥éƒ½æ˜¯ class é¡åˆ¥</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Object</span><span class="o">.</span><span class="n">class</span>
</span><span class='line'><span class="c1"># =&gt; Class</span>
</span><span class='line'><span class="no">Kernel</span><span class="o">.</span><span class="n">class</span>
</span><span class='line'><span class="c1"># =&gt; Module</span>
</span><span class='line'><span class="no">Module</span><span class="o">.</span><span class="n">class</span>
</span><span class='line'><span class="c1"># =&gt; Class</span>
</span><span class='line'><span class="no">Class</span><span class="o">.</span><span class="n">class</span>
</span><span class='line'><span class="c1"># =&gt; Class</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Class çš„å¯«æ³•</h3>

<p>ä¸€èˆ¬çœ‹åˆ°çš„ class</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Klass</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">hi</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s1">&#39;hi&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç›¸ç•¶æ–¼</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># æ‰€æœ‰é¡åˆ¥çš„åå­—éƒ½æ˜¯ä¸€å€‹å¸¸æ•¸(å¤§å¯«é–‹é ­)ï¼Œå¦‚æœä¸æ˜¯å¤§å¯«å°±ä¸æœƒæœ‰è‡ªå·±çš„åå­—</span>
</span><span class='line'><span class="no">Klass</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">hi</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s1">&#39;hi&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ—¢ç„¶çŸ¥é“äº† model è£¡çš„ class å¯¦éš›ä¸Šæ˜¯ <code>Class.new</code> æ¥ä¸‹ä¾†çœ‹ä¸€ä¸‹ doc <a href="https://ruby-doc.org/core-2.2.0/Class.html#method-c-new">Class new</a></p>

<blockquote><p>If a block is given, it is passed the class object, and the block is evaluated in the context of this class using class_eval.</p></blockquote>

<p>æ„æ€æ˜¯æŒ‡ï¼Œä¸­é–“é‚£æ®µ Block éƒ½æœƒç”¨ <code>class_eval</code> ä¾†åŸ·è¡Œï¼Œ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Klass</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">meth1</span>
</span><span class='line'>    <span class="s2">&quot;hello&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">meth2</span>
</span><span class='line'>    <span class="s2">&quot;bye&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="no">Klass</span><span class="o">.</span><span class="n">new</span>     <span class="c1">#=&gt; #&lt;Klass:0x007f916006aa60&gt;</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">meth1</span>          <span class="c1">#=&gt; &quot;hello&quot;</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">meth2</span>          <span class="c1">#=&gt; &quot;bye&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç”±æ­¤æ¨æ–·ä»¥ä¸‹ç›¸ç­‰</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Klass</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:books</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:male</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">gender</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Klass</span> <span class="o">=</span> <span class="no">Class</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:books</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:male</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">gender</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Klass</span><span class="p">;</span> <span class="k">end</span>
</span><span class='line'><span class="no">Klass</span><span class="o">.</span><span class="n">class_eval</span> <span class="k">do</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:books</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:male</span><span class="p">,</span> <span class="o">-&gt;</span><span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">gender</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç”±æ­¤å¯çŸ¥ï¼Œ<code>attr_accessor</code>, <code>has_many</code>, <code>scope</code> éƒ½æ˜¯ç”±ä¸Šå±¤ç‰©ä»¶æ‰€å®šç¾©å¥½çš„ method</p>

<p>çœ‹ä¸€ä¸‹åŸå§‹ç¢¼å…¶ä¸­ä¸€æ®µï¼Œå¯çœ‹åˆ° <code>has_many</code>ï¼Œæ˜¯åœ¨ä¸€å€‹ module è£¡é¢ï¼Œæ‡‰è©²æ˜¯é€é <code>include</code> æˆ–æ˜¯ <code>extend</code> çš„æ–¹å¼ï¼Œè®Šæˆäº† class çš„ methods</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># rails/activerecord/lib/active_record/associations.rb</span>
</span><span class='line'><span class="c1"># ...</span>
</span><span class='line'><span class="k">module</span> <span class="nn">ClassMethods</span>
</span><span class='line'><span class="c1"># ...</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">has_many</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">scope</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">extension</span><span class="p">)</span>
</span><span class='line'>    <span class="n">reflection</span> <span class="o">=</span> <span class="no">Builder</span><span class="o">::</span><span class="no">HasMany</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">extension</span><span class="p">)</span>
</span><span class='line'>  <span class="no">Reflection</span><span class="o">.</span><span class="n">add_reflection</span> <span class="nb">self</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">reflection</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="c1"># ...</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1"># ...</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸»è¦æ˜¯ç ”ç©¶ä¸€ä¸‹çœ‹ rails ä¸€äº›ç‰¹åˆ¥çš„åŠŸèƒ½æ˜¯æ€éº¼ä¾†çš„ï¼Œè¦ä»”ç´°çš„è©±å°±è¦å»æŒ–åŸå§‹ç¢¼æ‰èƒ½çŸ¥é“äº†</p>

<p>åƒè€ƒæ–‡ä»¶</p>

<ul>
<li><a href="http://mgleon08.github.io/blog/2016/03/08/instance-eval-class-eval/">ç”¨ Instance_eval &amp; Class_eval è‡ªå·±åŠ  Method!</a></li>
<li><a href="http://mgleon08.github.io/blog/2016/02/24/include-extend-require/">Ruby ä¸­çš„ Include Extend Require Load</a></li>
<li><a href="https://blog.frost.tw/posts/2017/10/22/The-ruby-s-class-is-free-Part-1/">è‡ªç”±çš„ Ruby é¡åˆ¥ï¼ˆä¸€ï¼‰</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GCP BigQuery With API]]></title>
    <link href="http://mgleon08.github.com/blog/2018/06/27/gcp-bigquery-with-api/"/>
    <updated>2018-06-27T21:18:35+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/06/27/gcp-bigquery-with-api</id>
    <content type="html"><![CDATA[<p>æœ€è¿‘å‰›å¥½ç¢°åˆ° BigQueryï¼Œå¯ä»¥ç›´æ¥é€é API å¸¶ sql æŒ‡ä»¤å»æ‹‰è³‡æ–™!</p>

<!-- more -->


<h3>å®‰è£</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;google-cloud-bigquery&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>


<p>è£ <a href="https://cloud.google.com/sdk/docs/downloads-interactive">å®‰ gcp SDK</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># å®‰è£</span>
</span><span class='line'><span class="n">curl</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//s</span><span class="n">dk</span><span class="o">.</span><span class="n">cloud</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span> <span class="o">|</span> <span class="n">bash</span>
</span><span class='line'><span class="c1"># Restart your shell</span>
</span><span class='line'><span class="nb">exec</span> <span class="o">-</span><span class="n">l</span> <span class="vg">$SHELL</span>
</span><span class='line'><span class="c1"># è¨˜å¾—åœ¨ google é‚£é‚Šè¦å…ˆé–‹æ¬Šé™ï¼Œæ‰å¯ä»¥æŒ‡å®šåˆ°è‡ªå·±è¦çš„ project</span>
</span><span class='line'><span class="n">gcloud</span> <span class="n">init</span>
</span><span class='line'><span class="c1"># authï¼Œä½†æœ€å¥½çš„è©±æ˜¯è¦ç”³è«‹ä¸€å€‹ æ†‘è­‰ï¼Œä¸¦è¨­å®šåœ¨ç’°å¢ƒè®Šæ•¸(environmentvalue)</span>
</span><span class='line'><span class="n">gcloud</span> <span class="n">auth</span> <span class="n">application</span><span class="o">-</span><span class="n">default</span> <span class="n">login</span>
</span><span class='line'><span class="c1"># å–å¾—æ†‘è­‰</span>
</span><span class='line'><span class="n">gcloud</span> <span class="n">auth</span> <span class="n">application</span><span class="o">-</span><span class="n">default</span> <span class="nb">print</span><span class="o">-</span><span class="n">access</span><span class="o">-</span><span class="n">token</span>
</span></code></pre></td></tr></table></div></figure>


<h3>åŸ·è¡Œ</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;google/cloud/bigquery&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># This uses Application Default Credentials to authenticate.</span>
</span><span class='line'><span class="c1"># @see https://cloud.google.com/bigquery/docs/authentication/getting-started</span>
</span><span class='line'><span class="n">bigquery</span> <span class="o">=</span> <span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="o">::</span><span class="no">Bigquery</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">project</span><span class="p">:</span> <span class="s2">&quot;project_id&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">sql</span>     <span class="o">=</span> <span class="s2">&quot;SELECT &quot;</span> <span class="o">+</span>
</span><span class='line'>          <span class="s2">&quot;CONCAT(&#39;https://stackoverflow.com/questions/&#39;, &quot;</span> <span class="o">+</span>
</span><span class='line'>          <span class="s2">&quot;       CAST(id as STRING)) as url, view_count &quot;</span> <span class="o">+</span>
</span><span class='line'>          <span class="s2">&quot;FROM `bigquery-public-data.stackoverflow.posts_questions` &quot;</span> <span class="o">+</span>
</span><span class='line'>          <span class="s2">&quot;WHERE tags like &#39;%google-bigquery%&#39; &quot;</span> <span class="o">+</span>
</span><span class='line'>          <span class="s2">&quot;ORDER BY view_count DESC LIMIT 10&quot;</span>
</span><span class='line'><span class="n">results</span> <span class="o">=</span> <span class="n">bigquery</span><span class="o">.</span><span class="n">query</span> <span class="n">sql</span>
</span><span class='line'>
</span><span class='line'><span class="n">results</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="ss">:url</span><span class="o">]</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">row</span><span class="o">[</span><span class="ss">:view_count</span><span class="o">]</span><span class="si">}</span><span class="s2"> views&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>å•é¡Œ</h3>

<p>åœ¨åŸ·è¡Œä¸Šæœ‰é‡åˆ°ä¸€äº›å•é¡Œï¼Œruby ç”¨ query ç¬¬ä¸€æ¬¡å»æ‰“çš„æ™‚å€™ï¼Œå›ä¾†çš„å€¼å»æœƒæ˜¯ç©º Arrayï¼Œç¬¬äºŒæ¬¡å°±æœƒæœ‰å€¼</p>

<p>å¯ä»¥çœ‹åˆ°ä¸‹é¢ <code>job_complete</code> ä¹Ÿæ˜¯ <code>false</code>ï¼Œç¬¬äºŒæ¬¡æ‰“å°±æœƒæ˜¯ true</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bigquery</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Sending HTTP post https://www.googleapis.com/bigquery/v2/projects/project_id/queries?</span>
</span><span class='line'><span class="c1"># 200</span>
</span><span class='line'><span class="c1"># #&lt;Hurley::Response POST https://www.googleapis.com/bigquery/v2/projects/project_id/queries == 200 (184 bytes) 11197ms&gt;</span>
</span><span class='line'><span class="c1"># Success - #&lt;Google::Apis::BigqueryV2::QueryResponse:0x007fa1021033f8</span>
</span><span class='line'><span class="c1">#  @job_complete=false,</span>
</span><span class='line'><span class="c1">#  @job_reference=</span>
</span><span class='line'><span class="c1">#   #&lt;Google::Apis::BigqueryV2::JobReference:0x007fa102102318</span>
</span><span class='line'><span class="c1">#    @job_id=&quot;job_0HlGAo3KB4WrAGz20MypIHluup9B&quot;,</span>
</span><span class='line'><span class="c1">#    @project_id=&quot;project_id&quot;&gt;,</span>
</span><span class='line'><span class="c1">#  @kind=&quot;bigquery#queryResponse&quot;&gt;</span>
</span><span class='line'><span class="c1">#  =&gt; []</span>
</span></code></pre></td></tr></table></div></figure>


<h3>åŸå› </h3>

<p>Google å›è¦†</p>

<p><code>job_complete=false</code> ä»£è¡¨é€™å€‹ bigquery job é‚„æ²’è·‘å®Œ.</p>

<p>åœ¨ bigquery ä¸‹ query çš„æ™‚å€™, åŸ·è¡Œ query çš„ API call æœƒæœ‰ä¸€å€‹ timeout, ç•¶ API call åŸ·è¡Œçš„æ™‚é–“è¶…éé€™å€‹ timeout ä½†æ˜¯ query é‚„æ²’è·‘å®Œçš„æ™‚å€™, API call æœƒ return HTTP code 200, ä½†æ˜¯ query result æ˜¯ç©ºçš„, ä¸¦ä¸” <code>job_complete = false.</code></p>

<p>è©³ç´°å¯ä»¥åƒè€ƒæ–‡ä»¶[1]ä¸€é–‹é ­ &ldquo;Runs a BigQuery SQL query and returns results if the query completes within a specified timeout.&rdquo; ä»¥åŠåŒä¸€ä»½æ–‡ä»¶ä¸‹æ–¹çš„ timeoutMs ä»¥åŠ jobComplete é€™äº›åƒæ•¸.</p>

<p>å¦‚å‰æ‰€è¿°, å¦‚æœæ”¶åˆ° job_complete = false çš„ HTTP code 200 response, è¡¨ç¤º job é‚„åœ¨åŸ·è¡Œ. é€™æ™‚å€™çš„æ¨™æº–åšæ³•æ˜¯å» poll GetQueryResults é€™å€‹ API (åƒè€ƒæ–‡ä»¶[2]) ç›´åˆ° job_complete = true å†æ‹¿å–çµæœ.</p>

<ul>
<li><a href="https://cloud.google.com/bigquery/docs/reference/rest/v2/jobs/query">1. query</a></li>
<li><a href="https://cloud.google.com/bigquery/docs/reference/rest/v2/jobs/getQueryResults">2. getQueryResults</a></li>
</ul>


<h3>è§£æ±ºæ–¹å¼</h3>

<p>åœ¨ new çš„æ™‚å€™ï¼Œæ–°å¢ timeout æ™‚é–“(ä¹Ÿå¯ä»¥è¨­å®š retries)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Google</span><span class="o">::</span><span class="no">Cloud</span><span class="o">::</span><span class="no">Bigquery</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">project</span><span class="p">:</span> <span class="n">project_id</span><span class="p">,</span> <span class="ss">timeout</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span> <span class="ss">retries</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>ä½†å¯¦éš›æ¸¬è©¦åŠ ä¸Š <code>timeout</code> å»å¥½åƒæ²’æœ‰ç”¨..</p></blockquote>

<p>åœ¨è©¦çš„æ™‚å€™ï¼Œæœ‰ç”¨å¦å¤–çš„æ–¹å¼å»è§£æ±ºï¼Œè‡ªå·±å»è™•ç† job å°±å¯ä»¥ç¢ºä¿ job è·‘å®Œï¼Œå†æ‹¿è³‡æ–™å›ä¾†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># å…ˆè¨­å®š job</span>
</span><span class='line'><span class="n">bigquery</span><span class="o">.</span><span class="n">query_job</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span><span class='line'><span class="c1"># å†è®“å®ƒå»åŸ·è¡Œ wait_until_done!</span>
</span><span class='line'><span class="n">job</span><span class="o">.</span><span class="n">wait_until_done!</span>
</span><span class='line'><span class="c1"># æœ€å¾Œå†å°‡çµæœå›å‚³ï¼Œé€™æ¨£å°±å¯ä»¥ç¢ºä¿ç¬¬ä¸€æ¬¡å¯ä»¥æ‹‰åˆ°å€¼</span>
</span><span class='line'><span class="n">job</span><span class="o">.</span><span class="n">query_results</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†å»çœ‹åŸå§‹ç¢¼ï¼Œå¯¦éš›ä¸Šä¹Ÿæ˜¯åšä¸€æ¨£çš„å‹•ä½œ..</p>

<blockquote><p>å› è©²æ˜¯å…§å»ºçš„ <code>query</code> æœ‰è¨­å®š 10 ç§’å°±æœƒ responseï¼Œå› æ­¤æ”¹ç›´æ¥å»åŸ·è¡Œè£¡é¢çš„å‹•ä½œï¼Œå°±æ²’æœ‰é€™å€‹é™åˆ¶</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">query</span> <span class="n">query</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">external</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">max</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">cache</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">standard_sql</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="ss">legacy_sql</span><span class="p">:</span> <span class="kp">nil</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span>
</span><span class='line'>  <span class="n">job</span> <span class="o">=</span> <span class="n">query_job</span> <span class="n">query</span><span class="p">,</span> <span class="ss">params</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span> <span class="ss">external</span><span class="p">:</span> <span class="n">external</span><span class="p">,</span>
</span><span class='line'>                  <span class="ss">cache</span><span class="p">:</span> <span class="n">cache</span><span class="p">,</span> <span class="ss">standard_sql</span><span class="p">:</span> <span class="n">standard_sql</span><span class="p">,</span>
</span><span class='line'>                  <span class="ss">legacy_sql</span><span class="p">:</span> <span class="n">legacy_sql</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span>
</span><span class='line'>  <span class="n">job</span><span class="o">.</span><span class="n">wait_until_done!</span>
</span><span class='line'>  <span class="n">ensure_job_succeeded!</span> <span class="n">job</span>
</span><span class='line'>  <span class="n">job</span><span class="o">.</span><span class="n">data</span> <span class="ss">max</span><span class="p">:</span> <span class="n">max</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>åƒè€ƒæ–‡ä»¶</p>

<ul>
<li><a href="https://cloud.google.com/bigquery/create-simple-app-api">Create A Simple Application With the API</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/tree/master/google-cloud-bigquery">google-cloud-bigquery</a></li>
<li><a href="https://cloud.google.com/sdk/docs/downloads-interactive">å®‰è£ gcp SDK</a></li>
<li><a href="https://cloud.google.com/bigquery/docs/bq-command-line-tool">Command Line</a></li>
<li><a href="https://cloud.google.com/docs/authentication/production">Auth</a></li>
<li><a href="https://cloud.google.com/ruby/">åœ¨ GOOGLE CLOUD PLATFORM ä¸ŠåŸ·è¡Œ RUBY</a></li>
</ul>


<p>Auth</p>

<ul>
<li><a href="https://stackoverflow.com/questions/13212991/how-to-query-bigquery-programmatically-from-python-without-end-user-interaction">How to query BigQuery programmatically from Python without end-user interaction?</a></li>
<li><a href="https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login">gcloud auth application-default login</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è·Ÿè‘— DHH ç·´ç¿’ ActionCable]]></title>
    <link href="http://mgleon08.github.com/blog/2018/06/21/rails-action-cable/"/>
    <updated>2018-06-21T23:23:08+08:00</updated>
    <id>http://mgleon08.github.com/blog/2018/06/21/rails-action-cable</id>
    <content type="html"><![CDATA[<p>ActionCable å·²ç¶“æœ‰ä¸€é™£å­äº†ï¼Œå‰›å¥½æœ‰æ™‚é–“ä¾†ç©ä¸€ä¸‹</p>




<!-- more -->




<p>ä¸»è¦è·Ÿè‘— DHH çš„å½±ç‰‡ä¾†ç·´ç¿’ä¸€ä¸‹ï¼Œäº†è§£æ•´å€‹ ActionCable çš„æµç¨‹</p>




<ul>
<li><a href="https://www.youtube.com/watch?v=n0WUjGkDFS0">Rails 5: Action Cable demo</a></li>
</ul>




<h1 id="">ä»‹ç´¹</h1>




<p>ActionCable ä¸»è¦æ˜¯ä¸€å€‹ Pub/Sub æ¨¡å‹ + WebSocket çš„ Ruby æ¡†æ¶ï¼Œå¯ä»¥è®“ Rails å¯¦ç¾å³æ™‚é€šè¨Šçš„æ–¹å¼</p>




<h3 id="websocket">WebSocket</h3>




<ul>
<li>æ˜¯ä¸€ç¨®å»ºç«‹åœ¨å–®ä¸€ TCP é€£ç·šä¸Šçš„å…¨é›™å·¥ï¼ˆfull-duplexï¼‰é€šè¨Šç®¡é“ï¼Œå¯ä»¥è®“ç¶²é æ‡‰ç”¨ç¨‹å¼èˆ‡ä¼ºæœå™¨ä¹‹é–“åšå³æ™‚æ€§ã€é›™å‘çš„è³‡æ–™å‚³éã€‚</li>

<li>ç€è¦½å™¨èˆ‡ä¼ºæœå™¨ä¹‹é–“è‹¥è¦å»ºç«‹ä¸€æ¢ WebSocket é€£ç·šï¼Œåœ¨ä¸€é–‹å§‹çš„äº¤æ¡ï¼ˆhandshakeï¼‰éšæ®µä¸­ï¼Œè¦å…ˆå¾ HTTP å”å®šå‡ç´šç‚º WebSocket å”å®š</li>
</ul>




<p><img src="https://heroku-blog-files.s3.amazonaws.com/1462551384-websocket-protocol.png" alt="" /></p>




<h3 id="polling">Polling è¼ªè©¢</h3>




<ul>
<li>ç€è¦½å™¨æ¯éš”ä¸€æ®µæ™‚é–“å°±è‡ªå‹•é€å‡ºä¸€å€‹ HTTP è«‹æ±‚çµ¦ server ï¼Œç²å–æœ€æ–°çš„ç¶²é è³‡æ–™</li>

<li>åœ¨ server æ²’æœ‰æ–°è³‡æ–™æ™‚ï¼Œç€è¦½å™¨ä¹Ÿæ˜¯æœƒè‡ªå‹•é€å‡ºè«‹æ±‚ï¼Œé€ æˆç¶²è·¯è³‡æºæµªè²»</li>
</ul>




<h3 id="longpolling">Long-Polling é•·æ™‚é–“è¼ªè©¢</h3>




<ul>
<li>server åœ¨æ¥æ”¶åˆ°ç€è¦½å™¨æ‰€é€å‡ºçš„ HTTP è«‹æ±‚å¾Œï¼Œ server æœƒç­‰å¾…ä¸€æ®µæ™‚é–“ï¼Œè‹¥åœ¨é€™æ®µæ™‚é–“è£¡ server æœ‰æ–°çš„è³‡æ–™ï¼Œå®ƒå°±æœƒæŠŠæœ€æ–°çš„è³‡æ–™å‚³å›çµ¦ç€è¦½å™¨</li>

<li>å¦‚æœç­‰å¾…çš„æ™‚é–“åˆ°äº†ä¹‹å¾Œä¹Ÿæ²’æœ‰æ–°è³‡æ–™çš„è©±ï¼Œå°±æœƒé€ä¸€å€‹å›æ‡‰çµ¦ç€è¦½å™¨ï¼Œå‘ŠçŸ¥ç€è¦½å™¨è³‡æ–™æ²’æœ‰æ›´æ–°</li>

<li>å¦‚æœåœ¨è³‡æ–™æ›´æ–°å¾ˆé »ç¹çš„ç‹€æ³ä¸‹ï¼Œé•·æ™‚é–“è¼ªè©¢ä¸¦ä¸æœƒæ¯”å‚³çµ±çš„è¼ªè©¢æœ‰æ•ˆç‡ï¼Œè€Œä¸”æœ‰æ™‚å€™è³‡æ–™é‡å¾ˆå¤§æ™‚ï¼Œæœƒé€ æˆé€£çºŒçš„ polls ä¸æ–·ç”¢ç”Ÿï¼Œåè€Œæœƒæ›´ç³Ÿç³•ã€‚</li>
</ul>




<h3 id="streaming">Streaming</h3>




<ul>
<li>è®“ server åœ¨æ¥æ”¶åˆ°ç€è¦½å™¨æ‰€é€å‡º HTTP è«‹æ±‚å¾Œï¼Œç«‹å³ç”¢ç”Ÿä¸€å€‹å›æ‡‰ç€è¦½å™¨çš„é€£ç·šï¼Œä¸¦ä¸”è®“é€™å€‹é€£ç·šæŒçºŒä¸€æ®µæ™‚é–“ä¸è¦ä¸­æ–·ï¼Œè€Œ server åœ¨é€™æ®µæ™‚é–“å…§å¦‚æœæœ‰æ–°çš„è³‡æ–™ï¼Œå°±å¯ä»¥é€éé€™å€‹é€£ç·šå°‡è³‡æ–™é¦¬ä¸Šå‚³é€çµ¦ç€è¦½å™¨ã€‚</li>

<li>ç”±æ–¼æ˜¯å»ºç«‹åœ¨ HTTP å”å®šä¸Šçš„ä¸€ç¨®å‚³è¼¸æ©Ÿåˆ¶ï¼Œæ‰€ä»¥æœ‰å¯èƒ½æœƒå› ç‚ºä»£ç† serverï¼ˆproxyï¼‰æˆ–é˜²ç«ç‰†ï¼ˆfirewallï¼‰å°‡å…¶ä¸­çš„è³‡æ–™å­˜æ”¾åœ¨ç·©è¡å€ä¸­ï¼Œé€ æˆè³‡æ–™å›æ‡‰ä¸Šçš„å»¶é²ï¼Œå› æ­¤è¨±å¤šä½¿ç”¨ä¸²æµçš„ Comet å¯¦ä½œæœƒåœ¨åµæ¸¬åˆ°æœ‰ä»£ç† server çš„ç‹€æ³æ™‚ï¼Œæ”¹ç”¨ Long-Polling çš„æ–¹å¼è™•ç†ã€‚</li>
</ul>




<h3 id="pubsubpublishsubscribepattern">Pub/Sub ç™¼ä½ˆ/è¨‚é–±æ¨¡å¼ (Publish/Subscribe Pattern)</h3>




<ul>
<li>ç™¼ä½ˆ/è¨‚é–±è¨­è¨ˆæ¨¡å¼æ˜¯ä¸€ç¨®åœ¨å³æ™‚é€šè¨Šä¸Šå¾ˆå¸¸ç”¨çš„æ¶æ§‹ï¼Œå¯ä»¥å°‡é€šè¨Šæ‹†æˆç™¼ä½ˆæ–¹å’Œè¨‚é–±æ–¹ï¼Œç™¼ä½ˆæ–¹éåŒæ­¥åœ°å°‡è¨Šæ¯å‚³é€çµ¦ä¸å®šæ•¸é‡çš„è¨‚é–±æ–¹ã€‚</li>

<li>Pub/Sub éƒ¨åˆ†å¯ä»¥å¾ä½ çš„ä¸»æ‡‰ç”¨ Process å¤–ï¼Œç¨ç«‹å‡ºä¾†æˆç‚ºä¸€å€‹å–®ç¨çš„é‹ä½œå…ƒä»¶ã€‚</li>
</ul>




<h1 id="actioncable">Actioncable å¯¦ä½œ</h1>




<ul>
<li>å»ºç«‹æ–°çš„å°ˆæ¡ˆ</li>
</ul>




<pre><code class="ruby">rails new campfire
</code></pre>




<ul>
<li>å»ºç«‹ rooms controller</li>
</ul>




<pre><code class="ruby"># show å¯ä»¥å†ç”¢ç”Ÿ controller è‡ªå‹•ç”¢ç”Ÿ show action &amp; router
rails g controller rooms show
</code></pre>




<ul>
<li>ä¿®æ”¹ routes</li>
</ul>




<pre><code class="ruby"># config/routes.rb
Rails.application.routes.draw do
  root to: 'rooms#show'
end
</code></pre>




<ul>
<li>å»ºç«‹ message model</li>
</ul>




<pre><code class="ruby"># content:text å¯è‡ªå‹•åœ¨ migration ç”¢ç”Ÿç›¸å°æ‡‰çš„æ¬„ä½
rails g model message content:text
rails db:migrate
</code></pre>




<ul>
<li>ä¿®æ”¹ rooms controller</li>
</ul>




<pre><code class="ruby"># controllers/rooms_controller.rb
class RoomsController &lt; ApplicationController
  def show
    @messages = Message.all
  end
end
</code></pre>




<pre><code class="ruby"># rails console å»ºç«‹ä¸€ç­†ä¾†æ¸¬è©¦
Message.create!(content: "Hello World!")
</code></pre>




<ul>
<li>ä¿®æ”¹ rooms/show.html.erb è®“ messages é¡¯ç¤º</li>
</ul>




<pre><code class="ruby"># views/rooms/show.html.erb
&lt;h1&gt;Chat room&lt;/h1&gt;
&lt;div id="messages"&gt;
  &lt;%= render @messages %&gt;
&lt;/div&gt;
</code></pre>




<p>æ­¤æ™‚å°±å¯ä»¥ <code>rails s</code> çœ‹ä¸€ä¸‹é¦–é æœ‰æ²’æœ‰æ±è¥¿</p>




<ul>
<li>å»ºç«‹ channel</li>
</ul>




<p>speak æœƒè‡ªå‹•ç”¢ç”Ÿ channel çš„ action</p>




<p><code>rails g channel room speak</code></p>




<ul>
<li>Server ç«¯ Mount ActionCable</li>
</ul>




<pre><code class="ruby"># config/routes.rb
Rails.application.routes.draw do
  root to: 'rooms#show'
  mount ActionCable.server =&gt; '/cable'
end
</code></pre>




<ul>
<li>ä¿®æ”¹ room.coffee</li>
</ul>




<p>è«‹æ³¨æ„é€™é‚Šæ˜¯ coffee js å› æ­¤ç©ºæ ¼æœƒæœ‰å·®åˆ¥</p>




<pre><code class="ruby"># assets/javascripts/channels/room.coffee
App.room = App.cable.subscriptions.create "RoomChannel",
  connected: -&gt;
    # Called when the subscription is ready for use on the server

  disconnected: -&gt;
    # Called when the subscription has been terminated by the server

  received: (data) -&gt;
    # Called when there's incoming data on the websocket for this channel
    # æ¥åˆ° data å¾Œè¦åšä»€éº¼è™•ç†ï¼Œç›®å‰è¨­å®šæ˜¯å°‡ message alert å½ˆå‡º
    alert data['message']

  speak: (message)-&gt;
  # å‚³ message åˆ° RoomChannel çš„ speak action
    @perform 'speak', message: message
</code></pre>




<ul>
<li>ä¿®æ”¹ room channel çš„ speak action</li>
</ul>




<pre><code class="ruby"># channels/room_channel.rb
class RoomChannel &lt; ApplicationCable::Channel
  def subscribed
    # è¨‚é–±çš„é »é“åç¨±
    stream_from "room_channel"
  end

  def unsubscribed
    # Any cleanup needed when channel is unsubscribed
  end

  def speak(data)
    # å°‡ message å»£æ’­åˆ° room_channel çš„ received function
    ActionCable.server.broadcast("room_channel", message: data['message'])
  end
end
</code></pre>




<p>é‡æ–°å•Ÿå‹• serverï¼Œåœ¨ç€è¦½å™¨çš„ <code>console</code> åŸ·è¡Œ </p>




<pre><code class="ruby"># é€™å€‹æŒ‡ä»¤æœƒ call client side çš„ speak functionï¼Œä¹Ÿå°±æ˜¯ @perform 'speak', message: message
App.room.speak("Hello, World!") 
</code></pre>




<p>å°±æœƒçœ‹åˆ°å½ˆå‡ºè¦–çª—ï¼Œè¡¨ç¤ºä¼ºæœå™¨ç«¯å·²ç¶“æ¥å—åˆ°è¨Šæ¯ã€‚</p>




<ul>
<li>æ–°å¢ text inputï¼Œè®“ client å¯ä»¥ç›´æ¥è¼¸å…¥ data</li>
</ul>




<pre><code class="ruby"># views/rooms/show.html.erb
&lt;h1&gt;Chat room&lt;/h1&gt;
&lt;div id="messages"&gt;
 &lt;%= render @messages %&gt;
&lt;/div&gt;
&lt;form&gt;
  &lt;label&gt;Say something:&lt;/label&gt;
  &lt;input type="text" data-behavior="room_speaker"&gt;
&lt;/form&gt;
</code></pre>




<ul>
<li>è¨­å®šè¼¸å…¥å¾ŒåŸ·è¡Œçš„å‹•ä½œ</li>
</ul>




<p>è¨˜å¾—å…ˆå®‰è£ <code>jquery</code>ï¼Œå› ç‚ºå¾Œé¢æœƒåˆ©ç”¨ <code>jquery</code> ä¾†æ“ä½œ <code>dom</code> å’Œ <code>event</code></p>




<pre><code class="ruby"># Gemfile
gem 'jquery-rails'
</code></pre>




<pre><code class="ruby"># assets/javascripts/application.js
//= require jquery
</code></pre>




<p>è«‹æ³¨æ„é€™é‚Šæ˜¯ coffee js å› æ­¤ç©ºæ ¼æœƒæœ‰å·®åˆ¥</p>




<pre><code class="ruby"># assets/javascripts/channels/room.coffee
App.room = App.cable.subscriptions.create "RoomChannel",
  connected: -&gt;
    # Called when the subscription is ready for use on the server

  disconnected: -&gt;
    # Called when the subscription has been terminated by the server

  received: (data) -&gt;
    # Called when there's incoming data on the websocket for this channel
    # æ¥åˆ° data å¾Œè¦åšä»€éº¼è™•ç†ï¼Œç›®å‰è¨­å®šæ˜¯å°‡ message alert å½ˆå‡º
    alert data['message']

  speak: (message)-&gt;
    @perform 'speak', message: message

# è¨­å®šåœ¨æŒ‰ä¸‹éµç›¤ Enter æŒ‰éµå¾Œï¼Œè¦åŸ·è¡Œ App.room.speakï¼Œå°±ä¸ç”¨é€é console å»è¼¸å…¥
$(document).on 'keypress', '[data-behavior~=room_speaker]', (event) -&gt;
  if event.keyCode is 13 #return
    App.room.speak event.target.value
    event.target.value = ''
    event.preventDefault()
</code></pre>




<p>åŸºæœ¬ä¸Šç¾åœ¨å°±å¯ä»¥é€éè¼¸å…¥æ¡†ï¼Œè®“ <code>alert</code> è·³å‡ºä¾†äº†</p>




<h3 id="jobactioncable">é€é job ä¾†åŸ·è¡Œ ActionCable</h3>




<ul>
<li>å¯¦éš›å­˜å–åˆ° db</li>
</ul>




<pre><code class="ruby"># channels/room_channel.rb
class RoomChannel &lt; ApplicationCable::Channel
  def subscribed
    stream_from "room_channel"
  end

  def unsubscribed
    # Any cleanup needed when channel is unsubscribed
  end

  def speak(data)
    # æ”¹æˆç›´æ¥ create record åœ¨ db è£¡é¢
    Message.create(content: data['message'])
  end
end
</code></pre>




<ul>
<li>create å¾Œ callback åŸ·è¡Œ Job</li>
</ul>




<pre><code class="ruby"># models/message.rb
class Message &lt; ApplicationRecord
  after_create_commit { MessageBroadcastJob.perform_later self }
end
</code></pre>




<ul>
<li>å»ºç«‹ job</li>
</ul>




<pre><code class="ruby">rails g job MessageBroadcast
</code></pre>




<pre><code class="ruby"># jobs/message_broadcast_job.rb
class MessageBroadcastJob &lt; ApplicationJob
  queue_as :default

  def perform(message)
     # perform_later å¾ŒæœƒåŸ·è¡Œçš„å‹•ä½œ
    ActionCable.server.broadcast("room_channel", message: render_message(message))
  end

  private

  def render_message(message)
     # é€é ApplicationController å°‡ html code render å›ä¾†ç•¶ä¸€å€‹åƒæ•¸åšå‚³é
    ApplicationController.renderer.render(partial: 'messages/message', locals: { message: message })
  end
end
</code></pre>




<p>æ­¤æ™‚ <code>rails s</code> æ¸¬è©¦æ˜¯å¦æ­£å¸¸ï¼Œå› è©²æœƒæœ‰ <code>alert</code> è·³å‡ºä¸€æ®µ <code>html code</code></p>




<ul>
<li>ä¿®æ”¹ received function</li>
</ul>




<pre><code class="ruby"># assets/javascripts/channels/room.coffee
App.room = App.cable.subscriptions.create "RoomChannel",
  connected: -&gt;
    # Called when the subscription is ready for use on the server

  disconnected: -&gt;
    # Called when the subscription has been terminated by the server

  received: (data) -&gt;
    # Called when there's incoming data on the websocket for this channel
    # alert æ”¹æˆé€é jquery æ‰¾åˆ° id='messages' çš„ domï¼Œä¸¦æŠŠå›å‚³ä¾†çš„ html code append ä¸Šå»
    $('#messages').append data['message']

  speak: (message)-&gt;
    @perform 'speak', message: message

$(document).on 'keypress', '[data-behavior~=room_speaker]', (event) -&gt;
  if event.keyCode is 13 #return
    App.room.speak event.target.value
    event.target.value = ''
    event.preventDefault()
</code></pre>




<p>å†é‡å•Ÿä¸€æ¬¡ï¼Œé€™æ™‚è¼¸å…¥è³‡æ–™å¾Œï¼Œç•«é¢æœƒç«‹å³æ–°å¢ï¼Œå¯ä»¥é–‹é›™ç•«é¢å»åšæ¸¬è©¦ï¼Œå¦ä¸€é‚Šçš„ç•«é¢æ˜¯å¦ä¹Ÿæ˜¯ç«‹å³æ–°å¢</p>




<ul>
<li><a href="https://github.com/mgleon08/pratice_action_cable">å®Œæˆç¯„ä¾‹ç¨‹å¼ç¢¼</a></li>

<li><a href="http://mgleon08.github.io/blog/2017/10/06/http-websocket-bot/">ä¹‹å‰ç©éçš„ Http Websocket Bot</a></li>
</ul>




<p>åƒè€ƒæ–‡ä»¶:</p>




<ul>
<li><a href="https://www.youtube.com/watch?v=n0WUjGkDFS0">Rails 5: Action Cable demo</a></li>

<li><a href="https://ihower.tw/rails/actioncable.html">Action Cable å³æ™‚é€šè¨Š</a></li>

<li><a href="https://www.learnenough.com/action-cable-tutorial">Action Cable Tutorial</a></li>

<li><a href="https://github.com/rails/rails/tree/master/actioncable">Action Cable â€“ Integrated WebSockets for Rails</a></li>

<li><a href="https://blog.heroku.com/real_time_rails_implementing_websockets_in_rails_5_with_action_cable">Real-Time Rails: Implementing WebSockets in Rails 5 with Action Cable</a></li>

<li><a href="https://www.sitepoint.com/create-a-chat-app-with-rails-5-actioncable-and-devise/">Create a Chat App with Rails 5, ActionCable, and Devise</a></li>

<li><a href="https://evilmartians.com/chronicles/anycable-actioncable-on-steroids">AnyCable</a></li>
</ul>



]]></content>
  </entry>
  
</feed>
