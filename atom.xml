<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Leon's Blogging]]></title>
  <link href="http://mgleon08.github.com/atom.xml" rel="self"/>
  <link href="http://mgleon08.github.com/"/>
  <updated>2016-09-17T23:00:53+08:00</updated>
  <id>http://mgleon08.github.com/</id>
  <author>
    <name><![CDATA[LeonJi]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[I/O 輸入輸出]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/io/"/>
    <updated>2016-08-30T10:32:37+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/io</id>
    <content type="html"><![CDATA[<p>先來說說什麼是 IO</p>

<!-- more -->


<blockquote><ul>
<li>所謂「I/O」，是input/output(輸出入) 的縮寫，泛指所有的輸出入動作。</li>
<li>我們從鍵盤上輸入資料、移動滑鼠、由掃描器輸入影像、從磁碟機讀入檔案，都是屬於輸入的動作；從印表機印出報表、顯示圖形到螢幕、將執行結果存入磁碟中，都是屬於輸出的一種。</li>
<li>I/O也指磁碟機的存取、或是通訊埠的接收資料和傳送資料等動作，一般都是針對可兼做輸出和輸入的設備。</li>
</ul>
</blockquote>

<p>由以上可知，當我們鍵盤上打字，就是一種輸入的動作，再 terminal 顯示我們輸入的字，就是一種輸出的動作</p>

<h1>ruby IO</h1>

<ul>
<li>標準輸入：$stdin</li>
<li>標準輸出：$stdout</li>
<li>標準錯誤輸出：$stderr</li>
<li>命令列引數的陣列: ARGV</li>
</ul>


<h3>標準輸出 vs 標準錯誤輸出</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#io.rb</span>
</span><span class='line'><span class="vg">$stdout</span><span class="o">.</span><span class="n">print</span>  <span class="s2">&quot;標準輸出&quot;</span>
</span><span class='line'><span class="vg">$stderr</span><span class="o">.</span><span class="n">print</span>  <span class="s2">&quot;標準錯誤輸出&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#執行 ruby io.rb &gt; log.txt，會發現 console 只會顯示 &#39;標準錯誤輸出&#39;，而標準輸出則會輸出到 log.txt</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">##&lt;IO:&lt;STDIN&gt;&gt;</span>
</span><span class='line'><span class="no">STDIN</span>
</span><span class='line'><span class="vg">$stdin</span>
</span><span class='line'>
</span><span class='line'><span class="c1">##&lt;IO:&lt;STDOUT&gt;&gt;</span>
</span><span class='line'><span class="vg">$&gt;</span>
</span><span class='line'><span class="no">STDOUT</span>
</span><span class='line'><span class="vg">$stdout</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#雖然有很多種表示法，但是比較偏好 $stdin，因為再 ruby 全大寫通常是常數，會讓人誤會，另一個則是不懂的人難以理解</span>
</span></code></pre></td></tr></table></div></figure>


<h3>輸入 input</h3>

<p><code>$stdin.gets</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vg">$stdin</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">hello</span>
</span><span class='line'><span class="c1">#=&gt; &quot;hello\n&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>#chomp!</code> 去除掉 \n</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vg">$stdin</span><span class="o">.</span><span class="n">gets</span><span class="o">.</span><span class="n">chomp!</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">hello</span>
</span><span class='line'><span class="c1">#=&gt; &quot;hello&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>#eof?</code> 判斷是否讀到最後</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="s1">&#39;ruby.rb&#39;</span> <span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">eof?</span>
</span><span class='line'><span class="c1">#=&gt; false</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="c1">#=&gt; &quot;1\n&quot;</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">eof?</span>
</span><span class='line'><span class="c1">#=&gt; false</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="c1">#=&gt; &quot;2\n&quot;</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="c1">#=&gt; nil</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">eof?</span>
</span><span class='line'><span class="c1">#=&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>#getc</code> 每次讀取一個字元</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s1">&#39;ruby.rb&#39;</span> <span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">getc</span>
</span><span class='line'><span class="c1">#=&gt; &quot;1&quot;</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">getc</span>
</span><span class='line'><span class="c1">#=&gt; &quot;\n&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#會被主動轉換成 ASCII 編碼，因此第二個會讀出 \n</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>io.read</code> 指定讀取長度，預設為全部</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s1">&#39;ruby.rb&#39;</span> <span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'><span class="c1">#=&gt; &quot;1\n2\n3&quot;</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">rewind</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">0</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; &quot;1\n2&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>輸出 output</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#adds a new line character</span>
</span><span class='line'><span class="c1">#is an equivalent to the $stdout.puts</span>
</span><span class='line'><span class="nb">puts</span> <span class="s1">&#39;a&#39;</span>
</span><span class='line'><span class="c1">#=&gt;a\n</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#is an equivalent to the $stdout.print</span>
</span><span class='line'><span class="nb">printf</span> <span class="s1">&#39;a&#39;</span>
</span><span class='line'><span class="c1">#a</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#prints one character to the console</span>
</span><span class='line'><span class="nb">putc</span> <span class="mi">97</span>
</span><span class='line'><span class="c1">#a=&gt; 97</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#p calls the inspect method upon the object being printed, The method is useful for debugging.</span>
</span><span class='line'><span class="nb">p</span> <span class="s2">&quot;a&quot;</span>
</span><span class='line'><span class="c1">#=&gt; &#39;a&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="no">StringIO</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="c1">#=&gt; #&lt;StringIO:0x007fc9a08813e8&gt;</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; nil</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">rewind</span>
</span><span class='line'><span class="c1">#=&gt; 0</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="c1">#=&gt; &quot;123\n&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>指標</h3>

<p>資料流的存取方法，有區分成「固定長度」與「非固定長度」</p>

<ul>
<li><p>固定長度的讀取方式</p>

<ul>
<li>優點：讀取速度快，資料都以固定的長度儲存，可以很快的找到指定的位置</li>
<li>缺點：浪費空間，即使用不到大的空間也是會空下位置</li>
</ul>
</li>
<li><p>非固定長度的讀取方式</p>

<ul>
<li>優點：省空間，有用到才會有空間</li>
<li>缺點：讀取速度慢，每次讀取資料時，都必須從頭開始讀取</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">rewind</span>  <span class="c1">#將指標移到最前面</span>
</span><span class='line'>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">pos</span>     <span class="c1">#目前指標位置</span>
</span><span class='line'>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="err">位置</span><span class="p">,</span> <span class="err">方式</span><span class="p">)</span> <span class="c1">#指定位置</span>
</span><span class='line'><span class="c1">#方式有三種：</span>
</span><span class='line'><span class="c1">#SEEK_SET ： 直接移動到指定位置</span>
</span><span class='line'><span class="c1">#SEEK_CUR ： 移動到目前位置的相對位置</span>
</span><span class='line'><span class="c1">#SEEK_END ： 移動到檔尾算起的相對位置</span>
</span><span class='line'>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</span><span class='line'><span class="c1">#引數為 0 的話，表示全部清空</span>
</span><span class='line'><span class="c1">#引數為 io.pos 的話，表示將目前指標後的檔案全清空</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;ruby.rb&quot;</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; 3</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'><span class="c1">#=&gt; &quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#因為 a 若有檔案在會寫在檔案後面，此時指標會指向最後面，因此可以用 rewind 將指標移致最前面</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">rewind</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'><span class="c1">#=&gt; 123</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Readline</h1>

<blockquote><p>The Readline module provides interface for GNU Readline. This module defines a number of methods to facilitate completion and accesses input history from the Ruby interpreter. This module supported Edit Line(libedit) too. libedit is compatible with GNU Readline.</p></blockquote>

<p>GNU的readline是一個開源的跨平台程序庫，提供了交互式的文本編輯功能</p>

<p><a href="http://ruby-doc.org/stdlib-2.1.1/libdoc/readline/rdoc/Readline.html">Readline</a></p>

<h1>stringIO 物件</h1>

<ul>
<li><a href="http://ruby-doc.org/stdlib-2.3.0/libdoc/stringio/rdoc/StringIO.html">StringIO</a></li>
</ul>


<p>設一個能夠儲存字串的物件</p>

<blockquote><p>Pseudo I/O on String object.<br/>
Commonly used to simulate <code>$stdio</code> or <code>$stderr</code></p></blockquote>

<p>此時對 io 操作 puts 並不會真正的輸出，而是將字串存入 io 物件之中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">StringIO</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">rewind</span>
</span><span class='line'><span class="nb">p</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#&quot;A\nB\nC\n&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>檔案輸出入</h1>

<p>File 繼承自 IO</p>

<blockquote><p>File.new 與 File.open 和 IO.new 與 IO.open 幾乎一樣，只差在覆寫了 initialize 方法，使其接受的參數不再是 FD 而是檔案的路徑字串。</p></blockquote>

<ul>
<li><a href="http://ruby-doc.org/core-2.1.5/File.html">File</a></li>
<li><a href="http://mgleon08.github.io/blog/2016/01/31/ruby-file-dir/">用 Ruby 進行 File ＆ Dir 檔案操作</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># r  讀取，檔案必須存在</span>
</span><span class='line'><span class="c1"># w  會主動建立空檔案，檔案已存在則會被覆蓋</span>
</span><span class='line'><span class="c1"># a  寫入。主動建檔，檔案已存在則追加在後。</span>
</span><span class='line'><span class="c1"># r+ 讀取 / 寫入，不會主動建檔，將內容加在檔案最前面，會覆蓋原有內容，檔案必須存在)</span>
</span><span class='line'><span class="c1"># w+ 讀取 / 寫入。同 w 功能</span>
</span><span class='line'><span class="c1"># a+ 讀取 / 寫入。同 a 功能</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#在每個模式後面加上&quot;b&quot;</span>
</span><span class='line'><span class="c1">#例如 &quot;rb&quot; 或 &quot;rb+&quot;，就可以開啟「二進位」模式 </span>
</span><span class='line'>
</span><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;ruby.rb&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/work/ruby.rb&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">close</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">closed?</span> <span class="c1">#檢查是否關閉</span>
</span><span class='line'><span class="c1">#若後面沒有 block (結束會自動關閉) 必須要再加上，io.close，關閉檔案，否則會出錯</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 打開檔案，並寫入文字（若沒檔案會直接新增）</span>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;langs&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>  <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;Ruby&quot;</span>
</span><span class='line'>  <span class="n">f</span><span class="o">.</span><span class="n">write</span> <span class="s2">&quot;Java</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="n">f</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Python</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#查看檔案是否存在，建立時間，檔案大小</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">File</span><span class="o">.</span><span class="n">exists?</span> <span class="s1">&#39;tempfile&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">new</span> <span class="s1">&#39;tempfile&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span> <span class="s1">&#39;tempfile&#39;</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">f</span><span class="o">.</span><span class="n">size</span>
</span><span class='line'>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">rename</span> <span class="s1">&#39;tempfile&#39;</span><span class="p">,</span> <span class="s1">&#39;tempfile2&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">close</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#逐一行印出</span>
</span><span class='line'><span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;stones&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">while</span> <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">gets</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">line</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">close</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#逐一行顯示</span>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="s2">&quot;ruby.rb&quot;</span> <span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>  <span class="k">while</span> <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">line</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#刪除檔案</span>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/home/work/ruby.rb&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#讀取檔案</span>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;ruby.rb&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><h3>IO 的世界相當大啊，還有很多沒有提及，以後若有機會接觸到比較深的再來研究~.~</h3></blockquote>

<ul>
<li><a href="http://mgleon08.github.io/blog/2016/01/31/ruby-file-dir/">用 Ruby 進行 File ＆ Dir 檔案操作</a></li>
<li><a href="http://mgleon08.github.io/blog/2016/02/07/callsystem/">用 Ruby 來 Calling Shell Commands</a></li>
</ul>


<p>官方文件：</p>

<ul>
<li><a href="http://ruby-doc.org/core-2.2.2/IO.html">IO</a></li>
<li><a href="http://ruby-doc.org/stdlib-1.9.3/libdoc/stringio/rdoc/StringIO.html">StringIO</a></li>
<li><a href="http://ruby-doc.org/core-2.1.5/File.html">File</a></li>
<li><a href="https://ruby-doc.org/core-2.2.0/Dir.html">Dir</a></li>
<li><a href="http://ruby-doc.org/core-2.3.1/Kernel.html">Kernel</a></li>
<li><a href="http://ruby-doc.org/stdlib-2.1.1/libdoc/readline/rdoc/Readline.html">Readline</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="http://zetcode.com/lang/rubytutorial/io/">Input &amp; output in Ruby</a></li>
<li><a href="https://blog.alphacamp.co/2016/06/30/ruby-open/">Ruby#open 知多少？</a></li>
<li><a href="http://rpg0822.pixnet.net/blog/post/2844850-ruby-%E7%AD%86%E8%A8%98---7----%E8%A9%B2%E6%AD%BB%E7%9A%84-io-">Ruby 筆記 - 7 - 該死的 IO</a></li>
<li><a href="http://stackoverflow.com/questions/4279604/what-is-the-difference-between-stdin-and-stdin-in-ruby">What is the difference between STDIN and $stdin in Ruby?</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ERB Template]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/erb-template/"/>
    <updated>2016-08-30T10:31:47+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/erb-template</id>
    <content type="html"><![CDATA[<p>相信學過 rails 一定知道 erb，可以很方便地將 ruby code 寫在 view 中</p>

<!-- more -->


<p>但不一定是要有 rails 才可以用 erb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#template.rb</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;erb&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Template</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@foo</span> <span class="o">=</span> <span class="n">foo</span>
</span><span class='line'>    <span class="vi">@bar</span> <span class="o">=</span> <span class="n">bar</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">open_template</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="no">ERB</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">templates_path</span><span class="p">),</span> <span class="kp">nil</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="nb">binding</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">templates_path</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;../template.erb&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Template</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">open_template</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#template.erb</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span> <span class="o">&lt;</span><span class="sx">%= @foo %&gt;</span>
</span><span class='line'><span class="sx">2. &lt;%=</span> <span class="vi">@bar</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#執行</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">template</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="c1">#1. hi</span>
</span><span class='line'><span class="c1">#2. hello</span>
</span></code></pre></td></tr></table></div></figure>


<h3>也可以利用 erb 來寫設定檔</h3>

<ul>
<li><a href="http://mgleon08.github.io/blog/2016/02/07/yaml/">用 Yaml 來寫文件, 設定檔</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="http://ruby-doc.org/stdlib-2.3.1/libdoc/erb/rdoc/ERB.html">ERB doc</a></li>
<li><a href="http://stackoverflow.com/questions/1338960/ruby-templates-how-to-pass-variables-into-inlined-erb">Ruby templates: How to pass variables into inlined ERB?</a></li>
<li><a href="http://stackoverflow.com/questions/8954706/render-an-erb-template-with-values-from-a-hash">Render an ERB template with values from a hash</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OptionParser]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/optionparser/"/>
    <updated>2016-08-30T10:30:52+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/optionparser</id>
    <content type="html"><![CDATA[<p>ruby 裡內建的強大工具，可以解析命令行參數</p>

<!-- more -->


<p>先來看一下什麼是 Unix命令行</p>

<p>通常的Unix命令行參數包含下面這些形式：</p>

<ul>
<li>Option - 主要功能是用於調整命令行工具的行為

<ul>
<li>Option的表現通常有兩種形式

<ul>
<li>short opt​​ion</li>
<li>long option</li>
</ul>
</li>
<li>Option的類型有兩種

<ul>
<li><code>switch</code> 不帶 argument</li>
<li><code>flag</code> 帶有 argument</li>
</ul>
</li>
</ul>
</li>
<li>Argument - 表示命令行工具要操作的對象，通常是路徑，URL或者名稱等等。</li>
<li>Action - 表示命令行工具的行為，比如 git 命令的 push 或者 pull 等等。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="n">max</span><span class="o">-</span><span class="n">count</span><span class="o">=</span><span class="mi">10</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#git 是 command，log 是 action，表示查看 git 的提交歷史。</span>
</span><span class='line'><span class="c1">#--max-count 則是 option，表示最多顯示N條commit記錄</span>
</span></code></pre></td></tr></table></div></figure>


<p>用 <code>ARGV</code> 來接命令列引數的陣列。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;optparse&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Hello</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@arguments</span> <span class="o">=</span> <span class="n">arguments</span>
</span><span class='line'>      <span class="n">parse_options</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">parse_options</span>
</span><span class='line'>    <span class="n">options</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="s1">&#39;Usage: xxxx [options]&#39;</span>
</span><span class='line'>    <span class="c1">#on(&#39;short opt​​ion&#39;, &#39;long option&#39;, &#39;comment&#39;)</span>
</span><span class='line'>    <span class="c1">#帶參數</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-a arg&#39;</span><span class="p">,</span> <span class="s1">&#39;--aa arg&#39;</span><span class="p">,</span> <span class="s1">&#39;this is test&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">arg</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">arg</span> <span class="p">}</span>
</span><span class='line'>    <span class="c1">#不帶參數</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="s1">&#39;--bb&#39;</span><span class="p">,</span> <span class="s1">&#39;this is test&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s1">&#39;b&#39;</span> <span class="p">}</span>
</span><span class='line'>    <span class="c1">#多個參數</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-c arg&#39;</span><span class="p">,</span> <span class="s1">&#39;--cc arg&#39;</span><span class="p">,</span> <span class="s1">&#39;this is test&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">arg</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">arg</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="s1">&#39;Show this message&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span><span class="p">(</span><span class="n">options</span><span class="p">);</span> <span class="nb">exit</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">parse!</span><span class="p">(</span><span class="vi">@arguments</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Hello</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ARGV</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">a</span> <span class="n">a</span>
</span><span class='line'><span class="c1">#=&gt;a</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">--</span><span class="n">aa</span> <span class="n">aa</span>
</span><span class='line'><span class="c1">#=&gt;aa</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">b</span>
</span><span class='line'><span class="c1">#=&gt;b</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">--</span><span class="n">bb</span>
</span><span class='line'><span class="c1">#=&gt;b</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">c</span> <span class="n">c</span><span class="p">,</span><span class="n">cc</span>
</span><span class='line'><span class="c1">#=&gt;c,cc</span>
</span><span class='line'>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">h</span>
</span><span class='line'><span class="c1">#Usage: xxxx [options]</span>
</span><span class='line'><span class="c1">#   -t, --test arg                   this is test</span>
</span><span class='line'><span class="c1">#   -h, --help                       Show this message</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ARGV</h3>

<p><a href="http://lrthw.github.io/ex13/">Learn Ruby The Hard Way ex13</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">third</span> <span class="o">=</span> <span class="no">ARGV</span>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;Your first variable is: </span><span class="si">#{</span><span class="n">first</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;Your second variable is: </span><span class="si">#{</span><span class="n">second</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;Your third variable is: </span><span class="si">#{</span><span class="n">third</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># ARGV 就是「參數變數(argument variable)」，是一個非常標準的程式術語。</span>
</span><span class='line'><span class="c1"># 在其他的程式語言你也可以看到它全大寫的原因是因為它是一個「常數(constant)」，</span>
</span><span class='line'><span class="c1"># 意思是當它被賦值之後你就不應該去改變它了。這個變數會接收當你運行 Ruby 腳本時所傳</span>
</span><span class='line'><span class="c1"># 入的參數。通過後面的習題你將對它有更多的了解。你將對它有更多的了解。</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 第 1 行將 ARGV 「解包(unpack)」，與其將所有參數放到同一個變數下面，我們將每個參數</span>
</span><span class='line'><span class="c1"># 予一個變數名稱 first 、 second 以及 third。腳本本身的名稱被存在一個特殊變數 $0</span>
</span><span class='line'><span class="c1"># 裡，這是我們不需要解包的部份。也許看來有些異，但「解包」可能是最好的描述方式了。它</span>
</span><span class='line'><span class="c1"># 的涵義很簡單：「將 ARGV 中的東西解包，然後將所有</span>
</span><span class='line'><span class="c1"># 的參數依次賦予左邊的變數名稱」。</span>
</span></code></pre></td></tr></table></div></figure>


<p>官方文件：</p>

<ul>
<li><a href="http://ruby-doc.org/stdlib-2.3.1/libdoc/optparse/rdoc/OptionParser.html">OptionParser</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="https://ruby-china.org/wiki/building-a-command-line-tool-with-optionparser">用 OptionParser 构建 Command Line 工具</a></li>
<li><a href="http://rubylearning.com/blog/2011/01/03/how-do-i-make-a-command-line-tool-in-ruby/">How do I make a command-line tool in Ruby?</a></li>
</ul>


<p>相關 gem：</p>

<ul>
<li><a href="https://github.com/defunkt/choice">choice</a></li>
<li><a href="https://github.com/ManageIQ/trollop">trollop</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Make You Own Gem]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/make-you-own-gem/"/>
    <updated>2016-08-30T10:24:36+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/make-you-own-gem</id>
    <content type="html"><![CDATA[<p>bundle 本身就有提供可以產生 gem 相關檔案的功能</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="n">gem</span> <span class="n">xxx</span> <span class="o">--</span><span class="n">mit</span> <span class="o">-</span><span class="n">t</span><span class="o">=</span><span class="n">rspec</span>
</span><span class='line'><span class="c1">#後面可以設定參數，ex: 自動產生 LICENSE.txt, 測試用 rspec or mintest 等等</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#xxx/Gemfile                  &lt;= dependency 哪些套件，但基本上裡面是指定到 xxx.gemspec，將相依的套件定義在 xxx.gemspec 即可</span>
</span><span class='line'><span class="c1">#xxx/Rakefile                 &lt;= 發佈和打包的 rake tasks</span>
</span><span class='line'><span class="c1">#xxx/LICENSE.txt              &lt;= 註明 License</span>
</span><span class='line'><span class="c1">#xxx/README.md                &lt;= 說明如何使用它(github上會顯示)</span>
</span><span class='line'><span class="c1">#xxx/.gitignore               &lt;= 不要進 Git 的檔案在這定義</span>
</span><span class='line'><span class="c1">#xxx/xxx.gemspec             &lt;= gem 的 spec</span>
</span><span class='line'><span class="c1">#xxx/lib/xxx.rb              &lt;= gem 裡的 library，主要 code 都是在這裡</span>
</span><span class='line'><span class="c1">#xxx/lib/xxx/version.rb      &lt;= 版本紀錄</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>xxx.gemspec</code> gem 裡面的基本設定都會在這邊，需要寫的都會註明 <code>TODO:</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># coding: utf-8</span>
</span><span class='line'><span class="n">lib</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../lib&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'><span class="vg">$LOAD_PATH</span><span class="o">.</span><span class="n">unshift</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="k">unless</span> <span class="vg">$LOAD_PATH</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;xxx/version&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">spec</span><span class="o">|</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">name</span>          <span class="o">=</span> <span class="s2">&quot;xxx&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">version</span>       <span class="o">=</span> <span class="no">Xxx</span><span class="o">::</span><span class="no">VERSION</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">authors</span>       <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;TODO: Write your name&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">email</span>         <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;TODO: Write your email address&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">summary</span>       <span class="o">=</span> <span class="sx">%q{TODO: Write a short summary, because Rubygems requires one.}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">description</span>   <span class="o">=</span> <span class="sx">%q{TODO: Write a longer description or delete this line.}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">homepage</span>      <span class="o">=</span> <span class="s2">&quot;TODO: Put your gem&#39;s website or public repo URL here.&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">license</span>       <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Prevent pushing this gem to RubyGems.org by setting &#39;allowed_push_host&#39;, or</span>
</span><span class='line'>  <span class="c1"># delete this section to allow pushing this gem to any host.</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">respond_to?</span><span class="p">(</span><span class="ss">:metadata</span><span class="p">)</span>
</span><span class='line'>    <span class="n">spec</span><span class="o">.</span><span class="n">metadata</span><span class="o">[</span><span class="s1">&#39;allowed_push_host&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;TODO: Set to &#39;http://mygemserver.com&#39;&quot;</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="k">raise</span> <span class="s2">&quot;RubyGems 2.0 or newer is required to protect against public gem pushes.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">files</span>         <span class="o">=</span> <span class="sb">`git ls-files -z`</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x0</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">%r{^(test|spec|features)/}</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">bindir</span>        <span class="o">=</span> <span class="s2">&quot;exe&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">executables</span>   <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">%r{^exe/}</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">require_paths</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;lib&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;bundler&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 1.11&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;rake&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 10.0&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;rspec&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 3.0&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Build</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">build</span> <span class="n">xxx</span><span class="o">.</span><span class="n">gemspec</span>
</span><span class='line'><span class="c1">#目錄底下會多出此檔 xxx-0.0.1.gem</span>
</span><span class='line'>
</span><span class='line'><span class="no">Successfully</span> <span class="n">built</span> <span class="no">RubyGem</span>
</span><span class='line'><span class="ss">Name</span><span class="p">:</span> <span class="n">xxx</span>
</span><span class='line'><span class="ss">Version</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="ss">File</span><span class="p">:</span> <span class="n">xxx</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="n">gem</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Install</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">xxx</span>
</span><span class='line'>
</span><span class='line'><span class="err">$</span> <span class="n">irb</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;xxx&#39;</span>
</span><span class='line'><span class="c1">#=&gt; true</span>
</span><span class='line'>
</span><span class='line'><span class="no">Xxx</span><span class="o">.</span><span class="n">hi</span>
</span><span class='line'><span class="c1">#=&gt;Hello, world!</span>
</span></code></pre></td></tr></table></div></figure>


<h1>發佈到 RubyGems.org</h1>

<ul>
<li>gem update &ndash;system</li>
<li>申請帳號 <a href="https://rubygems.org/sign_up">rubygems</a></li>
<li>發佈</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">push</span> <span class="n">xxx</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">gem</span>
</span><span class='line'><span class="c1">#push 後會要輸入你剛剛的申請的帳號密碼，就ok囉</span>
</span></code></pre></td></tr></table></div></figure>


<h3>command-reference</h3>

<p><a href="http://guides.rubygems.org/command-reference/">command-reference</a></p>

<p>參考文件：</p>

<ul>
<li><a href="RubyGems.org">https://rubygems.org/</a></li>
<li><a href="http://bundler.io/v1.12/man/bundle-gem.1.html">bundle gem</a></li>
<li><a href="http://guides.rubygems.org/make-your-own-gem/">MAKE YOUR OWN GEM</a></li>
<li><a href="http://blog.jex.tw/blog/2013/11/29/ruby-build-own-gem/">Ruby 建立自己的 Gem 套件</a></li>
<li><a href="https://quickleft.com/blog/engineering-lunch-series-step-by-step-guide-to-building-your-first-ruby-gem/">Step-by-Step Guide to Building Your First Ruby Gem</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cucumber]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/cucumber/"/>
    <updated>2016-08-30T10:23:07+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/cucumber</id>
    <content type="html"><![CDATA[<p>BDD 行為驅動開發工具</p>

<!-- more -->


<ul>
<li>Behavior Driven Development BDD 行為驅動開發工具</li>
<li>Cucumber 通過 Gherkin 語言来描述語句</li>
</ul>


<h3>好處</h3>

<ul>
<li>會說話的程式碼</li>
<li>用口語方式寫測試</li>
<li>讓溝通更順暢</li>
<li>使用人類的語言來描述程式行為</li>
<li>明確溝通需求</li>
<li>測試即文件</li>
<li>消除落差</li>
<li>留作紀錄</li>
</ul>


<h3>Usage</h3>

<p>描述行為</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Feature</span> <span class="p">(</span><span class="err">功能</span><span class="p">)</span>             <span class="c1">#功能說明, 使用情境</span>
</span><span class='line'>  <span class="no">Scenario</span><span class="p">(</span><span class="err">場景，劇本</span><span class="p">)</span>    <span class="c1">#操作方式 特定流程</span>
</span><span class='line'>      <span class="no">Step</span>    <span class="p">(</span><span class="err">步驟</span><span class="p">)</span>      <span class="c1">#操作步驟</span>
</span><span class='line'>      <span class="no">Given</span>   <span class="p">(</span><span class="err">假設</span><span class="p">)</span>      <span class="c1">#前情提要, 初始化</span>
</span><span class='line'>      <span class="no">And</span>     <span class="p">(</span><span class="err">並且</span><span class="p">)</span>      <span class="c1">#更多前情提要</span>
</span><span class='line'>      <span class="no">When</span>    <span class="p">(</span><span class="err">當</span><span class="p">)</span>        <span class="c1">#執行動作</span>
</span><span class='line'>      <span class="no">And</span>     <span class="p">(</span><span class="err">並且</span><span class="p">)</span>      <span class="c1">#更多動作 </span>
</span><span class='line'>      <span class="no">Then</span>    <span class="p">(</span><span class="err">那麼</span><span class="p">)</span>      <span class="c1">#預期結果</span>
</span><span class='line'>      <span class="no">And</span>     <span class="p">(</span><span class="err">並且</span><span class="p">)</span>      <span class="c1">#更多結果</span>
</span></code></pre></td></tr></table></div></figure>


<h3>撰寫測試</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#features/cucumber.feature</span>
</span><span class='line'><span class="ss">Feature</span><span class="p">:</span>
</span><span class='line'>  <span class="no">Add</span> <span class="n">two</span> <span class="n">number</span>
</span><span class='line'>
</span><span class='line'>  <span class="ss">Scenario</span><span class="p">:</span> <span class="no">Add</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">2</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">3</span>
</span><span class='line'>  <span class="no">Given</span> <span class="n">the</span> <span class="n">first</span> <span class="n">number</span> <span class="n">is</span> <span class="mi">1</span>
</span><span class='line'>  <span class="no">And</span> <span class="n">the</span> <span class="n">second</span> <span class="n">numner</span> <span class="n">is</span> <span class="mi">2</span>
</span><span class='line'>  <span class="no">When</span> <span class="n">calculate</span> <span class="n">two</span> <span class="n">number</span>
</span><span class='line'>  <span class="no">Then</span> <span class="n">result</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#features/step_definitions/interaction_steps.rb</span>
</span><span class='line'><span class="no">Given</span><span class="p">(</span><span class="sr">/^the first number is (\d+)$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">num1</span><span class="o">|</span>
</span><span class='line'>  <span class="vi">@num1</span> <span class="o">=</span> <span class="n">num1</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Given</span><span class="p">(</span><span class="sr">/^the second numner is (\d+)$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">num2</span><span class="o">|</span>
</span><span class='line'>  <span class="vi">@num2</span> <span class="o">=</span> <span class="n">num2</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">When</span><span class="p">(</span><span class="sr">/^calculate two number$/</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="vi">@sum</span> <span class="o">=</span> <span class="vi">@num1</span> <span class="o">+</span> <span class="vi">@num2</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Then</span><span class="p">(</span><span class="sr">/^result should be (\d+)$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
</span><span class='line'>  <span class="vi">@sum</span><span class="o">.</span><span class="n">should</span> <span class="o">===</span> <span class="n">result</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">console</span>
</span><span class='line'><span class="ss">Feature</span><span class="p">:</span>
</span><span class='line'>  <span class="no">Add</span> <span class="n">two</span> <span class="n">number</span>
</span><span class='line'>
</span><span class='line'>  <span class="ss">Scenario</span><span class="p">:</span> <span class="no">Add</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">2</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">3</span> <span class="c1"># features/command_options.feature:4</span>
</span><span class='line'>    <span class="no">Given</span> <span class="n">the</span> <span class="n">first</span> <span class="n">number</span> <span class="n">is</span> <span class="mi">1</span>     <span class="c1"># features/step_definitions/interaction_steps.rb:1</span>
</span><span class='line'>    <span class="no">And</span> <span class="n">the</span> <span class="n">second</span> <span class="n">numner</span> <span class="n">is</span> <span class="mi">2</span>      <span class="c1"># features/step_definitions/interaction_steps.rb:5</span>
</span><span class='line'>    <span class="no">When</span> <span class="n">calculate</span> <span class="n">two</span> <span class="n">number</span>       <span class="c1"># features/step_definitions/interaction_steps.rb:9</span>
</span><span class='line'>    <span class="no">Then</span> <span class="n">result</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">3</span>         <span class="c1"># features/step_definitions/interaction_steps.rb:13</span>
</span><span class='line'>
</span><span class='line'><span class="mi">1</span> <span class="n">scenario</span> <span class="p">(</span><span class="mi">1</span> <span class="n">passed</span><span class="p">)</span>
</span><span class='line'><span class="mi">4</span> <span class="n">steps</span> <span class="p">(</span><span class="mi">4</span> <span class="n">passed</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>產表工具</h3>

<p>cucumber-html-report</p>

<h3>測試涵蓋率</h3>

<p>Istanbul</p>

<p>參考文件：</p>

<ul>
<li><a href="https://github.com/cucumber/cucumber">cucumber github</a></li>
<li><a href="https://cucumber.io/">cucumber.io</a></li>
<li><a href="http://teddy-chen-tw.blogspot.tw/2013/07/bdd2cucumber.html">搞笑談軟工: BDD（2）：大家來吃小黃瓜之Cucumber運作原理</a></li>
<li><a href="http://icodeit.org/2012/05/cucumber%E7%AE%80%E4%BB%8B/">Cucumber简介</a></li>
<li><a href="http://insights.thoughtworkers.org/bdd/">醒醒吧少年，只用CUCUMBER不能帮助你BDD</a></li>
<li><a href="https://ruby-china.org/topics/7119">Cucumber 经验总结</a></li>
<li><a href="http://www.cnblogs.com/davenkin/archive/2012/02/03/cucumber-watir-in-10-minutes.html">10分钟学会 Cucumber+Watir 自动化测试框架</a></li>
<li><a href="https://danielzhangqinglong.github.io/2015/03/02/rails-test-samples/">在实际开发中使用RSpec和Cucumber进行TDD/BDD测试</a></li>
<li><a href="http://tauntaunslayer13.me/blog/2014/01/26/ru-he-shi-yong-capybarahe-cucumbershi-xian-ye-mian-ji-bie-zi-dong-hua/">如何使用Capybara和Cucumber实现页面级别自动化</a></li>
<li><a href="http://tauntaunslayer13.me/blog/2014/03/12/cucumberxiao-huang-gua-ye-mian-ji-zi-dong-hua-ce-shi-ru-men-jiao-cheng/">Cucumber小黄瓜页面级自动化测试入门教程</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rake 任務管理工具]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/11/rake/"/>
    <updated>2016-08-11T20:53:30+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/11/rake</id>
    <content type="html"><![CDATA[<p>rake 是個任務管理工具，可以將許多任務，寫成一個 rake，之後只要執行指令，就會將所有任務都完成，例如 rake db:create 中的 db:create 就是 Rails 提供的任務。</p>

<!-- more -->


<p>Rakefile</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rspec/core/rake_task&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Run specs&quot;</span>
</span><span class='line'><span class="no">RSpec</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">RakeTask</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:spec</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;spec/**/*_spec.rb&quot;</span> <span class="c1">#所有測試文件的位置</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kp">true</span> <span class="c1">#輸出 Rake::TestTask 執行的具體Ruby命令</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">ruby_opts</span> <span class="o">=</span> <span class="s2">&quot;-rtesthelper&quot;</span> <span class="c1">#避免每個測試文件重複 require &quot;test_helper&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Cucumber</span><span class="o">::</span><span class="no">Rake</span><span class="o">::</span><span class="no">Task</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:features</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">cucumber_opts</span> <span class="o">=</span> <span class="s2">&quot;features --format progress&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:spec</span><span class="p">,</span> <span class="ss">:features</span><span class="o">]</span>
</span><span class='line'><span class="c1">#設定 default 要跑的 task，之後只要執行 rake or rake default 就會去執行，spec 和 feature 的 task</span>
</span></code></pre></td></tr></table></div></figure>


<p>之前文章：<br/>
<a href="http://mgleon08.github.io/blog/2016/03/10/custom-tasks/">自己定義 Rake Tasks</a></p>

<p>官方文件：<br/>
<a href="http://rake.rubyforge.org/">RAKE – Ruby Make</a><br/>
<a href="https://relishapp.com/rspec/rspec-core/v/3-4/docs/command-line/rake-task">Rake task rspec</a><br/>
<a href="http://rake.rubyforge.org/classes/Rake/TestTask.html">Class Rake::TestTask</a></p>

<p>參考文件：<br/>
<a href="http://kaochenlong.com/2016/04/30/rake/">Ruby 語法放大鏡之「常在終端機裡下 rake db:migrate 指令，這個 rake 是什麼，後面那個 db:migrate 又是怎麼回事?」</a><br/>
<a href="http://code.oneapm.com/ruby/2015/05/28/ruby-rake-testtask/">Rake::TestTask 介绍</a><br/>
<a href="http://stackoverflow.com/questions/19200734/how-to-convert-array-of-activerecord-models-to-csv">How to convert array of ActiveRecord models to CSV?</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[更改 Rails 命名規則 Inflector]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/11/inflector/"/>
    <updated>2016-08-11T20:49:39+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/11/inflector</id>
    <content type="html"><![CDATA[<p>在 rails 當中，有許多命名的慣例</p>

<!-- more -->


<ul>
<li>像是 <code>hello_controller</code> 檔案，裡面慣例對應到的 Class 就是 <code>Hello_Controller</code></li>
<li>但若是像 <code>api_controller</code>，就會是 <code>Api_Controller</code></li>
</ul>


<p>雖然不是不行，但 API 本來就是縮寫，硬要改成 Api 可能會讓人覺得怪怪的</p>

<p>因此 rails 有提供解決辦法，就能夠將 <code>api_Controller</code> 改成 <code>API_Controller</code></p>

<p>rails 內建有 <code>Inflector</code> 就是用來處理命名規則用的</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">/</span><span class="n">initializers</span><span class="o">/</span><span class="n">inflections</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>
</span><span class='line'><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Inflector</span><span class="o">.</span><span class="n">inflections</span><span class="p">(</span><span class="ss">:en</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">inflect</span><span class="o">|</span>
</span><span class='line'>  <span class="n">inflect</span><span class="o">.</span><span class="n">acronym</span> <span class="s1">&#39;API&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>或是 Rails 轉單複數單字，有錯誤時，可以定義</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#錯誤</span>
</span><span class='line'><span class="s2">&quot;Business&quot;</span><span class="o">.</span><span class="n">singularize</span>  <span class="o">=&gt;</span> <span class="s2">&quot;Busines&quot;</span>
</span><span class='line'><span class="s2">&quot;moose&quot;</span><span class="o">.</span><span class="n">pluralize</span> <span class="o">=&gt;</span> <span class="s2">&quot;mooses&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">/</span><span class="n">initializers</span><span class="o">/</span><span class="n">inflections</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'>
</span><span class='line'><span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Inflector</span><span class="o">.</span><span class="n">inflections</span><span class="p">(</span><span class="ss">:en</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">inflect</span><span class="o">|</span>
</span><span class='line'>  <span class="n">inflect</span><span class="o">.</span><span class="n">irregular</span> <span class="s1">&#39;tooth&#39;</span><span class="p">,</span> <span class="s1">&#39;teeth&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>other</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Be sure to restart your server when you modify this file.</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Add new inflection rules using the following format. Inflections</span>
</span><span class='line'><span class="c1"># are locale specific, and you may define rules for as many different</span>
</span><span class='line'><span class="c1"># locales as you wish. All of these examples are active by default:</span>
</span><span class='line'><span class="c1"># ActiveSupport::Inflector.inflections(:en) do |inflect|</span>
</span><span class='line'><span class="c1">#   inflect.plural /^(ox)$/i, &#39;\1en&#39;</span>
</span><span class='line'><span class="c1">#   inflect.singular /^(ox)en/i, &#39;\1&#39;</span>
</span><span class='line'><span class="c1">#   inflect.irregular &#39;person&#39;, &#39;people&#39;</span>
</span><span class='line'><span class="c1">#   inflect.uncountable %w( fish sheep )</span>
</span><span class='line'><span class="c1"># end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># These inflection rules are supported but not enabled by default:</span>
</span><span class='line'><span class="c1"># ActiveSupport::Inflector.inflections(:en) do |inflect|</span>
</span><span class='line'><span class="c1">#   inflect.acronym &#39;RESTful&#39;</span>
</span><span class='line'><span class="c1"># end</span>
</span></code></pre></td></tr></table></div></figure>


<p>官方文件：</p>

<ul>
<li><a href="http://api.rubyonrails.org/classes/ActiveSupport/Inflector.html">Inflector</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="https://ruby-china.org/topics/19242">&lsquo;APIController&rsquo; is not a supported controller name</a></li>
<li><a href="https://ihower.tw/rails4/environments-and-bundler.html">環境設定與Bundler</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby on Rails 裝機趴 (Only Mac)]]></title>
    <link href="http://mgleon08.github.com/blog/2016/07/22/install-ruby-on-rails/"/>
    <updated>2016-07-22T19:58:37+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/07/22/install-ruby-on-rails</id>
    <content type="html"><![CDATA[<p>最近剛好新來了一台電腦，所有東西都要重新安裝，就順手把需要的東西都紀錄了一下，以便之後可以快速的安裝起來!</p>

<!-- more -->


<h3>目錄</h3>

<ul>
<li><a href="#iterm2">iTerm2</a></li>
<li><a href="#homebrew">Homebrew</a></li>
<li><a href="#git">Git</a></li>
<li><a href="#github">GitHub</a></li>
<li><a href="#zsh">zsh &amp; oh-my-zsh</a></li>
<li><a href="#rvmorrbenv">rvm or rbenv</a></li>
<li><a href="#rubygems">RubyGems</a></li>
<li><a href="#rails">Rails</a></li>
<li><a href="#bundle">Bundle</a></li>
<li><a href="#nvm">NVM</a></li>
<li><a href="#npm">NPM</a></li>
<li><a href="#sublime">Sublime Text</a></li>
<li><a href="#vim">Vim</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#other">Other</a></li>
</ul>


<h1><span id="iterm2">iTerm2</span></h1>

<blockquote><p>Terminal 終端機</p></blockquote>

<ul>
<li><a href="https://www.iterm2.com/">iTerm2</a></li>
</ul>


<h3>tmux</h3>

<ul>
<li><a href="http://blog.chh.tw/posts/tmux-terminal-multiplexer/">終端機必備的多工良伴：tmux</a></li>
</ul>


<h1><span id="homebrew">Homebrew</span></h1>

<blockquote><p>Mac OS X 上的套件管理程式</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#安裝</span>
</span><span class='line'><span class="sr">/usr/</span><span class="n">bin</span><span class="o">/</span><span class="n">ruby</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#homebrew檢查 </span>
</span><span class='line'><span class="n">brew</span> <span class="n">doctor</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#已經裝了哪些套件</span>
</span><span class='line'><span class="n">brew</span> <span class="n">list</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#homebrew更新</span>
</span><span class='line'><span class="n">brew</span> <span class="n">update</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#搜尋套件</span>
</span><span class='line'><span class="n">brew</span> <span class="n">search</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#查詢套件資訊</span>
</span><span class='line'><span class="n">brew</span> <span class="n">info</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#module會裝到/usr/local/opt/xxx</span>
</span><span class='line'><span class="c1">#安裝xxx模組 </span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">xxx</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#更新xxx模組 </span>
</span><span class='line'><span class="n">brew</span> <span class="n">upgrade</span> <span class="n">xxx</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://brew.sh/">Homebrew</a></li>
</ul>


<p>推薦套件</p>

<p><a href="http://searchbrew.com/">searchbrew</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#postgresql</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">postgresql</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">pg</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#mysql</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">mysql</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">mysql2</span>
</span><span class='line'><span class="n">mysql</span><span class="o">.</span><span class="n">server</span> <span class="n">start</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#redis</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">redis</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#背景啟動</span>
</span><span class='line'><span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="o">--</span><span class="n">daemonize</span> <span class="n">yes</span>
</span><span class='line'><span class="n">redis</span><span class="o">-</span><span class="n">server</span><span class="o">&amp;&amp;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#imagemagick</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">imagemagick</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">rmagick</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#ffmpeg</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">ffmpeg</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#MediaInfo</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">mediainfo</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#wget</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">wget</span>
</span></code></pre></td></tr></table></div></figure>


<h1><span id="git">Git</span></h1>

<blockquote><p>版本控制</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#安裝 git</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">git</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#設定輸出顏色</span>
</span><span class='line'><span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">color</span><span class="o">.</span><span class="n">ui</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#設定 git 的 user 和 email</span>
</span><span class='line'><span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="s2">&quot;YOUR NAME&quot;</span>
</span><span class='line'><span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="s2">&quot;YOUR@EMAIL.com&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#空白對有些語言是有影響的(像是Ruby)，因此我們會希望 Git 去忽略空白的變化</span>
</span><span class='line'><span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">apply</span><span class="o">.</span><span class="n">whitespace</span> <span class="n">nowarn</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#讓 git 記住你，不需每次上傳 code 都要打帳號密碼</span>
</span><span class='line'><span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">global</span> <span class="n">credential</span><span class="o">.</span><span class="n">helper</span> <span class="n">store</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Git GUI</h3>

<ul>
<li><a href="https://www.sourcetreeapp.com/">SourceTree</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#建立 command line 快捷</span>
</span><span class='line'><span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/Applications/</span><span class="no">SourceTree</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="no">Contents</span><span class="o">/</span><span class="no">Resources</span><span class="o">/</span><span class="n">stree</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://gitx.frim.nl/">GitX</a></li>
<li><a href="http://jonas.nitro.dk/tig/manual.html#view-scrolling">tig</a></li>
</ul>


<h3>Git 指令</h3>

<ul>
<li><a href="http://mgleon08.github.io/blog/2015/12/27/git-command/">Git 指令操作手冊</a></li>
</ul>


<h1><span id="github">GitHub</span></h1>

<p>設定SSH連接</p>

<blockquote><p>若要沿用舊電腦的 key ， 將舊電腦的 id_rsa &amp; public key 複製過來即可，但因為新電腦第一次登入，會要求輸入就電腦的 key 的密碼</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#本機產生 ssh key (id_rsa（private key）id_rsa.pub（public key）) ~/.ssh/</span>
</span><span class='line'><span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span> <span class="o">-</span><span class="n">t</span> <span class="n">rsa</span> <span class="o">-</span><span class="n">C</span> <span class="o">[</span><span class="n">email</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#設定權限(預設應該就有設好，若是自己新開檔案就要設定)</span>
</span><span class='line'><span class="n">chmod</span> <span class="mi">600</span> <span class="n">id_rsa</span>
</span><span class='line'><span class="n">chmod</span> <span class="mi">644</span> <span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#在 github 上新增新的 ssh</span>
</span><span class='line'><span class="err">將</span> <span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span> <span class="err">內容複製過去</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#測試是否能連上 github</span>
</span><span class='line'><span class="n">ssh</span> <span class="o">-</span><span class="n">T</span> <span class="n">git</span><span class="vi">@github</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#查看 ssh 功能</span>
</span><span class='line'><span class="n">man</span> <span class="n">ssh</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#將 key 加入 ssh-agent memory</span>
</span><span class='line'><span class="n">ssh</span><span class="o">-</span><span class="n">add</span> <span class="o">~</span><span class="sr">/.ssh/i</span><span class="n">d_dsa</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#檢查目前的 key</span>
</span><span class='line'><span class="n">ssh</span><span class="o">-</span><span class="n">add</span> <span class="o">-</span><span class="n">l</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#刪除 ssh-agent key</span>
</span><span class='line'><span class="n">ssh</span><span class="o">-</span><span class="n">add</span> <span class="o">-</span><span class="n">d</span> <span class="o">~</span><span class="sr">/.ssh/i</span><span class="n">d_dsa</span><span class="o">.</span><span class="n">pub</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#刪除所有 ssh-agent key</span>
</span><span class='line'><span class="n">ssh</span><span class="o">-</span><span class="n">add</span> <span class="o">-</span><span class="n">D</span> <span class="o">~</span><span class="sr">/.ssh/i</span><span class="n">d_dsa</span><span class="o">.</span><span class="n">pub</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#將 key 永久紀錄</span>
</span><span class='line'><span class="n">ssh</span><span class="o">-</span><span class="n">add</span> <span class="o">-</span><span class="n">K</span> <span class="o">[</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">ssh</span><span class="o">-</span><span class="n">key</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://developer.github.com/guides/using-ssh-agent-forwarding/">Using SSH agent forwarding</a></li>
<li><a href="https://ihower.tw/blog/archives/7837">SSH agent forwarding 的應用</a></li>
<li><a href="http://man.linuxde.net/ssh">ssh命令</a></li>
<li><a href="http://linux.vbird.org/linux_basic/0210filepermission.php#chmod">鳥哥的私房菜 - 權限指令</a></li>
</ul>


<h1><span id="zsh">zsh &amp; oh-my-zsh</span></h1>

<blockquote><p>shell &amp; zsh 的 framework 套件</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#安裝 zsh</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">zsh</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#將 shell 預設改成 zsh，改完記得重開 iterm or source ~/.zshrc</span>
</span><span class='line'><span class="n">chsh</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/bin/</span><span class="n">zsh</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#查看目前使用是哪個 shell</span>
</span><span class='line'><span class="n">echo</span> <span class="vg">$SHELL</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#下載 oh-my-zsh</span>
</span><span class='line'><span class="n">git</span> <span class="nb">clone</span> <span class="ss">git</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">robbyrussell</span><span class="o">/</span><span class="n">oh</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">zsh</span><span class="o">.</span><span class="n">git</span> <span class="o">~</span><span class="sr">/.oh-my-zsh</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#將 oh-my-zsh 預設的設定複製到 ./</span><span class="o">.</span><span class="n">zshrc</span> <span class="p">(</span><span class="o">.</span><span class="n">zshrc</span> <span class="err">需要自行產生</span><span class="p">)</span>
</span><span class='line'><span class="n">cp</span> <span class="o">~</span><span class="sr">/.oh-my-zsh/</span><span class="n">templates</span><span class="o">/</span><span class="n">zshrc</span><span class="o">.</span><span class="n">zsh</span><span class="o">-</span><span class="n">template</span> <span class="o">~</span><span class="sr">/.zshrc</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#安裝 zsh-completions</span>
</span><span class='line'><span class="sr">brew install zsh-completions</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#加入以下兩行來啟動 zsh-completions</span>
</span><span class='line'><span class="sr">#zsh-completions</span>
</span><span class='line'><span class="sr">fpath=(/us</span><span class="n">r</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">zsh</span><span class="o">-</span><span class="n">completions</span> <span class="vg">$fpath</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#同時還需要 rebuild zsh 的 .zcompdump</span>
</span><span class='line'><span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">~</span><span class="sr">/.zcompdump; compinit</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#更改 theme ( 到 .zshrc 更改 ZSH_THEME 參數 )</span>
</span><span class='line'><span class="sr">ZSH_THEME=&quot;edvardm&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#啟動 oh-my-zsh 內建的套件，要看有哪些套件可以去 ~/</span><span class="o">.</span><span class="n">oh</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">zsh</span> <span class="err">裡面的</span> <span class="n">plugins</span> <span class="err">看裡面的設定</span><span class="p">(</span> <span class="err">到</span> <span class="o">.</span><span class="n">zshrc</span> <span class="err">更改</span> <span class="n">plugins</span> <span class="err">參數</span> <span class="p">)</span>
</span><span class='line'><span class="n">plugins</span><span class="o">=</span><span class="p">(</span><span class="n">git</span> <span class="n">ruby</span> <span class="n">rbenv</span> <span class="n">github</span> <span class="n">gitignore</span> <span class="n">rails</span> <span class="n">rake</span> <span class="n">python</span> <span class="n">z</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a></li>
<li><a href="http://icarus4.logdown.com/posts/177661-from-bash-to-zsh-setup-tips">bash 轉移 zsh (oh-my-zsh) 設定心得</a></li>
</ul>


<h1><span id="rvmorrbenv">rvm or rbenv</span></h1>

<blockquote><p>管理 ruby &amp; gem 工具</p></blockquote>

<h3>rvm</h3>

<ul>
<li><a href="http://mgleon08.github.io/blog/2016/02/15/rvm-and-gemsets/">RVM and Gemsets Ruby版本控制</a></li>
<li><a href="https://ruby-china.org/wiki/rvm-guide">rvm 使用指南</a></li>
</ul>


<h3>rbenv</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#安裝</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">rbenv</span> <span class="n">ruby</span><span class="o">-</span><span class="n">build</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#將指令放到 ~/.zshrc or ~/.bashrc</span>
</span><span class='line'><span class="n">export</span> <span class="no">PATH</span><span class="o">=</span><span class="s2">&quot;$HOME/.rbenv/bin:$PATH&quot;</span>
</span><span class='line'><span class="nb">eval</span> <span class="s2">&quot;$(rbenv init -)&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#列出所有 ruby 版本</span>
</span><span class='line'><span class="n">rbenv</span> <span class="n">install</span> <span class="o">--</span><span class="n">list</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#列出安装的版本</span>
</span><span class='line'><span class="n">rbenv</span> <span class="n">versions</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#列出正在使用的版本</span>
</span><span class='line'><span class="n">rbenv</span> <span class="n">version</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#安裝 ruby (請依照當下最新的版本)</span>
</span><span class='line'><span class="n">rbenv</span> <span class="n">install</span> <span class="mi">2</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#設定預設版本</span>
</span><span class='line'><span class="n">rbenv</span> <span class="n">global</span> <span class="mi">2</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#確定目前使用的 ruby 是透過 rbenv 而不是內建的(記得重開視窗)</span>
</span><span class='line'><span class="n">which</span> <span class="n">ruby</span>
</span><span class='line'><span class="c1">#=&gt; 確保有 .rbenv/shims/ruby</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#project 加上 .ruby-version 檔案裡面寫 ruby 版本 才能加入控管</span>
</span><span class='line'><span class="mi">2</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#rbenv 指令</span>
</span><span class='line'><span class="no">Some</span> <span class="n">useful</span> <span class="n">rbenv</span> <span class="n">commands</span> <span class="ss">are</span><span class="p">:</span>
</span><span class='line'>   <span class="n">commands</span>    <span class="no">List</span> <span class="n">all</span> <span class="n">available</span> <span class="n">rbenv</span> <span class="n">commands</span>
</span><span class='line'>   <span class="n">local</span>       <span class="no">Set</span> <span class="ow">or</span> <span class="n">show</span> <span class="n">the</span> <span class="n">local</span> <span class="n">application</span><span class="o">-</span><span class="n">specific</span> <span class="no">Ruby</span> <span class="n">version</span>
</span><span class='line'>   <span class="n">global</span>      <span class="no">Set</span> <span class="ow">or</span> <span class="n">show</span> <span class="n">the</span> <span class="n">global</span> <span class="no">Ruby</span> <span class="n">version</span>
</span><span class='line'>   <span class="n">shell</span>       <span class="no">Set</span> <span class="ow">or</span> <span class="n">show</span> <span class="n">the</span> <span class="n">shell</span><span class="o">-</span><span class="n">specific</span> <span class="no">Ruby</span> <span class="n">version</span>
</span><span class='line'>   <span class="n">install</span>     <span class="no">Install</span> <span class="n">a</span> <span class="no">Ruby</span> <span class="n">version</span> <span class="n">using</span> <span class="n">ruby</span><span class="o">-</span><span class="n">build</span>
</span><span class='line'>   <span class="n">uninstall</span>   <span class="no">Uninstall</span> <span class="n">a</span> <span class="n">specific</span> <span class="no">Ruby</span> <span class="n">version</span>
</span><span class='line'>   <span class="n">rehash</span>      <span class="no">Rehash</span> <span class="n">rbenv</span> <span class="n">shims</span> <span class="p">(</span><span class="n">run</span> <span class="n">this</span> <span class="n">after</span> <span class="n">installing</span> <span class="n">executables</span><span class="p">)</span>
</span><span class='line'>   <span class="n">version</span>     <span class="no">Show</span> <span class="n">the</span> <span class="n">current</span> <span class="no">Ruby</span> <span class="n">version</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">origin</span>
</span><span class='line'>   <span class="n">versions</span>    <span class="no">List</span> <span class="n">all</span> <span class="no">Ruby</span> <span class="n">versions</span> <span class="n">available</span> <span class="n">to</span> <span class="n">rbenv</span>
</span><span class='line'>   <span class="n">which</span>       <span class="no">Display</span> <span class="n">the</span> <span class="n">full</span> <span class="n">path</span> <span class="n">to</span> <span class="n">an</span> <span class="n">executable</span>
</span><span class='line'>   <span class="n">whence</span>      <span class="no">List</span> <span class="n">all</span> <span class="no">Ruby</span> <span class="n">versions</span> <span class="n">that</span> <span class="n">contain</span> <span class="n">the</span> <span class="n">given</span> <span class="n">executable</span>
</span></code></pre></td></tr></table></div></figure>


<p>rbenv-gemset</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#安裝 rbenv-gemset</span>
</span><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">rbenv</span><span class="o">-</span><span class="n">gemset</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#rbenv gemset 指令</span>
</span><span class='line'><span class="n">possible</span> <span class="n">commands</span> <span class="ss">are</span><span class="p">:</span>
</span><span class='line'>  <span class="n">active</span>
</span><span class='line'>  <span class="n">create</span> <span class="o">[</span><span class="n">version</span><span class="o">]</span> <span class="o">[</span><span class="n">gemset</span><span class="o">]</span>
</span><span class='line'>  <span class="n">delete</span> <span class="o">[</span><span class="n">version</span><span class="o">]</span> <span class="o">[</span><span class="n">gemset</span><span class="o">]</span>
</span><span class='line'>  <span class="n">file</span>
</span><span class='line'>  <span class="n">init</span> <span class="o">[</span><span class="n">gemset</span><span class="o">]</span>
</span><span class='line'>  <span class="n">list</span>
</span><span class='line'>  <span class="n">version</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#使用方法</span>
</span><span class='line'><span class="err">將想要使用的</span> <span class="n">gemset</span> <span class="err">名稱，放到</span> <span class="o">.</span><span class="n">rbenv</span><span class="o">-</span><span class="n">gemsets</span> <span class="err">檔案即可，在該專案執行</span> <span class="n">bundle</span> <span class="err">就會對設定好的</span> <span class="n">gemset</span> <span class="err">進行操作</span>
</span><span class='line'><span class="err">若是沒有設定該檔案就會是</span> <span class="n">global</span> <span class="err">的</span> <span class="n">bundle</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://ruby-china.org/wiki/rbenv-guide">rbenv 使用指南</a></li>
</ul>


<h1><span id="rubygems">RubyGems</span></h1>

<blockquote><p>RubyGems 是 Ruby 的套件管理系統，讓你輕易安裝及管理 Ruby 函式庫。</p></blockquote>

<p><a href="https://rubygems.org/">RubyGems.org</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#RubyGems 的版本</span>
</span><span class='line'><span class="n">gem</span> <span class="o">-</span><span class="n">v</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#升級RubyGems的版本</span>
</span><span class='line'><span class="n">gem</span> <span class="n">update</span> <span class="o">--</span><span class="nb">system</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#安裝某個套件(加上 --no-ri --no-rdoc 可以不要產生預設的 RDoc和ri文件)</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">gem_name</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">ri</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">rdoc</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#列出安裝的套件</span>
</span><span class='line'><span class="n">gem</span> <span class="n">list</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#更新最新版本</span>
</span><span class='line'><span class="n">gem</span> <span class="n">update</span> <span class="n">gem_name</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#更新所有你安裝的Gems</span>
</span><span class='line'><span class="n">gem</span> <span class="n">update</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#安裝特定版本</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="o">-</span><span class="n">v</span> <span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x</span> <span class="n">gemname</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#反安裝</span>
</span><span class='line'><span class="n">gem</span> <span class="n">uninstall</span> <span class="n">gem_name</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#移除所有 gem</span>
</span><span class='line'><span class="n">gem</span> <span class="n">uninstall</span> <span class="o">-</span><span class="n">aIx</span>
</span></code></pre></td></tr></table></div></figure>


<h1><span id="rails">Rails</span></h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#後面的參數是不下載文件，可以省很多安裝時間</span>
</span><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">rails</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">ri</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">rdoc</span>
</span></code></pre></td></tr></table></div></figure>


<h1><span id="bundle">Bundle</span></h1>

<blockquote><p>管理應用程式 Gem 依存性(dependencies)管理工具，它會根據 Gemfile 的設定自動下載及安裝 Gem 套件</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">bundler</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://bundler.io/">bundle</a></li>
</ul>


<h1><span id="nvm">NVM</span></h1>

<blockquote><p>管理 npm 工具，類似 rvm</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#根據當下最新版本</span>
</span><span class='line'><span class="n">curl</span> <span class="o">-</span><span class="n">o</span><span class="o">-</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">creationix</span><span class="o">/</span><span class="n">nvm</span><span class="o">/</span><span class="n">v0</span><span class="o">.</span><span class="mi">31</span><span class="o">.</span><span class="mi">4</span><span class="o">/</span><span class="n">install</span><span class="o">.</span><span class="n">sh</span> <span class="o">|</span> <span class="n">bash</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#將以下放到自己的 ~/.zshrc or ~/.bashrc or .bash_profile 下面（預設會自動放好，但還是去確定一下）</span>
</span><span class='line'><span class="n">export</span> <span class="no">NVM_DIR</span><span class="o">=</span><span class="s2">&quot;/Users/leon/.nvm&quot;</span>
</span><span class='line'><span class="o">[</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">.</span> <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span>  <span class="c1"># This loads nvm%</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#重新載入 Shell</span>
</span><span class='line'><span class="o">.</span> <span class="o">~</span><span class="sr">/.nvm/n</span><span class="n">vm</span><span class="o">.</span><span class="n">sh</span> <span class="ow">or</span> <span class="n">source</span> <span class="o">~</span><span class="sr">/.zshrc</span>
</span><span class='line'>
</span><span class='line'><span class="sr"># 安裝穩定版本的 NodeJS</span>
</span><span class='line'><span class="sr">nvm install stable </span>
</span><span class='line'>
</span><span class='line'><span class="sr">#顯示目前可以安裝的版本</span>
</span><span class='line'><span class="sr">nvm ls-remote</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#安裝 NodeJS</span>
</span><span class='line'><span class="sr">nvm install &lt;version&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#安裝穩定版本的 NodeJS</span>
</span><span class='line'><span class="sr">nvm install stable </span>
</span><span class='line'><span class="sr"> </span>
</span><span class='line'><span class="sr">#使用版本，只有在當下，重新開新tab就會消失</span>
</span><span class='line'><span class="sr">nvm use stable </span>
</span><span class='line'><span class="sr"> </span>
</span><span class='line'><span class="sr">#設定預設版本，永久</span>
</span><span class='line'><span class="sr">nvm alias default stable</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#看目前安裝所有版本</span>
</span><span class='line'><span class="sr">ls -a ~/</span><span class="o">.</span><span class="n">nvm</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="n">node</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://segmentfault.com/a/1190000004404505">node版本管理工具nvm-Mac下安装及使用</a></li>
<li><a href="https://tenten.co/blog/install-gulp-grunt-bower-sass-susy-on-mac-with-nvm-rvm/">在 Mac 上裝 NVM, RVM 等跑 Gulp, Grunt, Bower 環境</a></li>
<li><a href="http://icarus4.logdown.com/posts/175092-nodejs-installation-guide">Node.js 安裝與版本切換教學 (for MAC)</a></li>
</ul>


<h1><span id="npm">NPM</span></h1>

<blockquote><p>套件管理</p></blockquote>

<p><a href="https://www.npmjs.com/">npm</a></p>

<p>資料夾一定會有 package.json</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#搜尋 npm 套件，但建議去網站上比較快</span>
</span><span class='line'><span class="n">npm</span> <span class="n">search</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#本地安裝，會安裝在當前專案的 node_modules 目錄下</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#全域安裝，會將套件安裝在統一的 npm 目錄底下</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#列出專案使用套件</span>
</span><span class='line'><span class="n">npm</span> <span class="n">ls</span> <span class="p">(</span><span class="o">-</span><span class="n">g</span> <span class="err">全域套件</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#更新專案套件</span>
</span><span class='line'><span class="n">npm</span> <span class="n">update</span> <span class="p">(</span><span class="o">-</span><span class="n">g</span> <span class="err">全域套件</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#移除專案套件</span>
</span><span class='line'><span class="n">npm</span> <span class="n">uninstall</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">-</span><span class="n">g</span> <span class="err">全域套件</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#清快取</span>
</span><span class='line'><span class="n">npm</span> <span class="n">cache</span> <span class="n">clean</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#查詢 npm 儲存路徑</span>
</span><span class='line'><span class="n">npm</span> <span class="n">config</span> <span class="n">get</span> <span class="n">prefix</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#自動安裝 package.json 套件定義檔中定義的所有套件</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#安裝套件並儲存在 package.json 中</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">save</span> <span class="c1">#套件發行時宣告的相依套件</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span> <span class="c1">#開發環境開發時需要的套件</span>
</span></code></pre></td></tr></table></div></figure>


<h3>package.json</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#自動產生 package.json</span>
</span><span class='line'><span class="n">npm</span> <span class="n">init</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;leon&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'> <span class="err"> </span> <span class="err"> </span><span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">Error: no test specified</span><span class="se">\&quot;</span><span class="s2"> &amp;&amp; exit 1&quot;</span>
</span><span class='line'> <span class="err"> </span><span class="p">},</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;ISC&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;dependencies&quot;</span><span class="p">:{</span><span class="c1">#套件相依</span>
</span><span class='line'> <span class="err"> </span><span class="p">},</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{</span><span class="c1">#開發套件相依</span>
</span><span class='line'><span class="err">    </span><span class="s2">&quot;lodash&quot;</span><span class="p">:</span> <span class="s2">&quot;^4.15.0&quot;</span> <span class="c1">#示範加上去的</span>
</span><span class='line'> <span class="err"> </span><span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://www.slideshare.net/wantingj/npm-46801372">Npm 套件管理 &amp; 常用開發工具介紹</a></li>
</ul>


<h1><span id="sublime">Sublime Text</span></h1>

<blockquote><p>編輯器</p></blockquote>

<p>安裝好用的套件管理 <a href="https://packagecontrol.io/installation">package control</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">All</span> <span class="no">Autocomplete</span>
</span><span class='line'><span class="no">AutoFileName</span>
</span><span class='line'><span class="no">Alignment</span>
</span><span class='line'><span class="no">Color</span> <span class="no">Highlighter</span>
</span><span class='line'><span class="no">CovertToUTF8</span>
</span><span class='line'><span class="no">Emmet</span>
</span><span class='line'><span class="no">GitGutter</span>
</span><span class='line'><span class="no">SideBarEnhancement</span>
</span><span class='line'><span class="no">BracketHighlighter</span>
</span><span class='line'><span class="no">SublimeCodeIntel</span>
</span><span class='line'><span class="no">PrettyRuby</span>
</span><span class='line'><span class="no">PrettyJson</span>
</span><span class='line'><span class="no">PrettyYaml</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#theme</span>
</span><span class='line'><span class="no">Spacegray</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://github.com/kkga/spacegray">Spacegray</a></p>

<p>Prefrences > Setting-User</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;hightlight_line&quot;</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;tab_size&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;translate_tabs_to_spaces&quot;</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;trim_trailing_white_space_on_save&quot;</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;ignored_packages&quot;</span><span class="p">:</span>
</span><span class='line'>  <span class="o">[</span>
</span><span class='line'>      <span class="s2">&quot;Vintage&quot;</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>建立快速鍵</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span> <span class="s2">&quot;keys&quot;</span><span class="p">:</span> <span class="o">[</span><span class="s2">&quot;super+shift+h&quot;</span><span class="o">]</span><span class="p">,</span> <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;pretty_ruby_format&quot;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>設定快速command <code>subl .</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#建立 bin 資料夾，建立軟連結到指定的檔案</span>
</span><span class='line'><span class="n">mkdir</span> <span class="o">~</span><span class="sr">/bin </span>
</span><span class='line'><span class="sr">ln -s &quot;/</span><span class="no">Applications</span><span class="o">/</span><span class="no">Sublime</span> <span class="no">Text</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="no">Contents</span><span class="o">/</span><span class="no">SharedSupport</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">subl</span><span class="s2">&quot; ~/bin/subl</span>
</span><span class='line'>
</span><span class='line'><span class="s2">#若是 echo $PATH 沒有相對應的路徑，可以在 .zshrc 加上</span>
</span><span class='line'><span class="s2">export PATH=&quot;</span><span class="vg">$HOME</span><span class="o">/</span><span class="ss">bin</span><span class="p">:</span><span class="vg">$PATH</span><span class="s2">&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://packagecontrol.io/installation">package control</a></li>
<li><a href="https://www.sublimetext.com/">Sublime Text</a></li>
<li><a href="https://scotch.io/bar-talk/best-sublime-text-3-themes-of-2015-and-2016">Best Sublime Text 3 Themes of 2015 and 2016</a></li>
</ul>


<h1><span id="vim">Vim</span></h1>

<p>介面優化，新增 <code>.vimrc</code> 檔案</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#顯示行號：對於 debug 相當有幫助! (加上 run 數字會跟著跑)</span>
</span><span class='line'><span class="ss">:set</span> <span class="n">nu</span> <span class="n">rnu</span>
</span><span class='line'><span class="c1">#自動對齊縮排：如果上一行有兩個 tab 的寬度，按 enter 繼續編輯下一行時會自動保留兩個 tab 鍵的寬度。</span>
</span><span class='line'><span class="ss">:set</span> <span class="n">ai</span>
</span><span class='line'><span class="c1">#光標底線：光標所在的那一行會有底線，幫助尋找光標位置</span>
</span><span class='line'><span class="ss">:set</span> <span class="n">cursorline</span>
</span><span class='line'><span class="c1">#上色模式-針對亮背景上色，預設為亮背景(白色等)上色，但是終端機的初始背景色為深紫色，會出現文字失蹤 ( 例如註解為深藍色 ) 的情況。將這一行換成 :set bg=dark 即可。</span>
</span><span class='line'><span class="ss">:set</span> <span class="n">bg</span><span class="o">=</span><span class="n">light</span>
</span><span class='line'><span class="c1">#縮排間隔數 ( 預設為 8 個空白對齊 )，也就是說按一次 tab 鍵，游標會自動跳 4 格空白字元的寬度。雖有多個空格但實際上只有一個 tab 字元。注意：也就是說，在其他環境下，看到 tab 字元，依舊是 8 個空白寬</span>
</span><span class='line'><span class="ss">:set</span> <span class="n">tabstop</span><span class="o">=</span><span class="mi">4</span>
</span><span class='line'><span class="c1">#自動縮排對齊間隔數：向右或向左一個縮排的寬度</span>
</span><span class='line'><span class="ss">:set</span> <span class="n">shiftwidth</span><span class="o">=</span><span class="mi">4</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://wiki.csie.ncku.edu.tw/vim/vimrc">vimrc設定教學</a></li>
<li><a href="http://www2.nsysu.edu.tw/csmlab/unix/vi_command.htm">vi指令說明(完整版)</a></li>
</ul>


<h1><span id="linux">Linux 常用指令</span></h1>

<ul>
<li><a href="http://jdev.tw/blog/3599/linux-terminal-commands-and-shortcuts">Linux常用Terminal命令與快捷鍵參考</a></li>
</ul>


<h1><span id="other">other</span></h1>

<ul>
<li><a href="http://macdown.uranusjr.com/">MacDown</a></li>
<li><a href="http://www.sequelpro.com/">Sequel Pro</a></li>
<li><a href="https://eggerapps.at/postico/">Postico</a></li>
<li><a href="https://www.getpostman.com/app/postman-osx">PostMan</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="https://github.com/yuyueugene84/ntu_ror_training_course/blob/master/installation_mac.md">Ruby on Rails Mac 安裝教學</a></li>
<li><a href="https://ihower.tw/rails4/installation.html">安裝 Rails 開發環境</a></li>
<li><a href="https://tenten.co/blog/install-gulp-grunt-bower-sass-susy-on-mac-with-nvm-rvm/">在 Mac 上裝 NVM, RVM 等跑 Gulp, Grunt, Bower 環境</a></li>
<li><a href="https://segmentfault.com/a/1190000004404505">node版本管理工具nvm-Mac下安装及使用</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Custom Seed File]]></title>
    <link href="http://mgleon08.github.com/blog/2016/07/04/custom-seed-file/"/>
    <updated>2016-07-04T22:27:18+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/07/04/custom-seed-file</id>
    <content type="html"><![CDATA[<p>在 <code>db</code> 下有個 seed.rb，可以寫一些假資料 or 要匯入的資料，在執行 <code>rake db:seed</code> 就會執行了<br/>
但是當有多個檔案，就可以自己寫個 <code>task</code> 來覆蓋原本的 <code>rake db:seed</code></p>

<!-- more -->


<p></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#檔案可以放在 db/seeds 資料夾底下</span>
</span><span class='line'><span class="c1">#db/seeds/hello.rb</span>
</span><span class='line'><span class="nb">puts</span> <span class="s1">&#39;hello&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#lib/tasks/custom_seed.rake</span>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:db</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">namespace</span> <span class="ss">:seed</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Dir</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="s1">&#39;seeds&#39;</span><span class="p">,</span> <span class="s1">&#39;*.rb&#39;</span><span class="p">)</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">filename</span><span class="o">|</span>
</span><span class='line'>      <span class="n">task_name</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;.rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">intern</span>
</span><span class='line'>      <span class="n">task</span> <span class="n">task_name</span> <span class="o">=&gt;</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>        <span class="nb">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>接著執行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">seed</span><span class="p">:</span><span class="n">hello</span>
</span><span class='line'><span class="c1">#=&gt;hello</span>
</span></code></pre></td></tr></table></div></figure>


<p>參考文件： <br/>
<a href="http://stackoverflow.com/questions/19872271/adding-a-custom-seed-file">Adding a custom seed file</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[好用的 Hash Method]]></title>
    <link href="http://mgleon08.github.com/blog/2016/07/04/rails-hash/"/>
    <updated>2016-07-04T21:58:11+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/07/04/rails-hash</id>
    <content type="html"><![CDATA[<p>在 rails 當中經常會使用 hash，rails 也提供很多方便的 methods</p>

<!--more-->


<h1>Hash</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Hash</span><span class="o">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="o">]</span>             <span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}</span>
</span><span class='line'><span class="no">Hash</span><span class="o">[</span> <span class="o">[</span> <span class="o">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="o">]</span> <span class="o">]</span> <span class="o">]</span>   <span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}</span>
</span><span class='line'><span class="no">Hash</span><span class="o">[</span><span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="o">]</span>         <span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>merge &amp; merge!</h1>

<p>回傳新的 hash，後面一樣的 key 則會覆蓋前面的</p>

<blockquote><p>以後面的為優先</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h1</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="mi">200</span> <span class="p">}</span>
</span><span class='line'><span class="n">h2</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="mi">254</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span> <span class="o">=&gt;</span> <span class="mi">300</span> <span class="p">}</span>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span>   <span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;254, &quot;c&quot;=&gt;300}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#將重複的做其他處理</span>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h2</span><span class="p">){</span><span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">oldval</span><span class="p">,</span> <span class="n">newval</span><span class="o">|</span> <span class="n">newval</span> <span class="o">-</span> <span class="n">oldval</span><span class="p">}</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;54,  &quot;c&quot;=&gt;300}</span>
</span><span class='line'><span class="n">h1</span>             <span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>merge!</code> 直接改變原先的 hash</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;254, &quot;c&quot;=&gt;300}</span>
</span><span class='line'><span class="n">h1</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;254, &quot;c&quot;=&gt;300}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>reverse_merge &amp; reverse_merge!</h1>

<p>回傳新的 hash，前面一樣的 key 則會覆蓋後面的</p>

<p>通常用在指定hash的預設值</p>

<blockquote><p>以前面的為優先</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h1</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="mi">200</span> <span class="p">}</span>
</span><span class='line'><span class="n">h2</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="mi">254</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span> <span class="o">=&gt;</span> <span class="mi">300</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;254, &quot;c&quot;=&gt;300}</span>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">reverse_merge</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;b&quot;=&gt;200, &quot;c&quot;=&gt;300, &quot;a&quot;=&gt;100}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>deep_merge &amp; deep_merge!</h1>

<p>在兩個hash的鍵值相同，而值也是個hash的情況下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h1</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:b</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}}</span>
</span><span class='line'><span class="n">h2</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:a</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:c</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}}</span>
</span><span class='line'>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; {:a=&gt;{:c=&gt;2}} error</span>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">deep_merge</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; {:a=&gt;{:b=&gt;1, :c=&gt;2}}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>fetch</h1>

<p>即使是 nil, false 也會回傳，只有在空值的時候回傳預設值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">}</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;false, &quot;c&quot;=&gt;nil}</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; 100</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; false</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; nil</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; 8</span>
</span></code></pre></td></tr></table></div></figure>


<p>在處理應該存在的哈希鍵時，使用 fetch。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">heroes</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">batman</span><span class="p">:</span> <span class="s1">&#39;Bruce Wayne&#39;</span><span class="p">,</span> <span class="ss">superman</span><span class="p">:</span> <span class="s1">&#39;Clark Kent&#39;</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># bad - if we make a mistake we might not spot it right away</span>
</span><span class='line'><span class="n">heroes</span><span class="o">[</span><span class="ss">:batman</span><span class="o">]</span> <span class="c1"># =&gt; &quot;Bruce Wayne&quot;</span>
</span><span class='line'><span class="n">heroes</span><span class="o">[</span><span class="ss">:supermann</span><span class="o">]</span> <span class="c1"># =&gt; nil</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># good - fetch raises a KeyError making the problem obvious</span>
</span><span class='line'><span class="n">heroes</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:supermann</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>在使用 fetch 時，使用第二個參數設置默認值而不是使用自定義的邏輯。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">batman</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Bruce Wayne&#39;</span><span class="p">,</span> <span class="ss">is_evil</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># bad - if we just use || operator with falsy value we won&#39;t get the expected result</span>
</span><span class='line'><span class="n">batman</span><span class="o">[</span><span class="ss">:is_evil</span><span class="o">]</span> <span class="o">||</span> <span class="kp">true</span> <span class="c1"># =&gt; true</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># good - fetch work correctly with falsy values</span>
</span><span class='line'><span class="n">batman</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:is_evil</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</span></code></pre></td></tr></table></div></figure>


<p>盡量用 fetch 加區塊而不是直接設定默認值。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">batman</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Bruce Wayne&#39;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># bad - if we use the default value, we eager evaluate it</span>
</span><span class='line'><span class="c1"># so it can slow the program down if done multiple times</span>
</span><span class='line'><span class="n">batman</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:powers</span><span class="p">,</span> <span class="n">get_batman_powers</span><span class="p">)</span> <span class="c1"># get_batman_powers is an expensive call</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># good - blocks are lazy evaluated, so only triggered in case of KeyError exception</span>
</span><span class='line'><span class="n">batman</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:powers</span><span class="p">)</span> <span class="p">{</span> <span class="n">get_batman_powers</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>except &amp; except!</h1>

<p>通常用在確保某些欄位不要被傳進來的參數修改到</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h1</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">a</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="ss">b</span><span class="p">:</span><span class="mi">200</span> <span class="p">}</span>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">except</span><span class="p">(</span><span class="ss">:a</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>symbolize_keys &amp; symbolize_keys!</h1>

<p>回傳新的 hash，key 值轉成 symbol</p>

<blockquote><p>通常用在確保 key 的一致性</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Rob&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;28&#39;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nb">hash</span><span class="o">.</span><span class="n">symbolize_keys</span>
</span><span class='line'><span class="c1"># =&gt; {:name=&gt;&quot;Rob&quot;, :age=&gt;&quot;28&quot;}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>stringify_keys &amp; stringify_keys!</h1>

<p>回傳新的 hash，key 值轉成 string</p>

<p>alias <code>to_options</code> &amp; <code>to_options!</code></p>

<blockquote><p>通常用在確保 key 的一致性</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Rob&#39;</span><span class="p">,</span> <span class="ss">age</span><span class="p">:</span> <span class="s1">&#39;28&#39;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nb">hash</span><span class="o">.</span><span class="n">stringify_keys</span>
</span><span class='line'><span class="c1">#=&gt; { &quot;name&quot; =&gt; &quot;Rob&quot;, &quot;age&quot; =&gt; &quot;28&quot; }</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#若有衝突已後面為優先</span>
</span><span class='line'><span class="p">{</span><span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:a</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}</span><span class="o">.</span><span class="n">stringify_keys</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;2}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>slice &amp; slice!</h1>

<p>有 <code>!</code> 行為會不太一樣，要注意</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h1</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="mi">200</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100}</span>
</span><span class='line'><span class="n">h1</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;200}</span>
</span><span class='line'>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">slice!</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;b&quot;=&gt;200}</span>
</span><span class='line'><span class="n">h1</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>extract!</h1>

<p>將需要的值提取出來，成為新的 hash</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h1</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="mi">200</span> <span class="p">}</span>
</span><span class='line'><span class="n">h1</span><span class="o">.</span><span class="n">extract!</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100}</span>
</span><span class='line'><span class="n">h1</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;b&quot;=&gt;200}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>to_query</h1>

<p>Alias for Hash#to_query</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;David&#39;</span><span class="p">,</span> <span class="ss">nationality</span><span class="p">:</span> <span class="s1">&#39;Danish&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">to_query</span>
</span><span class='line'><span class="c1">#=&gt; &quot;name=David&amp;nationality=Danish&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;David&#39;</span><span class="p">,</span> <span class="ss">nationality</span><span class="p">:</span> <span class="s1">&#39;Danish&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">to_query</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c1"># =&gt; &quot;user%5Bname%5D=David&amp;user%5Bnationality%5D=Danish&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>values_at</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># bad</span>
</span><span class='line'><span class="n">email</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">&#39;email&#39;</span><span class="o">]</span>
</span><span class='line'><span class="n">nickname</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">&#39;nickname&#39;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># good</span>
</span><span class='line'><span class="n">email</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values_at</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;nickname&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>other</h1>

<h3>attributes</h3>

<p>將物件轉成 hash</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">foo</span> <span class="o">=</span> <span class="no">Book</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'><span class="c1">#=&gt; #&lt;Book id: 22, name: &quot;book&quot;, desc: &quot;desc&quot;, created_at: &quot;xxx&quot;, updated_at: &quot;xxx&quot;&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">foo</span><span class="o">.</span><span class="n">attributes</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;id&quot;=&gt;22, &quot;name&quot;=&gt;&quot;book&quot;, &quot;desc&quot;=&gt;&quot;desc&quot;, &quot;star&quot;=&gt;1, &quot;created_at&quot;=&gt;xxx, &quot;updated_at&quot;=&gt;xxx}</span>
</span></code></pre></td></tr></table></div></figure>


<p>官方文件：<br/>
<a href="http://ruby-doc.org/core-2.1.5/Hash.html">Ruby Doc Hash</a><br/>
<a href="http://apidock.com/rails/v4.2.1/Hash">Hash apidock</a></p>

<p>參考文件：<br/>
<a href="https://ihower.tw/rails4/activesupport.html">ActiveSupport - 工具函式庫</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Class << Self]]></title>
    <link href="http://mgleon08.github.com/blog/2016/07/04/class-self/"/>
    <updated>2016-07-04T00:01:37+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/07/04/class-self</id>
    <content type="html"><![CDATA[<p>有時會看到這種特別的寫法 <code>class &lt;&lt; self</code>，有兩種不同的用法</p>

<!-- more -->


<h1>class method</h1>

<p>將所以需要 <code>self.</code> 全部包在裡面，就不用一個一個 <code>self.</code><br/>
不過這比較看是個人偏好，有些人會覺得 <code>self.</code> 可讀性較高</p>

<p><a href="http://stackoverflow.com/questions/10964081/class-self-vs-self-method-with-ruby-whats-better">class &lt;&lt; self vs self.method with Ruby: what&rsquo;s better?</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Foo</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">bar</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s1">&#39;bar&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">bar2</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s1">&#39;bar2&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="no">Foo</span><span class="o">.</span><span class="n">bar</span>
</span><span class='line'><span class="c1">#bar</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">Foo</span><span class="o">.</span><span class="n">bar2</span>
</span><span class='line'><span class="c1">#bar2</span>
</span></code></pre></td></tr></table></div></figure>


<p>上下相等</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Foo</span>
</span><span class='line'>  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">bar</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s1">&#39;bar&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">bar2</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s1">&#39;bar2&#39;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="no">Foo</span><span class="o">.</span><span class="n">bar</span>
</span><span class='line'><span class="c1">#bar</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">Foo</span><span class="o">.</span><span class="n">bar2</span>
</span><span class='line'><span class="c1">#bar2</span>
</span></code></pre></td></tr></table></div></figure>


<h1>對單一物件，宣告出一個類別</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Foo</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">foo</span>
</span><span class='line'>    <span class="k">return</span> <span class="s1">&#39;foo&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">f1</span> <span class="o">=</span> <span class="no">Foo</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">f2</span> <span class="o">=</span> <span class="no">Foo</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="n">f1</span><span class="o">.</span><span class="n">foo</span> <span class="c1"># foo</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">f2</span><span class="o">.</span><span class="n">foo</span> <span class="c1"># foo</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 只對f1 修改方法</span>
</span><span class='line'><span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="n">f1</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">foo</span>
</span><span class='line'>    <span class="k">return</span> <span class="s1">&#39;Edit foo&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="n">f1</span><span class="o">.</span><span class="n">foo</span> <span class="c1"># Edit foo</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">f2</span><span class="o">.</span><span class="n">foo</span> <span class="c1"># foo</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 只對f1 新增方法</span>
</span><span class='line'><span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="n">f1</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">bar</span>
</span><span class='line'>    <span class="k">return</span> <span class="s1">&#39;bar&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="n">f1</span><span class="o">.</span><span class="n">bar</span> <span class="c1"># bar</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">f2</span><span class="o">.</span><span class="n">bar</span> <span class="c1"># undefined method `bar&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>參考文件：<br/>
<a href="http://wemee.blogspot.tw/2014/07/ruby-class.html">Ruby: class &lt;&lt; self</a><br/>
<a href="http://stackoverflow.com/questions/10964081/class-self-vs-self-method-with-ruby-whats-better">class &lt;&lt; self vs self.method with Ruby: what&rsquo;s better?</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Retrieving Multiple Objects in Batches 批次取出多筆記錄]]></title>
    <link href="http://mgleon08.github.com/blog/2016/06/22/retrieving-multiple-objects-in-batches/"/>
    <updated>2016-06-22T00:32:45+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/06/22/retrieving-multiple-objects-in-batches</id>
    <content type="html"><![CDATA[<p>當要處理多筆資料時，一般都會用 User.all 去取資料</p>

<!-- more -->


<p>但是當資料相當龐大，一次取出那麼多會非常佔用記憶體<br/>
因此有以下解決方式，一次拿一部分（預設為1000）</p>

<h1>find_each</h1>

<ul>
<li>一筆一筆放入區塊。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">find_each</span><span class="p">(</span><span class="ss">start</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="ss">batch_size</span><span class="p">:</span> <span class="mi">5000</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
</span><span class='line'>  <span class="no">NewsMailer</span><span class="o">.</span><span class="n">weekly</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">deliver_now</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#:start 選項可以設定批次的起始 ID。</span>
</span><span class='line'><span class="c1">#:batch_size 選項允許你在將各筆記錄傳進區塊前，指定一批要取多少筆記錄。</span>
</span></code></pre></td></tr></table></div></figure>


<h1>find_in_batches</h1>

<ul>
<li>取出記錄放入陣列傳至區塊</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Invoice</span><span class="o">.</span><span class="n">find_in_batches</span> <span class="k">do</span> <span class="o">|</span><span class="n">invoices</span><span class="o">|</span>
</span><span class='line'>  <span class="n">export</span><span class="o">.</span><span class="n">add_invoices</span><span class="p">(</span><span class="n">invoices</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#和 find_each 一樣的選項 :batch_size 與 :start。</span>
</span></code></pre></td></tr></table></div></figure>


<p>官方資料：<br/>
<a href="http://guides.rubyonrails.org/active_record_querying.html">Active Record Query Interface</a><br/>
<a href="http://rails.ruby.tw/active_record_querying.html">Active Record 查詢</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cache Etag Memcache]]></title>
    <link href="http://mgleon08.github.com/blog/2016/06/13/cache-etag-memcache/"/>
    <updated>2016-06-13T23:22:01+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/06/13/cache-etag-memcache</id>
    <content type="html"><![CDATA[<p>當有資料不常去做更動，就能夠用 cache 去讀取增加速度!</p>

<!-- more -->


<ul>
<li>cache 處太多，程式會變複雜，增加維護的難度</li>
<li>cache 會增加除錯難度，資料不再只有唯一的資料庫版本</li>
<li>cache 如果沒寫好，可能會產生資料不一致的Bug、時間顯示相關的Bug(例如顯示資料的時間雖然時間不會變，但是如果是要顯示多少小時以前，就會變動了)等等</li>
<li>cache 增加了寫程式的難度，像是Expire過期資料、資料的安全性(放在cache 層的資料也需要被保護注意安全)</li>
<li>會增加撰寫UI的難度，因為 cache 相關的程式可能會混在樣本中</li>
</ul>


<h1>Cache Store</h1>

<ul>
<li>預設的 memory_store 只適合單機開發，重啟 Rails cache 資料就不見了。</li>
<li>正式上線的網站會推薦使用 <code>Memcached</code></li>
<li>它是一套Name-Value Pair(NVP)分散式記憶體快取系統，當你有多個Rails伺服器的時候，也可以很方便的共用快取資料。</li>
</ul>


<h1>Etag</h1>

<p>ETag 是用來辨識當前的頁面是否有所改變（Rails 預設就有使用了）</p>

<p>第一次</p>

<ol>
<li>Client 發 Request</li>
<li>Rails 流程

<ul>
<li><ol>
<li>Render body</li>
</ol>
</li>
<li><ol>
<li>Create ETag</li>
</ol>
</li>
<li><ol>
<li>Body &amp; ETag included in response(<code>headers['ETag'] = Digest::MD5.hexdigest(body)</code>)</li>
</ol>
</li>
</ul>
</li>
<li>Rails 發 Response

<ul>
<li>200 Success Head 裡包含 ￼headers[&lsquo;ETag&rsquo;]</li>
</ul>
</li>
<li>Client 接收並 caches response</li>
</ol>


<p>第二次</p>

<ol>
<li>Client 發 Request 並帶著 <code>headers['If-None-Match']</code> 就是 Etag 但不知道為什麼要叫這名字</li>
<li>Rails 流程

<ul>
<li><ol>
<li>Render body</li>
</ol>
</li>
<li><ol>
<li>Create ETag</li>
</ol>
</li>
<li><ol>
<li>Compare ETag</li>
</ol>
</li>
<li><ol>
<li>If ETags match then body not included in response</li>
</ol>
</li>
</ul>
</li>
<li>Rails 發 Response

<ul>
<li>304 Not Modified</li>
</ul>
</li>
<li>Client 接收並 reads response from cache</li>
</ol>


<p>以上雖然就不需要再重新 response body，但是每次 request 都必須再把整個 body 去 generate 一次 ETag 這是相當沒有效率的事</p>

<p>所以可以透過 Customer Etag 來改善</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ItemsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="n">etag</span> <span class="p">{</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>    <span class="vi">@item</span> <span class="o">=</span> <span class="no">Item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="err">￼</span>    <span class="n">fresh_when</span><span class="p">(</span><span class="vi">@item</span><span class="p">)</span>
</span><span class='line'>  <span class="c1">#headers[&#39;ETag&#39;] = Digest::MD5.hexdigest(@item.cache_key)</span>
</span><span class='line'>  <span class="c1">#加上面的 etag {current_user.id} 等於 fresh_when([@item, current_user.id])，可以有更多參數去判斷是否有改變</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>這樣一來就只要 id 和 update_at 兩個就可以知道到底整個頁面有沒有東西變動過</p>

<h1>memcache store uses dalli</h1>

<p>Dalli is a high performance pure Ruby client for accessing memcached servers</p>

<ol>
<li>Approximately 20% faster than memcache-client.</li>
<li>Provides proper failover with recovery and adjustable timeouts.</li>
<li>Easier to integrate with monitoring tools like NewRelic RPM in order to track usage. 4. ThreadSafe.</li>
<li><p>Backwards compatible with the previous memcache-client API.</p></li>
<li><p>安裝Memcached</p></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">brew</span> <span class="n">install</span> <span class="n">memcached</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>加上memcached的函式庫</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;dalli&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>編輯<code>config/environments/development.rb</code>和<code>production.rb</code>加上</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">action_controller</span><span class="o">.</span><span class="n">perform_caching</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">cache_store</span> <span class="o">=</span> <span class="ss">:dalli_store</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 存入</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="no">Post</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
</span><span class='line'><span class="c1"># 取出</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c1"># 删除</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c1"># 查看</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</span><span class='line'><span class="c1"># fetch: 檢查 key 是否存在, 不存在, 把 block 里的结果作為 value, 并返回结果. 如果存在, 就不去執行 block 的内容</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;last_post&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="no">Post</span><span class="o">.</span><span class="n">last</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># =&gt; blah</span>
</span><span class='line'><span class="c1"># 还可以设定过期时间</span>
</span><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="ss">expires_in</span><span class="p">:</span> <span class="mi">4</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="p">{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>使用時機</h3>

<p>資料庫裡不常變動的資料，ex:所有國家</p>

<p>使用</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">cached_skills</span>
</span><span class='line'>  <span class="no">Rails</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="o">[</span><span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="ss">:skills</span><span class="o">]</span><span class="p">,</span> <span class="ss">expires_in</span><span class="p">:</span> <span class="mi">240</span><span class="o">.</span><span class="n">hours</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">skills</span><span class="o">.</span><span class="n">to_a</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>[self.class.name, id, :skills]這是存儲的關鍵</li>
<li>cache 將會在240小時後過期</li>
<li>如果不轉 array (to_a)直接將 active-record 的 relations 儲存到 cache 的話，每次訪問 cache 這個 relations 還是會查詢資料庫的</li>
</ul>


<p>gem：<br/>
<a href="https://github.com/petergoldstein/dalli">dalli</a></p>

<p>官方文件：<br/>
<a href="http://guides.ruby-china.org/caching_with_rails.html">Rails 缓存简介</a><br/>
<a href="http://guides.rubyonrails.org/caching_with_rails.html">Caching with Rails: An overview</a><br/>
<a href="https://memcached.org/">memcached</a></p>

<p>參考文件：<br/>
<a href="https://ihower.tw/rails4/caching.html">快取</a><br/>
<a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching">Google Developers: HTTP 快取</a><br/>
<a href="http://grantcss.com/blog/2014/12/04/introduce-dalli/">數據緩存提升性能gem - Dalli介紹</a><br/>
<a href="https://ihower.tw/blog/archives/1768">如何使用 memcached 做快取</a><br/>
<a href="https://danielzhangqinglong.github.io/2015/03/19/rails-caching/">Rails中使用memcached內存緩存技術</a><br/>
<a href="https://danielzhangqinglong.github.io/2015/04/03/intro-http-caching-with-rails/">译 ~ 介绍Rails中的条件HTTP缓存</a><br/>
<a href="https://ruby-china.org/topics/24996">Rails 3 和 Rails 4 中 ETags 工作原理</a><br/>
<a href="http://enginechang.logdown.com/posts/249025-discussion-on-memory-cache">淺談memory cache</a><br/>
<a href="https://ruby-china.org/topics/19389">总结 Web 应用中常用的各种 Cache</a><br/>
<a href="http://rails-everyday.group.iteye.com/group/wiki/1160">Rails Cache</a><br/>
<a href="https://www.nateberkopec.com/2015/07/15/the-complete-guide-to-rails-caching.html">Speed Up Your Rails App by 66% - The Complete Guide to Rails Caching</a><br/>
<a href="https://www.fastly.com/blog/accelerating-rails-part-1-built-caching">Accelerating Rails, Part 1: Built-in Caching</a><br/>
<a href="https://www.fastly.com/blog/accelerating-rails-part-2-dynamic-http-caching">Accelerating Rails, Part 2: Dynamic HTTP Caching</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cookie & Session]]></title>
    <link href="http://mgleon08.github.com/blog/2016/06/12/cookie-and-session/"/>
    <updated>2016-06-12T20:34:20+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/06/12/cookie-and-session</id>
    <content type="html"><![CDATA[<p>用於讓 server 記住 client 的行為與資料。</p>

<!-- more -->


<h1>Cookie</h1>

<p>由於 HTTP 協定是無狀態((Stateless)的，server 端無法得知使用者在前端的操作內容，阻礙了前端與後端對話，因此 cookie 就是被設計來解決這個問題的機制。</p>

<ul>
<li>當 server 想要儲存使用者的某些狀態時，就可以發送 cookie 給 client</li>
<li>http header 裡面其中一個欄位</li>
<li>key / value 的形式儲</li>
<li>檔案大小最多 4Kb</li>
<li>以明文的方式在網際網路上傳輸及在 Client 端電腦儲存，所以不建議儲存敏感資料</li>
<li>儲存在 client 的瀏覽器</li>
<li>儲存位置

<ul>
<li>記憶體 cookie：由瀏覽器維護，當瀏覽器關閉，cookie也隨之消失，為非持久性的</li>
<li>硬碟 cookie：存在用戶端硬碟中，有一個過期時間，除非使用者手動清理cookie或是超過過期時間，否則cookie不會消失，為持久性的</li>
</ul>
</li>
</ul>


<h1>Session</h1>

<ul>
<li>儲存在 server 端</li>
<li>session 需要 cookie 的輔助才能產生運作</li>
<li>server 會傳送帶有 session id 的 cookie 給 client，當下一個 request 及cookie 再被送至 server 端時，會用 cookie 中的 session id 來辨認每個使用者所儲存的狀態與 data。</li>
<li>相對於 cookies，session 多用來儲存敏感的資料，也常常成為攻擊的目標 <a href="http://guides.rubyonrails.org/security.html#session-hijacking">Session Hijacking</a></li>
</ul>


<h1>rails 裡的 Session &amp; Cookie</h1>

<h3>session</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#設定</span>
</span><span class='line'><span class="n">session</span><span class="o">[</span><span class="ss">:current_user_id</span><span class="o">]</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span>
</span><span class='line'><span class="c1">#移除</span>
</span><span class='line'><span class="n">session</span><span class="o">[</span><span class="ss">:current_user_id</span><span class="o">]</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(:</span> <span class="n">current_user_id</span><span class="p">)</span>
</span><span class='line'><span class="c1">#整個 session 清掉</span>
</span><span class='line'><span class="n">reset_session</span>
</span></code></pre></td></tr></table></div></figure>


<h3>session store</h3>

<p><code>config/initializers/session_store.rb</code> 裡面可以設定</p>

<ul>
<li><code>:cookie_store</code>（預設）</li>
<li><code>:active_record_store</code> 使用資料庫來儲存（安全性較高）

<ul>
<li>需搭配 activerecord-session_store gem，產生sessions資料表</li>
</ul>
</li>
<li><code>:mem_cache_store</code> 使用Memcached快取系統來儲存，適合逾須兼顧效能的高流量網站</li>
</ul>


<blockquote><p>Rails預設採用 Cookies session storage 來儲存 Session 資料，它是將 Session 資料透過 config/secrets.yml 的 secret_key_base 編碼後放到瀏覽器的 Cookie 之中</p></blockquote>

<h3>cookie</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#設定</span>
</span><span class='line'><span class="n">cookies</span><span class="o">[</span><span class="ss">:commenter_name</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@comment</span><span class="o">.</span><span class="n">author</span>
</span><span class='line'><span class="c1">#移除</span>
</span><span class='line'><span class="n">cookies</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:commenter_name</span><span class="p">)</span>
</span><span class='line'><span class="c1">#保護不能讓使用者亂改 signed</span>
</span><span class='line'><span class="n">cookies</span><span class="o">.</span><span class="n">signed</span><span class="o">[</span><span class="ss">:user_preference</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@current_user</span><span class="o">.</span><span class="n">preferences</span>
</span><span class='line'><span class="c1">#盡可能永遠留在使用者瀏覽器的資料 permanent</span>
</span><span class='line'><span class="n">cookies</span><span class="o">[</span><span class="ss">:remember_token</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">value</span><span class="p">:</span>   <span class="n">remember_token</span><span class="p">,</span>
</span><span class='line'>                             <span class="ss">expires</span><span class="p">:</span> <span class="mi">20</span><span class="o">.</span><span class="n">years</span><span class="o">.</span><span class="n">from_now</span><span class="o">.</span><span class="n">utc</span> <span class="p">}</span>
</span><span class='line'><span class="c1">#上下相等</span>
</span><span class='line'><span class="n">cookies</span><span class="o">.</span><span class="n">permanent</span><span class="o">[</span><span class="ss">:remember_me</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">salt</span><span class="o">]</span>
</span><span class='line'><span class="c1">#permanent 預設為 20 年後過期 = 20.years.from_now</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#可一起用</span>
</span><span class='line'><span class="n">cookies</span><span class="o">.</span><span class="n">permanent</span><span class="o">.</span><span class="n">signed</span><span class="o">[</span><span class="ss">:remember_me</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">salt</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Rails 3 是 digitally signed cookie 可以用這方法 decode</span>
</span><span class='line'><span class="c1">#Rails 4 則改為 Encrypted cookies 就無法</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;rack&#39;</span>
</span><span class='line'><span class="n">cookie</span> <span class="o">=</span> <span class="s2">&quot;BAh7CUkiD3Nlc3Npb25faWQGOgZFRkkiJ(...)&quot;</span>
</span><span class='line'><span class="no">Rack</span><span class="o">::</span><span class="no">Session</span><span class="o">::</span><span class="no">Cookie</span><span class="o">::</span><span class="no">Base64</span><span class="o">::</span><span class="no">Marshal</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>官方文件：<br/>
<a href="http://rails.ruby.tw/action_controller_overview.html#session">session</a><br/>
<a href="http://rails.ruby.tw/action_controller_overview.html#cookies">cookie</a><br/>
<a href="http://guides.rubyonrails.org/security.html#sessions">RailsGuide</a></p>

<p>參考文件：<br/>
<a href="http://blog.andikan.me/2012/10/03/cookie-and-session/">Cookie 和 Session 的神秘關係</a><br/>
<a href="https://ihower.tw/rails4/actioncontroller.html">Action Controller - 控制 HTTP 流程</a><br/>
<a href="http://fred-zone.blogspot.tw/2014/01/web-session.html">Web 技術中的 Session 是什麼？</a><br/>
<a href="http://railsfun.tw/t/session-cookie/380">session / cookie 解釋</a><br/>
<a href="http://lucaswu.logdown.com/posts/735841-rails-sessions-cookies-and-flash">Rails - Sessions, Cookies and Flash</a>
<a href="http://grantcss.com/blog/2015/03/23/how-rails-sessions-work/">[译] Rails Sessions 是如何工作的？</a><br/>
<a href="http://www.rails365.net/articles/cookie-yuan-li-yu-shi-xian-rails-pian">cookie原理与实现(rails篇)</a><br/>
<a href="http://www.rails365.net/articles/session-yuan-li-yu-shi-xian-rails-pian">session原理与实现(rails篇)</a><br/>
<a href="https://read01.com/NyARK.html">COOKIE與SESSION比較</a><br/>
<a href="http://railstutorial-china.org/rails42/chapter8.html#logging-in">第 8 章 登录和退出</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Garbage Collection (GC)]]></title>
    <link href="http://mgleon08.github.com/blog/2016/06/10/garbage-collection/"/>
    <updated>2016-06-10T12:18:42+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/06/10/garbage-collection</id>
    <content type="html"><![CDATA[<p>在 ruby 當中，經常會看到 : 的符號，代表 symbol</p>

<!-- more -->


<p>跟一般 string 的差異在於</p>

<ul>
<li>同樣的 string，會產生不同的 記憶體</li>
<li>同樣的 symbol，一樣的記憶體</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">3</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;foo&quot;</span><span class="o">.</span><span class="n">object_id</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1">#=&gt;70302331020060</span>
</span><span class='line'><span class="c1">#=&gt;70302331019980</span>
</span><span class='line'><span class="c1">#=&gt;70302331019920</span>
</span><span class='line'>
</span><span class='line'><span class="mi">3</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="ss">:foo</span><span class="o">.</span><span class="n">object_id</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1">#=&gt;1091868</span>
</span><span class='line'><span class="c1">#=&gt;1091868</span>
</span><span class='line'><span class="c1">#=&gt;1091868</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#將字串 freeze 起來，object_id 也會是一樣</span>
</span><span class='line'><span class="mi">3</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;foo&quot;</span><span class="o">.</span><span class="n">freeze</span><span class="o">.</span><span class="n">object_id</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="c1">#=&gt;70172682147320</span>
</span><span class='line'><span class="c1">#=&gt;70172682147320</span>
</span><span class='line'><span class="c1">#=&gt;70172682147320</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Garbage Collection</h1>

<ul>
<li><p>在 ruby 2.2 之前，symbol 所佔用的記憶體沒辦法被自動回收，要釋放就必須重啟動程式，因此會造成 memory leak 的問題</p></li>
<li><p>但在 2.2 之後，Symbol GC(Garbage Collection) ，那些動態用 to_sym 或 intern 長出來的 Symbol 就可以跟一般物件一樣被回收了。</p></li>
</ul>


<h3>ruby2.1</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Ruby 2.1</span>
</span><span class='line'><span class="n">before</span> <span class="o">=</span> <span class="no">Symbol</span><span class="o">.</span><span class="n">all_symbols</span><span class="o">.</span><span class="n">size</span>
</span><span class='line'><span class="mi">100_000</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;sym</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">to_sym</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="no">GC</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'><span class="n">after</span> <span class="o">=</span> <span class="no">Symbol</span><span class="o">.</span><span class="n">all_symbols</span><span class="o">.</span><span class="n">size</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">after</span> <span class="o">-</span> <span class="n">before</span>
</span><span class='line'><span class="c1"># =&gt; 100001</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ruby 2.2</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Ruby 2.2</span>
</span><span class='line'><span class="n">before</span> <span class="o">=</span> <span class="no">Symbol</span><span class="o">.</span><span class="n">all_symbols</span><span class="o">.</span><span class="n">size</span>
</span><span class='line'><span class="mi">100_000</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;sym</span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">to_sym</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="no">GC</span><span class="o">.</span><span class="n">start</span>
</span><span class='line'><span class="n">after</span> <span class="o">=</span> <span class="no">Symbol</span><span class="o">.</span><span class="n">all_symbols</span><span class="o">.</span><span class="n">size</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">after</span> <span class="o">-</span> <span class="n">before</span>
</span><span class='line'><span class="c1"># =&gt; 1</span>
</span></code></pre></td></tr></table></div></figure>


<p>參考文件：<br/>
<a href="http://kaochenlong.com/2016/04/25/string-and-symbol/">Ruby 語法放大鏡之「有的變數變前面有一個冒號(例如 :name)，是什麼意思?」</a><br/>
<a href="https://www.sitepoint.com/symbol-gc-ruby-2-2/">Symbol GC in Ruby 2.2</a><br/>
<a href="http://grantcss.com/blog/2015/01/26/symbol-gc-in-ruby-2-dot-2/">[译] 在 Ruby 2.2 中的 Symbol GC</a><br/>
<a href="https://ruby-china.org/topics/21498">Ruby 2.2 的 可回收 symbol</a><br/>
<a href="https://ruby-china.org/topics/17575">升级 Ruby 2.1 以及 GC 调整</a><br/>
<a href="https://ruby-china.org/topics/13740">Ruby 的 GC 不释放内存给回系统的？</a><br/>
<a href="https://ruby-china.org/topics/28127">画说 Ruby 与 Python 垃圾回收</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Override Default Primary Key Id]]></title>
    <link href="http://mgleon08.github.com/blog/2016/06/09/override-default-primary-key-id/"/>
    <updated>2016-06-09T22:37:33+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/06/09/override-default-primary-key-id</id>
    <content type="html"><![CDATA[<p>有時候在處理一些 table 時，會不希望 Primary Key 是一開始預設的 id 流水號</p>

<!-- more -->


<p>像是當 table 會不斷清空又重建，若是流水號，就會一直不斷的壘加上去，這時我們就會希望 table 的 Primary Key 可以自己設定</p>

<p>migration 可以很方便做到這件事，也可以改成複合健(兩個 primary key，預設是無法，可以靠 composite_primary_keys  gem 來達成)</p>

<!-- more -->


<p>先將原本 id 移除</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">up</span>
</span><span class='line'>  <span class="n">remove_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:id</span> <span class="c1"># remove existing primary key</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">down</span>
</span><span class='line'>  <span class="n">add_column</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:primary_key</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>加上新的 primary key id</p>

<ul>
<li>ex1:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:sku</span><span class="p">,</span> <span class="ss">primary</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ex2:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">create_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:sku</span><span class="p">,</span> <span class="ss">primary_key</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ex3:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>  <span class="n">create_table</span> <span class="ss">:products</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:sku</span><span class="p">,</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">add_index</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:sku</span><span class="p">,</span> <span class="ss">unique</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">execute</span> <span class="sx">%Q{ ALTER TABLE &quot;products&quot; ADD PRIMARY KEY (&quot;sku&quot;); }</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>參考文件：<br/>
<a href="http://ruby-journal.com/how-to-override-default-primary-key-id-in-rails/">How to Override Default Primary Key Id in Rails</a><br/>
<a href="https://github.com/composite-primary-keys/composite_primary_keys">composite_primary_keys</a><br/>
<a href="http://stackoverflow.com/questions/23848388/change-primary-key-issue-rails-4-0">Change Primary Key Issue Rails 4.0</a><br/>
<a href="http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html#method-i-create_table">create_table</a><br/>
<a href="http://rails.ruby.tw/active_record_migrations.html">Active Record 遷移</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Class Macro (Ruby’s Declarative Style)]]></title>
    <link href="http://mgleon08.github.com/blog/2016/06/09/class-macro/"/>
    <updated>2016-06-09T20:14:09+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/06/09/class-macro</id>
    <content type="html"><![CDATA[<p>Class Macro 就是在 rails 的 ActiveRecord 中，經常會看到，<code>validates</code> <code>belongs_to</code> <code>hsa_manay</code> 等等的宣告</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">validates</span>  <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:group</span>
</span><span class='line'>  <span class="n">has_many</span>   <span class="ss">:posts</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>範例:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">ActiveRecord</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Base</span>
</span><span class='line'>    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">has_many</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2"> has many </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  
</span><span class='line'>      <span class="c1">#定義 Dynamic method</span>
</span><span class='line'>      <span class="n">define_method</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;Select * From </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2"> Where..&quot;</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;Return </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>        <span class="o">[]</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Movie</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1">#self.has_many(:reviews)</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:reviews</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:genres</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Project</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:tasks</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">movie</span> <span class="o">=</span> <span class="no">Movie</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">movie</span><span class="o">.</span><span class="n">reviews</span>
</span><span class='line'><span class="n">project</span> <span class="o">=</span> <span class="no">Project</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">project</span><span class="o">.</span><span class="n">tasks</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#=&gt;Movie has many reviews</span>
</span><span class='line'><span class="c1">#=&gt;Movie has many genres</span>
</span><span class='line'><span class="c1">#=&gt;Project has many tasks</span>
</span><span class='line'><span class="c1">#=&gt;Select * From reviews Where..</span>
</span><span class='line'><span class="c1">#=&gt;Return reviews</span>
</span><span class='line'><span class="c1">#=&gt;Select * From tasks Where..</span>
</span><span class='line'><span class="c1">#=&gt;Return tasks</span>
</span></code></pre></td></tr></table></div></figure>


<p>之前有寫過
<a href="http://mgleon08.github.io/blog/2016/04/19/dynamic-classes-and-methods/">Dynamic Classes &amp; Methods</a></p>

<p>另一個範例，可以動態的將取出來的值做改變</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Precentage</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="o">*</span><span class="n">columns</span><span class="p">,</span> <span class="ss">precentage</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
</span><span class='line'>    <span class="n">columns</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">column</span><span class="o">|</span>
</span><span class='line'>      <span class="c1">#這裡做了 alias_method 主要是希望，如果想知道原本的價錢，還可以呼叫 xx_origin</span>
</span><span class='line'>      <span class="n">alias_method</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">column</span><span class="si">}</span><span class="s2">_origin&quot;</span><span class="p">,</span> <span class="n">column</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">precentage</span>
</span><span class='line'>        <span class="c1">#動態產生新的 method 去取代原本</span>
</span><span class='line'>        <span class="n">define_method</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>          <span class="nb">send</span><span class="p">(</span><span class="n">precentage</span><span class="p">)</span> <span class="o">*</span> <span class="nb">send</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">column</span><span class="si">}</span><span class="s2">_origin&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Book</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">Precentage</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">:precentage</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@price</span>      <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="ss">:price</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@precentage</span> <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="ss">:precentage</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">transform</span> <span class="ss">:price</span><span class="p">,</span> <span class="ss">precentage</span><span class="p">:</span> <span class="ss">:precentage</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">price</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="ss">precentage</span><span class="p">:</span><span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">book</span><span class="o">.</span><span class="n">precentage</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">book</span><span class="o">.</span><span class="n">price</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">book</span><span class="o">.</span><span class="n">price_origin</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#=&gt; 0.8</span>
</span><span class='line'><span class="c1">#=&gt; 80.0</span>
</span><span class='line'><span class="c1">#=&gt; 100</span>
</span></code></pre></td></tr></table></div></figure>


<p>參考文件：<br/>
<a href="https://pragmaticstudio.com/blog/2015/4/14/ruby-macros">How To Write &ldquo;Macros&rdquo; in Ruby</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby Range]]></title>
    <link href="http://mgleon08.github.com/blog/2016/06/09/ruby-range/"/>
    <updated>2016-06-09T20:13:54+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/06/09/ruby-range</id>
    <content type="html"><![CDATA[<p>經常會使用 range 去判斷某個值，是否在某個區間<br/>
ruby 也提供很多好用的方法去判斷，cover?, include? 等等</p>

<!-- more -->


<h1>Range</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#... 不包含結尾</span>
</span><span class='line'><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>      <span class="c1">#=&gt; []</span>
</span><span class='line'><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>      <span class="c1">#=&gt; [-5, -4, -3, -2, -1]</span>
</span><span class='line'><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>    <span class="c1">#=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;]</span>
</span><span class='line'><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>   <span class="c1">#=&gt; [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="no">Range</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>    <span class="c1">#=&gt; true</span>
</span><span class='line'><span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>           <span class="c1">#=&gt; false</span>
</span></code></pre></td></tr></table></div></figure>


<h1>begin/end first/last</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">r1</span> <span class="o">=</span> <span class="mi">3</span><span class="o">.</span><span class="n">.</span><span class="mi">6</span>
</span><span class='line'><span class="n">r2</span> <span class="o">=</span> <span class="mi">3</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="mi">6</span>
</span><span class='line'><span class="n">r1a</span><span class="p">,</span> <span class="n">r1b</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">r1</span><span class="o">.</span><span class="n">last</span>    <span class="c1">#=&gt; 3, 6</span>
</span><span class='line'><span class="n">r1c</span><span class="p">,</span> <span class="n">r1d</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">begin</span><span class="p">,</span> <span class="n">r1</span><span class="o">.</span><span class="n">end</span>     <span class="c1">#=&gt; 3, 6</span>
</span><span class='line'><span class="n">r2a</span><span class="p">,</span> <span class="n">r2b</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">begin</span><span class="p">,</span> <span class="n">r2</span><span class="o">.</span><span class="n">end</span>     <span class="c1">#=&gt; 3, 6 (注意：不是3和5)</span>
</span><span class='line'><span class="n">r1</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                     <span class="c1">#=&gt; [3, 4]</span>
</span></code></pre></td></tr></table></div></figure>


<h1>step</h1>

<p>從 0..20 中取出 0，5，10，20</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">20</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>
</span><span class='line'><span class="c1">#=&gt; [0, 5, 10, 15, 20]</span>
</span></code></pre></td></tr></table></div></figure>


<h1>include?/cover?</h1>

<p>判斷值，是否在 range 當中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">r</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">.</span><span class="n">.</span> <span class="mi">5</span>
</span><span class='line'><span class="n">r</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>     <span class="c1">#=&gt; true</span>
</span><span class='line'><span class="n">r</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>     <span class="c1">#=&gt; false</span>
</span><span class='line'><span class="n">r</span><span class="o">.</span><span class="n">cover?</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c1">#=&gt; true</span>
</span><span class='line'><span class="n">r</span><span class="o">.</span><span class="n">cover?</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>       <span class="c1">#=&gt; false</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="o">.</span><span class="n">.</span><span class="s2">&quot;z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">&quot;ab&quot;</span><span class="p">)</span>     <span class="c1"># =&gt; false </span>
</span><span class='line'><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="o">.</span><span class="n">.</span><span class="s2">&quot;z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cover?</span><span class="p">(</span><span class="s2">&quot;ab&quot;</span><span class="p">)</span>       <span class="c1"># =&gt; true </span>
</span></code></pre></td></tr></table></div></figure>


<p>主要差異是</p>

<ul>
<li>include? 會將所有值一一拿出來做比對，因此效率較差</li>
<li>cover?   只會取出開頭和結尾，去比對，值 > 開頭 &amp;&amp; 值 &lt;= 結尾，效能比較好</li>
</ul>


<p>官方文件：<br/>
<a href="http://ruby-doc.org/core-1.9.3/Range.html">ruby-doc Range</a></p>

<p>參考文件：<br/>
<a href="http://stackoverflow.com/questions/21608935/what-is-the-difference-between-rangeinclude-and-rangecover">What is the difference between Range#include? and Range#cover? ?</a>  <br/>
<a href="https://blog.8thlight.com/makis-otman/2014/09/03/setting-date-ranges-in-ruby.html">Apprentice Blog of the Week: Setting Date Ranges in Ruby</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Coding Principle 程式設計原則 SOLID]]></title>
    <link href="http://mgleon08.github.com/blog/2016/05/29/coding-principle/"/>
    <updated>2016-05-29T20:27:06+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/05/29/coding-principle</id>
    <content type="html"><![CDATA[<p>在 Coding 的世界中，有許多重要的 Principle 值得我們去遵循</p>

<!-- more -->


<h1>SOLID</h1>

<h1>Single Responsibility Principle(單一責任原則SRP)</h1>

<h3>定義：</h3>

<ul>
<li>對一個類別而言，應該僅有一個引起它變化的原因（職責）</li>
<li>降低單一類別被「改變」所影響的機會</li>
<li>只有一個理由需要更改這個class，如果有一個以上的理由就表示：這個class負責超過一個以上的責任</li>
</ul>


<h3>說明：</h3>

<ul>
<li>若一個類別有多重職責，職責之間會互相耦合，一個職責的變化可能會影響該類別完成其他職責的能力。</li>
</ul>


<p><a href="http://ithelp.ithome.com.tw/articles/10100557">軟體路上不孤單Day10-物件導向原則介紹3[SRP]</a></p>

<h1>Open/Close Principle (開放關閉原則OCP)</h1>

<h3>定義：</h3>

<ul>
<li>軟體模組（class, method, module）應該對擴展開放，對修改關閉</li>
<li>讓模組容易增加(擴展)功能，而不必去修改原有程式碼</li>
<li>讓主要類別不會因為新增需求而改變</li>
</ul>


<h3>說明：</h3>

<ul>
<li>對有相似行為類別的建立抽象層，如 abstract class, 或是 interface。</li>
<li>將公共屬性或方法提取到抽象層中，當需要擴展行為（新增）時只需要建立新的子類別並繼承抽象層，不必修改原有的行為。</li>
</ul>


<blockquote><p>注意：實作 OCP 抽象層需要花費時間和精力，也可能會造成複雜度的上升，OCP 應該只運用在程序中頻繁發生的變化上。</p></blockquote>

<p><a href="http://ithelp.ithome.com.tw/articles/10100008">軟體路上不孤單Day08-物件導向原則介紹1[OCP]</a></p>

<h1>Liskov Substitution Principle (Liskov替換原則LSP)</h1>

<h3>定義：</h3>

<ul>
<li>子類別(Sub Type)必須能夠替換成他們的基本類別(Base Type)</li>
<li>子類別應該可以替換任何基本類別出現的位置，且程序還能正常工作</li>
<li>避免繼承時子類別所造成的「行為改變」</li>
</ul>


<h3>說明：</h3>

<ol>
<li>不能僅用 is-a 的關係就建立繼承，必須考慮是否在基本類別中有些方法對子類別而言是不需要或是無意義的。</li>
</ol>


<p>這些沒有意義的方法會造成不可預期的結果。</p>

<ol>
<li>建立一個抽象層並提取公共方法，並讓子類別派生抽象層。</li>
</ol>


<blockquote><p>注意：必須要有繼承關係才需要考慮 LSP ，而 LSP 是讓設計達到 OCP 的規則之一 。</p></blockquote>

<p><a href="http://ithelp.ithome.com.tw/articles/10100827">軟體路上不孤單Day11-物件導向原則介紹4[LSP]</a></p>

<h1>Law of Demeter(迪米特原則LOD, LKD)</h1>

<h3>定義：</h3>

<ul>
<li>也稱最少知識原則(Principle of Least Knowledge)</li>
<li>避免曝露過多資訊造成用戶端因流程調整而改變</li>
<li>模組應該儘可能的減少其他模組交互，目的在於降低彼此之間的依賴。</li>
</ul>


<h3>說明：</h3>

<p>以下為必須遵循 LOD 的條件</p>

<p>類別 O 的任何方法 m 只能呼叫屬於以下情況的方法</p>

<ol>
<li>類別 O 本身的方法</li>
<li>傳入 m 的參數的方法</li>
<li>在 m 中建立對象的方法</li>
<li>任何直接持有的對象方法</li>
</ol>


<p><a href="http://ithelp.ithome.com.tw/articles/10101265">軟體路上不孤單Day13-物件導向原則介紹6[LoD]</a></p>

<h1>Interface Segregation Principle(介面隔離ISP)</h1>

<h3>定義：</h3>

<ul>
<li>使用單純簡單的 interface , 比使用一個複雜過大的 interface 來的好。</li>
<li>用戶不應該被迫相依於他們用不到的函示</li>
<li>降低用戶端因為不相關介面而被改變</li>
</ul>


<h3>說明：</h3>

<p>一個過大的 interface ，通常代表其中有某些功能是客戶端不需要的，如果客戶端實作了不需要的功能 ，這些功能會造成不必要的耦合。</p>

<p>我們可以把過大的 interface 分離，將其中某些功能拆離到另一個 interface 中。</p>

<p><a href="http://ithelp.ithome.com.tw/articles/10101106">軟體路上不孤單Day12-物件導向原則介紹5[ISP]</a></p>

<h1>Dependency Inversion Principle (相依性反轉DIP)</h1>

<h3>定義：</h3>

<ul>
<li>高層模組不應該相依於低層模組，兩者都應該相依於抽象</li>
<li>避免高階程式因為低階程式改變而被迫改變</li>
<li>抽象不應該相依於具體，具體應該相依於抽象。</li>
</ul>


<h3>說明：</h3>

<p>對象的引用盡量是抽象型態而不是具體型態。</p>

<blockquote><p>注意：若是具體型態已經相當穩定，不太會變化，依賴於該具體類別也是無妨。</p></blockquote>

<p><a href="http://ithelp.ithome.com.tw/articles/10101486">軟體路上不孤單Day14-物件導向原則介紹7[DIP]</a></p>

<hr />

<h1>Do not repeat yourself(DRY)</h1>

<h3>定義：</h3>

<ul>
<li>當有相同的 code 時，應該整合成一個，不該重複出現</li>
</ul>


<p><a href="http://ithelp.ithome.com.tw/articles/10100309">軟體路上不孤單Day09-物件導向原則介紹2[DRY]</a></p>

<h1>duck type(鴨子類型)</h1>

<h3>定義：</h3>

<ul>
<li>當我看到一隻鳥，它走路像鴨子，游泳像鴨子，叫聲像鴨子，我就稱其為鴨子</li>
</ul>


<h3>說明：</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>    <span class="n">x</span><span class="o">.</span><span class="n">hi</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>因此只要 x 將帶有 <code>hi</code> 的方法都可以使用，不管是人或是動物</p>

<p><a href="http://www.ithome.com.tw/voice/88063">進一步思考Duck typing</a></p>

<p>參考文件：<br/>
<a href="http://rockssdlog.blogspot.tw/2012/03/oo-solid.html">白話- OO設計原則 (SOLID原則) - 附生活實例</a> <br/>
<a href="http://ithelp.ithome.com.tw/search?tab=article&amp;search=%E8%BB%9F%E9%AB%94%E8%B7%AF%E4%B8%8A%E4%B8%8D%E5%AD%A4%E5%96%AE&amp;page=1">軟體路上不孤單</a><br/>
<a href="http://122.146.238.121/wordpress/?cat=95">Design Principle</a><br/>
<a href="http://slides.com/jaceju/design-patterns-by-examples/#/">從實例學設計模式</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Default Args]]></title>
    <link href="http://mgleon08.github.com/blog/2016/05/29/default-args/"/>
    <updated>2016-05-29T20:22:19+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/05/29/default-args</id>
    <content type="html"><![CDATA[<p>很常時候，需要給變數一個預設值，因此有以下方法，都可以設定預設值</p>

<!-- more -->


<h1>||</h1>

<p>只要是空值，或是 false, nil 就會回傳後面的預設值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">}</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;false, &quot;c&quot;=&gt;nil}</span>
</span><span class='line'><span class="n">h</span><span class="o">[</span><span class="s1">&#39;a&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="mi">8</span>
</span><span class='line'><span class="c1">#=&gt; 100</span>
</span><span class='line'><span class="n">h</span><span class="o">[</span><span class="s1">&#39;b&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="mi">8</span>
</span><span class='line'><span class="c1">#=&gt; 8</span>
</span><span class='line'><span class="n">h</span><span class="o">[</span><span class="s1">&#39;c&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="mi">8</span>
</span><span class='line'><span class="c1">#=&gt; 8</span>
</span><span class='line'><span class="n">h</span><span class="o">[</span><span class="s1">&#39;d&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="mi">8</span>
</span><span class='line'><span class="c1">#=&gt; 8</span>
</span></code></pre></td></tr></table></div></figure>


<h1>fetch</h1>

<p>即使是 nil, false 也會回傳，只有在空值的時候回傳預設值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">h</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">}</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;100, &quot;b&quot;=&gt;false, &quot;c&quot;=&gt;nil}</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; 100</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; false</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; nil</span>
</span><span class='line'><span class="n">h</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; 8</span>
</span></code></pre></td></tr></table></div></figure>


<p>在處理應該存在的哈希鍵時，使用 fetch。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">heroes</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">batman</span><span class="p">:</span> <span class="s1">&#39;Bruce Wayne&#39;</span><span class="p">,</span> <span class="ss">superman</span><span class="p">:</span> <span class="s1">&#39;Clark Kent&#39;</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># bad - if we make a mistake we might not spot it right away</span>
</span><span class='line'><span class="n">heroes</span><span class="o">[</span><span class="ss">:batman</span><span class="o">]</span> <span class="c1"># =&gt; &quot;Bruce Wayne&quot;</span>
</span><span class='line'><span class="n">heroes</span><span class="o">[</span><span class="ss">:supermann</span><span class="o">]</span> <span class="c1"># =&gt; nil</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># good - fetch raises a KeyError making the problem obvious</span>
</span><span class='line'><span class="n">heroes</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:supermann</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>在使用 fetch 時，使用第二個參數設置默認值而不是使用自定義的邏輯。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">batman</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Bruce Wayne&#39;</span><span class="p">,</span> <span class="ss">is_evil</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># bad - if we just use || operator with falsy value we won&#39;t get the expected result</span>
</span><span class='line'><span class="n">batman</span><span class="o">[</span><span class="ss">:is_evil</span><span class="o">]</span> <span class="o">||</span> <span class="kp">true</span> <span class="c1"># =&gt; true</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># good - fetch work correctly with falsy values</span>
</span><span class='line'><span class="n">batman</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:is_evil</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</span></code></pre></td></tr></table></div></figure>


<p>盡量用 fetch 加區塊而不是直接設定默認值。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">batman</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;Bruce Wayne&#39;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># bad - if we use the default value, we eager evaluate it</span>
</span><span class='line'><span class="c1"># so it can slow the program down if done multiple times</span>
</span><span class='line'><span class="n">batman</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:powers</span><span class="p">,</span> <span class="n">get_batman_powers</span><span class="p">)</span> <span class="c1"># get_batman_powers is an expensive call</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># good - blocks are lazy evaluated, so only triggered in case of KeyError exception</span>
</span><span class='line'><span class="n">batman</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:powers</span><span class="p">)</span> <span class="p">{</span> <span class="n">get_batman_powers</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>merge</h1>

<p>只有在 merge 的參數裡有同樣的值，才會覆蓋掉 default 的值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">default</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="kp">nil</span> <span class="p">}</span>
</span><span class='line'><span class="n">args</span>    <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;a&quot;</span> <span class="o">=&gt;</span> <span class="mi">8</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">default</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; {&quot;a&quot;=&gt;8, &quot;b&quot;=&gt;false, &quot;c&quot;=&gt;nil}</span>
</span></code></pre></td></tr></table></div></figure>


<p>官方文件：<br/>
<a href="http://apidock.com/ruby/Hash/fetch">fetch</a><br/>
<a href="http://apidock.com/ruby/Hash/merge">merge</a></p>
]]></content>
  </entry>
  
</feed>
