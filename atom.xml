<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Leon's Blogging]]></title>
  <link href="http://mgleon08.github.com/atom.xml" rel="self"/>
  <link href="http://mgleon08.github.com/"/>
  <updated>2017-10-02T16:58:24+08:00</updated>
  <id>http://mgleon08.github.com/</id>
  <author>
    <name><![CDATA[LeonJi]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails 5 初探]]></title>
    <link href="http://mgleon08.github.com/blog/2017/09/17/rails5/"/>
    <updated>2017-09-17T10:09:39+08:00</updated>
    <id>http://mgleon08.github.com/blog/2017/09/17/rails5</id>
    <content type="html"><![CDATA[<p>Rails5.x.x 已經出來一段時間了，聽說增加了不少東西，來研究順便記錄一下~</p>

<!-- more -->


<h1>後端</h1>

<ul>
<li>rake 有些相關指令可改用 rails (<code>rake db:migrate</code> to <code>rails db:migrate</code>原來的 rake 指令還是可以用)</li>
</ul>


<h1>前端</h1>

<ul>
<li>Yarn 成為預設套件 (<a href="https://github.com/pnpm/node-package-manager-benchmark">yarn 和 npm 效能比較表</a>)</li>
<li><code>jquery-rails</code> 移出 Gemfile (需要的話，可用 yarn 來安裝)</li>
<li>Support webpack</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Webpack</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span><span class="err">將許多</span><span class="n">javascript</span><span class="err">的檔案包在一起，減少</span><span class="n">request</span><span class="err">的次數</span>
</span><span class='line'><span class="mi">2</span><span class="o">.</span><span class="err">利用</span> <span class="no">Loader</span><span class="err">將</span><span class="no">ES6</span><span class="err">編譯成</span><span class="no">ES5</span><span class="err">的語法，讓瀏覽器能順利讀取</span>
</span><span class='line'><span class="mi">3</span><span class="o">.</span><span class="err">整合</span><span class="no">ES</span> <span class="no">Modules</span><span class="err">、</span><span class="no">CommonJS</span><span class="err">和</span><span class="no">AMD</span><span class="err">，等等的模組</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h1>建立專案 with Webpack &amp; Vue</h1>

<h3>新的專案</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 可改成 react or angular</span>
</span><span class='line'><span class="n">rails</span> <span class="kp">new</span> <span class="n">myapp</span> <span class="o">--</span><span class="n">webpack</span><span class="o">=</span><span class="n">vue</span>
</span></code></pre></td></tr></table></div></figure>


<h3>原本的專案</h3>

<blockquote><p>記得先 brew install yarn (預設會用 yarn 來安裝)</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;webpack&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># command</span>
</span><span class='line'><span class="n">rails</span> <span class="ss">webpack</span><span class="p">:</span><span class="n">install</span>
</span><span class='line'><span class="n">rails</span> <span class="ss">webpack</span><span class="p">:</span><span class="ss">install</span><span class="p">:</span><span class="n">vue</span>
</span></code></pre></td></tr></table></div></figure>


<h3>新增檔案</h3>

<p>在 <code>app/javascript/pack</code> 的所有檔案會自動被 webpack compiled</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">app</span><span class="o">/</span><span class="ss">javascript</span><span class="p">:</span>
</span><span class='line'>  <span class="err">├──</span> <span class="ss">packs</span><span class="p">:</span>
</span><span class='line'>  <span class="err">│</span>   <span class="c1"># only webpack entry files here</span>
</span><span class='line'>  <span class="err">│</span>   <span class="err">├──</span> <span class="n">app</span><span class="o">.</span><span class="n">vue</span>
</span><span class='line'>  <span class="err">│  </span> <span class="err">├──</span> <span class="n">application</span><span class="o">.</span><span class="n">js</span>
</span><span class='line'>  <span class="err">│</span>   <span class="err">└──</span> <span class="n">hello_vue</span><span class="o">.</span><span class="n">js</span>
</span><span class='line'>  <span class="err">└──</span> <span class="ss">src</span><span class="p">:</span>
</span><span class='line'>  <span class="err">│</span>   <span class="err">└──</span> <span class="n">application</span><span class="o">.</span><span class="n">css</span>
</span><span class='line'>  <span class="err">└──</span> <span class="ss">images</span><span class="p">:</span>
</span><span class='line'>      <span class="err">└──</span> <span class="n">logo</span><span class="o">.</span><span class="n">svg</span>
</span></code></pre></td></tr></table></div></figure>


<p>Rails 會自動產生 vue component 的 sample</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app.vue</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">template</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;app&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="p"></span><span class="o">&lt;</span><span class="sr">/p&gt;</span>
</span><span class='line'><span class="sr">  &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/template&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">&lt;script&gt;</span>
</span><span class='line'><span class="sr">export default {</span>
</span><span class='line'><span class="sr">  data: function () {</span>
</span><span class='line'><span class="sr">    return {</span>
</span><span class='line'><span class="sr">      message: &quot;Hello Vue!&quot;</span>
</span><span class='line'><span class="sr">    }</span>
</span><span class='line'><span class="sr">  }</span>
</span><span class='line'><span class="sr">}</span>
</span><span class='line'><span class="sr">&lt;/s</span><span class="n">cript</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">style</span> <span class="n">scoped</span><span class="o">&gt;</span>
</span><span class='line'><span class="nb">p</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">font</span><span class="o">-</span><span class="ss">size</span><span class="p">:</span> <span class="mi">2</span><span class="n">em</span><span class="p">;</span>
</span><span class='line'>  <span class="n">text</span><span class="o">-</span><span class="ss">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/style&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr"># hello_vue.js</span>
</span><span class='line'><span class="sr">import Vue from &#39;vue&#39;</span>
</span><span class='line'><span class="sr">import App from &#39;./</span><span class="n">app</span><span class="o">.</span><span class="n">vue</span><span class="s1">&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">document.addEventListener(&#39;</span><span class="no">DOMContentLoaded</span><span class="s1">&#39;, () =&gt; {</span>
</span><span class='line'><span class="s1">  document.body.appendChild(document.createElement(&#39;</span><span class="n">hello</span><span class="s1">&#39;))</span>
</span><span class='line'><span class="s1">  const app = new Vue(App).$mount(&#39;</span><span class="n">hello</span><span class="err">&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<h3>建立 controller</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="n">pages</span> <span class="n">index</span>
</span></code></pre></td></tr></table></div></figure>


<p>更改 page index 內容 &amp; router</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/views/pages/index.html.erb</span>
</span><span class='line'><span class="o">&lt;</span><span class="sx">%= javascript_pack_tag &#39;hello_vue&#39; %&gt;s</span>
</span><span class='line'><span class="sx">&lt;%=</span> <span class="n">stylesheet_pack_tag</span> <span class="s1">&#39;application&#39;</span> <span class="o">%&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># router</span>
</span><span class='line'><span class="n">root</span> <span class="s1">&#39;pages/index&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>啟動</h3>

<ul>
<li>啟動後，Webpacker 會自動 Compiling</li>
<li>若是有修改 vue 裡面的內容，頁面重新整理會在自動 Compiling</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rails</span> <span class="n">s</span>
</span><span class='line'>
</span><span class='line'><span class="no">Started</span> <span class="no">GET</span> <span class="s2">&quot;/&quot;</span> <span class="k">for</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">at</span> <span class="mi">2017</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">17</span> <span class="mi">11</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">29</span> <span class="o">+</span><span class="mi">0800</span>
</span><span class='line'><span class="no">Processing</span> <span class="n">by</span> <span class="no">PagesController</span><span class="c1">#index as HTML</span>
</span><span class='line'>  <span class="no">Rendering</span> <span class="n">pages</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span> <span class="n">within</span> <span class="n">layouts</span><span class="o">/</span><span class="n">application</span>
</span><span class='line'><span class="o">[</span><span class="no">Webpacker</span><span class="o">]</span> <span class="no">Compiling</span><span class="err">…</span>
</span><span class='line'><span class="o">[</span><span class="no">Webpacker</span><span class="o">]</span> <span class="no">Compiled</span> <span class="n">all</span> <span class="n">packs</span> <span class="k">in</span> <span class="sr">/Users/</span><span class="n">leon</span><span class="o">/</span><span class="no">Code</span><span class="o">/</span><span class="n">practice</span><span class="o">/</span><span class="n">rails5</span><span class="o">/</span><span class="n">myapp</span><span class="o">/</span><span class="kp">public</span><span class="o">/</span><span class="n">packs</span>
</span><span class='line'>  <span class="no">Rendered</span> <span class="n">pages</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">erb</span> <span class="n">within</span> <span class="n">layouts</span><span class="o">/</span><span class="n">application</span> <span class="p">(</span><span class="mi">4828</span><span class="o">.</span><span class="mi">5</span><span class="n">ms</span><span class="p">)</span>
</span><span class='line'><span class="no">Completed</span> <span class="mi">200</span> <span class="no">OK</span> <span class="k">in</span> <span class="mi">6547</span><span class="n">ms</span> <span class="p">(</span><span class="ss">Views</span><span class="p">:</span> <span class="mi">6249</span><span class="o">.</span><span class="mi">7</span><span class="n">ms</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>也可以手動啟動 Webpack Dev Servers</li>
<li>這樣修改 vue 的內容，只要檔案 save 就會自動 Compiling，不需要面重新整理 (vue-hot-reload)</li>
</ul>


<blockquote><p>開兩個 terminal</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 啟動</span>
</span><span class='line'><span class="n">rails</span> <span class="n">s</span>
</span><span class='line'><span class="n">bin</span><span class="o">/</span><span class="n">webpack</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="n">server</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>forman gem</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;foreman&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Procfile</span>
</span><span class='line'><span class="ss">backend</span><span class="p">:</span> <span class="n">bin</span><span class="o">/</span><span class="n">rails</span> <span class="n">s</span> <span class="o">-</span><span class="nb">p</span> <span class="mi">3000</span>
</span><span class='line'><span class="ss">frontend</span><span class="p">:</span> <span class="n">bin</span><span class="o">/</span><span class="n">webpack</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="n">server</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 啟動</span>
</span><span class='line'><span class="n">foreman</span> <span class="n">start</span>
</span></code></pre></td></tr></table></div></figure>


<p>教學文件:</p>

<ul>
<li><a href="http://railsbook.tw/table-of-content">為你自己學 Ruby on Rails</a></li>
<li><a href="https://railstutorial-china.org/book/">Ruby on Rails 課程</a></li>
</ul>


<p>參考文件:</p>

<ul>
<li><a href="http://mgleon08.github.io/blog/2016/11/29/front-end-tools">前端工具整理</a></li>
<li><a href="https://medium.com/@hpux/rails-5-1-loves-javascript-a1d84d5318b">Rails 5.1 loves Javascript</a></li>
<li><a href="https://mkdev.me/en/posts/rails-5-vue-js-how-to-stop-worrying-and-love-the-frontend">Rails 5 &amp; Vue.js: how to stop worrying and love the frontend</a></li>
<li><a href="https://ruby-china.org/topics/32904">Rails 5.1 使用 yarn 和 webpack 實戰 (vue, 建構等)</a></li>
</ul>


<p>webpack</p>

<ul>
<li><a href="https://github.com/rails/webpacker">webpack gem</a></li>
<li><a href="https://webpack.github.io/docs/webpack-dev-server.html">webpack-dev-server</a></li>
<li><a href="https://gorails.com/episodes/using-webpack-in-rails-with-webpacker-gem">Using Webpack gem in rails (video)</a></li>
</ul>


<p>Vue</p>

<ul>
<li><a href="https://gorails.com/episodes/how-to-use-vuejs-and-turbolinks-together">How to use Vue.js and Turbolinks together</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用 Explain 優化 SQL 語句]]></title>
    <link href="http://mgleon08.github.com/blog/2017/09/01/mysql-sql-optimization-with-explain/"/>
    <updated>2017-09-01T14:33:17+08:00</updated>
    <id>http://mgleon08.github.com/blog/2017/09/01/mysql-sql-optimization-with-explain</id>
    <content type="html"><![CDATA[<p>有時候發現 query 速度很慢，但又不知道要怎麼提升的時候，就可以用 explain 的方式，來看看 sql 語法，哪裡可以做優化!</p>

<!-- more -->


<p>當 query 速度很慢時，很多時候可能是少加了 index，但有時又不是能夠這麼快的馬上看出來，這時候就可以將 sql 語法前面加上 <code>explain</code> 來解析</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">explain</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">user</span>
</span></code></pre></td></tr></table></div></figure>


<table>
<thead>
<tr>
<th> id </th>
<th> select_type </th>
<th> table </th>
<th> partitions </th>
<th> type  </th>
<th> possible_keys </th>
<th> key     </th>
<th> key_len </th>
<th> ref  </th>
<th> rows </th>
<th> filtered </th>
<th> Extra       </th>
</tr>
</thead>
<tbody>
<tr>
<td> 1  </td>
<td> SIMPLE      </td>
<td> users </td>
<td> NULL       </td>
<td> range </td>
<td> PRIMARY       </td>
<td> PRIMARY </td>
<td> 4       </td>
<td> NULL </td>
<td> 2148 </td>
<td> 100      </td>
<td> Using where </td>
</tr>
</tbody>
</table>


<ol>
<li>id: 沒有意義</li>
<li>select_type: 查詢類型，是單表查詢、聯合查詢還是子查詢等</li>
<li>table: 查詢的表名</li>
<li>type: 連接使用的類型(重要項) 顯示連接使用的類型,按最 優到最差的類型排序

<ul>
<li>System</li>
<li>const</li>
<li>eq_ref</li>
<li>ref</li>
<li>fulltext</li>
<li>ref_or_null</li>
<li>index_merge</li>
<li>unique_subquery</li>
<li>index_subquery</li>
<li>range</li>
<li>index</li>
<li>ALL</li>
</ul>
</li>
<li>prossible_keys: 能在該表中使用哪些索引有助於查詢</li>
<li>key:實際使用的索引</li>
<li>key_len：索引的長度，在不損失精確性的情況 下,長度越短越好</li>
<li>ref：索引的哪一列被使用了</li>
<li>rows:返回的結果的行數</li>
<li>Extra:其他說明</li>
</ol>


<p>每個欄位詳細的一些 type 可以到參考文件裡的文章去找尋!</p>

<h1>composite index</h1>

<p>另外有時候我們會做 composite index，但其實這種 index 是有順序的!</p>

<p>例如:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">add_index</span> <span class="ss">:lookup</span><span class="p">,</span> <span class="o">[</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">:phone</span><span class="o">]</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s2">&quot;lookup_index&quot;</span><span class="p">,</span> <span class="ss">unique</span><span class="p">:</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>當在 <code>where</code> 的時候，就必須有順序 <code>name</code> <code>email</code> <code>phone</code> 這個 <code>index</code> 才會有效</p>

<p>ex:</p>

<ul>
<li><code>name</code></li>
<li><code>name</code> <code>email</code></li>
<li><code>name</code> <code>email</code> <code>phone</code></li>
<li><code>name</code> <code>phone</code></li>
</ul>


<p><code>where</code> 的時候不管順序，只要有對應到就可以</p>

<p>像是 <code>email</code> or <code>phone</code> or <code>email</code> + <code>phone</code> 就不會用到這個 index</p>

<p>參考文件:</p>

<ul>
<li><a href="http://www.shixinke.com/mysql/mysql-sql-optimization-with-using-explain-and-show-profile">使用explain和show profile來分析SQL語句實現優化SQL語句</a></li>
<li><a href="http://blog.kejyun.com/2012/12/Using-EXPLAIN-SQL-To-Analysis-Efficient-On-MySQL.html">在MySQL使用Explain做SQL SELECT語法效能測試</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Capistrano 自動化部署設定]]></title>
    <link href="http://mgleon08.github.com/blog/2017/03/30/capistrano/"/>
    <updated>2017-03-30T12:51:42+08:00</updated>
    <id>http://mgleon08.github.com/blog/2017/03/30/capistrano</id>
    <content type="html"><![CDATA[<p>用 Capistrano 做自動化部署</p>

<!-- more -->


<p>記得先把 server 相關的設定都設定好。
還有 SSH 相關的可以參考</p>

<ul>
<li><a href="http://mgleon08.github.io/blog/2015/12/14/ssh-no-password/">遠端 SSH 免密碼登入(key)設定</a></li>
</ul>


<h3>Gemfile</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;capistrano&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;capistrano-rails&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;capistrano-bundler&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;capistrano-rbenv&#39;</span> <span class="c1"># 如果是用 rbenv 做 ruby 版控才需要</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Generate Capistrano Config Files</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 若是要不同的名稱可以加上 STAGES=sandbox,staging</span>
</span><span class='line'><span class="c1"># 預設為 production &amp; staging</span>
</span><span class='line'><span class="n">cap</span> <span class="n">install</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Capfile</span>
</span><span class='line'><span class="c1"># config/deploy.rb</span>
</span><span class='line'><span class="c1"># config/deploy/&lt;stage_name&gt;.rb</span>
</span></code></pre></td></tr></table></div></figure>


<h3>deploy.rb 設定檔</h3>

<p>可以將共用的設定放在 <code>config/deploy.rb</code> 其他個別環境的就放在 <code>config/deploy/production.rb</code> <code>config/deploy/staging.rb</code>
等等</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/deploy.rb</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># lock Capistrano Version</span>
</span><span class='line'><span class="n">lock</span> <span class="s1">&#39;3.6.1&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># application name</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:application</span><span class="p">,</span> <span class="s1">&#39;my_app_name&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># which repo to pull from when deploying</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:repo_url</span><span class="p">,</span> <span class="s1">&#39;git@example.com:me/my_repo.git&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># ask which brnach to pull from when deploying</span>
</span><span class='line'><span class="c1"># Default branch is :master</span>
</span><span class='line'><span class="n">ask</span> <span class="ss">:branch</span><span class="p">,</span> <span class="sb">`git rev-parse --abbrev-ref HEAD`</span><span class="o">.</span><span class="n">chomp</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># location to put your app on server</span>
</span><span class='line'><span class="c1"># Default deploy_to directory is /var/www/my_app_name</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:deploy_to</span><span class="p">,</span> <span class="s1">&#39;/home/deploy/my_app_name&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># rbenv settings, version and path</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:rbenv_ruby</span><span class="p">,</span> <span class="s1">&#39;2.2.3&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># these files will be symlinked to APP_PATH/shared/</span>
</span><span class='line'><span class="c1"># Default value for :linked_files is []</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:linked_files</span><span class="p">,</span> <span class="sx">%w(config/database.yml config/secrets.yml)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># these directories will be symlinked to APP_PATH/shared/</span>
</span><span class='line'><span class="c1"># Default value for linked_dirs is []</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:linked_dirs</span><span class="p">,</span> <span class="sx">%w(log tmp/pids tmp/cache tmp/sockets public/system)</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># setting $PATH</span>
</span><span class='line'><span class="c1"># Default value for default_env is {}</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:default_env</span><span class="p">,</span> <span class="p">{</span> <span class="ss">path</span><span class="p">:</span> <span class="s2">&quot;/opt/ruby/bin:$PATH&quot;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># how many releases you want to keep on server</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:keep_releases</span><span class="p">,</span> <span class="mi">3</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 也可以在這裡設定一些 hook</span>
</span><span class='line'><span class="c1"># 範例</span>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:deploy</span> <span class="k">do</span>
</span><span class='line'> <span class="n">desc</span> <span class="s2">&quot;Run custom task&quot;</span>
</span><span class='line'>  <span class="n">after</span> <span class="ss">:published</span><span class="p">,</span> <span class="ss">:task</span> <span class="k">do</span> <span class="c1"># 在什麼 flow 之後</span>
</span><span class='line'>    <span class="n">on</span> <span class="n">release_roles</span> <span class="ss">:all</span> <span class="k">do</span> <span class="c1"># 可以執行的主機權限</span>
</span><span class='line'>      <span class="n">within</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span> <span class="c1"># 在 current 目錄底下</span>
</span><span class='line'>        <span class="n">with</span> <span class="ss">rails_env</span><span class="p">:</span> <span class="ss">:staging</span> <span class="k">do</span> <span class="c1"># 在 staging 環境</span>
</span><span class='line'>          <span class="n">execute</span> <span class="ss">:rake</span><span class="p">,</span> <span class="s2">&quot;task_run&quot;</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/deploy/production.rb</span>
</span><span class='line'><span class="c1"># 用來設定連哪台 server, user 是誰, 該主機有什麼權限</span>
</span><span class='line'><span class="c1"># db: 處理 db 相關，像是跑 migrate, web: 跑 asset:precompile</span>
</span><span class='line'><span class="n">server</span> <span class="s1">&#39;example.com&#39;</span><span class="p">,</span> <span class="ss">user</span><span class="p">:</span> <span class="s1">&#39;deploy&#39;</span><span class="p">,</span> <span class="ss">roles</span><span class="p">:</span> <span class="sx">%w{app db web}</span><span class="p">,</span> <span class="ss">my_property</span><span class="p">:</span> <span class="ss">:my_value</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Capfile 設定檔</h3>

<p>require 需要的檔案</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Capfile</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Load DSL and set up stages</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;capistrano/setup&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Include default deployment tasks</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;capistrano/deploy&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Include tasks from other gems included in your Gemfile</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># For documentation on these, see for example:</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1">#   https://github.com/capistrano/rvm</span>
</span><span class='line'><span class="c1">#   https://github.com/capistrano/rbenv</span>
</span><span class='line'><span class="c1">#   https://github.com/capistrano/chruby</span>
</span><span class='line'><span class="c1">#   https://github.com/capistrano/bundler</span>
</span><span class='line'><span class="c1">#   https://github.com/capistrano/rails</span>
</span><span class='line'><span class="c1">#   https://github.com/capistrano/passenger</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># require &#39;capistrano/rvm&#39;</span>
</span><span class='line'><span class="c1"># require &#39;capistrano/rbenv&#39;</span>
</span><span class='line'><span class="c1"># require &#39;capistrano/chruby&#39;</span>
</span><span class='line'><span class="c1"># require &#39;capistrano/bundler&#39;</span>
</span><span class='line'><span class="c1"># require &#39;capistrano/rails/assets&#39;</span>
</span><span class='line'><span class="c1"># require &#39;capistrano/rails/migrations&#39;</span>
</span><span class='line'><span class="c1"># require &#39;capistrano/passenger&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Load custom tasks from `lib/capistrano/tasks` if you have any defined</span>
</span><span class='line'><span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;lib/capistrano/tasks/*.rake&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span> <span class="n">import</span> <span class="n">r</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>新增environments/staging.rb</h1>

<p>新增 <code>config/environments/staging.rb</code> 環境設定 內容同 <code>config/environments/production.rb</code></p>

<h1>產生 releases &amp; shared 目錄</h1>

<p>本機執行 <code>cap production deploy:check</code>，就會自動登入遠端的伺服器，在登入的帳號下新建releases和shared這兩個目錄</p>

<ul>
<li>releases是每次佈署的檔案目錄</li>
<li>shared目錄則是不同佈署目錄之間會共用的檔案。</li>
</ul>


<p>參考網站：</p>

<ul>
<li><a href="https://github.com/capistrano/capistrano">capistrano</a></li>
<li><a href="http://capistranorb.com/documentation/getting-started/before-after/">capistrano - Before / After Hooks</a></li>
<li><a href="http://capistranorb.com/documentation/getting-started/flow/">capistrano - Flow</a></li>
<li><a href="http://capistranorb.com/documentation/getting-started/configuration/">Capistranorb - configuration</a></li>
<li><a href="http://www.freelancingdigest.com/articles/capistrano-variables/">Capistrano - Variables</a></li>
<li><a href="https://ihower.tw/rails/deployment.html">網站佈署</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Import CSV Into Rails]]></title>
    <link href="http://mgleon08.github.com/blog/2017/02/14/import-csv-into-rails/"/>
    <updated>2017-02-14T17:39:16+08:00</updated>
    <id>http://mgleon08.github.com/blog/2017/02/14/import-csv-into-rails</id>
    <content type="html"><![CDATA[<p>有時候會需要匯入 csv 的檔案, 就可以用 seed 的方式來處理</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#db/seeds/import_csv.rb</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;csv&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">imprt_csv</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/lib/seeds/import.csv&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">CSV</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">csv_text</span><span class="p">,</span> <span class="ss">headers</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">row</span><span class="o">|</span>
</span><span class='line'>  <span class="no">Item</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="n">row</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>檔案可以放在 <code>lib/csv/xx.csv</code></p>

<p>最後用 task 方式去跑 seed 來匯入 <a href="http://mgleon08.github.io/blog/2016/07/04/custom-seed-file/">Custom Seed File</a></p>

<p>參考文件：</p>

<ul>
<li><a href="https://www.mattboldt.com/importing-massive-data-into-rails/">Importing Massive CSV Data Into Rails</a></li>
<li><a href="http://stackoverflow.com/questions/4410794/ruby-on-rails-import-data-from-a-csv-file">Ruby on Rails - Import Data from a CSV file</a></li>
<li><a href="https://gist.github.com/arjunvenkat/1115bc41bf395a162084">How to seed a Rails database with a CSV file</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Vue]]></title>
    <link href="http://mgleon08.github.com/blog/2016/12/19/vue/"/>
    <updated>2016-12-19T21:20:49+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/12/19/vue</id>
    <content type="html"><![CDATA[<p>剛好最近在玩 vue 就來記錄一下</p>

<!-- more -->


<ul>
<li><a href="https://github.com/mgleon08/vue_sample">vue_sample</a></li>
<li><a href="https://github.com/mgleon08/vue_practice">vue_practice</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="https://cn.vuejs.org/">vue</a></li>
<li><a href="https://vuex.vuejs.org/zh-cn/">Vuex</a></li>
<li><a href="http://router.vuejs.org/zh-cn/">vue-router 2</a></li>
<li><a href="https://segmentfault.com/a/1190000005363030#articleHeader0">vue + webpack 起手式</a></li>
<li><a href="http://www.qinshenxue.com/article/20161106163608.html">vue2 vue-router2 webpack</a></li>
<li><a href="https://segmentfault.com/a/1190000005015164">用 Vuex 建構一個筆記應用</a></li>
<li><a href="https://laracasts.com/series/learn-vue-2-step-by-step">Learn Vue 2: Step By Step</a></li>
</ul>


<p>Javascript：</p>

<ul>
<li><a href="http://es6.ruanyifeng.com/">ECMAScript 6 入門</a></li>
<li><a href="http://javascript.ruanyifeng.com/#toc0">JavaScript 標準參考課程</a></li>
<li><a href="https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/">從ES6開始的JavaScript學習生活</a></li>
<li><a href="http://liubin.org/promises-book/#introduction">JavaScript Promise迷你書（中文版）</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails With GraphQL API]]></title>
    <link href="http://mgleon08.github.com/blog/2016/12/16/graphql/"/>
    <updated>2016-12-16T17:31:16+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/12/16/graphql</id>
    <content type="html"><![CDATA[<p>GraphQL 是 facebook 所開放的查詢語言</p>

<!-- more -->


<blockquote><p>GraphQl is a query language for your API</p></blockquote>

<ul>
<li>GraphQL 是 facebook 所開放的查詢語言，可以透過定義的schema系統將複雜的邏輯拆分成細粒度的資料結構，讓前端能夠透過GraphQL提供的類型查詢系統，自由定製請求數據的能力。</li>
<li>GraphQL 本身適合對數據力度小，需求變更頻繁的場景，與 RESTful 相反</li>
</ul>


<h3>GraphQL Look Like</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">user</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">id</span><span class="p">,</span>
</span><span class='line'>    <span class="nb">name</span><span class="p">,</span>
</span><span class='line'>    <span class="n">friends</span> <span class="p">{</span>
</span><span class='line'>      <span class="nb">name</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Response</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;user&quot;</span> <span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Marc-Andre Giroux&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;friends&quot;</span><span class="p">:</span> <span class="o">[</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Joe Bro&quot;</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Johny Yolo&quot;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="o">]</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Rails with GraphQL API</h1>

<p><a href="https://github.com/rmosolgo/graphql-ruby">graphql-ruby</a></p>

<p>主要有五個步驟</p>

<ul>
<li>新增 ruby gem <a href="https://github.com/rmosolgo/graphql-ruby">graphql-ruby</a></li>
<li>Declare Query Type</li>
<li>Build a Schema</li>
<li>Add GraphQL end_point</li>
</ul>


<h3>Ruby gem</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;graphql&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">bundle</span> <span class="n">install</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Declare Query Type</h3>

<p>All Types (<code>!</code> marks a field as &ldquo;non-null&rdquo;)</p>

<ul>
<li>string</li>
<li>int</li>
<li>float</li>
<li>boolean</li>
<li>ID</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/graph/types/post_type.rb</span>
</span><span class='line'><span class="no">PostType</span> <span class="o">=</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Post&quot;</span>
</span><span class='line'>  <span class="n">description</span> <span class="s2">&quot;A blog post&quot;</span>
</span><span class='line'>  <span class="c1"># `!` marks a field as &quot;non-null&quot;</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:title</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:body</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:comments</span><span class="p">,</span> <span class="n">types</span><span class="o">[!</span><span class="no">CommentType</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/graph/types/comment_type.rb</span>
</span><span class='line'><span class="no">CommentType</span> <span class="o">=</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Comment&quot;</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:id</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:body</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:created_at</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">String</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make sure you add this line to your application.rb for rails to autoload the types</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#config/application.rb</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">&lt;&lt;</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="s1">&#39;graph&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">&lt;&lt;</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="s1">&#39;graph&#39;</span><span class="p">,</span> <span class="s1">&#39;types&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Build a Schema</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#app/graph/types/query_type.rb</span>
</span><span class='line'><span class="c1">#query root</span>
</span><span class='line'>
</span><span class='line'><span class="no">QueryType</span> <span class="o">=</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">ObjectType</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="nb">name</span> <span class="s2">&quot;Query&quot;</span>
</span><span class='line'>  <span class="n">description</span> <span class="s2">&quot;The query root of this schema&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:post</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">type</span> <span class="no">PostType</span>
</span><span class='line'>    <span class="n">argument</span> <span class="ss">:id</span><span class="p">,</span> <span class="o">!</span><span class="n">types</span><span class="o">.</span><span class="n">ID</span> <span class="c1">#argument 可以根據哪些欄位去查詢</span>
</span><span class='line'>    <span class="n">description</span> <span class="s2">&quot;Find a Post by ID&quot;</span>
</span><span class='line'>    <span class="n">resolve</span> <span class="o">-&gt;</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="s2">&quot;id&quot;</span><span class="o">]</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/graph/schema.rb</span>
</span><span class='line'><span class="no">Schema</span> <span class="o">=</span> <span class="no">GraphQL</span><span class="o">::</span><span class="no">Schema</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">query</span> <span class="no">QueryType</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Router</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#config/routes.rb</span>
</span><span class='line'><span class="n">resources</span> <span class="ss">:queries</span><span class="p">,</span> <span class="ss">via</span><span class="p">:</span> <span class="o">[</span><span class="ss">:post</span><span class="p">,</span> <span class="ss">:options</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/controller/queries_controller.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">QueriesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="n">query_string</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:query</span><span class="o">]</span>
</span><span class='line'>    <span class="n">query_variables</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:variables</span><span class="o">]</span> <span class="o">||</span> <span class="p">{}</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="no">BlogSchema</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query_string</span><span class="p">,</span> <span class="ss">variables</span><span class="p">:</span> <span class="n">query_variables</span><span class="p">)</span>
</span><span class='line'>    <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="n">result</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Execute queries</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">curl</span> <span class="o">-</span><span class="no">XPOST</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;query={ blog(id: 1) { title content }}&#39;</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="ss">localhost</span><span class="p">:</span><span class="mi">3000</span><span class="o">/</span><span class="n">queries</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://graphql.org/">graphql.org</a></li>
<li><a href="http://graphql-swapi.parseapp.com/">GraphiQL</a></li>
<li><a href="https://github.com/rmosolgo/graphql-ruby">graphql-ruby gem</a></li>
<li><a href="https://www.youtube.com/watch?v=tmy4oZ_sVmk">15 - 夏俊晨 - GraphQL on Rails (video)</a></li>
<li><a href="https://speakerdeck.com/onlimii/graphql-on-rails">GraphQL on Rails</a></li>
<li><a href="http://mgiroux.me/2015/getting-started-with-rails-graphql-relay/">Getting started with Rails and GraphQL</a></li>
<li><a href="http://www.jianshu.com/p/4355bd92c216">GraphQL on Rails(一) GraphQL介紹</a></li>
<li><a href="http://www.jianshu.com/p/f7e435a17960">GraphQL on Rails(二) GraphQL介紹</a></li>
<li><a href="http://www.jianshu.com/p/f9f20602af5a">GraphQL on Rails(三) GraphQL介紹</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[前端工具整理]]></title>
    <link href="http://mgleon08.github.com/blog/2016/11/29/front-end-tools/"/>
    <updated>2016-11-29T11:32:26+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/11/29/front-end-tools</id>
    <content type="html"><![CDATA[<p>前端工具，名詞實在太多了，這篇就來簡單記錄一下!</p>

<!-- more -->


<ul>
<li><a href="#nvm">NVM</a></li>
<li><a href="#npm">NPM</a></li>
<li><a href="#yarn">YARN</a></li>
<li><a href="#bower">Bower</a></li>
<li><a href="#grunt">Grunt</a></li>
<li><a href="#gulp">Gulp</a></li>
<li><a href="#yeoman">Yeoman</a></li>
<li><a href="#browserify">Browserify</a></li>
<li><a href="#webpack">Webpack</a></li>
<li><a href="#babel">Babel</a></li>
</ul>


<h1><span id="nvm">NVM</span></h1>

<blockquote><p>管理 npm 工具，類似 rvm</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#根據當下最新版本</span>
</span><span class='line'><span class="n">curl</span> <span class="o">-</span><span class="n">o</span><span class="o">-</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">creationix</span><span class="o">/</span><span class="n">nvm</span><span class="o">/</span><span class="n">v0</span><span class="o">.</span><span class="mi">31</span><span class="o">.</span><span class="mi">4</span><span class="o">/</span><span class="n">install</span><span class="o">.</span><span class="n">sh</span> <span class="o">|</span> <span class="n">bash</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#將以下放到自己的 ~/.zshrc or ~/.bashrc or .bash_profile 下面（預設會自動放好，但還是去確定一下）</span>
</span><span class='line'><span class="n">export</span> <span class="no">NVM_DIR</span><span class="o">=</span><span class="s2">&quot;/Users/leon/.nvm&quot;</span>
</span><span class='line'><span class="o">[</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">.</span> <span class="s2">&quot;$NVM_DIR/nvm.sh&quot;</span>  <span class="c1"># This loads nvm%</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#重新載入 Shell</span>
</span><span class='line'><span class="o">.</span> <span class="o">~</span><span class="sr">/.nvm/n</span><span class="n">vm</span><span class="o">.</span><span class="n">sh</span> <span class="ow">or</span> <span class="n">source</span> <span class="o">~</span><span class="sr">/.zshrc</span>
</span><span class='line'>
</span><span class='line'><span class="sr"># 安裝穩定版本的 NodeJS</span>
</span><span class='line'><span class="sr">nvm install stable </span>
</span><span class='line'>
</span><span class='line'><span class="sr">#顯示目前可以安裝的版本</span>
</span><span class='line'><span class="sr">nvm ls-remote</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#安裝 NodeJS</span>
</span><span class='line'><span class="sr">nvm install &lt;version&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#安裝穩定版本的 NodeJS</span>
</span><span class='line'><span class="sr">nvm install stable </span>
</span><span class='line'><span class="sr"> </span>
</span><span class='line'><span class="sr">#使用版本，只有在當下，重新開新tab就會消失</span>
</span><span class='line'><span class="sr">nvm use stable </span>
</span><span class='line'><span class="sr"> </span>
</span><span class='line'><span class="sr">#設定預設版本，永久</span>
</span><span class='line'><span class="sr">nvm alias default stable</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#看目前安裝所有版本</span>
</span><span class='line'><span class="sr">ls -a ~/</span><span class="o">.</span><span class="n">nvm</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="n">node</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://segmentfault.com/a/1190000004404505">node版本管理工具nvm-Mac下安装及使用</a></li>
<li><a href="https://tenten.co/blog/install-gulp-grunt-bower-sass-susy-on-mac-with-nvm-rvm/">在 Mac 上裝 NVM, RVM 等跑 Gulp, Grunt, Bower 環境</a></li>
<li><a href="http://icarus4.logdown.com/posts/175092-nodejs-installation-guide">Node.js 安裝與版本切換教學 (for MAC)</a></li>
</ul>


<h1><span id="npm">NPM</span></h1>

<blockquote><p>套件管理</p></blockquote>

<p><a href="https://www.npmjs.com/">npm</a></p>

<p>資料夾一定會有 package.json</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#搜尋 npm 套件，但建議去網站上比較快</span>
</span><span class='line'><span class="n">npm</span> <span class="n">search</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#本地安裝，會安裝在當前專案的 node_modules 目錄下</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#全域安裝，會將套件安裝在統一的 npm 目錄底下</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#列出專案使用套件</span>
</span><span class='line'><span class="n">npm</span> <span class="n">ls</span> <span class="p">(</span><span class="o">-</span><span class="n">g</span> <span class="err">全域套件</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#更新專案套件</span>
</span><span class='line'><span class="n">npm</span> <span class="n">update</span> <span class="p">(</span><span class="o">-</span><span class="n">g</span> <span class="err">全域套件</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#移除專案套件</span>
</span><span class='line'><span class="n">npm</span> <span class="n">uninstall</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">-</span><span class="n">g</span> <span class="err">全域套件</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#清快取</span>
</span><span class='line'><span class="n">npm</span> <span class="n">cache</span> <span class="n">clean</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#查詢 npm 儲存路徑</span>
</span><span class='line'><span class="n">npm</span> <span class="n">config</span> <span class="n">get</span> <span class="n">prefix</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#自動安裝 package.json 套件定義檔中定義的所有套件</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#安裝套件並儲存在 package.json 中</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">save</span> <span class="c1">#用於上線時必要的套件(react, bootstrap…)，會更新到package.json裡的Dependencies(上線依賴)</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">package</span> <span class="nb">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span> <span class="c1">#用來安裝開發時用的工具(ex babel, webpack, webpack-dev-server…)，會更新到package.json裡的devDependencies(開發依賴)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>package.json</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#自動產生 package.json</span>
</span><span class='line'><span class="n">npm</span> <span class="n">init</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;leon&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'> <span class="err"> </span> <span class="err"> </span><span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;echo </span><span class="se">\&quot;</span><span class="s2">Error: no test specified</span><span class="se">\&quot;</span><span class="s2"> &amp;&amp; exit 1&quot;</span>
</span><span class='line'> <span class="err"> </span><span class="p">},</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;license&quot;</span><span class="p">:</span> <span class="s2">&quot;ISC&quot;</span><span class="p">,</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;dependencies&quot;</span><span class="p">:{</span><span class="c1">#套件相依</span>
</span><span class='line'> <span class="err"> </span><span class="p">},</span>
</span><span class='line'> <span class="err"> </span><span class="s2">&quot;devDependencies&quot;</span><span class="p">:</span> <span class="p">{</span><span class="c1">#開發套件相依</span>
</span><span class='line'><span class="err">    </span><span class="s2">&quot;lodash&quot;</span><span class="p">:</span> <span class="s2">&quot;^4.15.0&quot;</span> <span class="c1">#示範加上去的</span>
</span><span class='line'> <span class="err"> </span><span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://www.slideshare.net/wantingj/npm-46801372">Npm 套件管理 &amp; 常用開發工具介紹</a></li>
</ul>


<h1><span id="yarn">Yarn</span></h1>

<p>Facebook 開源的 Yarn，這是針對存儲在 npm 或 Bower 註冊表中的 JavaScript 模組的一個代理包管理器。</p>

<ul>
<li><a href="https://yarnpkg.com/">yarn</a></li>
<li><a href="https://github.com/yarnpkg/yarn">yarn github</a></li>
<li><a href="https://github.com/cssmagic/blog/issues/67">[譯] Yarn 官方介紹: 一款新的 JavaScript 包管理器</a></li>
<li><a href="https://sheerdevelopment.com/posts/facebook-js-5">Facebook 新發佈的 Yarn JS 包管理器的 5 大功能</a></li>
</ul>


<h1><span id="bower">Bower</span></h1>

<p><a href="https://bower.io/search/">Bower</a> 由 Twitter 團隊開發的前端套件管理工具，用來管理或安裝 Web 開發所需要的 Package，像是 CSS 和 JavaScript，也可以依據套件的相依性來安裝</p>

<blockquote><p>簡單來說，開發者不用再去煩惱套件相依性問題</p>

<p>主要用來做前端資源依賴管理，跟npm很像，區別在於：npm管理的是node模組的依賴，bower管理的是前端資源的依賴，如css、javascript文件等。</p></blockquote>

<ul>
<li>快速管理與安裝網頁前端套件。</li>
<li>易於檢視專案的套件相依性，僅需檢查 bower.json 即可知道專案使用了哪些套件及版本。</li>
<li>一鍵佈署或更新網站所需要使用的套件。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="n">bower</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 查詢相關指令</span>
</span><span class='line'><span class="n">bower</span> <span class="n">help</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 查詢已經安裝的套件</span>
</span><span class='line'><span class="n">bower</span> <span class="n">list</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 搜尋套件</span>
</span><span class='line'><span class="n">bower</span> <span class="n">search</span> <span class="o">&lt;</span><span class="nb">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 移除已安裝的套件</span>
</span><span class='line'><span class="n">bower</span> <span class="n">uninstall</span> <span class="o">&lt;</span><span class="nb">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 升級已安裝套件</span>
</span><span class='line'><span class="n">bower</span> <span class="n">update</span> <span class="o">&lt;</span><span class="nb">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 顯示該套件的 bower.json</span>
</span><span class='line'><span class="n">bower</span> <span class="n">info</span> <span class="o">&lt;</span><span class="nb">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 透過 bower.json 來安裝相依套件</span>
</span><span class='line'><span class="n">bower</span> <span class="n">install</span>
</span><span class='line'><span class="c1"># registered package</span>
</span><span class='line'><span class="n">bower</span> <span class="n">install</span> <span class="n">jquery</span>
</span><span class='line'><span class="c1"># GitHub shorthand</span>
</span><span class='line'><span class="n">bower</span> <span class="n">install</span> <span class="n">desandro</span><span class="o">/</span><span class="n">masonry</span>
</span><span class='line'><span class="c1"># Git endpoint</span>
</span><span class='line'><span class="n">bower</span> <span class="n">install</span> <span class="ss">git</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">package</span><span class="o">.</span><span class="n">git</span>
</span><span class='line'><span class="c1"># URL</span>
</span><span class='line'><span class="n">bower</span> <span class="n">install</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//ex</span><span class="n">ample</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">script</span><span class="o">.</span><span class="n">js</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://blog.wu-boy.com/2013/01/bower-is-a-package-manager-for-the-web/">Bower 管理網站套件的好工具</a></li>
<li><a href="http://blog.fens.me/nodejs-bower-intro/">bower解決js的依賴管理</a></li>
<li><a href="http://edentsai231.logdown.com/posts/198741-bower-front-end-kit-management-tool">Bower 前端套件管理工具</a></li>
<li><a href="http://wwsun.github.io/posts/bower-post.html">使用Bower進行前端依賴管理</a></li>
</ul>


<h1><span id="grunt">Grunt</span></h1>

<p>The JavaScript Task Runner，可以透過一些設定讓你輕鬆完成一些例行性的任務，例如壓縮檔案，編譯 coffee less，搬移到目標目錄，單元測試等等。(類似 Ruby 中的 rake)</p>

<blockquote><p>建構工具，主要用來運行各種任務，比如文件壓縮、合併、打包等</p></blockquote>

<p>在新專案使用Grunt，必須要先有兩個檔案</p>

<ul>
<li>package.json</li>
<li>Gruntfile</li>
</ul>


<p>在package.json中，Grunt 和Grunt 任務會用的到外掛，都會列在devDependencies 中。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="n">grunt</span><span class="o">-</span><span class="n">cli</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 查詢相關指令</span>
</span><span class='line'><span class="n">grunt</span> <span class="o">--</span><span class="n">help</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://gruntjs.com/">Grunt</a></li>
<li><a href="http://blog.fens.me/nodejs-grunt-intro/">grunt讓Nodejs規範起來</a></li>
<li><a href="http://yujiangshui.com/grunt-basic-tutorial/">Grunt 新手一日入門</a></li>
<li><a href="http://andyyou.logdown.com/posts/141718-grunt">Grunt 系列1 基礎教學</a></li>
<li><a href="http://andyyou.logdown.com/posts/142728-grunt-set-2">Grunt 系列2 設定</a></li>
<li><a href="http://andyyou.logdown.com/posts/143296-grunt-series-3-example-implementations">Grunt 系列3 範例實作</a></li>
</ul>


<h1><span id="gulp">Gulp</span></h1>

<p>跟 grunt 做的事一樣，但是效能比較好</p>

<ul>
<li>程式碼撰寫風格檢查、程式碼品質分析</li>
<li>最小化(Minification)、醜化(Uglify)</li>
<li>合併檔案 (Concatenation)</li>
<li>套用格式轉換 (Less, Sass, TypeScript, Babel, &hellip; ) • 套用 Vendor prefixes</li>
<li>自動注入 JS/CSS 引用到 HTML 之中 • 更新套件版本</li>
<li>快取HTML範本</li>
<li>單元測試、整合測試、連續性整合</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="n">gulp</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
</span></code></pre></td></tr></table></div></figure>


<p>主要是寫在 <code>gulpfile.js</code></p>

<ul>
<li><a href="http://gulpjs.com/">Gulp</a></li>
<li><a href="http://fireqqtw.logdown.com/posts/249086-good-helper-of-gulp-automation">Gulp-自動化的好幫手</a></li>
<li><a href="https://kejyuntw.gitbooks.io/gulp-learning-notes/content/">gulp 學習筆記</a></li>
<li><a href="https://github.com/nimojs/gulp-book">gulp 入門指南</a></li>
</ul>


<h1><span id="yeoman">yeoman</span></h1>

<p>用來自動產生網站骨架或程式碼的工具</p>

<p>包含以下三套工具，分別說明如下：</p>

<ul>
<li>yo - scaffolding tool from Yeoman 用來自動產生網站骨架或程式碼的工具</li>
<li>bower - 用來管理特定網站下所使用的各式前端套件，如: jQuery</li>
<li>grunt - 用來執行一些網站的自動化工作，例如單元測試、最小化、執行批次命令</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="n">yo</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://blog.fens.me/nodejs-yeoman-intro/">Yeoman自動建構js項目</a></p>

<h3>以上比較</h3>

<ul>
<li><p>bower - 用來做前端資源依賴管理，跟npm很像，區別在於</p>

<ul>
<li>npm管理的是node模組的依賴</li>
<li>bower管理的是前端資源的依賴，如css、javascript文件等，之後就不需要手動下載和管理你的腳本文件。</li>
</ul>
</li>
<li><p>grunt/gulp - 一個幫助我們自動管理和運行JavaScript的任務之執行工具，可以用了檢查程式碼語法是否正確，壓縮程式碼，合併文件，透過Grunt可以簡化我們的工作流程。</p></li>
<li><p>Yeoman - 一個 Web 應用的架構（scaffolding）工具。它提供了非常多的樣板，用來生成不同類型的 Web 應用。這些樣板稱為生成器（generator）。</p></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="http://blog.fens.me/series-nodejs/">從零開始nodejs系列文章</a></li>
<li><a href="http://www.ifeenan.com/javascript/2014-08-05-%E6%AF%94%E8%BE%83Grunt,NPM,Gulp/">比較grunt,npm,gulp</a></li>
<li><a href="http://jser.me/2014/03/11/%E9%80%9A%E8%BF%87%E4%BE%8B%E5%AD%90%E5%AF%B9%E6%AF%94grunt%E5%92%8Cgulp.html">透過例子對比grunt和gulp</a></li>
<li><a href="https://segmentfault.com/a/1190000000349384">30 天學習 30 種新技術系列</a></li>
</ul>


<h1><span id="browserify">Browserify</span></h1>

<p>允許用 nodejs 的程式碼風格來定義模組，並使用在瀏覽器上，可以完全跟nodejs後端模組通用,保持單個功能模組的重用性.</p>

<ul>
<li><code>module.exports</code> 來匯出模組功能</li>
<li><code>require</code> 來請求某個模組</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="n">browserify</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="http://browserify.org/">browserify</a></li>
<li><a href="http://zhaoda.net/2015/10/16/browserify-guide/">Browserify 使用指南</a></li>
<li><a href="http://agigi.logdown.com/note/153897-browserify-of-node-js">Node.js的browserify</a></li>
<li><a href="http://www.ifeenan.com/javascript/2014-08-20-%E5%88%A9%E7%94%A8Browserify%E5%92%8CGulp%E6%9D%A5%E6%9E%84%E5%BB%BAReact%E5%BA%94%E7%94%A8/">利用browserify和gulp來建構react應用 </a></li>
</ul>


<h1><span id="webpack">Webpack</span></h1>

<p>Webpack是所謂的模組打包工具，它可以幫你把各種文件(JS、JSX、coffee、less/sass…、圖片）打包成一系列的靜態資源來使用。</p>

<ul>
<li>將你的 js 檔案 Bundle 變成單一的檔案</li>
<li>在你的前端程式碼中使用 npm packages</li>
<li>撰寫 JavaScript ES6 或 ES7（需要透過 babel 來幫助）</li>
<li>Minify 或優化程式碼</li>
<li>將 LESS 或 SCSS 轉換成 CSS</li>
<li>使用 HMR（Hot Module Replacement）</li>
<li>包含任何類型的檔案到你的 JavaScript</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="n">webpack</span>
</span><span class='line'><span class="n">npm</span> <span class="n">install</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span> <span class="n">webpack</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 每次 build 的時候查看改變的檔案</span>
</span><span class='line'><span class="n">webpack</span> <span class="o">--</span><span class="n">watch</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 使用自訂的 webpack 設定檔</span>
</span><span class='line'><span class="n">webpack</span> <span class="o">--</span><span class="n">config</span> <span class="n">myconfig</span><span class="o">.</span><span class="n">js</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><a href="https://webpack.js.org/">webpack</a></li>
<li><a href="https://neighborhood999.github.io/webpack-tutorial-gitbook/">Webpack Tutorial 繁體中文 Gitbook</a></li>
<li><a href="http://blog.elaine.me/articles/React-webpack/">Webpack React 入門筆記</a></li>
<li><a href="http://blog.kkbruce.net/2015/10/webpack.html#.WCqPgeF97Vo">WEBPACK入門教學筆記</a></li>
<li><a href="http://skychang.github.io/2015/08/26/Webpack-First/">Webpack - 使用 Webpack</a></li>
<li><a href="https://medium.com/html-test/%E5%BE%9E%E7%84%A1%E5%88%B0%E6%9C%89%E5%BB%BA%E7%AB%8B-webpack-%E8%A8%AD%E5%AE%9A%E6%AA%94-%E4%B8%80-42fbc76a2d37#.9kszblege">從無到有建立 webpack 設定檔（一）</a></li>
<li><a href="https://medium.com/html-test/%E5%BE%9E%E7%84%A1%E5%88%B0%E6%9C%89%E5%BB%BA%E7%AB%8B-webpack-%E8%A8%AD%E5%AE%9A%E6%AA%94-%E4%BA%8C-%E8%A8%AD%E5%AE%9A%E6%A8%A3%E5%BC%8F-61c210d63411#.d0yrggih7">從無到有建立 webpack 設定檔（二）設定樣式</a></li>
<li><a href="https://medium.com/html-test/%E5%BE%9E%E7%84%A1%E5%88%B0%E6%9C%89%E5%BB%BA%E7%AB%8B-webpack-%E8%A8%AD%E5%AE%9A%E6%AA%94-%E4%B8%89-%E9%80%B2%E9%9A%8E%E8%A8%AD%E5%AE%9A-d3d7583e61cf#.tdqkx4xlp">從無到有建立 webpack 設定檔（三）進階設定</a></li>
<li><a href="https://medium.com/html-test/webpack-%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B-585f2bc952b9#.ipr7ygu7m">【webpack】的基本工作流程</a></li>
<li><a href="http://blog.hugzh.com/2016/05/02/webpack%E5%AD%A6%E4%B9%A0%E5%AE%9E%E8%B7%B5%E7%B3%BB%E5%88%97-%E4%B8%80/">Webpack學習實踐系列(一)</a></li>
<li><a href="https://rhadow.github.io/2015/03/23/webpackIntro/">如何使用 Webpack 模組整合工具</a></li>
<li><a href="https://rhadow.github.io/2015/05/30/webpack-loaders-and-plugins/">深入瞭解 Webpack Plugins</a></li>
<li><a href="https://roy-huang.com/category/webpack/">webpack tutorial</a></li>
<li><a href="https://llp0574.github.io/2016/11/29/getting-started-with-webpack2/">Webpack 2 入門課程</a></li>
</ul>


<h1><span id="babel">Babel</span></h1>

<p>Babel是一個廣泛使用的轉碼器，可以將ES6程式碼轉為ES5程式碼，從而在現有環境執行。</p>

<ul>
<li><a href="http://www.ruanyifeng.com/blog/2016/01/babel.html">Babel 入門課程</a></li>
<li><a href="http://code.kpman.cc/2016/09/13/babel-%E7%9B%B8%E9%97%9C%E5%90%8D%E8%A9%9E%E7%B0%A1%E4%BB%8B/">babel 相關名詞簡介</a></li>
</ul>


<p>其他參考資料</p>

<ul>
<li><a href="http://www.yidianzixun.com/article/0EmFXyTl">終於弄懂了各種前端build工具</a></li>
<li><a href="http://blog.kdchang.cc/2016/11/05/how-to-establish-modern-front-end-development-environment-tutorial/">一看就懂的前端開發環境建置入門教學</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rake Db Tasks 指令]]></title>
    <link href="http://mgleon08.github.com/blog/2016/11/28/rake-db-tasks/"/>
    <updated>2016-11-28T15:04:17+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/11/28/rake-db-tasks</id>
    <content type="html"><![CDATA[<p>用來記錄一下 rake db 指令</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 建立 database</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">create</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 刪除整個 database</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">drop</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 查看所有 migration 的狀態 (up 已執行過，down 尚未執行。)</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">migrate</span><span class="p">:</span><span class="n">status</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 還原已跑最新的 migration</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">rollback</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 還原已跑最新三個的 migration</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">rollback</span> <span class="no">STEP</span><span class="o">=</span><span class="mi">3</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 還原指定已跑的 migration</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">migrate</span><span class="p">:</span><span class="n">down</span> <span class="no">VERSION</span><span class="o">=</span><span class="mi">20100905201547</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 重跑目前最新的 migration</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">migrate</span><span class="p">:</span><span class="k">redo</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 重跑目前最新的三個 migration</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">migrate</span><span class="p">:</span><span class="k">redo</span> <span class="no">STEP</span><span class="o">=</span><span class="mi">3</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 執行 db/migrate 中還沒跑過的 migrations</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 針對設定的 migrations 版本執行</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">migrate</span> <span class="no">VERSION</span><span class="o">=</span><span class="mi">12341234</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 初始化空的資料庫</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">scheme</span><span class="p">:</span><span class="nb">load</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 更新測試資料庫的 schema</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="nb">test</span><span class="ss">:prepare</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 從目前 database 中實際的 schema 建立 db/schema.rb</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">schema</span><span class="p">:</span><span class="n">dump</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 從 db/schema.rb 中把 schema 建立到 databse 中</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="ss">schema</span><span class="p">:</span><span class="nb">load</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># does db:create, db:schema:load, db:seed</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">setup</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># does db:drop, db:create, db:schema:load</span>
</span><span class='line'><span class="n">rake</span> <span class="ss">db</span><span class="p">:</span><span class="n">reset</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># clean assets</span>
</span><span class='line'><span class="no">RAILS_ENV</span><span class="o">=</span><span class="n">production</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">assets</span><span class="p">:</span><span class="n">clean</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># assets precompile</span>
</span><span class='line'><span class="no">RAILS_ENV</span><span class="o">=</span><span class="n">production</span> <span class="n">bundle</span> <span class="nb">exec</span> <span class="n">rake</span> <span class="ss">assets</span><span class="p">:</span><span class="n">precompile</span>
</span></code></pre></td></tr></table></div></figure>


<p>相關 gem</p>

<ul>
<li><a href="https://github.com/rroblak/seed_dump">seed_dump</a></li>
<li><a href="https://github.com/yamldb/yaml_db">yaml_db</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Docker 簡單介紹]]></title>
    <link href="http://mgleon08.github.com/blog/2016/11/25/docker/"/>
    <updated>2016-11-25T16:28:35+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/11/25/docker</id>
    <content type="html"><![CDATA[<p>docker 讓應用程式佈署在軟體容器下的工作可以自動化進行，藉此在Linux作業系統上，提供一個額外的軟體抽象層，以及作業系統層虛擬化的自動管理機制。</p>

<!-- more -->


<p>Docker 的優點</p>

<ul>
<li>秒級實作</li>
<li>對系統資源的使用率很高，一台主機可以同時執行數千個 Docker 容器</li>
<li>更快速的交付和部署

<ul>
<li>使用一個標準的映像檔來建立一套開發容器，開發完成之後，維運人員可以直接使用這個容器來部署程式碼。</li>
</ul>
</li>
<li>更有效率的虛擬化

<ul>
<li>不需額外的虛擬化支援，它是核心層級的虛擬化</li>
</ul>
</li>
<li>更輕鬆的遷移和擴展

<ul>
<li>Docker 容器幾乎可以在任意的平台上執行</li>
</ul>
</li>
<li>更簡單的管理</li>
</ul>


<p>Docker vs VM</p>

<ul>
<li>Docker 僅載入所需要的函式庫與執行檔，而不像VM需要安裝大容量的作業系統</li>
<li>VM是用硬體端的hypervisor技術來同時執行多個虛擬主機，一般可預見需要大量的運行資源。Docker則是用軟體端的作業系統來實現虛擬分割的技術，由於僅載入核心的函式庫</li>
</ul>


<h3>Basic</h3>

<ul>
<li><a href="https://docs.docker.com/engine/reference/commandline/docker/">base command</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/ps/#description">ps</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/container/">container</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/image/">image</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/images/">images</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 查看版本</span>
</span><span class='line'><span class="n">docker</span> <span class="o">--</span><span class="n">version</span>
</span><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">--</span><span class="n">version</span>
</span><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="o">--</span><span class="n">version</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 從 hub 取得所需要的 images :後面為版本號，若沒加則會拉最新的</span>
</span><span class='line'><span class="n">docker</span> <span class="n">pull</span> <span class="ss">ubuntu</span><span class="p">:</span><span class="mi">12</span><span class="o">.</span><span class="mo">04</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 搜尋官方的 Image</span>
</span><span class='line'><span class="n">docker</span> <span class="n">search</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># container (有些 container 可改 ps)</span>
</span><span class='line'><span class="n">docker</span> <span class="n">container</span> <span class="n">ls</span>                              <span class="c1"># List all running containers</span>
</span><span class='line'><span class="n">docker</span> <span class="n">container</span> <span class="n">ls</span> <span class="o">-</span><span class="n">a</span>                           <span class="c1"># List all containers, even those not running</span>
</span><span class='line'><span class="n">docker</span> <span class="n">container</span> <span class="n">stop</span> <span class="o">&lt;</span><span class="n">containerID</span><span class="o">&gt;</span>              <span class="c1"># Gracefully stop the specified container</span>
</span><span class='line'><span class="n">docker</span> <span class="n">container</span> <span class="n">kill</span> <span class="o">&lt;</span><span class="n">containerID</span><span class="o">&gt;</span>              <span class="c1"># Force shutdown of the specified container</span>
</span><span class='line'><span class="n">docker</span> <span class="n">container</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">containerID</span><span class="o">&gt;</span>                <span class="c1"># Remove specified container from this machine</span>
</span><span class='line'><span class="n">docker</span> <span class="n">container</span> <span class="n">rm</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">container</span> <span class="n">ls</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="c1"># Remove all containers</span>
</span><span class='line'><span class="n">docker</span> <span class="n">start</span> <span class="o">&lt;</span><span class="n">containerID</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">docker</span> <span class="n">stop</span> <span class="o">&lt;</span><span class="n">containerID</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># images</span>
</span><span class='line'><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span> <span class="o">-</span><span class="n">a</span>                       <span class="c1"># List all images on this machine</span>
</span><span class='line'><span class="n">docker</span> <span class="n">image</span> <span class="n">rm</span> <span class="o">&lt;</span><span class="n">image</span> <span class="nb">id</span><span class="o">&gt;</span>               <span class="c1"># Remove specified image from this machine</span>
</span><span class='line'><span class="n">docker</span> <span class="n">image</span> <span class="n">rm</span> <span class="err">$</span><span class="p">(</span><span class="n">docker</span> <span class="n">image</span> <span class="n">ls</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="c1"># Remove all images from this machine</span>
</span><span class='line'><span class="n">docker</span> <span class="n">rmi</span> <span class="o">&lt;</span><span class="n">imageID</span><span class="o">&gt;|&lt;</span><span class="n">imageName</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">docker</span> <span class="n">rmi</span> <span class="n">nginx</span>
</span><span class='line'><span class="n">docker</span> <span class="n">rmi</span> <span class="n">nginx</span> <span class="o">-</span><span class="n">f</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 看 container log</span>
</span><span class='line'><span class="n">docker</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span> <span class="o">&lt;</span><span class="n">imageID</span><span class="o">&gt;|&lt;</span><span class="n">imageName</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Run</h3>

<ul>
<li><a href="https://docs.docker.com/engine/reference/commandline/run/">run</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/attach/">attach</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/exec/">exec</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 執行 docker ，若本地沒有 image，就會自動去 Docker Hub pull 下來，如果沒有指定 TAG，預設使用 latest</span>
</span><span class='line'><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">i</span> <span class="ss">ubuntu</span><span class="p">:</span><span class="mi">12</span><span class="o">.</span><span class="mo">04</span> <span class="n">bash</span>
</span><span class='line'><span class="c1">#-t 在容器中分配一個虛擬終端（pseudo-tty）並綁定到容器的標準輸入上</span>
</span><span class='line'><span class="c1">#-i 建立與容器標準輸入（STDIN）的互動連結，讓容器的標準輸入保持打開</span>
</span><span class='line'><span class="c1">#執行後啟動 bash</span>
</span><span class='line'>
</span><span class='line'><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="nb">p</span> <span class="mi">80</span><span class="p">:</span><span class="mi">80</span> <span class="o">--</span><span class="nb">name</span> <span class="n">webserver</span> <span class="n">nginx</span>
</span><span class='line'><span class="c1"># -p 80:80 (主機 port, container port)</span>
</span><span class='line'><span class="c1"># --name webserver</span>
</span><span class='line'><span class="c1"># -d daemon 模式，放到背景去跑</span>
</span><span class='line'>
</span><span class='line'><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">v</span> <span class="o">~</span><span class="sr">/Downloads: ubuntu:12.04 bash</span>
</span><span class='line'><span class="sr"># 建立容器並啟動，且掛載本地目錄(local 在前，container 在後)</span>
</span><span class='line'>
</span><span class='line'><span class="sr"># 連到 container 最後執行</span>
</span><span class='line'><span class="sr"># 當多個窗口同時 attach 到同一個容器的時候，所有窗口都會同步顯示。當某個窗口因命令阻塞時,其他窗口也無法執行操作了</span>
</span><span class='line'><span class="sr">docker attach &lt;imageID&gt;|&lt;imageName&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="sr"># 進去 container 執行 bash</span>
</span><span class='line'><span class="sr">docker exec -it &lt;imageID&gt;|&lt;imageName&gt; bash</span>
</span><span class='line'>
</span><span class='line'><span class="sr"># Volume mapping to map the local directory /o</span><span class="n">pt</span><span class="o">/</span><span class="n">datadir</span> <span class="n">to</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>
</span><span class='line'><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">v</span> <span class="sr">/opt/</span><span class="ss">datadir</span><span class="p">:</span><span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span> <span class="n">mysql</span>
</span></code></pre></td></tr></table></div></figure>


<h3>建立映像檔</h3>

<ul>
<li><a href="https://docs.docker.com/engine/reference/commandline/commit/">commit</a></li>
<li><a href="https://philipzheng.gitbooks.io/docker_practice/content/image/create.html">images create</a></li>
</ul>


<h3>## 1.修改已有映像檔</h3>

<p>進去現有的 container，加入新的套件，再用此 container build 新的 images</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># commit 建立新的 images</span>
</span><span class='line'><span class="n">docker</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s1">&#39;message&#39;</span> <span class="o">-</span><span class="n">a</span> <span class="s1">&#39;author&#39;</span>
</span><span class='line'><span class="n">docker</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Added json gem&quot;</span> <span class="o">-</span><span class="n">a</span> <span class="s2">&quot;Docker Newbee&quot;</span> <span class="mi">0</span><span class="n">b2616b0e5a8</span> <span class="n">ouruser</span><span class="o">/</span><span class="ss">sinatra</span><span class="p">:</span><span class="n">v2</span>
</span><span class='line'><span class="c1"># -m 指定提交的說明信息，跟我們使用的版本控制工具一樣；</span>
</span><span class='line'><span class="c1"># -a 可以指定更新的使用者信息</span>
</span><span class='line'><span class="c1"># 之後是用來建立映像檔的容器的 CONTAINER ID</span>
</span><span class='line'><span class="c1"># 最後指定新映像檔的名稱和 tag 。建立成功後會印出新映像檔的 ID。</span>
</span></code></pre></td></tr></table></div></figure>


<h3>## <a href="#dockerfile">2.利用 Dockerfile 建立映像檔</a></h3>

<h3>Tag and Publish the image</h3>

<ul>
<li><a href="https://docs.docker.com/engine/reference/commandline/tag/">tag</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/push/">push</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Tag the image</span>
</span><span class='line'><span class="n">docker</span> <span class="n">tag</span> <span class="n">username</span><span class="o">/</span><span class="ss">repository</span><span class="p">:</span><span class="n">tag</span>
</span><span class='line'><span class="n">docker</span> <span class="n">tag</span> <span class="n">helloworld</span> <span class="n">leon</span><span class="o">/</span><span class="n">get</span><span class="o">-</span><span class="ss">started</span><span class="p">:</span><span class="n">part1</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Upload your tagged image to the repository:</span>
</span><span class='line'><span class="n">docker</span> <span class="n">push</span> <span class="n">eon</span><span class="o">/</span><span class="n">get</span><span class="o">-</span><span class="ss">started</span><span class="p">:</span><span class="n">part1</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Pull and run the image from the remote repository</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="nb">p</span> <span class="mi">4000</span><span class="p">:</span><span class="mi">80</span> <span class="n">username</span><span class="o">/</span><span class="ss">repository</span><span class="p">:</span><span class="n">tag</span>
</span></code></pre></td></tr></table></div></figure>


<h3>儲存映像檔</h3>

<ul>
<li><a href="https://docs.docker.com/engine/reference/commandline/save/">save</a></li>
</ul>


<p>如果要建立映像檔到本地檔案，可以使用 docker save 命令</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">sudo</span> <span class="n">docker</span> <span class="n">images</span>
</span><span class='line'><span class="no">REPOSITORY</span>          <span class="no">TAG</span>                 <span class="no">IMAGE</span> <span class="no">ID</span>            <span class="no">CREATED</span>             <span class="no">VIRTUAL</span> <span class="no">SIZE</span>
</span><span class='line'><span class="n">ubuntu</span>              <span class="mi">14</span><span class="o">.</span><span class="mo">04</span>               <span class="n">c4ff7513909d</span>        <span class="mi">5</span> <span class="n">weeks</span> <span class="n">ago</span>         <span class="mi">225</span><span class="o">.</span><span class="mi">4</span> <span class="no">MB</span>
</span><span class='line'>
</span><span class='line'><span class="n">docker</span> <span class="n">save</span> <span class="o">-</span><span class="n">o</span> <span class="n">ubuntu_14</span><span class="o">.</span><span class="mo">04</span><span class="o">.</span><span class="n">tar</span> <span class="ss">ubuntu</span><span class="p">:</span><span class="mi">14</span><span class="o">.</span><span class="mo">04</span>
</span></code></pre></td></tr></table></div></figure>


<h3>載入映像檔</h3>

<ul>
<li><a href="https://docs.docker.com/engine/reference/commandline/load/">load</a></li>
</ul>


<p>可以使用 docker load 從建立的本地檔案中再匯入到本地映像檔庫</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span> <span class="nb">load</span> <span class="o">--</span><span class="n">input</span> <span class="n">ubuntu_14</span><span class="o">.</span><span class="mo">04</span><span class="o">.</span><span class="n">tar</span>
</span><span class='line'><span class="n">docker</span> <span class="nb">load</span> <span class="o">&lt;</span> <span class="n">ubuntu_14</span><span class="o">.</span><span class="mo">04</span><span class="o">.</span><span class="n">tar</span>
</span></code></pre></td></tr></table></div></figure>


<h3><a href="https://philipzheng.gitbooks.io/docker_practice/content/container/enter.html">進入容器</a></h3>

<ul>
<li><a href="https://docs.docker.com/engine/reference/commandline/exec/">exec</a></li>
<li><a href="https://docs.docker.com/engine/reference/commandline/attach/">attach</a></li>
</ul>


<p>attach 命令有時候並不方便。當多個窗口同時 attach 到同一個容器的時候，所有窗口都會同步顯示。當某個窗口因命令阻塞時,其他窗口也無法執行操作了</p>

<p><img src="https://blog.fntsr.tw/wp-content/uploads/2014/12/Docker-Command-Diagram.png" alt="" /></p>

<h2><span id="dockerfile">Dockerfile</span></h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 1. OS-Ubuntu</span>
</span><span class='line'><span class="no">FROM</span> <span class="no">Ubuntu</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 2. Update apt repo</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
</span><span class='line'><span class="c1"># 3. Install denpendencies using apt</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 4. Install python denpendencies using pip</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span><span class="o">-</span><span class="n">mysql</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 5. Copy source code to /opt folder</span>
</span><span class='line'><span class="no">COPY</span> <span class="o">.</span> <span class="sr">/opt/sou</span><span class="n">rce</span><span class="o">-</span><span class="n">code</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 6. Run the web server using &#39;flask&#39; command</span>
</span><span class='line'><span class="no">ENTRYPOINT</span> <span class="no">FLASK_APP</span><span class="o">=</span><span class="sr">/opt/sou</span><span class="n">rce</span><span class="o">-</span><span class="n">code</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">py</span> <span class="n">flask</span> <span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span> <span class="n">build</span> <span class="no">Dockerfile</span> <span class="o">-</span><span class="n">t</span> <span class="n">user_name</span><span class="o">/</span><span class="n">custom_app</span>
</span><span class='line'><span class="n">docker</span> <span class="n">push</span> <span class="n">user_name</span><span class="o">/</span><span class="n">custom_app</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://philipzheng.gitbooks.io/docker_practice/content/dockerfile/instructions.html">Dockerfile 指令</a></p>

<blockquote><p>注意一個映像檔不能超過 127 層</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#一般會建議放置 Dockerfile 的目錄為空目錄。也可以透過 .dockerignore 檔案（每一行新增一條排除模式：exclusion patterns）來讓 Docker 忽略路徑下的目錄和檔案。</span>
</span><span class='line'><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">tagName</span><span class="o">&gt;</span> <span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#這樣也可以，只是不指定名稱</span>
</span><span class='line'><span class="n">docker</span> <span class="n">build</span> <span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<h3>FROM</h3>

<p>一定要有，只能有一個 FROM，基於某個已存在的 image 進行二次開發。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FROM</span> <span class="ss">ubuntu</span><span class="p">:</span><span class="mi">14</span><span class="o">.</span><span class="mo">04</span><span class="o">.</span><span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<h3>MAINTAINER</h3>

<p>指定維護者訊息。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">MAINTAINER</span> <span class="o">&lt;</span><span class="nb">name</span> <span class="o">|</span> <span class="n">email</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>RUN</h3>

<p>對映像檔執行相對應的命令。每運行一條 RUN 指令，映像檔就會新增一層，主要用來安裝 packages、設定系統環境等</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">RUN</span> <span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;</span> <span class="err">或</span> <span class="no">RUN</span> <span class="o">[</span><span class="s2">&quot;executable&quot;</span><span class="p">,</span> <span class="s2">&quot;param1&quot;</span><span class="p">,</span> <span class="s2">&quot;param2&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>前者將在 shell 終端中運行命令，即 /bin/sh -c；後者則使用 exec 執行。指定使用其它終端可以透過第二種方式實作，例如 RUN [&ldquo;/bin/bash&rdquo;, &ldquo;-c&rdquo;, &ldquo;echo hello&rdquo;]。</p>

<p>每條 RUN 指令將在當前映像檔基底上執行指定命令，並產生新的映像檔。當命令較長時可以使用 \ 來換行。</p>

<h3>EXPOSE</h3>

<p>設定 Docker 伺服器容器對外的埠號，供外界使用。在啟動容器時需要透過 -P，Docker 會自動分配一個埠號轉發到指定的埠號（當然也可以自己給，例如 -p 1055:80)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">EXPOSE</span> <span class="mi">80</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ADD</h3>

<p>該命令將複製指定的 <src> 到容器中的 <dest>。 其中 <src> 可以是 Dockerfile 所在目錄的相對路徑；也可以是一個 URL；還可以是一個 tar 檔案（其複製後會自動解壓縮）。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ADD</span> <span class="o">&lt;</span><span class="n">src</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dest</span><span class="o">&gt;</span>
</span><span class='line'><span class="no">ADD</span> <span class="n">text</span><span class="o">.</span><span class="n">conf</span> <span class="sr">/etc/</span><span class="n">apache2</span><span class="o">/</span><span class="nb">test</span><span class="o">.</span><span class="n">conf</span>
</span></code></pre></td></tr></table></div></figure>


<h3>USER</h3>

<p>切換使用者身份，Docker 預設使用者是 root，但若不需要，建議切換使用者身份，畢竟 root 權限太大了，使用上有安全的風險。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">USER</span> <span class="no">Leon</span>
</span></code></pre></td></tr></table></div></figure>


<h3>VOLUME</h3>

<p>建立一個可以從本地端或其他容器掛載的掛載點，一般用來存放資料庫和需要保存的資料等。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">VOLUME</span> <span class="o">[</span><span class="s2">&quot;/data&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>WORKDIR</h3>

<p>用來切換工作目錄，Docker 預設工作目錄是在根目錄，只有 RUN 能執行 cd 指令切換目錄，只作用在當下的 RUN，也就是說每一個 RUN 都是獨立進行的。如果想讓其他指令在指定的目錄下執行，就得靠 WORKDIR。WORKDIR 的變更影響是持續的，不用每個指令前都使用一次 WORKDIR</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">WORKDIR</span> <span class="sr">/a</span>
</span><span class='line'><span class="sr">WORKDIR b</span>
</span><span class='line'><span class="sr">WORKDIR c</span>
</span><span class='line'><span class="sr">RUN pwd</span>
</span><span class='line'>
</span><span class='line'><span class="sr">#則最終路徑為 /</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="o">/</span><span class="n">c</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ENV</h3>

<p>指定一個環境變數，會被後續 RUN 指令使用，並在容器運行時保持。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ENV</span> <span class="o">&lt;</span><span class="n">key</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="no">ENV</span> <span class="no">PG_MAJOR</span> <span class="mi">9</span><span class="o">.</span><span class="mi">3</span>
</span><span class='line'><span class="no">ENV</span> <span class="no">PG_VERSION</span> <span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mi">4</span>
</span><span class='line'><span class="no">RUN</span> <span class="n">curl</span> <span class="o">-</span><span class="no">SL</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//ex</span><span class="n">ample</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">postgres</span><span class="o">-</span><span class="vg">$PG_VERSION</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span> <span class="o">|</span> <span class="n">tar</span> <span class="o">-</span><span class="n">xJC</span> <span class="sr">/usr/s</span><span class="n">rc</span><span class="o">/</span><span class="n">postgress</span> <span class="o">&amp;&amp;</span> <span class="err">…</span>
</span><span class='line'><span class="no">ENV</span> <span class="no">PATH</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">postgres</span><span class="o">-</span><span class="vg">$PG_MAJOR</span><span class="o">/</span><span class="ss">bin</span><span class="p">:</span><span class="vg">$PATH</span>
</span></code></pre></td></tr></table></div></figure>


<h3>COPY</h3>

<p>能將本機端的檔案或目錄，複製到 image 內。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#複製本地端的 &lt;src&gt;（為 Dockerfile 所在目錄的相對路徑）到容器中的 &lt;dest&gt;。</span>
</span><span class='line'><span class="no">COPY</span> <span class="o">&lt;</span><span class="n">src</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dest</span><span class="o">&gt;</span>
</span><span class='line'><span class="no">COPY</span> <span class="nb">test</span><span class="o">.</span><span class="n">rb</span> <span class="o">.</span><span class="n">/</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ENTRYPOINT</h3>

<p>指定 Docker image 運行成 instance (也就是 Docker container) 時，要執行的指令或檔案。在這個範本中，test.rb 就是要執行的檔案。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ENTRYPOINT</span> <span class="o">[</span><span class="s2">&quot;./test.rb&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>會將 docker run xxx 後面的參數，當作 ENTRYPOINT 指令的參數</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ENTRYPOINT</span> <span class="o">[</span><span class="s2">&quot;echo&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">docker</span> <span class="n">run</span> <span class="no">CONTAINER</span> <span class="n">echo</span> <span class="n">foo</span>
</span><span class='line'><span class="c1"># =&gt; echo foo</span>
</span></code></pre></td></tr></table></div></figure>


<h3>CMD</h3>

<p>指定啟動容器時執行的命令，每個 Dockerfile 只能有一條 CMD 命令。如果指定了多條命令，只有最後一條會被執行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#使用 exec 執行，推薦使用</span>
</span><span class='line'><span class="no">CMD</span> <span class="o">[</span><span class="s2">&quot;executable&quot;</span><span class="p">,</span><span class="s2">&quot;param1&quot;</span><span class="p">,</span><span class="s2">&quot;param2&quot;</span><span class="o">]</span>
</span><span class='line'><span class="c1">#在 /bin/sh 中執行，使用在給需要互動的指令</span>
</span><span class='line'><span class="c1">#提供給 ENTRYPOINT 的預設參數</span>
</span><span class='line'><span class="no">CMD</span> <span class="n">command</span> <span class="n">param1</span> <span class="n">param2</span> <span class="no">CMD</span> <span class="o">[</span><span class="s2">&quot;param1&quot;</span><span class="p">,</span><span class="s2">&quot;param2&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>會將 docker run xxx 後面的參數，覆蓋掉 CMD 指定的命令。</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">CMD</span> <span class="o">[</span><span class="s2">&quot;echo&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">docker</span> <span class="n">run</span> <span class="no">CONTAINER</span> <span class="n">echo</span> <span class="n">foo</span>
</span><span class='line'><span class="c1"># =&gt; foo</span>
</span></code></pre></td></tr></table></div></figure>


<h3>範例</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">FROM</span> <span class="ss">ubuntu</span><span class="p">:</span><span class="n">latest</span>
</span><span class='line'>
</span><span class='line'><span class="no">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">-</span><span class="n">qq</span> <span class="o">&amp;&amp;</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">aptitude</span> <span class="n">git</span> <span class="n">imagemagick</span> <span class="n">curl</span> <span class="n">vim</span> <span class="n">bash</span><span class="o">-</span><span class="n">completion</span> <span class="n">htop</span> <span class="n">nodejs</span> <span class="n">mysql</span><span class="o">-</span><span class="n">client</span> <span class="n">libmysqlclient</span><span class="o">-</span><span class="n">dev</span>
</span><span class='line'>
</span><span class='line'><span class="no">RUN</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">keyserver</span> <span class="ss">hkp</span><span class="p">:</span><span class="sr">//</span><span class="n">keys</span><span class="o">.</span><span class="n">gnupg</span><span class="o">.</span><span class="n">net</span> <span class="o">--</span><span class="n">recv</span><span class="o">-</span><span class="n">keys</span> <span class="mi">409</span><span class="no">B6B1796C275462A1703113804BB82D39DC0E3</span>
</span><span class='line'><span class="no">RUN</span> <span class="p">\</span><span class="n">curl</span> <span class="o">-</span><span class="n">sSL</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">get</span><span class="o">.</span><span class="n">rvm</span><span class="o">.</span><span class="n">io</span> <span class="o">|</span> <span class="n">bash</span> <span class="o">-</span><span class="n">s</span> <span class="n">stable</span>
</span><span class='line'><span class="no">RUN</span> <span class="sr">/bin/</span><span class="n">bash</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;rvm install 2.1.5&quot;</span>
</span><span class='line'><span class="no">RUN</span> <span class="sr">/bin/</span><span class="n">bash</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;gem install bundler -v 1.10.5 --no-ri --no-rdoc&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">ENV</span> <span class="no">APP_ROOT</span> <span class="sr">/yourator</span>
</span><span class='line'>
</span><span class='line'><span class="sr">RUN mkdir $APP_ROOT</span>
</span><span class='line'><span class="sr">WORKDIR $APP_ROOT</span>
</span><span class='line'><span class="sr">ADD . $APP_ROOT</span>
</span><span class='line'><span class="sr">RUN /</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;bundle install&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Docker Compose</h2>

<p>Compose 是一個工具，用來定義與執行多個 container 組成的 Docker Applications。你可以使用 Compose 檔案來組態設定你的應用服務。然後使用單一命令，透過你的組態設定來建立與啟動你的服務。</p>

<p>Compose 適合用來開發、測試、與建立 staging 環境，如同 CI workflows。</p>

<p>使用 Compose 有基本的三個處理步驟：</p>

<ol>
<li>使用 Dockerfile 定義你的 app 環境，讓它可以在任何地方都能複製(reproduced)。</li>
<li>使用 docker-compose.yml 定義你的服務，讓他們可以在獨立環境內一起執行。</li>
<li>最後，執行 docker-compose up，Compose 將會開始與執行你所有的 app。</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># docker-compose.yml</span>
</span><span class='line'><span class="ss">services</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">web</span><span class="p">:</span>
</span><span class='line'>      <span class="ss">images</span><span class="p">:</span><span class="s2">&quot;mmumshad/simple-webapp&quot;</span>
</span><span class='line'>      <span class="ss">ports</span><span class="p">:</span>
</span><span class='line'>          <span class="o">-</span> <span class="s2">&quot;80:5000&quot;</span>
</span><span class='line'>  <span class="ss">detabase</span><span class="p">:</span>
</span><span class='line'>      <span class="ss">images</span><span class="p">:</span><span class="s2">&quot;mysql&quot;</span>
</span><span class='line'>      <span class="n">volumes</span><span class="o">::</span>
</span><span class='line'>          <span class="o">-</span> <span class="sr">/opt/</span><span class="ss">data</span><span class="p">:</span><span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://i.imgur.com/2Z22ghU.png" alt="" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span>
</span><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">stop</span>
</span><span class='line'><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">down</span>
</span></code></pre></td></tr></table></div></figure>


<p>官方文件：</p>

<ul>
<li><a href="https://docs.docker.com/docker-for-mac/">Get started with Docker for Mac</a></li>
<li><a href="https://docs.docker.com/engine/reference/builder/">Docker Docs</a></li>
<li><a href="https://docs.docker.com/get-started/part2/#recap-and-cheat-sheet-optional">Docker Sample</a></li>
<li><a href="https://docs.docker.com/compose/">Docker Compose</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="https://philipzheng.gitbooks.io/docker_practice/content/index.html">Docker —— 從入門到實踐</a></li>
<li><a href="http://www.cc.ntu.edu.tw/chinese/epaper/0036/20160321_3611.html">淺談輕量化的虛擬技術 - Docker容器</a></li>
<li><a href="http://bonze.tw/%E4%BC%BA%E6%9C%8D%E5%99%A8%E7%A0%94%E7%A9%B6%E5%AE%A4/dockerfile%E7%B0%A1%E5%96%AE%E4%BB%8B%E7%B4%B9">Dockerfile簡單介紹</a></li>
<li><a href="https://segmentfault.com/q/1010000000417103">Dockerfile裡指定執行命令用ENTRYPOING和用CMD有何不同？</a></li>
<li><a href="http://blog.maxkit.com.tw/2017/03/docker-compose.html">Docker Compose 初步閱讀與學習記錄</a></li>
<li><a href="https://medium.com/@DcardLab/dcard-%E5%AF%A6%E7%BF%92%E7%94%9F%E6%B4%BB%E6%97%A5%E8%A8%98-%E5%B0%8F%E9%AF%A8%E9%AD%9A-docker-%E4%BB%8B%E7%B4%B9-a574b28feae4">Dcard 實習生活日記：小鯨魚（Docker）介紹s</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在專案中連接另一個 Database]]></title>
    <link href="http://mgleon08.github.com/blog/2016/10/24/connect-multiple-database/"/>
    <updated>2016-10-24T10:17:44+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/10/24/connect-multiple-database</id>
    <content type="html"><![CDATA[<p>有時候會需要連接另外一個 database 的資料，rails 可以很方便地來做連接!</p>

<!-- more -->


<p>在 model 底下建立子資料夾，連接到另外一個 database，不過關聯就需要另外再去定義，因為是單純去 database 去拉資料過來</p>

<ul>
<li>好處：就不用透過 api 去拉資料</li>
<li>壞處：當拉的 database，結構有變就必須跟著動到 code</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#models/test/base.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Test</span><span class="o">::</span><span class="no">Base</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">abstract_class</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>  <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">establish_connection</span><span class="p">(</span>
</span><span class='line'>    <span class="ss">:adapter</span>  <span class="o">=&gt;</span> <span class="s2">&quot;mysql2&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:host</span>     <span class="o">=&gt;</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="s2">&quot;root&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="ss">:database</span> <span class="o">=&gt;</span> <span class="s2">&quot;database_name&quot;</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#models/test/course.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Test</span><span class="o">::</span><span class="no">Course</span> <span class="o">&lt;</span> <span class="no">Test</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="ss">:Course</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:teachers</span><span class="p">,</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s2">&quot;Test::Teacher&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#models/test/teacher.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Test</span><span class="o">::</span><span class="no">Teacher</span> <span class="o">&lt;</span> <span class="no">Test</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="ss">:teacher</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:course</span><span class="p">,</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s2">&quot;Test::Course&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>other</h2>

<p>也可以寫在 database.yml 裡面</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">development_db2</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">database</span><span class="p">:</span> <span class="n">your_database_name_development</span>
</span><span class='line'>  <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">default</span>
</span><span class='line'>
</span><span class='line'><span class="ss">test_db2</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">database</span><span class="p">:</span> <span class="n">your_database_name_test</span>
</span><span class='line'>  <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">default</span>
</span><span class='line'>
</span><span class='line'><span class="ss">production_db2</span><span class="p">:</span>
</span><span class='line'>  <span class="ss">database</span><span class="p">:</span> <span class="n">your_database_name</span>
</span><span class='line'>  <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">default</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">OtherDatabase</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="c1">#記得要用 symbol</span>
</span><span class='line'>  <span class="n">establish_connection</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">RAILS_ENV</span><span class="si">}</span><span class="s2">_db2&quot;</span><span class="o">.</span><span class="n">to_sym</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">OtherDatabase</span>
</span><span class='line'>  <span class="nb">self</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="ss">:user</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>其他文件:</p>

<ul>
<li><a href="http://railsfun.tw/t/activerecord-in-pure-ruby-api-server/161">ActiveRecord in pure Ruby（+ API server）</a></li>
<li><a href="http://geekhmer.github.io/blog/2015/02/07/ruby-on-rails-connect-to-multiple-databases-and-migrations/">Ruby on Rails Connect to Multiple Databases and Migrations</a></li>
<li><a href="https://solidfoundationwebdev.com/blog/posts/connecting-models-to-different-databases-in-rails">Connecting Models To Different Databases In Rails</a></li>
<li><a href="http://stackoverflow.com/questions/1226182/how-do-i-work-with-two-different-databases-in-rails-with-active-records">How do i work with two different databases in rails with active records?</a></li>
<li><a href="http://stackoverflow.com/questions/6122508/connecting-rails-3-1-with-multiple-databases">Connecting Rails 3.1 with Multiple Databases</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Web Server / Application Server / Rack / Process / Thread]]></title>
    <link href="http://mgleon08.github.com/blog/2016/10/23/web-server-application-server-rack-process-thread/"/>
    <updated>2016-10-23T16:05:22+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/10/23/web-server-application-server-rack-process-thread</id>
    <content type="html"><![CDATA[<p>這幾個名詞之前一直搞不太清楚，所以透過這邊來順便理解一下。</p>

<!-- more -->


<h1>Web Server</h1>

<blockquote><p>專門只處理 HTTP request 與 response，當收到 HTTP request 之後，需要business logic 的部分就從 application server 取，最後把 result 轉為 HTTP response</p></blockquote>

<ul>
<li>Apache</li>
<li>Nginx</li>
</ul>


<h3>Proxy Server(代理伺服器)</h3>

<p>主要的工作是去各個 Web Server 抓取資料回來放在伺服器上來供用戶讀取下載，如此一來可以大幅減少到各個 Web server 抓取資料的時間。</p>

<h3>Reverse Proxy Server(反向代理伺服器)</h3>

<p>和 Proxy Server 剛好相反，負責將用戶端的資料傳送（HTTP）給藏在 Reverse Proxy Server 後面的 Web Server，這些躲在後面的 Web Server 不會、也不能直接被用戶直接連結，只能經由 Reverse Proxy Server 代理傳送和接收資料，如此不僅可以保護後方 Web Server 被攻擊，同時還可提供負載平衡、快取以及資料加密的功能。</p>

<h1>Application Serve</h1>

<blockquote><p>專門用來處理 business logic 的，較常見的用法是接受 web server 的 request，執行完business logic (過程中視需要去access DB tier)之後把 result 回給 web server</p></blockquote>

<ul>
<li>WEBrick</li>
<li>Passenger</li>
<li>Unicorn

<ul>
<li><code>single-threaded multi-process</code></li>
<li><code>process monitoring</code></li>
<li>能讓所有處理序都監聽同一個共享的socket，而不是每個處理序使用單獨的socket</li>
</ul>
</li>
<li>Puma

<ul>
<li><code>purely multi-threaded</code></li>
</ul>
</li>
<li>Thin

<ul>
<li><code>evented I/O</code></li>
<li><code>no process monitoring</code></li>
<li>它的集群節點沒有處理序監控，所以需要去監控處理序是否崩潰。每個處理序監聽各自的socket，不像 Unicorn 一樣共享 socket</li>
</ul>
</li>
<li>Rainbows <code>multi-threaded</code></li>
</ul>


<h1>Rack</h1>

<blockquote><p>處理一個抽象過的HTTP請求和響應。而這個 HTTP 抽象層就稱之為Rack。</p></blockquote>

<ul>
<li>所有的 Ruby app server (ex: Unicorn, puma, Passenger) 都實現了Rack介面, 因此能夠與所有 Ruby web frameworkm，像 Rails，Sinatra 等之間進行切換</li>
</ul>


<p><img src="http://ohcoder.com/assets/raptor/rack.jpg" alt="" /></p>

<p>官方文件：</p>

<ul>
<li><a href="http://rack.github.io/">Rack: a Ruby Webserver Interface</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="https://ruby-china.org/topics/21517">為什麼我們需要 Rack ?</a></li>
<li><a href="https://www.rails365.net/articles/rack-jie-shao-yu-yuan-li">rack介紹與原理</a></li>
<li><a href="https://www.rails365.net/articles/rack-yu-zhong-jian-jian">rack與中間件</a></li>
<li><a href="http://rails.ruby.tw/rails_on_rack.html">Rails on Rack</a></li>
<li><a href="http://gabebw.com/blog/2015/08/10/advanced-rack">Advanced Rack</a></li>
</ul>


<p>Video：</p>

<ul>
<li><a href="https://vimeo.com/user12143456/review/69109140/c72efbd052">Rebuilding a Ruby web server</a></li>
</ul>


<h1>Process, Threaded, Evented</h1>

<h3>多處理序阻塞I/O（Muti-process bloking I/O）</h3>

<ul>
<li>一個 process 處理一個 client</li>
<li>concurrency 透過構造多個 process來實現</li>
<li>當對方沒有數據發送，那麼 read 操作就會被阻塞，如果對方接收數據太慢，那麼 write 操作也會被阻塞</li>
</ul>


<p>優點：</p>

<ul>
<li>工作原理非常簡單</li>
<li>不會有 therad safe</li>
</ul>


<p>缺點：</p>

<ul>
<li>process 很吃記憶體，因此不太適合用來做 I/O concurrency</li>
</ul>


<h3>多執行緒阻塞I/O(Muti-threaded blocking I/O)</h3>

<ul>
<li>一個 process 有多個 threaded，每個 threaded 都可以處理 client</li>
<li>concurrency 透過構造小數量的 process，每一個 process 包含有多個 threaded 來實現</li>
</ul>


<p>優點：</p>

<ul>
<li>concurrency 比較不吃記憶體</li>
</ul>


<p>缺點：</p>

<ul>
<li>要注意 therad safe</li>
</ul>


<h3>事件I/O（Evented I/O）</h3>

<ul>
<li>使用單一 process 和 therad</li>
<li>絕對不會被阻塞，類似 javascript 的 callback</li>
<li>持續監聽 Evented I/O，當對方沒有數據發送，或是對方接收數據太慢，I/O 呼叫只返回特定的錯誤訊息，以避免阻塞</li>
</ul>


<blockquote><p>thread safe: 一個 process 有多個 thread 在跑，因為變數是共享的，所以可能造成對一個變數，做重複的操作，導致錯誤的結果</p></blockquote>

<ul>
<li><a href="http://mp.weixin.qq.com/s?__biz=MzI0NjIzNDkwOA==&amp;mid=2247483676&amp;idx=1&amp;sn=1df45612132f3f96037b04d62f72d0cf&amp;scene=0">Ruby 中的多进程与多线程</a></li>
<li><a href="https://read01.com/GoNKk4.html">Ruby 中的多進程與多線程</a></li>
<li><a href="http://aftcast.pixnet.net/blog/post/23786004-thread-safe%E7%9A%84%E7%90%86%E8%A7%A3%E8%88%87%E5%88%86%E6%9E%90">Thread-Safe的理解與分析</a></li>
</ul>


<h1>GIL/GVL</h1>

<blockquote><p>MRI裡有個東西叫全局解釋器鎖(global interpreter lock)。這個鎖環繞著Ruby程式碼的執行。即是說在一個多執行緒的上下文中，在任何時候只有一個執行緒可以執行Ruby程式碼。 因此，假如一台8核機器上跑著8個執行緒，在特定的時間點上也只有一個執行緒和一個核心在忙碌。GIL一直保護著Ruby內核，以免競爭條件造成數據混亂。把警告和優化放一邊</p></blockquote>

<ul>
<li><a href="https://ruby-china.org/topics/28415">無人知曉的 GIL</a></li>
<li><a href="http://cenalulu.github.io/python/gil-in-python/">Python的GIL是什麼鬼，多執行緒性能究竟如何</a></li>
<li><a href="http://zhuoqiang.me/python-thread-gil-and-ctypes.html">python 執行緒，GIL 和 ctypes</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="http://www.rubyraptor.org/how-we-made-raptor-up-to-4x-faster-than-unicorn-and-up-to-2x-faster-than-puma-torquebox/">How we&rsquo;ve made Phusion Passenger 5 (「Raptor」) up to 4x faster than Unicorn, up to 2x faster than Puma, Torquebox</a>    <a href="http://ohcoder.com/blog/2014/11/11/raptor-part-1/">(中譯)</a></li>
<li><a href="http://michaelhsu.tw/2013/07/04/server/">Web server / Application server 傻傻分不清楚 ？</a></li>
<li><a href="http://blog.chh.tw/posts/ruby-on-rails-server-options/">Ruby on Rails 伺服器的選擇</a></li>
<li><a href="http://www.javaworld.com/article/2077354/learn-java/app-server-web-server-what-s-the-difference.html">App server, Web server: What&rsquo;s the difference?</a></li>
<li><a href="http://www.justinweiss.com/articles/a-web-server-vs-an-app-server/">A Web Server vs. An App Server</a></li>
<li><a href="http://stackoverflow.com/questions/4113299/ruby-on-rails-server-options">Ruby on Rails Server options [closed]</a> <a href="https://ruby-china.org/topics/25276">Ruby 伺服器對比</a></li>
<li><a href="https://ruby-china.org/topics/10832">Ruby 的多執行緒應用伺服器介紹</a></li>
<li><a href="http://blog.mz026.rocks/20160917/rails-connection-leak">大戰 Rails Connection Leak</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Useful Third Party Tool]]></title>
    <link href="http://mgleon08.github.com/blog/2016/10/20/tool/"/>
    <updated>2016-10-20T11:06:41+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/10/20/tool</id>
    <content type="html"><![CDATA[<p>紀錄一下有用的 Third Party Tool</p>

<!-- more -->


<h3>coding style</h3>

<ul>
<li><a href="https://infinum.co/the-capsized-eight/articles/top-8-tools-for-ruby-on-rails-code-optimization-and-cleanup">Top 8 tools for Ruby on Rails code optimization and cleanup</a></li>
<li><a href="https://houndci.com">houndci</a></li>
<li><a href="https://codeclimate.com/">codeclimate</a></li>
</ul>


<h3>spec</h3>

<ul>
<li><a href="https://travis-ci.org/">travis-ci</a></li>
<li><a href="https://circleci.com/">circleci</a></li>
</ul>


<h3>test cover</h3>

<ul>
<li><a href="https://coveralls.io/">coveralls</a></li>
</ul>


<h3>error 監控</h3>

<ul>
<li><a href="https://raygun.com/">RayGun</a></li>
<li><a href="https://rollbar.com/">Rollbar</a></li>
<li><a href="https://getsentry.com/welcome/">Sentry</a></li>
<li><a href="https://www.honeybadger.io/">honeybadger</a></li>
<li><a href="https://airbrake.io/">airbrake</a></li>
</ul>


<h3>效能監控：紀錄和統計Requests的Latency time和Error rate</h3>

<ul>
<li><a href="https://newrelic.com/">NewRelic</a></li>
<li><a href="https://www.skylight.io/">skylight</a></li>
<li><a href="https://scoutapp.com/">scoutapp</a></li>
<li><a href="https://www.datadoghq.com/">datadog</a></li>
</ul>


<h3>倒站監控：當網站連不到的時候，會寄Email或簡訊通知你</h3>

<ul>
<li><a href="https://uptimerobot.com/">uptimerobot</a></li>
<li><a href="https://tools.pingdom.com/">pingdom</a></li>
</ul>


<h3>Security</h3>

<ul>
<li><a href="https://brakemanpro.com/">brakeman</a></li>
<li><a href="https://hakiri.io/">hakiri</a></li>
</ul>


<h3>DevOps</h3>

<ul>
<li><a href="https://saltstack.com/">saltstack</a></li>
<li><a href="http://www.fabfile.org/">fabfile</a></li>
<li><a href="https://www.ansible.com/">ansible</a></li>
<li><a href="http://capistranorb.com/#">capistranorb</a></li>
<li><a href="https://www.chef.io/chef/">chef</a></li>
<li><a href="https://puppet.com/">puppet</a></li>
</ul>


<h3>share localhost</h3>

<p><a href="https://meetfinch.com/">meetfinch</a></p>

<h3>npm version check</h3>

<p><a href="https://david-dm.org/">David</a></p>

<h3>chatroom</h3>

<p><a href="https://gitter.im/">Gitter Chat</a></p>

<h3>Badge</h3>

<p><a href="http://shields.io/">shields</a></p>

<h3>監控API</h3>

<p><a href="https://www.runscope.com/">Runscope</a></p>

<h3>API文件</h3>

<ul>
<li><a href="https://apiblueprint.org/">apiblueprint</a></li>
<li><a href="http://raml.org/">raml</a></li>
<li><a href="http://swagger.io/">swagger</a></li>
<li><a href="https://github.com/lord/slate">slate</a></li>
</ul>


<h3>Other</h3>

<ul>
<li><a href="https://blog.ocowchun.com/2016/11/21/one-click-deploy-rails-app/">一鍵部署 Rails App</a></li>
<li><a href="https://henry40408-blog.herokuapp.com/kitchen-and-packer/">Kitchen 與 Packer 實戰</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby Logger]]></title>
    <link href="http://mgleon08.github.com/blog/2016/10/17/ruby-logger/"/>
    <updated>2016-10-17T17:47:38+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/10/17/ruby-logger</id>
    <content type="html"><![CDATA[<p>logger 可以方便我們去找尋問題在哪邊，因此設定好 logger 訊息是非常重要的</p>

<!-- more -->


<p>在 ruby 中，可以自定義 logger 的 level 還有 format，和輸出方式等等</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#設定 logger 的輸出</span>
</span><span class='line'><span class="n">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#設定 logger level</span>
</span><span class='line'><span class="n">logger</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">::</span><span class="no">INFO</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#設定 logger formatter</span>
</span><span class='line'><span class="n">logger</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span> <span class="o">|</span><span class="n">severity</span><span class="p">,</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">progname</span><span class="p">,</span> <span class="n">msg</span><span class="o">|</span>
</span><span class='line'>  <span class="s2">&quot;</span><span class="si">#{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Message in a block.</span>
</span><span class='line'><span class="n">logger</span><span class="o">.</span><span class="n">fatal</span> <span class="p">{</span> <span class="s2">&quot;Argument &#39;foo&#39; not given.&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># Message as a string.</span>
</span><span class='line'><span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="s2">&quot;Argument </span><span class="si">#{</span><span class="vi">@foo</span><span class="si">}</span><span class="s2"> mismatch.&quot;</span>
</span><span class='line'><span class="c1"># With progname.</span>
</span><span class='line'><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;initialize&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="s2">&quot;Initializing...&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="c1"># With severity.</span>
</span><span class='line'><span class="n">logger</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="no">Logger</span><span class="o">::</span><span class="no">FATAL</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;Fatal error!&#39;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>同時輸出到 terminal &amp; file</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Logger</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">Logger</span>
</span><span class='line'>  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span class='line'>      <span class="n">io</span> <span class="o">=</span> <span class="o">[</span><span class="no">STDOUT</span><span class="p">,</span> <span class="n">log_file</span><span class="o">]</span>
</span><span class='line'>      <span class="n">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">MultiIO</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="o">*</span><span class="n">io</span><span class="p">))</span>
</span><span class='line'>      <span class="n">logger</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">::</span><span class="no">INFO</span>
</span><span class='line'>      <span class="n">logger</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="nb">proc</span> <span class="k">do</span> <span class="o">|</span><span class="n">_severity</span><span class="p">,</span> <span class="n">_datetime</span><span class="p">,</span> <span class="n">_progname</span><span class="p">,</span> <span class="n">msg</span><span class="o">|</span>
</span><span class='line'>        <span class="s2">&quot;</span><span class="si">#{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="n">logger</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">log_file</span>
</span><span class='line'>      <span class="n">time</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-%dT%H:%M:%S&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span><span class="p">(</span><span class="s1">&#39;./sample&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">log_file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;./sample/</span><span class="si">#{</span><span class="n">time</span><span class="si">}</span><span class="s2">.log&quot;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">log_file</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MultiIO</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">*</span><span class="n">targets</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@targets</span> <span class="o">=</span> <span class="n">targets</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@targets</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">target</span><span class="o">|</span> <span class="n">target</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">close</span>
</span><span class='line'>    <span class="vi">@targets</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:close</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>官方文件:</p>

<ul>
<li><a href="https://ruby-doc.org/stdlib-2.1.0/libdoc/logger/rdoc/Logger.html">logger</a></li>
<li><a href="http://rails.ruby.tw/debugging_rails_applications.html#logger">rails guide</a></li>
</ul>


<p>參考文件:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/6407141/how-can-i-have-ruby-logger-log-output-to-stdout-as-well-as-file">How can I have ruby logger log output to stdout as well as file?</a></li>
<li><a href="http://stackoverflow.com/questions/14382252/how-to-format-ruby-logger">How to format ruby logger?</a></li>
<li><a href="https://www.sitepoint.com/rubyists-love-logging/">All Rubyists Love Logging</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Custom Config Setting]]></title>
    <link href="http://mgleon08.github.com/blog/2016/10/17/custom-config-setting/"/>
    <updated>2016-10-17T17:36:54+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/10/17/custom-config-setting</id>
    <content type="html"><![CDATA[<p>經常看到 rails 中有很多 config 的設定，像是 rspec 等等，會用一個 black 包起來就可以做設定了，那內部實作是如何?</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Mail</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">Configuration</span>
</span><span class='line'>    <span class="no">DEFAULT_VERSION</span>  <span class="o">=</span> <span class="s1">&#39;v1&#39;</span>
</span><span class='line'>    <span class="no">DEFAULT_API_KEY</span>  <span class="o">=</span> <span class="s1">&#39;token&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>      <span class="kp">attr_writer</span> <span class="ss">:version</span><span class="p">,</span> <span class="ss">:api_key</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>        <span class="k">yield</span> <span class="nb">self</span>
</span><span class='line'>        <span class="nb">self</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">version</span>
</span><span class='line'>        <span class="vi">@version</span> <span class="o">||=</span> <span class="no">DEFAULT_VERSION</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nf">api_key</span>
</span><span class='line'>        <span class="vi">@api_key</span> <span class="o">||=</span> <span class="no">DEFAULT_API_KEY</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Mail</span><span class="o">::</span><span class="no">Configuration</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>或是另外一種寫法</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Mail</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Config</span>
</span><span class='line'>    <span class="kp">extend</span> <span class="nb">self</span>
</span><span class='line'>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:token</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:logger</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">reset</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="kp">nil</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">reset</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">configure</span>
</span><span class='line'>      <span class="nb">block_given?</span> <span class="p">?</span> <span class="k">yield</span><span class="p">(</span><span class="no">Config</span><span class="p">)</span> <span class="p">:</span> <span class="no">Config</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">config</span>
</span><span class='line'>      <span class="no">Config</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Mail</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;MAIL_API_TOKEN&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">STDOUT</span><span class="p">)</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">::</span><span class="no">INFO</span>
</span><span class='line'>  <span class="nb">fail</span> <span class="s1">&#39;Missing ENV[MAIL_API_TOKEN]!&#39;</span> <span class="k">unless</span> <span class="n">config</span><span class="o">.</span><span class="n">token</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[環境變數 Environment Variable]]></title>
    <link href="http://mgleon08.github.com/blog/2016/10/17/environment-variable/"/>
    <updated>2016-10-17T17:33:41+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/10/17/environment-variable</id>
    <content type="html"><![CDATA[<p>為什麼需要環境變數?</p>

<!-- more -->


<p>因為在 github 上面不會將一些敏感資料放在上面，ex: password, token..etc <br/>
所以這些資料就會在 sever 上面做設定，以免資料外漏</p>

<p>那要設定這些資料有兩種方式</p>

<h2>Config file</h2>

<p>第一種是之前有提過的，做一個 example 設定檔，在到每個server上面個別去做設定。</p>

<ul>
<li><a href="http://mgleon08.github.io/blog/2016/02/07/yaml/">用 Yaml 來寫文件, 設定檔</a></li>
</ul>


<h2>Environment variable</h2>

<p>在 <code>Unix shell</code> 直接設定環境變數</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#通常會用全大寫，已表示固定的變數</span>
</span><span class='line'><span class="n">export</span> <span class="no">TOKEN</span><span class="o">=</span><span class="mi">123</span>
</span></code></pre></td></tr></table></div></figure>


<p>就能在 rails 中取得</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TOKEN&#39;</span><span class="o">]</span>
</span><span class='line'><span class="c1">#=&gt; 123</span>
</span></code></pre></td></tr></table></div></figure>


<p>但如果是在 <code>Unix shell</code> 下直接設定的話，只會存活在該 tab 底下，開新的 tab 就會消失，因此如果希望能一直存在的話，可以設定在 <code>~/.zshrc</code> or <code>~/.bashrc</code></p>

<blockquote><p>echo $SHELL 可以看是使用哪個 SHELL</p></blockquote>

<h2>Gem</h2>

<p>ruby 也有一些 gem 可以很方便的設定</p>

<ul>
<li><a href="https://github.com/laserlemon/figaro">figaro</a></li>
<li><a href="https://github.com/bkeepers/dotenv">dotenv</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="http://railsapps.github.io/rails-environment-variables.html">Rails Environment Variables</a></li>
<li><a href="http://braavos.me/blog/2014/08/05/rails-env/">Rails的環境變數</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[I/O 輸入輸出]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/io/"/>
    <updated>2016-08-30T10:32:37+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/io</id>
    <content type="html"><![CDATA[<p>先來說說什麼是 IO</p>

<!-- more -->


<blockquote><ul>
<li>所謂「I/O」，是input/output(輸出入) 的縮寫，泛指所有的輸出入動作。</li>
<li>我們從鍵盤上輸入資料、移動滑鼠、由掃描器輸入影像、從磁碟機讀入檔案，都是屬於輸入的動作；從印表機印出報表、顯示圖形到螢幕、將執行結果存入磁碟中，都是屬於輸出的一種。</li>
<li>I/O也指磁碟機的存取、或是通訊埠的接收資料和傳送資料等動作，一般都是針對可兼做輸出和輸入的設備。</li>
</ul>
</blockquote>

<p>由以上可知，當我們鍵盤上打字，就是一種輸入的動作，再 terminal 顯示我們輸入的字，就是一種輸出的動作</p>

<h1>ruby IO</h1>

<ul>
<li>標準輸入：$stdin</li>
<li>標準輸出：$stdout</li>
<li>標準錯誤輸出：$stderr</li>
<li>命令列引數的陣列: ARGV</li>
</ul>


<h3>標準輸出 vs 標準錯誤輸出</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#io.rb</span>
</span><span class='line'><span class="vg">$stdout</span><span class="o">.</span><span class="n">print</span>  <span class="s2">&quot;標準輸出&quot;</span>
</span><span class='line'><span class="vg">$stderr</span><span class="o">.</span><span class="n">print</span>  <span class="s2">&quot;標準錯誤輸出&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#執行 ruby io.rb &gt; log.txt，會發現 console 只會顯示 &#39;標準錯誤輸出&#39;，而標準輸出則會輸出到 log.txt</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">##&lt;IO:&lt;STDIN&gt;&gt;</span>
</span><span class='line'><span class="no">STDIN</span>
</span><span class='line'><span class="vg">$stdin</span>
</span><span class='line'>
</span><span class='line'><span class="c1">##&lt;IO:&lt;STDOUT&gt;&gt;</span>
</span><span class='line'><span class="vg">$&gt;</span>
</span><span class='line'><span class="no">STDOUT</span>
</span><span class='line'><span class="vg">$stdout</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#雖然有很多種表示法，但是比較偏好 $stdin，因為再 ruby 全大寫通常是常數，會讓人誤會，另一個則是不懂的人難以理解</span>
</span></code></pre></td></tr></table></div></figure>


<h3>輸入 input</h3>

<p><code>$stdin.gets</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vg">$stdin</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">hello</span>
</span><span class='line'><span class="c1">#=&gt; &quot;hello\n&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>#chomp!</code> 去除掉 \n</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vg">$stdin</span><span class="o">.</span><span class="n">gets</span><span class="o">.</span><span class="n">chomp!</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">hello</span>
</span><span class='line'><span class="c1">#=&gt; &quot;hello&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>#eof?</code> 判斷是否讀到最後</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="s1">&#39;ruby.rb&#39;</span> <span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">eof?</span>
</span><span class='line'><span class="c1">#=&gt; false</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="c1">#=&gt; &quot;1\n&quot;</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">eof?</span>
</span><span class='line'><span class="c1">#=&gt; false</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="c1">#=&gt; &quot;2\n&quot;</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="c1">#=&gt; nil</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">eof?</span>
</span><span class='line'><span class="c1">#=&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>#getc</code> 每次讀取一個字元</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s1">&#39;ruby.rb&#39;</span> <span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">getc</span>
</span><span class='line'><span class="c1">#=&gt; &quot;1&quot;</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">getc</span>
</span><span class='line'><span class="c1">#=&gt; &quot;\n&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#會被主動轉換成 ASCII 編碼，因此第二個會讀出 \n</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>io.read</code> 指定讀取長度，預設為全部</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s1">&#39;ruby.rb&#39;</span> <span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'><span class="c1">#=&gt; &quot;1\n2\n3&quot;</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">rewind</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">0</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; &quot;1\n2&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>輸出 output</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#adds a new line character</span>
</span><span class='line'><span class="c1">#is an equivalent to the $stdout.puts</span>
</span><span class='line'><span class="nb">puts</span> <span class="s1">&#39;a&#39;</span>
</span><span class='line'><span class="c1">#=&gt;a\n</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#is an equivalent to the $stdout.print</span>
</span><span class='line'><span class="nb">printf</span> <span class="s1">&#39;a&#39;</span>
</span><span class='line'><span class="c1">#a</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#prints one character to the console</span>
</span><span class='line'><span class="nb">putc</span> <span class="mi">97</span>
</span><span class='line'><span class="c1">#a=&gt; 97</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#p calls the inspect method upon the object being printed, The method is useful for debugging.</span>
</span><span class='line'><span class="nb">p</span> <span class="s2">&quot;a&quot;</span>
</span><span class='line'><span class="c1">#=&gt; &#39;a&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">a</span> <span class="o">=</span> <span class="no">StringIO</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="c1">#=&gt; #&lt;StringIO:0x007fc9a08813e8&gt;</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; nil</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">rewind</span>
</span><span class='line'><span class="c1">#=&gt; 0</span>
</span><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'><span class="c1">#=&gt; &quot;123\n&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>指標</h3>

<p>資料流的存取方法，有區分成「固定長度」與「非固定長度」</p>

<ul>
<li><p>固定長度的讀取方式</p>

<ul>
<li>優點：讀取速度快，資料都以固定的長度儲存，可以很快的找到指定的位置</li>
<li>缺點：浪費空間，即使用不到大的空間也是會空下位置</li>
</ul>
</li>
<li><p>非固定長度的讀取方式</p>

<ul>
<li>優點：省空間，有用到才會有空間</li>
<li>缺點：讀取速度慢，每次讀取資料時，都必須從頭開始讀取</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">rewind</span>  <span class="c1">#將指標移到最前面</span>
</span><span class='line'>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">pos</span>     <span class="c1">#目前指標位置</span>
</span><span class='line'>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="err">位置</span><span class="p">,</span> <span class="err">方式</span><span class="p">)</span> <span class="c1">#指定位置</span>
</span><span class='line'><span class="c1">#方式有三種：</span>
</span><span class='line'><span class="c1">#SEEK_SET ： 直接移動到指定位置</span>
</span><span class='line'><span class="c1">#SEEK_CUR ： 移動到目前位置的相對位置</span>
</span><span class='line'><span class="c1">#SEEK_END ： 移動到檔尾算起的相對位置</span>
</span><span class='line'>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</span><span class='line'><span class="c1">#引數為 0 的話，表示全部清空</span>
</span><span class='line'><span class="c1">#引數為 io.pos 的話，表示將目前指標後的檔案全清空</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;ruby.rb&quot;</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>
</span><span class='line'><span class="c1">#=&gt; 3</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'><span class="c1">#=&gt; &quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#因為 a 若有檔案在會寫在檔案後面，此時指標會指向最後面，因此可以用 rewind 將指標移致最前面</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">rewind</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'><span class="c1">#=&gt; 123</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Readline</h1>

<blockquote><p>The Readline module provides interface for GNU Readline. This module defines a number of methods to facilitate completion and accesses input history from the Ruby interpreter. This module supported Edit Line(libedit) too. libedit is compatible with GNU Readline.</p></blockquote>

<p>GNU的readline是一個開源的跨平台程序庫，提供了交互式的文本編輯功能</p>

<p><a href="http://ruby-doc.org/stdlib-2.1.1/libdoc/readline/rdoc/Readline.html">Readline</a></p>

<h1>stringIO 物件</h1>

<ul>
<li><a href="http://ruby-doc.org/stdlib-2.3.0/libdoc/stringio/rdoc/StringIO.html">StringIO</a></li>
</ul>


<p>設一個能夠儲存字串的物件</p>

<blockquote><p>Pseudo I/O on String object.<br/>
Commonly used to simulate <code>$stdio</code> or <code>$stderr</code></p></blockquote>

<p>此時對 io 操作 puts 並不會真正的輸出，而是將字串存入 io 物件之中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">StringIO</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">rewind</span>
</span><span class='line'><span class="nb">p</span> <span class="n">io</span><span class="o">.</span><span class="n">read</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#&quot;A\nB\nC\n&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>檔案輸出入</h1>

<p>File 繼承自 IO</p>

<blockquote><p>File.new 與 File.open 和 IO.new 與 IO.open 幾乎一樣，只差在覆寫了 initialize 方法，使其接受的參數不再是 FD 而是檔案的路徑字串。</p></blockquote>

<ul>
<li><a href="http://ruby-doc.org/core-2.1.5/File.html">File</a></li>
<li><a href="http://mgleon08.github.io/blog/2016/01/31/ruby-file-dir/">用 Ruby 進行 File ＆ Dir 檔案操作</a></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># r  讀取，檔案必須存在</span>
</span><span class='line'><span class="c1"># w  會主動建立空檔案，檔案已存在則會被覆蓋</span>
</span><span class='line'><span class="c1"># a  寫入。主動建檔，檔案已存在則追加在後。</span>
</span><span class='line'><span class="c1"># r+ 讀取 / 寫入，不會主動建檔，將內容加在檔案最前面，會覆蓋原有內容，檔案必須存在)</span>
</span><span class='line'><span class="c1"># w+ 讀取 / 寫入。同 w 功能</span>
</span><span class='line'><span class="c1"># a+ 讀取 / 寫入。同 a 功能</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#在每個模式後面加上&quot;b&quot;</span>
</span><span class='line'><span class="c1">#例如 &quot;rb&quot; 或 &quot;rb+&quot;，就可以開啟「二進位」模式 </span>
</span><span class='line'>
</span><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;ruby.rb&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;/home/work/ruby.rb&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">close</span>
</span><span class='line'><span class="n">io</span><span class="o">.</span><span class="n">closed?</span> <span class="c1">#檢查是否關閉</span>
</span><span class='line'><span class="c1">#若後面沒有 block (結束會自動關閉) 必須要再加上，io.close，關閉檔案，否則會出錯</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># 打開檔案，並寫入文字（若沒檔案會直接新增）</span>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;langs&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>  <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="s2">&quot;Ruby&quot;</span>
</span><span class='line'>  <span class="n">f</span><span class="o">.</span><span class="n">write</span> <span class="s2">&quot;Java</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="n">f</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Python</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#查看檔案是否存在，建立時間，檔案大小</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">File</span><span class="o">.</span><span class="n">exists?</span> <span class="s1">&#39;tempfile&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">new</span> <span class="s1">&#39;tempfile&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span>
</span><span class='line'><span class="nb">puts</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span> <span class="s1">&#39;tempfile&#39;</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">f</span><span class="o">.</span><span class="n">size</span>
</span><span class='line'>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">rename</span> <span class="s1">&#39;tempfile&#39;</span><span class="p">,</span> <span class="s1">&#39;tempfile2&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">close</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#逐一行印出</span>
</span><span class='line'><span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;stones&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">while</span> <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">gets</span> <span class="k">do</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">line</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">close</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#逐一行顯示</span>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span> <span class="s2">&quot;ruby.rb&quot;</span> <span class="p">,</span> <span class="s2">&quot;r&quot;</span> <span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>  <span class="k">while</span> <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">gets</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">line</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#刪除檔案</span>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/home/work/ruby.rb&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#讀取檔案</span>
</span><span class='line'><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;ruby.rb&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><h3>IO 的世界相當大啊，還有很多沒有提及，以後若有機會接觸到比較深的再來研究~.~</h3></blockquote>

<ul>
<li><a href="http://mgleon08.github.io/blog/2016/01/31/ruby-file-dir/">用 Ruby 進行 File ＆ Dir 檔案操作</a></li>
<li><a href="http://mgleon08.github.io/blog/2016/02/07/callsystem/">用 Ruby 來 Calling Shell Commands</a></li>
</ul>


<p>官方文件：</p>

<ul>
<li><a href="http://ruby-doc.org/core-2.2.2/IO.html">IO</a></li>
<li><a href="http://ruby-doc.org/stdlib-1.9.3/libdoc/stringio/rdoc/StringIO.html">StringIO</a></li>
<li><a href="http://ruby-doc.org/core-2.1.5/File.html">File</a></li>
<li><a href="https://ruby-doc.org/core-2.2.0/Dir.html">Dir</a></li>
<li><a href="http://ruby-doc.org/core-2.3.1/Kernel.html">Kernel</a></li>
<li><a href="http://ruby-doc.org/stdlib-2.1.1/libdoc/readline/rdoc/Readline.html">Readline</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="http://zetcode.com/lang/rubytutorial/io/">Input &amp; output in Ruby</a></li>
<li><a href="https://blog.alphacamp.co/2016/06/30/ruby-open/">Ruby#open 知多少？</a></li>
<li><a href="http://rpg0822.pixnet.net/blog/post/2844850-ruby-%E7%AD%86%E8%A8%98---7----%E8%A9%B2%E6%AD%BB%E7%9A%84-io-">Ruby 筆記 - 7 - 該死的 IO</a></li>
<li><a href="http://stackoverflow.com/questions/4279604/what-is-the-difference-between-stdin-and-stdin-in-ruby">What is the difference between STDIN and $stdin in Ruby?</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ERB Template]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/erb-template/"/>
    <updated>2016-08-30T10:31:47+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/erb-template</id>
    <content type="html"><![CDATA[<p>相信學過 rails 一定知道 erb，可以很方便地將 ruby code 寫在 view 中</p>

<!-- more -->


<p>但不一定是要有 rails 才可以用 erb</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#template.rb</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;erb&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Template</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@foo</span> <span class="o">=</span> <span class="n">foo</span>
</span><span class='line'>    <span class="vi">@bar</span> <span class="o">=</span> <span class="n">bar</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">open_template</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="no">ERB</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">templates_path</span><span class="p">),</span> <span class="kp">nil</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="nb">binding</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">templates_path</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;../template.erb&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Template</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">open_template</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#template.erb</span>
</span><span class='line'><span class="mi">1</span><span class="o">.</span> <span class="o">&lt;</span><span class="sx">%= @foo %&gt;</span>
</span><span class='line'><span class="sx">2. &lt;%=</span> <span class="vi">@bar</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#執行</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">template</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="c1">#1. hi</span>
</span><span class='line'><span class="c1">#2. hello</span>
</span></code></pre></td></tr></table></div></figure>


<h3>也可以利用 erb 來寫設定檔</h3>

<ul>
<li><a href="http://mgleon08.github.io/blog/2016/02/07/yaml/">用 Yaml 來寫文件, 設定檔</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="http://ruby-doc.org/stdlib-2.3.1/libdoc/erb/rdoc/ERB.html">ERB doc</a></li>
<li><a href="http://stackoverflow.com/questions/1338960/ruby-templates-how-to-pass-variables-into-inlined-erb">Ruby templates: How to pass variables into inlined ERB?</a></li>
<li><a href="http://stackoverflow.com/questions/8954706/render-an-erb-template-with-values-from-a-hash">Render an ERB template with values from a hash</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OptionParser]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/optionparser/"/>
    <updated>2016-08-30T10:30:52+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/optionparser</id>
    <content type="html"><![CDATA[<p>ruby 裡內建的強大工具，可以解析命令行參數</p>

<!-- more -->


<p>先來看一下什麼是 Unix命令行</p>

<p>通常的Unix命令行參數包含下面這些形式：</p>

<ul>
<li>Option - 主要功能是用於調整命令行工具的行為

<ul>
<li>Option的表現通常有兩種形式

<ul>
<li>short opt​​ion</li>
<li>long option</li>
</ul>
</li>
<li>Option的類型有兩種

<ul>
<li><code>switch</code> 不帶 argument</li>
<li><code>flag</code> 帶有 argument</li>
</ul>
</li>
</ul>
</li>
<li>Argument - 表示命令行工具要操作的對象，通常是路徑，URL或者名稱等等。</li>
<li>Action - 表示命令行工具的行為，比如 git 命令的 push 或者 pull 等等。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="n">max</span><span class="o">-</span><span class="n">count</span><span class="o">=</span><span class="mi">10</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#git 是 command，log 是 action，表示查看 git 的提交歷史。</span>
</span><span class='line'><span class="c1">#--max-count 則是 option，表示最多顯示N條commit記錄</span>
</span></code></pre></td></tr></table></div></figure>


<p>用 <code>ARGV</code> 來接命令列引數的陣列。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;optparse&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Hello</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@arguments</span> <span class="o">=</span> <span class="n">arguments</span>
</span><span class='line'>      <span class="n">parse_options</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">parse_options</span>
</span><span class='line'>    <span class="n">options</span> <span class="o">=</span> <span class="no">OptionParser</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="s1">&#39;Usage: xxxx [options]&#39;</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">separator</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">separator</span> <span class="s1">&#39;options:&#39;</span>
</span><span class='line'>    <span class="c1">#on(&#39;short opt​​ion&#39;, &#39;long option&#39;, &#39;comment&#39;)</span>
</span><span class='line'>    <span class="c1">#帶參數</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-a arg&#39;</span><span class="p">,</span> <span class="s1">&#39;--aa arg&#39;</span><span class="p">,</span> <span class="s1">&#39;this is test&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">arg</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">arg</span> <span class="p">}</span>
</span><span class='line'>    <span class="c1">#不帶參數</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="s1">&#39;--bb&#39;</span><span class="p">,</span> <span class="s1">&#39;this is test&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s1">&#39;b&#39;</span> <span class="p">}</span>
</span><span class='line'>    <span class="c1">#多個參數</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-c arg&#39;</span><span class="p">,</span> <span class="s1">&#39;--cc arg&#39;</span><span class="p">,</span> <span class="s1">&#39;this is test&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">arg</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">arg</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">,</span> <span class="s1">&#39;Show this message&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="nb">puts</span><span class="p">(</span><span class="n">options</span><span class="p">);</span> <span class="nb">exit</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">options</span><span class="o">.</span><span class="n">parse!</span><span class="p">(</span><span class="vi">@arguments</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Hello</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ARGV</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">a</span> <span class="n">a</span>
</span><span class='line'><span class="c1">#=&gt;a</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">--</span><span class="n">aa</span> <span class="n">aa</span>
</span><span class='line'><span class="c1">#=&gt;aa</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">b</span>
</span><span class='line'><span class="c1">#=&gt;b</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">--</span><span class="n">bb</span>
</span><span class='line'><span class="c1">#=&gt;b</span>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">c</span> <span class="n">c</span><span class="p">,</span><span class="n">cc</span>
</span><span class='line'><span class="c1">#=&gt;c,cc</span>
</span><span class='line'>
</span><span class='line'><span class="n">ruby</span> <span class="n">optparse</span><span class="o">.</span><span class="n">rb</span> <span class="o">-</span><span class="n">h</span>
</span><span class='line'><span class="c1">#Usage: xxxx [options]</span>
</span><span class='line'><span class="c1">#   -t, --test arg                   this is test</span>
</span><span class='line'><span class="c1">#   -h, --help                       Show this message</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ARGV</h3>

<p><a href="http://lrthw.github.io/ex13/">Learn Ruby The Hard Way ex13</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">third</span> <span class="o">=</span> <span class="no">ARGV</span>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;Your first variable is: </span><span class="si">#{</span><span class="n">first</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;Your second variable is: </span><span class="si">#{</span><span class="n">second</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;Your third variable is: </span><span class="si">#{</span><span class="n">third</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># ARGV 就是「參數變數(argument variable)」，是一個非常標準的程式術語。</span>
</span><span class='line'><span class="c1"># 在其他的程式語言你也可以看到它全大寫的原因是因為它是一個「常數(constant)」，</span>
</span><span class='line'><span class="c1"># 意思是當它被賦值之後你就不應該去改變它了。這個變數會接收當你運行 Ruby 腳本時所傳</span>
</span><span class='line'><span class="c1"># 入的參數。通過後面的習題你將對它有更多的了解。你將對它有更多的了解。</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># 第 1 行將 ARGV 「解包(unpack)」，與其將所有參數放到同一個變數下面，我們將每個參數</span>
</span><span class='line'><span class="c1"># 予一個變數名稱 first 、 second 以及 third。腳本本身的名稱被存在一個特殊變數 $0</span>
</span><span class='line'><span class="c1"># 裡，這是我們不需要解包的部份。也許看來有些異，但「解包」可能是最好的描述方式了。它</span>
</span><span class='line'><span class="c1"># 的涵義很簡單：「將 ARGV 中的東西解包，然後將所有</span>
</span><span class='line'><span class="c1"># 的參數依次賦予左邊的變數名稱」。</span>
</span></code></pre></td></tr></table></div></figure>


<p>官方文件：</p>

<ul>
<li><a href="http://ruby-doc.org/stdlib-2.3.1/libdoc/optparse/rdoc/OptionParser.html">OptionParser</a></li>
<li><a href="https://docs.ruby-lang.org/en/2.1.0/OptionParser.html">OptionParser doc</a></li>
</ul>


<p>參考文件：</p>

<ul>
<li><a href="https://ruby-china.org/wiki/building-a-command-line-tool-with-optionparser">用 OptionParser 构建 Command Line 工具</a></li>
<li><a href="http://rubylearning.com/blog/2011/01/03/how-do-i-make-a-command-line-tool-in-ruby/">How do I make a command-line tool in Ruby?</a></li>
<li><a href="http://stackoverflow.com/questions/1541294/how-do-you-specify-a-required-switch-not-argument-with-ruby-optionparser/1542658#1542658">How do you specify a required switch (not argument) with Ruby OptionParser?</a></li>
</ul>


<p>相關 gem：</p>

<ul>
<li><a href="https://github.com/docopt/docopt.rb">docopt</a></li>
<li><a href="https://github.com/leejarvis/slop">slop</a></li>
<li><a href="https://github.com/defunkt/choice">choice</a></li>
<li><a href="https://github.com/ManageIQ/trollop">trollop</a></li>
<li><a href="https://github.com/davetron5000/gli">gli</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Make You Own Gem]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/make-you-own-gem/"/>
    <updated>2016-08-30T10:24:36+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/make-you-own-gem</id>
    <content type="html"><![CDATA[<p>bundle 本身就有提供可以產生 gem 相關檔案的功能</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="n">gem</span> <span class="n">xxx</span> <span class="o">--</span><span class="n">mit</span> <span class="o">-</span><span class="n">t</span><span class="o">=</span><span class="n">rspec</span>
</span><span class='line'><span class="c1">#後面可以設定參數，ex: 自動產生 LICENSE.txt, 測試用 rspec or mintest 等等</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#xxx/Gemfile                  &lt;= dependency 哪些套件，但基本上裡面是指定到 xxx.gemspec，將相依的套件定義在 xxx.gemspec 即可</span>
</span><span class='line'><span class="c1">#xxx/Rakefile                 &lt;= 發佈和打包的 rake tasks</span>
</span><span class='line'><span class="c1">#xxx/LICENSE.txt              &lt;= 註明 License</span>
</span><span class='line'><span class="c1">#xxx/README.md                &lt;= 說明如何使用它(github上會顯示)</span>
</span><span class='line'><span class="c1">#xxx/.gitignore               &lt;= 不要進 Git 的檔案在這定義</span>
</span><span class='line'><span class="c1">#xxx/xxx.gemspec             &lt;= gem 的 spec</span>
</span><span class='line'><span class="c1">#xxx/lib/xxx.rb              &lt;= gem 裡的 library，主要 code 都是在這裡</span>
</span><span class='line'><span class="c1">#xxx/lib/xxx/version.rb      &lt;= 版本紀錄</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>xxx.gemspec</code> gem 裡面的基本設定都會在這邊，需要寫的都會註明 <code>TODO:</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># coding: utf-8</span>
</span><span class='line'><span class="n">lib</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../lib&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'><span class="vg">$LOAD_PATH</span><span class="o">.</span><span class="n">unshift</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="k">unless</span> <span class="vg">$LOAD_PATH</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;xxx/version&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">spec</span><span class="o">|</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">name</span>          <span class="o">=</span> <span class="s2">&quot;xxx&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">version</span>       <span class="o">=</span> <span class="no">Xxx</span><span class="o">::</span><span class="no">VERSION</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">authors</span>       <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;TODO: Write your name&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">email</span>         <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;TODO: Write your email address&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">summary</span>       <span class="o">=</span> <span class="sx">%q{TODO: Write a short summary, because Rubygems requires one.}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">description</span>   <span class="o">=</span> <span class="sx">%q{TODO: Write a longer description or delete this line.}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">homepage</span>      <span class="o">=</span> <span class="s2">&quot;TODO: Put your gem&#39;s website or public repo URL here.&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">license</span>       <span class="o">=</span> <span class="s2">&quot;MIT&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Prevent pushing this gem to RubyGems.org by setting &#39;allowed_push_host&#39;, or</span>
</span><span class='line'>  <span class="c1"># delete this section to allow pushing this gem to any host.</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">respond_to?</span><span class="p">(</span><span class="ss">:metadata</span><span class="p">)</span>
</span><span class='line'>    <span class="n">spec</span><span class="o">.</span><span class="n">metadata</span><span class="o">[</span><span class="s1">&#39;allowed_push_host&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;TODO: Set to &#39;http://mygemserver.com&#39;&quot;</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="k">raise</span> <span class="s2">&quot;RubyGems 2.0 or newer is required to protect against public gem pushes.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">files</span>         <span class="o">=</span> <span class="sb">`git ls-files -z`</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x0</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reject</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">%r{^(test|spec|features)/}</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">bindir</span>        <span class="o">=</span> <span class="s2">&quot;exe&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">executables</span>   <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">grep</span><span class="p">(</span><span class="sr">%r{^exe/}</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">require_paths</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;lib&quot;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;bundler&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 1.11&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;rake&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 10.0&quot;</span>
</span><span class='line'>  <span class="n">spec</span><span class="o">.</span><span class="n">add_development_dependency</span> <span class="s2">&quot;rspec&quot;</span><span class="p">,</span> <span class="s2">&quot;~&gt; 3.0&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Code</h1>

<p><code>xxx/lib/xxx.rb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;xxx/version&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">module</span> <span class="nn">Xxx</span>
</span><span class='line'>  <span class="c1"># Your code goes here...</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">hi</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;Hello, world!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Build</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">build</span> <span class="n">xxx</span><span class="o">.</span><span class="n">gemspec</span>
</span><span class='line'><span class="c1">#目錄底下會多出此檔 xxx-0.0.1.gem</span>
</span><span class='line'>
</span><span class='line'><span class="no">Successfully</span> <span class="n">built</span> <span class="no">RubyGem</span>
</span><span class='line'><span class="ss">Name</span><span class="p">:</span> <span class="n">xxx</span>
</span><span class='line'><span class="ss">Version</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'><span class="ss">File</span><span class="p">:</span> <span class="n">xxx</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="n">gem</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Install</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">xxx</span>
</span><span class='line'>
</span><span class='line'><span class="err">$</span> <span class="n">irb</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;xxx&#39;</span>
</span><span class='line'><span class="c1">#=&gt; true</span>
</span><span class='line'>
</span><span class='line'><span class="no">Xxx</span><span class="o">.</span><span class="n">hi</span>
</span><span class='line'><span class="c1">#=&gt;Hello, world!</span>
</span></code></pre></td></tr></table></div></figure>


<h1>發佈到 RubyGems.org</h1>

<ul>
<li>gem update &ndash;system</li>
<li>申請帳號 <a href="https://rubygems.org/sign_up">rubygems</a></li>
<li>發佈</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">push</span> <span class="n">xxx</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">gem</span>
</span><span class='line'><span class="c1">#push 後會要輸入你剛剛的申請的帳號密碼，就ok囉</span>
</span></code></pre></td></tr></table></div></figure>


<h3>command-reference</h3>

<p><a href="http://guides.rubygems.org/command-reference/">command-reference</a></p>

<p>參考文件：</p>

<ul>
<li><a href="RubyGems.org">https://rubygems.org/</a></li>
<li><a href="http://bundler.io/v1.12/man/bundle-gem.1.html">bundle gem</a></li>
<li><a href="http://guides.rubygems.org/make-your-own-gem/">MAKE YOUR OWN GEM</a></li>
<li><a href="http://blog.jex.tw/blog/2013/11/29/ruby-build-own-gem/">Ruby 建立自己的 Gem 套件</a></li>
<li><a href="https://quickleft.com/blog/engineering-lunch-series-step-by-step-guide-to-building-your-first-ruby-gem/">Step-by-Step Guide to Building Your First Ruby Gem</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cucumber]]></title>
    <link href="http://mgleon08.github.com/blog/2016/08/30/cucumber/"/>
    <updated>2016-08-30T10:23:07+08:00</updated>
    <id>http://mgleon08.github.com/blog/2016/08/30/cucumber</id>
    <content type="html"><![CDATA[<p>BDD 行為驅動開發工具</p>

<!-- more -->


<ul>
<li>Behavior Driven Development BDD 行為驅動開發工具</li>
<li>Cucumber 通過 Gherkin 語言来描述語句</li>
</ul>


<h3>好處</h3>

<ul>
<li>會說話的程式碼</li>
<li>用口語方式寫測試</li>
<li>讓溝通更順暢</li>
<li>使用人類的語言來描述程式行為</li>
<li>明確溝通需求</li>
<li>測試即文件</li>
<li>消除落差</li>
<li>留作紀錄</li>
</ul>


<h3>Usage</h3>

<p>描述行為</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Feature</span> <span class="p">(</span><span class="err">功能</span><span class="p">)</span>             <span class="c1">#功能說明, 使用情境</span>
</span><span class='line'>  <span class="no">Scenario</span><span class="p">(</span><span class="err">場景，劇本</span><span class="p">)</span>    <span class="c1">#操作方式 特定流程</span>
</span><span class='line'>      <span class="no">Step</span>    <span class="p">(</span><span class="err">步驟</span><span class="p">)</span>      <span class="c1">#操作步驟</span>
</span><span class='line'>      <span class="no">Given</span>   <span class="p">(</span><span class="err">假設</span><span class="p">)</span>      <span class="c1">#前情提要, 初始化</span>
</span><span class='line'>      <span class="no">And</span>     <span class="p">(</span><span class="err">並且</span><span class="p">)</span>      <span class="c1">#更多前情提要</span>
</span><span class='line'>      <span class="no">When</span>    <span class="p">(</span><span class="err">當</span><span class="p">)</span>        <span class="c1">#執行動作</span>
</span><span class='line'>      <span class="no">And</span>     <span class="p">(</span><span class="err">並且</span><span class="p">)</span>      <span class="c1">#更多動作 </span>
</span><span class='line'>      <span class="no">Then</span>    <span class="p">(</span><span class="err">那麼</span><span class="p">)</span>      <span class="c1">#預期結果</span>
</span><span class='line'>      <span class="no">And</span>     <span class="p">(</span><span class="err">並且</span><span class="p">)</span>      <span class="c1">#更多結果</span>
</span></code></pre></td></tr></table></div></figure>


<h3>撰寫測試</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#features/cucumber.feature</span>
</span><span class='line'><span class="ss">Feature</span><span class="p">:</span>
</span><span class='line'>  <span class="no">Add</span> <span class="n">two</span> <span class="n">number</span>
</span><span class='line'>
</span><span class='line'>  <span class="ss">Scenario</span><span class="p">:</span> <span class="no">Add</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">2</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">3</span>
</span><span class='line'>  <span class="no">Given</span> <span class="n">the</span> <span class="n">first</span> <span class="n">number</span> <span class="n">is</span> <span class="mi">1</span>
</span><span class='line'>  <span class="no">And</span> <span class="n">the</span> <span class="n">second</span> <span class="n">numner</span> <span class="n">is</span> <span class="mi">2</span>
</span><span class='line'>  <span class="no">When</span> <span class="n">calculate</span> <span class="n">two</span> <span class="n">number</span>
</span><span class='line'>  <span class="no">Then</span> <span class="n">result</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#features/step_definitions/interaction_steps.rb</span>
</span><span class='line'><span class="no">Given</span><span class="p">(</span><span class="sr">/^the first number is (\d+)$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">num1</span><span class="o">|</span>
</span><span class='line'>  <span class="vi">@num1</span> <span class="o">=</span> <span class="n">num1</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Given</span><span class="p">(</span><span class="sr">/^the second numner is (\d+)$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">num2</span><span class="o">|</span>
</span><span class='line'>  <span class="vi">@num2</span> <span class="o">=</span> <span class="n">num2</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">When</span><span class="p">(</span><span class="sr">/^calculate two number$/</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="vi">@sum</span> <span class="o">=</span> <span class="vi">@num1</span> <span class="o">+</span> <span class="vi">@num2</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">Then</span><span class="p">(</span><span class="sr">/^result should be (\d+)$/</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">result</span><span class="o">|</span>
</span><span class='line'>  <span class="vi">@sum</span><span class="o">.</span><span class="n">should</span> <span class="o">===</span> <span class="n">result</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">console</span>
</span><span class='line'><span class="ss">Feature</span><span class="p">:</span>
</span><span class='line'>  <span class="no">Add</span> <span class="n">two</span> <span class="n">number</span>
</span><span class='line'>
</span><span class='line'>  <span class="ss">Scenario</span><span class="p">:</span> <span class="no">Add</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">2</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">3</span> <span class="c1"># features/command_options.feature:4</span>
</span><span class='line'>    <span class="no">Given</span> <span class="n">the</span> <span class="n">first</span> <span class="n">number</span> <span class="n">is</span> <span class="mi">1</span>     <span class="c1"># features/step_definitions/interaction_steps.rb:1</span>
</span><span class='line'>    <span class="no">And</span> <span class="n">the</span> <span class="n">second</span> <span class="n">numner</span> <span class="n">is</span> <span class="mi">2</span>      <span class="c1"># features/step_definitions/interaction_steps.rb:5</span>
</span><span class='line'>    <span class="no">When</span> <span class="n">calculate</span> <span class="n">two</span> <span class="n">number</span>       <span class="c1"># features/step_definitions/interaction_steps.rb:9</span>
</span><span class='line'>    <span class="no">Then</span> <span class="n">result</span> <span class="n">should</span> <span class="n">be</span> <span class="mi">3</span>         <span class="c1"># features/step_definitions/interaction_steps.rb:13</span>
</span><span class='line'>
</span><span class='line'><span class="mi">1</span> <span class="n">scenario</span> <span class="p">(</span><span class="mi">1</span> <span class="n">passed</span><span class="p">)</span>
</span><span class='line'><span class="mi">4</span> <span class="n">steps</span> <span class="p">(</span><span class="mi">4</span> <span class="n">passed</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>產表工具</h3>

<p>cucumber-html-report</p>

<h3>測試涵蓋率</h3>

<p>Istanbul</p>

<p>參考文件：</p>

<ul>
<li><a href="https://github.com/cucumber/cucumber">cucumber github</a></li>
<li><a href="https://cucumber.io/">cucumber.io</a></li>
<li><a href="http://teddy-chen-tw.blogspot.tw/2013/07/bdd2cucumber.html">搞笑談軟工: BDD（2）：大家來吃小黃瓜之Cucumber運作原理</a></li>
<li><a href="http://icodeit.org/2012/05/cucumber%E7%AE%80%E4%BB%8B/">Cucumber简介</a></li>
<li><a href="http://insights.thoughtworkers.org/bdd/">醒醒吧少年，只用CUCUMBER不能帮助你BDD</a></li>
<li><a href="https://ruby-china.org/topics/7119">Cucumber 经验总结</a></li>
<li><a href="http://www.cnblogs.com/davenkin/archive/2012/02/03/cucumber-watir-in-10-minutes.html">10分钟学会 Cucumber+Watir 自动化测试框架</a></li>
<li><a href="https://danielzhangqinglong.github.io/2015/03/02/rails-test-samples/">在实际开发中使用RSpec和Cucumber进行TDD/BDD测试</a></li>
<li><a href="http://tauntaunslayer13.me/blog/2014/01/26/ru-he-shi-yong-capybarahe-cucumbershi-xian-ye-mian-ji-bie-zi-dong-hua/">如何使用Capybara和Cucumber实现页面级别自动化</a></li>
<li><a href="http://tauntaunslayer13.me/blog/2014/03/12/cucumberxiao-huang-gua-ye-mian-ji-zi-dong-hua-ce-shi-ru-men-jiao-cheng/">Cucumber小黄瓜页面级自动化测试入门教程</a></li>
<li><a href="https://hackmd.io/p/Bk7gPjMA#/">BDD 實戰經驗分享 MarsZ</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
